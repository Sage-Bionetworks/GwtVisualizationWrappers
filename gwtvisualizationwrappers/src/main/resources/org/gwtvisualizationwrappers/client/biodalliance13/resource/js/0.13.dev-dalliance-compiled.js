(function e$$0(u,t,n){function l(p,x){if(!t[p]){if(!u[p]){var C="function"==typeof require&&require;if(!x&&C)return C(p,!0);if(k)return k(p,!0);throw Error("Cannot find module '"+p+"'");}C=t[p]={exports:{}};u[p][0].call(C.exports,function(b){var a=u[p][1][b];return l(a?a:b)},C,C.exports,e$$0,u,t,n)}return t[p].exports}for(var k="function"==typeof require&&require,q=0;q<n.length;q++)l(n[q]);return l})({1:[function(c,u,t){function n(){}function l(a,b,g,d,e){a.slice(0,10).fetch(function(h){return h?
k(a,b,g,d,e):d(null,"Couldn't access BAM.")},{timeout:5E3})}function k(b,A,f,d,e){function h(e){if(!e)return d(null,"Couldn't access BAM");e=g(e,e.byteLength);e=new Uint8Array(e);var h=p(e,0);if(21840194!=h)return d(null,"Not a BAM file, magic=0x"+h.toString(16));for(var a=p(e,4),b="",h=0;h<a;++h)b+=String.fromCharCode(e[h+8]);b=p(e,a+8);a+=12;y.chrToIndex={};y.indexToChr=[];for(h=0;h<b;++h){for(var r=p(e,a),A="",f=0;f<r-1;++f)A+=String.fromCharCode(e[a+4+f]);p(e,a+r+4);y.chrToIndex[A]=h;0==A.indexOf("chr")?
y.chrToIndex[A.substring(3)]=h:y.chrToIndex["chr"+A]=h;y.indexToChr.push(A);a=a+8+r}if(y.indices)return d(y)}var y=new n;y.data=b;y.bai=A;y.indexChunks=f;var B=y.indexChunks?y.indexChunks.minBlockIndex:1E9;if(y.indexChunks){A=y.indexChunks.chunks;y.indices=[];for(var r=0;r<A.length;r++)y.indices[r]=null;y.data.slice(0,B).fetch(h)}else y.bai.fetch(function(r){var A,g,m;if(r){var v=new Uint8Array(r),z=p(v,0);if(21578050!=z)r=d(null,"Not a BAI file, magic=0x"+z.toString(16));else{z=p(v,4);y.indices=
[];for(var C=8,G=0;G<z;++G){var N=C;A=v;var w=m=N;g=p(A,w);for(var w=w+4,E=0;E<g;++E){p(A,w);var U=p(A,w+4),w=w+(8+16*U)}for(var E=p(A,w),w=w+4,U=1E9,c=w,L=0;L<E;++L){var x=a(A,c),c=c+8;if(x){A=x.block;0<x.offset&&(A+=65536);A<U&&(U=A);break}}w+=8*E;A=U;m=w-m;C+=m;B=Math.min(A,B);0<g&&(y.indices[G]=new Uint8Array(r,N,C-N))}r=!0}}else r="Couldn't access BAI";!0!==r?y.bai.url&&"undefined"===typeof e?(y.bai.url=y.data.url.replace(/.bam$/,".bai"),k(b,y.bai,f,d,!0)):d(null,r):y.data.slice(0,B).fetch(h)})}
function q(){}if("undefined"!==typeof c){c("./spans");t=c("./bin");var p=t.readInt,x=t.readShort,C=t.readByte,b=t.readFloat;c=c("./lh3utils");var a=c.readVob,g=c.unbgzf,f=c.reg2bins,v=c.Chunk}c={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};n.prototype.blocksForRange=function(b,A,g){var d=this.indices[b];if(!d)return[];
b=f(A,g);for(var e=[],h=0;h<b.length;++h)e[b[h]]=!0;b=[];for(var y=[],h=p(d,0),B=4,r=0;r<h;++r){var m=p(d,B),H=p(d,B+4),B=B+8;if(e[m])for(var z=0;z<H;++z){var I=a(d,B),C=a(d,B+8);(4681>m?y:b).push(new v(I,C));B+=16}else B+=16*H}h=p(d,B);e=null;A=Math.min(A>>14,h-1);g=Math.min(g>>14,h-1);for(h=A;h<=g;++h)(A=a(d,B+4+8*h))&&(!e||A.block<e.block||A.offset<e.offset)&&(e=A);d=[];if(null!=e)for(h=0;h<y.length;++h)g=y[h],g.maxv.block>=e.block&&g.maxv.offset>=e.offset&&d.push(g);y=d;d=[];for(h=0;h<y.length;++h)d.push(y[h]);
for(h=0;h<b.length;++h)d.push(b[h]);d.sort(function(d,e){var h=d.minv.block-e.minv.block;return 0!=h?h:d.minv.offset-e.minv.offset});b=[];if(0<d.length){y=d[0];for(h=1;h<d.length;++h)g=d[h],g.minv.block==y.maxv.block?y=new v(y.minv,g.maxv):(b.push(y),y=g);b.push(y)}return b};n.prototype.fetch=function(a,b,f,d,e){function h(){if(v>=r.length)return d(H);if(I){var a=new Uint8Array(I),a=y.readBamRecords(a,r[v].minv.offset,H,b,f,B,e);I=null;++v;return a?d(H):h()}var m=r[v],a=m.minv.block;y.data.slice(a,
m.maxv.block+65536-a).fetch(function(d){I=g(d,m.maxv.block-m.minv.block+1);return h()})}var y=this;e=e||{};var B=this.chrToIndex[a],r;if(void 0===B)r=[];else{if(null===this.indices[B]&&this.indexChunks.chunks[B]){var m=this.indexChunks.chunks[B];return this.bai.slice(m[0],m[1]).fetch(function(h){h=new Uint8Array(h);this.indices[B]=h;return this.fetch(a,b,f,d,e)}.bind(this))}(r=this.blocksForRange(B,b,f))||d(null,"Error in index fetch")}var H=[],v=0,I;h()};var z="=ACxGxxxTxxxxxxN".split(""),m="MIDNSHP=X???????".split("");
n.prototype.readBamRecords=function(a,A,g,d,e,h,y){for(;;){var f=p(a,A),f=A+f+4;if(f>=a.length)return!1;var r=new q,D=p(a,A+4),H=p(a,A+8),v=p(a,A+12),I=(v&65280)>>8,k=v&255,v=p(a,A+16),c=(v&4294901760)>>16,l=v&65535,v=p(a,A+20),G=p(a,A+24),N=p(a,A+28);p(a,A+32);r.segment=this.indexToChr[D];r.flag=c;r.pos=H;r.mq=I;y.light&&(r.seqLength=v);if(!y.light){0<=G&&(r.nextSegment=this.indexToChr[G],r.nextPos=N);I="";for(H=0;H<k-1;++H)I+=String.fromCharCode(a[A+36+H]);r.readName=I;A=A+36+k;k="";for(H=0;H<l;++H)I=
p(a,A),k=k+(I>>4)+m[I&15],A+=4;r.cigar=k;l="";k=v+1>>1;for(H=0;H<k;++H)I=a[A+H],l+=z[(I&240)>>4],l.length<v&&(l+=z[I&15]);A+=k;r.seq=l;l="";for(H=0;H<v;++H)l+=String.fromCharCode(a[A+H]+33);A+=v;for(r.quals=l;A<f;){l=String.fromCharCode(a[A],a[A+1]);k=String.fromCharCode(a[A+2]);if("A"==k)k=String.fromCharCode(a[A+3]),A+=4;else if("i"==k||"I"==k)k=p(a,A+3),A+=7;else if("c"==k||"C"==k)k=a[A+3],A+=4;else if("s"==k||"S"==k)k=x(a,A+3),A+=5;else if("f"==k)k=b(a,A+3),A+=7;else if("Z"==k||"H"==k)for(A+=
3,k="";H=a[A++],0!=H;)k+=String.fromCharCode(H);else if("B"==k){k=String.fromCharCode(a[A+3]);H=p(a,A+4);if("i"==k||"I"==k||"f"==k)I=4,c="f"==k?b:p;else if("s"==k||"S"==k)I=2,c=x;else if("c"==k||"C"==k)I=1,c=C;else throw"Unknown array type "+k;A+=8;k=[];for(G=0;G<H;++G)k.push(c(a,A)),A+=I}else throw"Unknown type "+k;r[l]=k}}if(!d||r.pos<=e&&r.pos+v>=d)void 0!==h&&D!=h||g.push(r);if(r.pos>e)return!0;A=f}};"undefined"!==typeof u&&(u.exports={makeBam:l,BAM_MAGIC:21840194,BAI_MAGIC:21578050,BamFlags:c})},
{"./bin":4,"./lh3utils":24,"./spans":36}],2:[function(c,u,t){function n(a){this.type=a}function l(a,b){this.parser=a;this.sink=b}function k(a,b){this.parser=a;this.sink=b;this.wigState=null}if("undefined"!==typeof c){var q=c("./spans"),p=q.Range,x=q.union,C=q.intersection,q=c("./sourceadapters").registerParserFactory;u=c("./das");var b=u.DASStylesheet,a=u.DASStyle,g=u.DASGroup,f=c("./utils").shallowCopy}n.prototype.createSession=function(a){return"wig"==this.type?new k(this,a):new l(this,a)};var v=
/([^=]+)=(.+)/,z=/\s/,m=/^[0-9]+,[0-9]+,[0-9]+/;l.prototype.parse=function(a){var b=a.split(z);if(!(3>b.length)){var v=parseInt(b[1])+1;a=parseInt(b[2]);a={segment:b[0],min:v,max:a};3<b.length&&"."!==b[3]&&(a.label=b[3]);4<b.length&&(a.score=parseFloat(b[4]));5<b.length&&(a.orientation=b[5]);if(8<b.length){var d=b[8];m.test(d)&&(a.itemRgb="rgb("+d+")")}if(12<=b.length){var d=parseInt(b[6]),e=parseInt(b[7]),h=parseInt(b[9]),y=b[10].split(",").map(function(d){return parseInt(d)}),B=b[11].split(",").map(function(d){return parseInt(d)});
a.type="transcript";var r=new g;r.id=b[3];r.type="transcript";r.notes=[];a.groups=[r];if(12<b.length){var D=r=b[12];13<b.length&&(D=b[13]);b=new g;b.id=r;b.label=D;b.type="gene";a.groups.push(b)}b=null;for(r=0;r<h;++r)D=B[r]+v,D=new p(D,D+y[r]),b=b?x(b,D):D;B=b.ranges();for(v=0;v<B.length;++v)y=B[v],h=f(a),h.min=y.min(),h.max=y.max(),this.sink(h);if(e>d&&(d="+"==a.orientation?new p(d,e+3):new p(d-3,e),d=C(b,d)))for(a.type="translation",d=d.ranges(),v=e=0;v<d.length;++v)h=v,"-"==a.orientation&&(h=
d.length-v-1),y=d[h],h=f(a),h.min=y.min(),h.max=y.max(),a.readframe=e,y=y.max()-y.min(),e=(e+y)%3,this.sink(h)}else this.sink(a)}};l.prototype.flush=function(){};k.prototype.parse=function(a){a=a.split(z);if("fixedStep"==a[0]){this.wigState="fixedStep";this.chr=this.pos=this.step=null;for(var b=this.span=1;b<a.length;++b){var g=v.exec(a[b]);g&&("chrom"==g[1]?this.chr=g[2]:"start"==g[1]?this.pos=parseInt(g[2]):"step"==g[1]?this.step=parseInt(g[2]):"span"==g[1]&&(this.span=parseInt(g[2])))}}else if("variableStep"==
a[0])for(this.wigState="variableStep",this.chr=null,b=this.span=1;b<a.length;++b)g=v.exec(a[b]),"chrom"==g[1]?this.chr=g[2]:"span"==g[1]&&(this.span=parseInt(g[2]));else this.wigState?"fixedStep"==this.wigState?1==a.length&&(a=parseFloat(a[0]),a={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:a},this.pos+=this.step,this.sink(a)):"variableStep"==this.wigState&&2==a.length&&(b=parseInt(a[0]),a=parseFloat(a[1]),a={segment:this.chr,min:b,max:b+this.span-1,score:a},this.sink(a)):4>a.length||
(a={segment:a[0],min:parseInt(a[1])+1,max:parseInt(a[2]),score:parseFloat(a[3])},this.sink(a))};k.prototype.flush=function(){};n.prototype.getStyleSheet=function(g){var f=new b;if("wig"==this.type){var m=new a;m.glyph="HISTOGRAM";m.BGCOLOR="blue";m.HEIGHT=30;f.pushStyle({type:"default"},null,m)}else m=new a,m.glyph="BOX",m.FGCOLOR="black",m.BGCOLOR="blue",m.HEIGHT=8,m.BUMP=!0,m.LABEL=!0,m.ZINDEX=20,f.pushStyle({type:"default"},null,m),m=new a,m.glyph="BOX",m.FGCOLOR="black",m.BGCOLOR="red",m.HEIGHT=
10,m.BUMP=!0,m.ZINDEX=20,f.pushStyle({type:"translation"},null,m),m=new a,m.glyph="BOX",m.FGCOLOR="black",m.BGCOLOR="white",m.HEIGHT=10,m.ZINDEX=10,m.BUMP=!0,m.LABEL=!0,f.pushStyle({type:"transcript"},null,m),m=new a,m.glyph="HISTOGRAM",m.COLOR1="white",m.COLOR2="black",m.HEIGHT=30,f.pushStyle({type:"density"},null,m);return g(f)};q("bed",function(a){return new n(a)});q("wig",function(a){return new n(a)})},{"./das":10,"./sourceadapters":34,"./spans":36,"./utils":49}],3:[function(c,u,t){function n(a,
b){return a[b]+256*a[b+1]+65536*a[b+2]+16777216*a[b+3]+4294967296*a[b+4]}function l(){}function k(a,b,d,e){this.bwg=a;this.cirTreeOffset=b;this.cirTreeLength=d;this.isSummary=e}function q(a,b,d){var e=new l;e.data=a;e.name=d;e.data.slice(0,512).salted().fetch(function(d){if(!d)return b(null,"Couldn't fetch file");var a=new Uint8Array(d),g=new Int16Array(d);d=new Int32Array(d);var r=a[0]+256*a[1]+65536*a[2]+16777216*a[3];if(2291137574==r)e.type="bigwig";else if(2273964779==r)e.type="bigbed";else return 654086024==
r||3958540679==r?b(null,"Currently don't support big-endian BBI files"):b(null,"Not a supported format, magic=0x"+r.toString(16));e.version=g[2];e.numZoomLevels=g[3];e.chromTreeOffset=n(a,8);e.unzoomedDataOffset=n(a,16);e.unzoomedIndexOffset=n(a,24);e.fieldCount=g[16];e.definedFieldCount=g[17];e.asOffset=n(a,36);e.totalSummaryOffset=n(a,44);e.uncompressBufSize=d[13];e.extHeaderOffset=n(a,56);e.zoomLevels=[];for(g=0;g<e.numZoomLevels;++g){var r=d[6*g+16],f=n(a,24*g+72),A=n(a,24*g+80);e.zoomLevels.push({reduction:r,
dataOffset:f,indexOffset:A})}e.readChromTree(function(){e.getAutoSQL(function(d){e.schema=d;return b(e)})})},{timeout:5E3})}function p(a,b,d,e,h){this.bbi=a;this.type=b;this.fieldCount=d;this.offset=e;this.field=h}if("undefined"!==typeof c){t=c("./spans");var x=t.Range,C=t.union,b=t.intersection;t=c("./das");var a=t.DASFeature,g=t.DASGroup,f=c("./utils").shallowCopy,v=c("./bin").readInt;c=c("jszlib");var z=c.inflateBuffer,m=c.arrayCopy}var F=/^[0-9]+,[0-9]+,[0-9]+/;l.prototype.readChromTree=function(a){var b=
this;this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var d=this.unzoomedDataOffset,d=d+4-(d-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,d-this.chromTreeOffset).fetch(function(d){var h=new Uint8Array(d),g=new Int16Array(d),f=(new Int32Array(d))[2];n(h,16);var r=function(d){var a=h[d],e=g[d/2+1];d+=4;for(var A=0;A<e;++A)if(0==a){d+=f;var m=n(h,d);d+=8;m-=b.chromTreeOffset;r(m)}else{for(var m="",v=0;v<f;++v){var k=h[d++];0!=k&&(m+=String.fromCharCode(k))}v=h[d+3]<<24|h[d+2]<<16|
h[d+1]<<8|h[d+0];d+=8;b.chromsToIDs[m]=v;0==m.indexOf("chr")&&(b.chromsToIDs[m.substr(3)]=v);b.idsToChroms[v]=m;b.maxID=Math.max(b.maxID,v)}};r(32);a(b)})};k.prototype.readWigData=function(a,b,d,e){a=this.bwg.chromsToIDs[a];if(void 0===a)return e([]);this.readWigDataById(a,b,d,e)};k.prototype.readWigDataById=function(a,b,d,e){var h=this;if(this.cirHeader){var g=[],f=0;Date.now();var r=function(e,h,r,g){return(0>a||e==a)&&h<=d&&r>=b},m=function(d,a){h.bwg.instrument&&console.log("level="+a+"; offset="+
d+"; time="+(Date.now()|0));f+=d.length;if(1==d.length&&48==d[0]-h.cirTreeOffset&&h.cachedCirRoot)k(h.cachedCirRoot,0,a),--f,0==f&&h.fetchFeatures(r,g,e);else{for(var b=4+32*h.cirBlockSize,m,G=0;G<d.length;++G){var A=new x(d[G],d[G]+b);m=m?C(m,A):A}b=m.ranges();for(m=0;m<b.length;++m)v(d,b[m],a)}},v=function(d,a,b,m){a.max();a.min();h.bwg.data.slice(a.min(),a.max()-a.min()).fetch(function(G){for(var m=0;m<d.length;++m)a.contains(d[m])&&(k(G,d[m]-a.min(),b),48==d[m]-h.cirTreeOffset&&0==d[m]-a.min()&&
(h.cachedCirRoot=G),--f,0==f&&h.fetchFeatures(r,g,e))})},k=function(e,h,r){var f=new Uint8Array(e),G=new Int16Array(e);e=new Int32Array(e);var B=f[h],G=G[h/2+1];h+=4;if(0!=B)for(B=0;B<G;++B){var w=h/4,E=e[w],v=e[w+1],H=e[w+2],w=e[w+3],L=n(f,h+16);r=n(f,h+24);(0>a||E<a||E==a&&v<=d)&&(0>a||H>a||H==a&&w>=b)&&g.push({offset:L,size:r});h+=32}else{for(var k=[],B=0;B<G;++B)w=h/4,E=e[w],v=e[w+1],H=e[w+2],w=e[w+3],L=n(f,h+16),(0>a||E<a||E==a&&v<=d)&&(0>a||H>a||H==a&&w>=b)&&k.push(L),h+=24;0<k.length&&m(k,
r+1)}};m([h.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(r){h.cirHeader=r;r=new Int32Array(h.cirHeader);h.cirBlockSize=r[1];h.readWigDataById(a,b,d,e)})};k.prototype.fetchFeatures=function(b,g,d){var e=this;g.sort(function(d,a){return(d.offset|0)-(a.offset|0)});if(0==g.length)d([]);else{var h=[],f=function(d,b,g,f){f||(f={});var m=new a;m._chromId=d;m.segment=e.bwg.idsToChroms[d];m.min=b;m.max=g;m.type=e.bwg.type;for(var y in f)m[y]=f[y];h.push(m)},B=function(){if(0==
g.length)Date.now(),d(h);else{var a=g[0];if(a.data)e.parseFeatures(a.data,f,b),g.splice(0,1),B();else{for(var D=a.offset,v=a.size,a=1;a<g.length&&g[a].offset==D+v;)v+=g[a].size,++a;e.bwg.data.slice(D,v).fetch(function(d){for(var a=0,h=0;a<v;){var b=g[h],r;0<e.bwg.uncompressBufSize?r=z(d,a+2,b.size-2):(r=new Uint8Array(b.size),m(new Uint8Array(d,a,b.size),0,r,0,b.size),r=r.buffer);b.data=r;a+=b.size;++h}B()})}}};B()}};k.prototype.parseFeatures=function(a,m,d){var e=new Uint8Array(a);if(this.isSummary)for(var h=
new Int16Array(a),y=new Int32Array(a),B=new Float32Array(a),e=a.byteLength/32,h=0;h<e;++h){a=y[8*h];var r=y[8*h+1],D=y[8*h+2],v=y[8*h+3],k=B[8*h+5],z=B[8*h+6];d(a,r+1,D)&&(v={type:"bigwig",score:z/v,maxScore:k},"bigbed"==this.bwg.type&&(v.type="density"),m(a,r+1,D,v))}else if("bigwig"==this.bwg.type)if(h=new Int16Array(a),y=new Int32Array(a),B=new Float32Array(a),a=y[0],k=y[1],z=y[3],v=y[4],r=e[20],e=h[11],3==r)for(h=0;h<e;++h){var c=B[h+6],y=k+h*z+1,r=k+h*z+v;d(a,y,r)&&m(a,y,r,{score:c})}else if(2==
r)for(h=0;h<e;++h)r=y[2*h+6]+1,D=r+v-1,c=B[2*h+7],d(a,r,D)&&m(a,r,D,{score:c});else if(1==r)for(h=0;h<e;++h)r=y[3*h+6]+1,D=y[3*h+7],c=B[3*h+8],r>D&&(r=D),d(a,r,D)&&m(a,r,D,{score:c});else console.log("Currently not handling bwgType="+r);else if("bigbed"==this.bwg.type)for(h=0,v=this.bwg.definedFieldCount,k=this.bwg.schema;h<e.length;){a=e[h+3]<<24|e[h+2]<<16|e[h+1]<<8|e[h+0];r=e[h+7]<<24|e[h+6]<<16|e[h+5]<<8|e[h+4];D=e[h+11]<<24|e[h+10]<<16|e[h+9]<<8|e[h+8];h+=12;for(c="";;)if(z=e[h++],0!=z)c+=String.fromCharCode(z);
else break;var z={},l;l=0<c.length?c.split("\t"):[];0<l.length&&3<v&&(z.label=l[0]);1<l.length&&4<v&&(c=parseInt(l[1]),isNaN(c)||(z.score=c));2<l.length&&5<v&&(z.orientation=l[2]);5<l.length&&8<v&&(c=l[5],F.test(c)&&(z.itemRgb="rgb("+c+")"));if(l.length>v-3&&k)for(c=v-3;c<l.length;++c)z[k.fields[c+3].name]=l[c];if(d(a,r+1,D,l))if(12>v)m(a,r+1,D,z);else{var c=l[3]|0,p=l[4]|0,G=l[6]|0,N=l[7].split(","),w=l[8].split(",");z.exonFrames&&(B=z.exonFrames.split(","),z.exonFrames=void 0);z.type="transcript";
var E=new g;for(y in z)E[y]=z[y];E.id=l[0];E.segment=this.bwg.idsToChroms[a];E.min=r+1;E.max=D;E.notes=[];z.groups=[E];if(9<l.length){var U=D=z.geneName||l[9];10<l.length&&(U=l[10]);z.geneName2&&(U=z.geneName2);l=f(E);l.id=D;l.label=U;l.type="gene";z.groups.push(l)}D=[];for(l=0;l<G;++l)E=(w[l]|0)+r,E=new x(E,E+(N[l]|0)),D.push(E);N=C(D);G=N.ranges();for(r=0;r<G.length;++r)D=G[r],m(a,D.min()+1,D.max(),z);if(p>c&&(r="+"==z.orientation?new x(c,p+3):new x(c-3,p),r=b(N,r))){z.type="translation";c=r.ranges();
for(N=p=0;c[0].min()>G[N].max();)N++;for(r=0;r<c.length;++r)G=r,"-"==z.orientation&&(G=c.length-r-1),D=c[G],z.readframe=p,B&&(G=parseInt(B[G+N]),"number"===typeof G&&0<=G&&2>=G&&(z.readframe=G,z.readframeExplicit=!0)),G=D.max()-D.min(),p=(p+G)%3,m(a,D.min()+1,D.max(),z)}}}else throw Error("Don't know what to do with "+this.bwg.type);};k.prototype.getFirstAdjacent=function(a,b,d,e){a=this.bwg.chromsToIDs[a];if(void 0===a)return e([]);this.getFirstAdjacentById(a,b,d,e)};k.prototype.getFirstAdjacentById=
function(a,b,d,e){var h=this;if(this.cirHeader){var g=null,f=-1,r=-1,m=0;Date.now();var v=function(d,a){m+=d.length;for(var e=4+32*h.cirBlockSize,b,r=0;r<d.length;++r){var w=new x(d[r],d[r]+e);b=b?C(b,w):w}e=b.ranges();for(b=0;b<e.length;++b)z(d,e[b],a)},z=function(r,f,B,G){f.max();f.min();h.bwg.data.slice(f.min(),f.max()-f.min()).fetch(function(G){for(var w=0;w<r.length;++w)if(f.contains(r[w])&&(k(G,r[w]-f.min(),B),--m,0==m)){if(!g)return 0<d&&(0!=a||0<b)?h.getFirstAdjacentById(0,0,d,e):0>d&&(a!=
h.bwg.maxID||1E9>b)?h.getFirstAdjacentById(h.bwg.maxID,1E9,d,e):e([]);h.fetchFeatures(function(w,e,h,G){return 0>d&&(w<a||h<b)||0<d&&(w>a||e>b)},[g],function(w){for(var a=null,h=-1,b=-1,G=0;G<w.length;++G){var r=w[G],g=r._chromId,f=r.min,m=r.max;if(null==a||0>d&&(g>h||m>b)||0<d&&(g<h||f<b))a=r,b=0>d?m:f,h=g}return null!=a?e([a]):e([])})}})},k=function(e,m,D){var G=new Uint8Array(e),N=new Int16Array(e);e=new Int32Array(e);var w=G[m],N=N[m/2+1];m+=4;if(0!=w)for(w=0;w<N;++w){var E=m/4,z=e[E],k=e[E+1],
L=e[E+2],c=e[E+3],E=n(G,m+16);D=n(G,m+24);(0>d&&(z<a||z==a&&k<=b)||0<d&&(L>a||L==a&&c>=b))&&!/_random/.exec(h.bwg.idsToChroms[z])&&(null==g||0>d&&(L>f||L==f&&c>r)||0<d&&(z<f||z==f&&k<r))&&(g={offset:E,size:D},r=0>d?c:k,f=0>d?L:z);m+=32}else{for(var F=G=-1,w=0;w<N;++w){E=m/4;z=e[E];k=e[E+1];L=e[E+2];c=e[E+3];E=e[E+4]<<32|e[E+5];if(0>d&&(z<a||z==a&&k<=b)&&L>=a||0<d&&(L>a||L==a&&c>=b)&&z<=a)if(0>G||c>F)G=E,F=0>d?c:k;m+=24}0<=G&&v([G],D+1)}};v([h.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,
48).fetch(function(r){h.cirHeader=r;r=new Int32Array(h.cirHeader);h.cirBlockSize=r[1];h.getFirstAdjacentById(a,b,d,e)})};l.prototype.readWigData=function(a,b,d,e){this.getUnzoomedView().readWigData(a,b,d,e)};l.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new k(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};l.prototype.getZoomedView=function(a){a=this.zoomLevels[a];
a.view||(a.view=new k(this,a.indexOffset,4E3,!0));return a.view};l.prototype._tsFetch=function(a,b,d,e,h){var g=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var f=[],r=this.topLevelReductionCache,m=0;m<r.length;++m)r[m]._chromId==b&&f.push(r[m]);return h(f)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(r){g.topLevelReductionCache=r;return g._tsFetch(a,b,d,e,h)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(b,
d,e,h)};l.prototype.thresholdSearch=function(a,b,d,e,h){function g(){if(0==r.length)return h(null);r.sort(function(a,e){var b=a.zoom-e.zoom;if(0!=b)return b;b=a.chrOrd-e.chrOrd;return 0!=b?b:a.min-e.min*d});var a=r.splice(0,1)[0];f._tsFetch(a.zoom,a.chr,a.min,a.max,function(f){var m=0<d?0:3E8;a.fromRef&&(m=b);for(var B=0;B<f.length;++B){var v=f[B],G;G=void 0!=v.maxScore?v.maxScore:v.score;if(0<d){if(G>e)if(0>a.zoom){if(v.min>m)return h(v)}else v.max>m&&r.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-
2,min:v.min,max:v.max,fromRef:a.fromRef})}else if(G>e)if(0>a.zoom){if(v.max<m)return h(v)}else v.min<m&&r.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,min:v.min,max:v.max,fromRef:a.fromRef})}g()})}d=0>d?-1:1;var f=this;a=this.chromsToIDs[a];for(var r=[{chrOrd:0,chr:a,zoom:f.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],m=1;m<=this.maxID+1;++m){var v=(a+d*m)%(this.maxID+1);0>v&&(v+=this.maxID+1);r.push({chrOrd:m,chr:v,zoom:f.zoomLevels.length-1,min:0,max:3E8})}g()};l.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);
this.data.slice(this.asOffset,2048).fetch(function(b){var d=new Uint8Array(b);b="";for(var e=0;e<d.length&&0!=d[e];++e)b+=String.fromCharCode(d[e]);var d=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,h=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(b);if(h){e={declType:h[1],name:h[2],comment:h[4],fields:[]};b=b.substring(h[0]);for(h=d.exec(b);null!=h;h=d.exec(b))e.fields.push({type:h[1],name:h[2],comment:h[4]});return a(e)}})};l.prototype.getExtraIndices=function(a){var b=this;if(4>this.version||0==this.extHeaderOffset||
"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(d){if(!d)return a(null,"Couldn't fetch extension header");var e=new Uint8Array(d),h=new Int16Array(d);new Int32Array(d);var g=h[1];d=n(e,4);if(0==g)return a(null);b.data.slice(d,20*g).fetch(function(d){if(!d)return a(null,"Couldn't fetch index info");var e=new Uint8Array(d),h=new Int16Array(d);new Int32Array(d);d=[];for(var f=0;f<g;++f){var m=h[10*f],v=h[10*f+1],z=n(e,20*f+4),m=new p(b,m,v,z,h[10*f+8]);d.push(m)}a(d)})})};
p.prototype.lookup=function(a,b){var d=this;this.bbi.data.slice(this.offset,32).fetch(function(e){function h(e){d.bbi.data.slice(e,4+f*(r+m)).fetch(function(e){var g=new Uint8Array(e),f=new Uint16Array(e);new Uint32Array(e);f=f[1];e=4;if(0==g[0]){for(var y=null,B=0;B<f;++B){for(var G="",N=0;N<r;++N){var w=g[e++];0!=w&&(G+=String.fromCharCode(w))}N=n(g,e);e+=8;if(0>a.localeCompare(G)&&y){h(y);return}y=N}h(y)}else{for(B=0;B<f;++B){G="";for(N=0;N<r;++N)w=g[e++],0!=w&&(G+=String.fromCharCode(w));if(G==
a)return f=n(g,e),g=v(g,e+8),d.bbi.getUnzoomedView().fetchFeatures(function(w,e,b,h){if(h&&h.length>d.field-3)return h[d.field-3]==a},[{offset:f,size:g}],b);e+=m}return b([])}})}var g=new Uint8Array(e);new Int16Array(e);e=new Int32Array(e);var f=e[1],r=e[2],m=e[3];n(g,16);h(d.offset+32)})};"undefined"!==typeof u&&(u.exports={makeBwg:q,BIG_BED_MAGIC:2273964779,BIG_WIG_MAGIC:2291137574})},{"./bin":4,"./das":10,"./spans":36,"./utils":49,jszlib:65}],4:[function(c,u,t){function n(a){this.blob=a}function l(a,
b,g,f){f||("object"===typeof b?(f=b,b=void 0):f={});this.url=a;this.start=b||0;g&&(this.end=g);this.opts=f}function k(a){if(!a)return null;for(var b=new Uint8Array(a.length),g=0;g<b.length;++g)b[g]=a.charCodeAt(g);return b.buffer}function q(a,b){return a[b+7]<<24|a[b+6]<<16|a[b+5]<<8|a[b+4]}function p(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function x(a,b){return a[b+1]<<8|a[b]}function C(a,b){return a[b]}function b(a,b){return a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3]}if("undefined"!==typeof c)var a=
c("./utils").shallowCopy,g=c("./sha1").b64_sha1,f=c("es6-promise").Promise;n.prototype.slice=function(a,b){var g;g=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,a+b):this.blob.webkitSlice(a);return new n(g)};n.prototype.salted=function(){return this};n.prototype.fetch="undefined"!==typeof FileReader?function(a){var b=new FileReader;b.onloadend=function(g){a(k(b.result))};b.readAsBinaryString(this.blob)}:function(a){var b=new FileReaderSync;try{var g=b.readAsArrayBuffer(this.blob);
a(g)}catch(f){a(null,f)}};l.prototype.slice=function(a,b){if(0>a)throw"Bad slice "+a;var g=this.start,f=this.end,g=g&&a?g+a:a||g;return new l(this.url,g,b&&g?g+b-1:f||b-1,this.opts)};var v=0,z=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");l.prototype.fetchAsText=function(a){var b=this;this.getURL().then(function(f){try{var k=new XMLHttpRequest;(z||b.opts.salt)&&0>f.indexOf("?")&&(f=f+"?salt="+g(""+Date.now()+","+ ++v));k.open("GET",f,!0);if(b.end){if(1E8<b.end-
b.start)throw"Monster fetch!";k.setRequestHeader("Range","bytes="+b.start+"-"+b.end)}k.onreadystatechange=function(){if(4==k.readyState)return 200==k.status||206==k.status?a(k.responseText):a(null)};b.opts.credentials&&(k.withCredentials=!0);k.send("")}catch(d){return a(null)}}).catch(function(b){console.log(b);return a(null,b)})};l.prototype.salted=function(){var b=a(this.opts);b.salt=!0;return new l(this.url,this.start,this.end,b)};l.prototype.getURL=function(){return this.opts.resolver?this.opts.resolver(this.url).then(function(a){return"string"===
typeof a?a:a.url}):f.resolve(this.url)};l.prototype.fetch=function(a,b){var f=this;b=b||{};var c=b.attempt||1,d=b.truncatedLength;if(3<c)return a(null);this.getURL().then(function(e){try{var h;b.timeout&&!f.opts.credentials&&(h=setTimeout(function(){console.log("timing out "+e);y.abort();return a(null,"Timeout")},b.timeout));var y=new XMLHttpRequest,B;(z||f.opts.salt)&&0>e.indexOf("?")&&(e=e+"?salt="+g(""+Date.now()+","+ ++v));y.open("GET",e,!0);y.overrideMimeType("text/plain; charset=x-user-defined");
if(f.end){if(1E8<f.end-f.start)throw"Monster fetch!";y.setRequestHeader("Range","bytes="+f.start+"-"+f.end);B=f.end-f.start+1}y.responseType="arraybuffer";y.onreadystatechange=function(){if(4==y.readyState){h&&clearTimeout(h);if(200==y.status||206==y.status){if(y.response){var b=y.response.byteLength;return!B||B==b||d&&b==d?a(y.response):f.fetch(a,{attempt:c+1,truncatedLength:b})}if(y.mozResponseArrayBuffer)return a(y.mozResponseArrayBuffer);b=y.responseText;return!B||B==b.length||d&&b.length==d?
a(k(y.responseText)):f.fetch(a,{attempt:c+1,truncatedLength:b.length})}return f.fetch(a,{attempt:c+1})}};f.opts.credentials&&(y.withCredentials=!0);y.send("")}catch(r){return a(null)}}).catch(function(d){console.log(d);return a(null,d)})};(function(a){var b=new ArrayBuffer(8),g=new Uint8Array(b),f=new Float32Array(b);a.readFloat=function(d,a){g[0]=d[a];g[1]=d[a+1];g[2]=d[a+2];g[3]=d[a+3];return f[0]}})(this);"undefined"!==typeof u&&(u.exports={BlobFetchable:n,URLFetchable:l,readInt:p,readIntBE:b,
readInt64:q,readShort:x,readByte:C,readFloat:this.readFloat})},{"./sha1":33,"./utils":49,"es6-promise":53}],5:[function(c,u,t){function n(k){var c="bp";1E9<k?(k/=1E9,c="Gb"):1E6<k?(k/=1E6,c="Mb"):1E3<k&&(k/=1E3,c="kb");return""+Math.round(k)+c}if("undefined"!==typeof c){var l=c("./cbrowser").Browser,k=c("./utils").makeElement,q=c("./numformats").formatLongInt,p=c("./zoomslider");c("./tier-edit");c("./export-config");c("./export-ui");c("./export-image");c("./svg-export");c("./session")}l.prototype.initUI=
function(c,l){this.noSourceCSS||["bootstrap-scoped.css","dalliance-scoped.css","font-awesome.min.css"].forEach(function(d){document.head.appendChild(k("link","",{rel:"stylesheet",href:this.resolveURL("$$css/"+d)}))}.bind(this));var b=this;b.disableDefaultFeaturePopup||this.addFeatureListener(function(d,a,e,h){b.featurePopup(d,a,e,h)});c.classList.add("dalliance");var a=b.toolbar=k("div",null,{className:"btn-toolbar toolbar"}),g=b.coordSystem.speciesName+" "+b.nameForCoordSystem(b.coordSystem);this.setDocumentTitle&&
(document.title=g+" :: dalliance");var f=k("input","",{className:"loc-field"});b.makeTooltip(f,"Enter a genomic location or gene name");var v=k("p","",{className:"loc-status"}),z=k("a",[k("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),m=new p({width:b.zoomSliderWidth});b.makeTooltip(m,"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).");var F=k("a",[k("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),A=k("a",
[k("i",null,{className:"fa fa-eraser"})],{className:"btn"}),T=k("a",[k("i",null,{className:"fa fa-plus"})],{className:"btn"}),d=k("a",[k("i",null,{className:"fa fa-bookmark"})],{className:"btn"}),e=k("a",[k("i",null,{className:"fa fa-print"})],{className:"btn"});k("a",[k("i",null,{className:"fa fa-refresh"})],{className:"btn"});var h=k("a",[k("i",null,{className:"fa fa-cogs"})],{className:"btn"}),y=k("a",[k("i",null,{className:"fa fa-question"})],{className:"btn"}),B=k("a",[k("i",null,{className:"fa fa-road"})],
{className:"btn"});b.makeTooltip(B,"Configure currently selected track(s) (E)");var r=k("a",[k("i",null,{className:"fa fa-angle-left"})],{className:"btn"},{width:"5px"}),D=k("a",[k("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),H=k("div",null,{className:"btn-group pull-right"});this.noTrackAdder||H.appendChild(T);this.noTrackEditor||H.appendChild(B);this.noExport||H.appendChild(e);this.noOptions||H.appendChild(h);this.noHelp||H.appendChild(y);this.setUiMode=
function(d){this.uiMode=d;var a={help:y,add:T,opts:h,"export":e,tier:B},b;for(b in a)b==d?a[b].classList.add("active"):a[b].classList.remove("active")};this.noLeapButtons||a.appendChild(D);H.firstChild&&a.appendChild(H);this.noLeapButtons||a.appendChild(r);this.noTitle||a.appendChild(k("div",k("h4",g,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||a.appendChild(k("div",[f,v],{className:"btn-group loc-group"}));this.noClearHighlightsButton||a.appendChild(A);this.noZoomSlider||
a.appendChild(k("div",[z,k("span",m,{className:"btn"}),F],{className:"btn-group"}));this.toolbarBelow?(c.appendChild(l),c.appendChild(a)):(c.appendChild(a),c.appendChild(l));var W=Math.log(2)/Math.log(10),I=Math.log(5)/Math.log(10),t=function(d){var a=(d/b.zoomExpt+Math.log(b.zoomBase))/Math.log(10);d=a|0;a-=d;return((.01>a?d:a<=W+.01?d+W:a<=I+.01?d+I:d+1)*Math.log(10)-Math.log(b.zoomBase))*b.zoomExpt},J=function(d){m.addLabel(d,n(Math.exp(d/b.zoomExpt)*b.zoomBase))};this.addViewListener(function(d,
a,e,h,g){f.value=d+":"+q(a)+".."+q(e);m.min=g.min|0;m.max=g.max|0;g.isSnapZooming?(m.value=g.alternate,m.value2=g.current,m.active=2):(m.value=g.current,m.value2=g.alternate,m.active=1);g.current==g.min?z.classList.add("disabled"):z.classList.remove("disabled");g.current==g.max?F.classList.add("disabled"):F.classList.remove("disabled");m.removeLabels();d=g.min;g=g.max;a=g-d;e=4;b.zoomSliderWidth&&150>b.zoomSliderWidth&&(e=3);J(t(d));for(h=1;h<e-1;++h)J(t(d+1*h*a/(e-1)));J(t(g));b.storeStatus&&b.storeViewStatus();
A.style.display=0<b.highlights.length?"inline-block":"none"});this.addTierListener(function(){b.storeStatus&&b.storeTierStatus()});f.addEventListener("keydown",function(d){40==d.keyCode&&(d.preventDefault(),d.stopPropagation(),b.setSelectedTier(0));if(10==d.keyCode||13==d.keyCode)d.preventDefault(),b.search(f.value,function(d){v.textContent=d?""+d:""})},!1);var u;T.addEventListener("click",function(d){u&&u.displayed?b.removeAllPopups():u=b.showTrackAdder(d)},!1);b.makeTooltip(T,"Add a new track from the registry or an indexed file. (A)");
z.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();b.zoomStep(-10)},!1);b.makeTooltip(z,"Zoom in (+)");F.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();b.zoomStep(10)},!1);b.makeTooltip(F,"Zoom out (-)");m.addEventListener("change",function(d){d=2==m.active;d!=b.isSnapZooming&&(b.savedZoom=b.zoomSliderValue-b.zoomMin,b.isSnapZooming=d);d=1==m.active?m.value:m.value2;b.zoomSliderValue=1*d;b.zoom(Math.exp(1*d/b.zoomExpt))},!1);d.addEventListener("click",
function(d){d.stopPropagation();d.preventDefault()},!1);b.makeTooltip(d,"Favourite regions");e.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();b.openExportPanel()},!1);b.makeTooltip(e,"Export publication-quality SVG. (X)");h.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();b.toggleOptsPopup(d)},!1);b.makeTooltip(h,"Configure options.");y.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();b.toggleHelpPopup(d)});b.makeTooltip(y,
"Help; Keyboard shortcuts. (H)");B.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();1==b.selectedTiers.length&&b.openTierPanel(b.tiers[b.selectedTiers[0]])},!1);r.addEventListener("click",function(d){b.leap(b.reverseKeyScrolling?-1:1,!1)},!1);b.makeTooltip(r,function(d){d=b.getSelectedTier();var a;0<=d&&(a=b.tiers[d]);return a&&a.featureSource&&b.sourceAdapterIsCapable(a.featureSource,"quantLeap")&&"number"==typeof a.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+
(a.config.name||a.dasSource.name)+'"" (ctrl+LEFT)':a&&a.featureSource&&b.sourceAdapterIsCapable(a.featureSource,"leap")?'Jump to the next feature in the selected track "'+(a.config.name||a.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});D.addEventListener("click",function(d){b.leap(b.reverseKeyScrolling?1:-1,!1)},!1);b.makeTooltip(D,function(d){d=b.getSelectedTier();var a;0<=d&&(a=b.tiers[d]);return a&&a.featureSource&&b.sourceAdapterIsCapable(a.featureSource,"quantLeap")&&"number"==typeof a.quantLeapThreshold?
'Jump to the next region with a score above the threshold in the selected track "'+(a.config.name||a.dasSource.name)+'"" (ctrl+RIGHT)':a&&a.featureSource&&b.sourceAdapterIsCapable(a.featureSource,"leap")?'Jump to the next feature in the selected track "'+(a.config.name||a.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});b.addTierSelectionListener(function(){var d=b.getSelectedTier(),a;0<=d&&(a=b.tiers[d]);d=!1;a&&a.featureSource&&(b.sourceAdapterIsCapable(a.featureSource,"quantLeap")&&
"number"==typeof a.quantLeapThreshold?d=!0:b.sourceAdapterIsCapable(a.featureSource,"leap")&&(d=!0));r.firstChild.className=d?"fa fa-angle-double-left":"fa fa-angle-left";D.firstChild.className=d?"fa fa-angle-double-right":"fa fa-angle-right"});A.addEventListener("click",function(d){b.clearHighlights()},!1);b.makeTooltip(A,"Clear highlights (C)");b.addTierSelectionWrapListener(function(d){0>d&&(b.setSelectedTier(null),f.focus())});b.addTierSelectionListener(function(d){"tier"===b.uiMode&&(0==d.length?
(b.hideToolPanel(),b.manipulatingTier=null,b.uiMode="none"):(d=b.tiers[d[0]],d!=b.manipulatingTier&&b.openTierPanel(d)))});var G=function(d){if(65==d.keyCode||97==d.keyCode)d.preventDefault(),d.stopPropagation(),b.showTrackAdder();else if(72==d.keyCode||104==d.keyCode)d.stopPropagation(),d.preventDefault(),b.toggleHelpPopup(d);else if(69==d.keyCode||101==d.keyCode)d.stopPropagation(),d.preventDefault(),1==b.selectedTiers.length&&b.openTierPanel(b.tiers[b.selectedTiers[0]]);else if(88==d.keyCode||
120==d.keyCode)d.stopPropagation(),d.preventDefault(),b.openExportPanel();else if(67==d.keyCode||99==d.keyCode)d.stopPropagation(),d.preventDefault(),b.clearHighlights()};c.addEventListener("focus",function(d){c.addEventListener("keydown",G,!1)},!1);c.addEventListener("blur",function(d){c.removeEventListener("keydown",G,!1)},!1);c.addEventListener("keydown",function(d){27===d.keyCode&&"none"!==b.uiMode&&(d.preventDefault(),d.stopPropagation(),b.setUiMode("none"),b.hideToolPanel(),b.selectedTiers&&
0<b.selectedTiers.length&&b.browserHolder.focus())},!1)};l.prototype.showToolPanel=function(c,l){var b=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);var a;a=l?c:k("div",c,{},{overflowY:"auto",width:"100%"});var g=k("div",k("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});g.addEventListener("click",function(a){b.hideToolPanel();b.setUiMode("none")},!1);this.makeTooltip(g,"Close tool panel (ESC)");this.activeToolPanel=k("div",[g,
a],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();b=this};l.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};l.prototype.toggleHelpPopup=function(c){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(c=k("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.resolveURL("$$help/index.html"),
className:"help-panel"}),this.showToolPanel(c,!1),this.setUiMode("help"))};l.prototype.toggleOptsPopup=function(c){var l=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{c=k("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var b=k("table");b.cellPadding=5;var a=k("input","",{type:"checkbox",checked:l.reverseScrolling});a.addEventListener("change",function(b){l.reverseScrolling=a.checked;
l.storeStatus()},!1);b.appendChild(k("tr",[k("td","Reverse trackpad scrolling",{align:"right"}),k("td",a)]));var g=k("input","",{type:"checkbox",checked:l.reverseKeyScrolling});g.addEventListener("change",function(a){l.reverseKeyScrolling=g.checked;l.storeStatus()},!1);b.appendChild(k("tr",[k("td","Reverse scrolling buttons and keys",{align:"right"}),k("td",g)]));var f=k("select");f.appendChild(k("option","Left",{value:"left"}));f.appendChild(k("option","Center",{value:"center"}));f.appendChild(k("option",
"Right",{value:"right"}));f.appendChild(k("option","None",{value:"none"}));f.value=l.rulerLocation;f.addEventListener("change",function(a){l.rulerLocation=f.value;l.positionRuler();for(a=0;a<l.tiers.length;++a)l.tiers[a].paintQuant();l.storeStatus()},!1);b.appendChild(k("tr",[k("td","Vertical guideline",{align:"right"}),k("td",f)]));var v=k("input","",{type:"checkbox",checked:l.singleBaseHighlight});v.addEventListener("change",function(a){l.singleBaseHighlight=v.checked;l.positionRuler();l.storeStatus()},
!1);v.setAttribute("id","singleBaseHightlightButton");b.appendChild(k("tr",[k("td","Display and highlight current genome location",{align:"right"}),k("td",v)]));c.appendChild(b);b=k("button","Reset browser",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});b.addEventListener("click",function(a){l.reset()},!1);c.appendChild(b);this.showToolPanel(c);this.setUiMode("opts")}}},{"./cbrowser":6,"./export-config":14,"./export-image":15,"./export-ui":16,"./numformats":26,"./session":32,
"./svg-export":38,"./tier-edit":44,"./utils":49,"./zoomslider":52}],6:[function(c,u,t){function n(d,a,w){this.min=a;this.max=w;this.chr=d}function l(d){d||(d={});this.prefix="//www.biodalliance.org/release-0.14/";this.sources=[];this.tiers=[];this.tierGroups={};this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.chains={};this.pageName=
"svgHolder";this.maxExtra=2.5;this.minExtra=.5;this.zoomFactor=1;this.maxPixelsPerBase=10;this.origin=0;this.targetQuantRes=1;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=.3;this.singleBaseHighlight=this.exportRuler=
this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)","white"];this.minTierHeight=20;this.noDefaultLabels=!1;this.availableSources=new b;this.defaultSources=[];this.mappableSources={};this.registry=null;this.noRegistryTabs=!0;this.hubs=[];this.hubObjects=[];this.sourceCache=new C;this.useFetchWorkers=this.retina=!0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.resolvers={};this.resolverSeed=1;this.assemblyNameUcsc=this.assemblyNamePrimary=!0;this.httpCanaryURL="http://www.biodalliance.org/http-canary.txt";
this.httpWarningURL="//www.biodalliance.org/https.html";this.initListeners=[];this.baseColors=d.baseColors?d.baseColors:{A:"green",C:"blue",G:"orange",T:"red","-":"hotpink",I:"red"};if(void 0!==d.viewStart&&"number"!==typeof d.viewStart)throw Error("viewStart must be an integer");if(void 0!==d.viewEnd&&"number"!==typeof d.viewEnd)throw Error("viewEnd must be an integer");if(void 0!==d.offscreenInitWidth&&"number"!==typeof d.offscreenInitWidth)throw Error("offscreenInitWidth must be an integer");for(var a in d)this[a]=
d[a];"string"===typeof d.uiPrefix&&"string"!==typeof d.prefix&&(this.prefix=d.uiPrefix);0>this.prefix.indexOf("//")&&0===this.prefix.indexOf("/")&&(d=window.location.hostname,window.location.port&&(d+=":"+window.location.port),this.prefix="//"+d+this.prefix);0===this.prefix.indexOf("//")&&(d=window.location.protocol,"http:"!=d&&"https:"!=d&&(console.log(window.location.protocol),console.log("WARNING: prefix is set to a protocol-relative URL ("+this.prefix+" when loading from a non-HTTP source"),this.prefix=
"http:"+this.prefix));if(!this.coordSystem)throw Error("Coordinate system must be configured");if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var w=this;if("complete"===document.readyState)w.realInit();else{var e=function(d){window.removeEventListener("load",e,!1);w.realInit()};window.addEventListener("load",e,!1)}}function k(d,a,w){if(w)for(var b=0;b<a.length;++b)a[b].mapping=w;d.set(a)}function q(d,a,w,b){b=b||[];
for(var e=d.length-1;0<=e;--e){var h=d[e];if(!h.notSelectable&&h.min()<=a&&h.max()>=a&&(!h.minY||!(w<h.minY()||w>h.maxY()))){h.feature?b.push(h.feature):h.group&&b.push(h.group);if(h.glyphs)return q(h.glyphs,a,w,b);if(h.glyph)return q([h.glyph],a,w,b);break}}return b}function p(d,a){var w=this;this.tagSeed=0;this.callbacks={};this.browser=d;this.worker=a;this.worker.onmessage=function(d){var a=d.data;if(a.cmd)"resolve"==a.cmd?(d=w.browser.resolvers[a.resolver])?d(a.url).then(function(d){w.worker.postMessage({tag:a.tag,
url:d})}).catch(function(d){console.log(d);w.worker.postMessage({tag:a.tag,err:d.toString()})}):console.log("No resolver "+a.resolver):console.log("Bad worker callback "+a.cmd);else if(d=w.callbacks[a.tag])d(a.result,a.error),delete w.callbacks[a.tag]}}function x(d){var a=d.resolveURL(d.workerPath);0==a.indexOf("//")&&(a="https:"==window.location.protocol?"https:"+a:"http:"+a);var w=new Blob(['importScripts("'+a+"?version="+T+'");'],{type:"application/javascript"});return new y(function(a,b){var e=
new Worker(URL.createObjectURL(w));e.onmessage=function(b){"init"===b.data.tag&&(console.log("Worker initialized"),a(new p(d,e)))};e.onerror=function(d){b(d.message)}})}function C(){this.sourcesByURI={}}if("undefined"!==typeof c){t=c("./utils");var b=t.Observed,a=t.makeElement,g=t.removeChildren,f=t.miniJSONify,v=t.shallowCopy,z=t.textXHR,m=c("./tier").DasTier,F=c("./sha1").hex_sha1,A=c("./thub").connectTrackHub,T=c("./version");t=c("./numformats");var d=t.formatQuantLabel,e=t.formatLongInt,h=c("./chainset").Chainset,
y=c("es6-promise").Promise;t=c("./sourcecompare");var B=t.sourcesAreEqual,r=t.sourcesAreEqualModuloStyle,D=t.sourceDataURI}l.prototype.resolveURL=function(d){return d.replace("$$",this.prefix)};l.prototype.destroy=function(){window.removeEventListener("resize",this.resizeListener,!1)};l.prototype.realInit=function(){var d=this;if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");else{this.wasInitialized=!0;var b=navigator.userAgent||"dummy";
0<=b.indexOf("Trident")&&0<=b.indexOf("rv:11")&&(this.disablePinning=!0);this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(b=0;b<this.sources.length;++b){var w=this.sources[b];w&&this.defaultSources.push(w)}this.restoreStatus&&(this.statusRestored=this.restoreStatus());var f=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");this.browserHolder=a("div",
null,{className:"dalliance dalliance-root",tabIndex:-1});this.maxHeight?this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=this.maxHeight&&(this.browserHolder.style.maxHeight=null);g(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=a("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=a("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=a("div",this.makeLoader(24),
{className:"tier-holder tier-holder-rest"});this.locSingleBase=a("span","",{className:"loc-single-base"});b=a("div",this.locSingleBase,{className:"loc-single-base-holder"});this.addViewListener(function(a,b,w,h,g,f,r){b=Math.round((r+f)/2);d.locSingleBase.appendChild(document.createTextNode(a+":"+e(b)));d.locSingleBase.removeChild(d.locSingleBase.firstChild)});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=a("div",[b,this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"}),
this.svgHolder.appendChild(this.tierHolderHolder));this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=a("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(a("span",["Powered by ",a("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+T],{className:"powered-by"}));this.browserHolder.appendChild(this.bhtmlRoot);this.resizeListener=function(d){f.resizeViewer()};window.addEventListener("resize",this.resizeListener,!1);this.ruler=a("div",null,{className:"guideline"});this.ruler2=
a("div",null,{className:"single-base-guideline"});this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=this.chains||{};this.chains={};for(var r in this.chainConfigs)b=this.chainConfigs[r],b instanceof h&&console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),this.chains[r]=new h(b);if(0<this.maxWorkers){r=[];for(b=0;b<this.maxWorkers;++b)r.push(x(this));r=y.all(r)}else r=y.resolve([]);this.fetchWorkers=
null;this.nextWorker=0;r.then(function(d){console.log("Booted "+d.length+" workers");f.fetchWorkers=d},function(d){console.log("Failed to boot workers",d)}).then(function(){if(d.offscreenInitWidth||"none"!=window.getComputedStyle(f.browserHolderHolder).display&&0<f.tierHolder.getBoundingClientRect().width)setTimeout(function(){f.realInit2()},1);else var a=setInterval(function(){"none"!=window.getComputedStyle(f.browserHolderHolder).display&&0<f.tierHolder.getBoundingClientRect().width&&(clearInterval(a),
f.realInit2())},300)})}};l.prototype.realInit2=function(){var b=this;g(this.tierHolder);g(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|b.offscreenInitWidth|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-
this.viewStart+1)/this.zoomBase);this.tierHolderHolder.addEventListener("mousewheel",function(d){d.stopPropagation();d.preventDefault();if(d.wheelDeltaX){var a=d.wheelDeltaX/5;b.reverseScrolling||(a=-a);b.move(a)}d.wheelDeltaY&&(a=d.wheelDeltaY,b.reverseScrolling&&(a=-a),b.tierHolder.scrollTop+=a)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(d){d.stopPropagation();d.preventDefault();1==d.axis?0!=d.detail&&(d=d.detail/4,b.reverseScrolling&&(d=-d),b.move(d)):(d=d.detail,
b.reverseScrolling||(d=-d),b.tierHolder.scrollTop+=d)},!1);this.tierHolderHolder.addEventListener("touchstart",function(d){return b.touchStartHandler(d)},!1);this.tierHolderHolder.addEventListener("touchmove",function(d){return b.touchMoveHandler(d)},!1);this.tierHolderHolder.addEventListener("touchend",function(d){return b.touchEndHandler(d)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(d){return b.touchCancelHandler(d)},!1);var e=function(a){if(13==a.keyCode){var w=!1;for(a=
0;a<b.tiers.length;++a){var e=b.tiers[a];e.wantedLayoutHeight&&e.wantedLayoutHeight!=e.layoutHeight&&(e.layoutHeight=e.wantedLayoutHeight,e.clipTier(),w=!0)}w&&b.arrangeTiers()}else if(32==a.keyCode||32==a.charCode)b.isSnapZooming?(b.isSnapZooming=!1,w=(b.savedZoom||20)+b.zoomMin):(b.isSnapZooming=!0,w=(b.savedZoom||0)+b.zoomMin),b.savedZoom=b.zoomSliderValue-b.zoomMin,b.zoomSliderValue=w,b.zoom(Math.exp(1*w/b.zoomExpt)),a.stopPropagation(),a.preventDefault();else if(85==a.keyCode)"opts"===b.uiMode&&
(w=document.getElementById("singleBaseHightlightButton").checked,document.getElementById("singleBaseHightlightButton").checked=!w),b.singleBaseHighlight=!b.singleBaseHighlight,b.positionRuler(),a.stopPropagation(),a.preventDefault();else if(39==a.keyCode)a.stopPropagation(),a.preventDefault(),b.scrollArrowKey(a,-1);else if(37==a.keyCode)a.stopPropagation(),a.preventDefault(),b.scrollArrowKey(a,1);else if(38==a.keyCode||87==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=b.getSelectedTier(),
0>a||(w=b.tiers[a],a=w.forceHeight||w.subtiers[0].height,40<=a&&w.mergeConfig({height:a-10}));else if(a.ctrlKey||a.metaKey){if(a=b.getSelectedTier(),!(0>a)&&(w=b.tiers[a],w.quantLeapThreshold)){var e=w.subtiers[0].height,h=w.subtiers[0].quant;h&&(a=1*h.min,h=1*h.max,e=(h-a)/e,w.mergeConfig({quantLeapThreshold:a+((Math.round((w.quantLeapThreshold-a)/e)|0)+1)*e}),w.notify("Threshold: "+d(w.quantLeapThreshold)))}}else if(a.altKey){if(h=b.selectedTiers.length,0!=h){a=b.selectedTiers[0];for(var g=!0,w=
[],e=0;e<b.selectedTiers.length;++e)w.push(b.tiers[b.selectedTiers[e]]),0<e&&1!=b.selectedTiers[e]-b.selectedTiers[e-1]&&(g=!1);if(!(g&&0>=a)){for(e=b.selectedTiers.length-1;0<=e;--e)b.tiers.splice(b.selectedTiers[e],1);b.selectedTiers.splice(0,h);h=g?a-1:a;for(e=0;e<w.length;++e)b.tiers.splice(h+e,0,w[e]),b.selectedTiers.push(h+e);b.withPreservedSelection(b._ensureTiersGrouped);b.markSelectedTiers();b.notifyTierSelection();b.reorderTiers();b.notifyTier("selected",a)}}}else if(a=b.getSelectedTier(),
0<a){if(b.setSelectedTier(a-1),a=b.tiers[b.getSelectedTier()],w=a.row.offsetTop,a=w+a.row.offsetHeight,w<b.tierHolder.scrollTop||a>b.tierHolder.scrollTop+b.tierHolder.offsetHeight)b.tierHolder.scrollTop=w}else b.notifyTierSelectionWrap(-1);else if(40==a.keyCode||83==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=b.getSelectedTier(),0>a||(w=b.tiers[a],a=w.forceHeight||w.subtiers[0].height,w.mergeConfig({height:a+10}));else if(a.ctrlKey||a.metaKey){if(a=b.getSelectedTier(),!(0>a)&&
(w=b.tiers[a],w.quantLeapThreshold&&(e=w.subtiers[0].height,h=w.subtiers[0].quant)))a=1*h.min,h=1*h.max,e=(h-a)/e,h=Math.round((w.quantLeapThreshold-a)/e)|0,1<h&&(w.mergeConfig({quantLeapThreshold:a+(h-1)*e}),w.notify("Threshold: "+d(w.quantLeapThreshold)))}else if(a.altKey){if(h=b.selectedTiers.length,0!=h){a=b.selectedTiers[0];for(var f=0,w=[],e=0;e<b.selectedTiers.length;++e)w.push(b.tiers[b.selectedTiers[e]]),0<e&&(f+=b.selectedTiers[e]-b.selectedTiers[e-1]-1);g=0==f;if(!(g&&a+h>=b.tiers.length)){for(e=
b.selectedTiers.length-1;0<=e;--e)b.tiers.splice(b.selectedTiers[e],1);b.selectedTiers.splice(0,h);h=g?a+1:a+f;for(e=0;e<w.length;++e)b.tiers.splice(h+e,0,w[e]),b.selectedTiers.push(h+e);b.withPreservedSelection(function(){b._ensureTiersGrouped(!0)});b.markSelectedTiers();b.notifyTierSelection();b.reorderTiers();b.notifyTier("selected",a)}}}else{if(a=b.getSelectedTier(),a<b.tiers.length-1&&(b.setSelectedTier(a+1),a=b.tiers[b.getSelectedTier()],w=a.row.offsetTop,a=w+a.row.offsetHeight,w<b.tierHolder.scrollTop||
a>b.tierHolder.scrollTop+b.tierHolder.offsetHeight))b.tierHolder.scrollTop=Math.min(w,a-b.tierHolder.offsetHeight)}else if(187==a.keyCode||61==a.keyCode)a.stopPropagation(),a.preventDefault(),b.zoomStep(-10);else if(189==a.keyCode||173==a.keyCode)a.stopPropagation(),a.preventDefault(),b.zoomStep(10);else if(73==a.keyCode||105==a.keyCode)a.stopPropagation(),a.preventDefault(),a=b.getSelectedTier(),0>a||(e=b.tiers[a],e.infoVisible?(e.infoElement.style.display="none",e.updateHeight(),e.infoVisible=!1):
(e.infoElement.style.display="block",e.updateHeight(),e.infoVisible=!0));else if(84==a.keyCode||116==a.keyCode)if(a.shiftKey)for(a.stopPropagation(),a.preventDefault(),a=0;a<b.tiers.length;++a)e=b.tiers[a],e.dasSource.collapseSuperGroups&&(void 0===w&&(w=!e.bumped),e.mergeConfig({bumped:w}));else a.ctrlKey||a.metaKey||(a.stopPropagation(),a.preventDefault(),a=b.getSelectedTier(),0>a||(e=b.tiers[a],e.dasSource.collapseSuperGroups&&(void 0===w&&(w=!e.bumped),e.mergeConfig({bumped:w}))));else if(77==
a.keyCode||109==a.keyCode)a.stopPropagation(),a.preventDefault(),(a.ctrlKey||a.metaKey)&&1<b.selectedTiers.length&&b.mergeSelectedTiers();else if(68==a.keyCode||100==a.keyCode){if(a.stopPropagation(),a.preventDefault(),a.ctrlKey||a.metaKey)a=b.getSelectedTier(),0>a||b.addTier(b.tiers[a].dasSource)}else if(80==a.keyCode||112==a.keyCode)if(a.ctrlKey||a.metaKey){w=[];for(a=0;a<b.selectedTiers.length;++a)w.push(b.tiers[b.selectedTiers[a]]);for(a=0;a<w.length;++a)w[a].mergeConfig({pinned:!w[a].pinned})}};
this.browserHolder.addEventListener("focus",function(a){b.browserHolder.addEventListener("keydown",e,!1)},!1);this.browserHolder.addEventListener("blur",function(a){b.browserHolder.removeEventListener("keydown",e,!1)},!1);this.hPopupHolder=a("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var w=0;w<this.sources.length;++w){var h=this.sources[w];if(h){var f=
{};this.restoredConfigs&&(f=this.restoredConfigs[w]);h.disabled||this.makeTier(h,f).then(function(a){b.refreshTier(a)})}}b._ensureTiersGrouped();b.arrangeTiers();b.reorderTiers();(w=this.getSequenceSource())&&w.getSeqInfo(this.chr,function(a){b.currentSeqMax=a?a.length:-1});this.queryRegistry();for(var r in this.chains)this.queryRegistry(r,!0);if(this.hubs)for(r=0;r<this.hubs.length;++r)w=this.hubs[r],"string"==typeof w&&(w={url:w}),function(a){A(a.url,function(d,w){if(w)console.log(w);else{var e;
if(e=a.genome?d.genomes[a.genome]:d.genomes[b.coordSystem.ucscName])a.mapping&&(e.mapping=a.mapping),a.label&&(e.hub.altLabel=a.label),b.hubObjects.push(e)}},a)}(w);this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus();b.setLocation(this.chr,this.viewStart,this.viewEnd,function(){b.setSelectedTier(1);for(var a=0;a<b.initListeners.length;++a)try{b.initListeners[a].call(b)}catch(d){console.log(d)}})};l.prototype.touchStartHandler=function(a){this.touchOriginX=
a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};l.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var d=a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&d!=this.touchOriginX&&this.move(d-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&(this.tierHolder.scrollTop-=
a-this.touchOriginY);this.touchOriginX=d;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){d=Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(d!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var b=this.viewStart+a/this.scale|0;this.scale=d/this.zoomInitialSep*this.zoomInitialScale;this.viewStart=b-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=d}};l.prototype.touchEndHandler=function(a){};l.prototype.touchCancelHandler=function(a){};
l.prototype.makeTier=function(a,d){try{return this.realMakeTier(a,d)}catch(b){console.log("Error initializing",a),console.log(b.stack||b)}};l.prototype.realMakeTier=function(a,d){var b=this,e=null;this.tierBackgroundColors&&(e=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);var h=new m(this,a,d,e);h.oorigin=this.viewStart;var g=!1,f,r,y,B=function(a,d){var e=h.subtiers;if(e){var g=0;for(d-=h.padding;g<e.length&&d>e[g].height&&g<e.length-1;)d=d-e[g].height-h.padding,
++g;if(!(g>=e.length))return e=e[g].glyphs,a-=(h.glyphCacheOrigin-b.viewStart)*b.scale,q(e,a,d)}},v=function(a){a.preventDefault();a.stopPropagation();a=a.clientX;a!=r&&(b.move(a-r,!0),r=a);b.isDragging=!0},k=function(a){window.removeEventListener("mousemove",v,!0);window.removeEventListener("mouseup",k,!0);b.move(a.clientX-r)};h.viewport.addEventListener("mousedown",function(a){b.browserHolder.focus();a.preventDefault();h.row.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",
v,!0);window.addEventListener("mouseup",k,!0);f=r=a;b.isDragging=!1},!1);h.viewport.addEventListener("mousemove",function(a){var d=h.row.getBoundingClientRect(),e=a.clientX-d.left,f=a.clientY-d.top,d=B(e,f);h.row.style.cursor=d&&0<d.length?"pointer":"default";y&&clearTimeout(y);g||(y=setTimeout(function(){var d=B(e,f);d&&0<d.length&&b.notifyFeatureHover(a,d[d.length-1],d,h)},1E3))});var z=null;h.viewport.addEventListener("mouseup",function(a){var d=h.row.getBoundingClientRect(),e=a.clientX-d.left,
d=a.clientY-d.top,g=B(e,d);g&&0<g.length&&!b.isDragging&&(z?(clearTimeout(z),z=null,b.featureDoubleClick(g,e,d)):z=setTimeout(function(){z=null;b.notifyFeature(a,g[g.length-1],g,h)},500));if(b.isDragging&&e!=f&&h.sequenceSource){var d=b.viewStart+e/b.scale,r=b.viewStart+f/b.scale;d<r?(e=d|0,d=r|0):(e=r|0,d|=0);b.notifyRegionSelect(b.chr,e,d)}b.isDragging=!1},!1);h.viewport.addEventListener("mouseout",function(a){g=!1});h.removeButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();
for(a=0;a<b.tiers.length;++a)if(b.tiers[a]===h){b.removeTier({index:a});break}},!1);h.nameButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();if(a.shiftKey){a=-1;for(var d=0;d<b.tiers.length;++d)if(b.tiers[d]===h){a=d;break}0<=a&&(d=b.selectedTiers.indexOf(a),0<=d?b.selectedTiers.splice(d,1):(b.selectedTiers.push(a),b.selectedTiers.sort()),b.markSelectedTiers(),b.notifyTierSelection(),0<b.selectedTiers.length?b.browserHolder.focus():b.notifyTierSelectionWrap(-1))}else{for(d=
0;d<b.tiers.length;++d)if(b.tiers[d]===h&&(b.browserHolder.focus(),1!=b.selectedTiers.length||b.selectedTiers[0]!=d)){b.setSelectedTier(d);return}h.infoVisible?(h.infoElement.style.display="none",h.updateHeight(),h.infoVisible=!1):(h.infoElement.style.display="block",h.updateHeight(),h.infoVisible=!0)}},!1);h.bumpButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();var d;h.dasSource.collapseSuperGroups&&(void 0===d&&(d=!h.bumped),h.mergeConfig({bumped:d}))},!1);var D,
c,A,l,H,C=!1,p=function(a){var d=h.label;a.stopPropagation();a.preventDefault();if(!D){c=h.pinned?b.pinnedTierHolder:b.tierHolder;A=c.scrollHeight-c.offsetHeight;D=d.cloneNode(!0);D.style.cursor="pointer";c.appendChild(D);d.style.visibility="hidden";for(var e=0;e<b.tiers.length;++e)if(b.tiers[e]===h){l=e;break}H=a.clientY}var g=c.getBoundingClientRect();D.style.left=d.getBoundingClientRect().left-g.left+"px";D.style.top=a.clientY-g.top+c.scrollTop-10+"px";d=a.clientY-g.top+c.scrollTop;for(e=0;e<b.tiers.length;++e)if(g=
b.tiers[e],!(g.pinned^h.pinned)&&(g=g.row.getBoundingClientRect(),d-=g.bottom-g.top,0>d)){if(e<l&&a.clientY<H||e>l&&a.clientY>H){b.withPreservedSelection(function(){b.tiers.splice(l,1);b.tiers.splice(e,0,h);b._ensureTiersGrouped(e>l)});for(d=0;d<b.tiers.length;++d)b.tiers[d]==h&&(l=d);H=a.clientY;b.reorderTiers();c.appendChild(D);C=!0}break}D.offsetTop<c.scrollTop?c.scrollTop-=c.scrollTop-D.offsetTop:D.offsetTop+D.offsetHeight>c.scrollTop+c.offsetHeight&&(c.scrollTop=Math.min(c.scrollTop+(D.offsetTop+
D.offsetHeight)-(c.scrollTop+c.offsetHeight),A))},F=function(a){var d=h.label;a.stopPropagation();a.preventDefault();D&&(D.style.cursor="auto",c.removeChild(D),D=null,d.style.visibility="visible");document.removeEventListener("mousemove",p,!1);document.removeEventListener("mouseup",F,!1);if(C){for(a=0;a<b.tiers.length;++a)if(b.tiers[a]==h){b.setSelectedTier(a);break}b.notifyTier("reordered",h)}};h.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();C=!1;document.addEventListener("mousemove",
p,!1);document.addEventListener("mouseup",F,!1)},!1);this.tiers.push(h);return h.init().then(function(a){a.currentlyHeight=50;b.updateHeight();a.updateLabel();b.withPreservedSelection(b._ensureTiersGrouped);a._updateFromConfig();b.reorderTiers();return a})};l.prototype.reorderTiers=function(){g(this.tierHolder);g(this.pinnedTierHolder);this.disablePinning&&(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var a=!1,d=[],b=[],e=0;e<this.tiers.length;++e){var h=this.tiers[e];
h.pinned&&!this.disablePinning?(d.push(h),this.pinnedTierHolder.appendChild(this.tiers[e].row),a=!0):(b.push(h),this.tierHolder.appendChild(this.tiers[e].row))}this.withPreservedSelection(function(){this.tiers.splice(0,this.tiers.length);for(var a=0;a<d.length;++a)this.tiers.push(d[a]);for(a=0;a<b.length;++a)this.tiers.push(b[a])});a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};l.prototype.withPreservedSelection=
function(a){for(var d=[],b=0;b<this.selectedTiers.length;++b)d.push(this.tiers[this.selectedTiers[b]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=d.indexOf(this.tiers[a])&&this.selectedTiers.push(a)};l.prototype.refreshTier=function(a,d){d=d||H;this.knownSpace&&this.knownSpace.invalidate(a,d)};l.prototype._ensureTiersGrouped=function(a){for(var d={},b=0;b<this.tiers.length;++b){var e=this.tiers[b];e.dasSource.tierGroup&&pusho(d,e.dasSource.tierGroup,e)}var h=[];a&&this.tiers.reverse();
for(b=0;b<this.tiers.length;++b)if(e=this.tiers[b],e.dasSource.tierGroup){var g=d[e.dasSource.tierGroup];if(g){a&&g.reverse();for(var f=0;f<g.length;++f)h.push(g[f]);d[e.dasSource.tierGroup]=null}}else h.push(e);a&&h.reverse();this.tiers.splice(0,this.tiers.length);for(f=0;f<h.length;++f)this.tiers.push(h[f])};l.prototype.arrangeTiers=function(){for(var d=[],b={},e=0;e<this.tiers.length;++e){var h=this.tiers[e];h.pinned&&(d.push(h),h.dasSource.tierGroup&&pusho(b,h.dasSource.tierGroup,h))}for(e=0;e<
this.tiers.length;++e)h=this.tiers[e],h.pinned||(d.push(h),h.dasSource.tierGroup&&pusho(b,h.dasSource.tierGroup,h));for(var g in b){var h=b[g],f=this.tierGroups[g];f||(f={element:a("div",a("span",g,{className:"tier-group-label"}),{className:"tier-group"})},this.tierGroups[g]=f);f.element.parentNode&&f.element.parentNode.removeChild(f.element);for(var r=h[0].pinned?this.pinnedTierHolder:this.tierHolder,m=1E7,y=0,e=0;e<h.length;++e)var B=h[e].row,m=Math.min(m,B.offsetTop),y=Math.max(y,B.offsetTop+B.offsetHeight);
f.element.style.top=m+"px";f.element.style.left="0px";f.element.style.height=y-m+"px";r.appendChild(f.element)}if(this.tierBackgroundColors)for(e=0;e<d.length;++e)h=d[e],h.setBackground(this.tierBackgroundColors[e%this.tierBackgroundColors.length]),h.label.style.left=h.dasSource.tierGroup?"18px":"2px",h.background=this.tierBackgroundColors[e%this.tierBackgroundColors.length]};l.prototype.refresh=function(){this.retrieveTierData(this.tiers,H);this.drawOverlays();this.positionRuler()};var H=function(a,
d){d.draw();d.updateStatus(a)};l.prototype.retrieveTierData=function(a,d){this.notifyLocation();var b=100/this.scale|0,e=1E3/this.scale|0,h=(this.viewStart+this.viewEnd)/2,g=h-this.origin;this.origin=h;this.scaleAtLastRedraw=this.scale;for(h=0;h<a.length;++h){var f=g;a[h].originHaxx&&(f+=a[h].originHaxx);a[h].originHaxx=f}g=this.targetQuantRes/this.scale;h=Math.max(1,(this.viewStart|0)-b);b=Math.min((this.viewEnd|0)+b,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);f=Math.max(1,(this.viewStart|
0)-e);e=Math.min((this.viewEnd|0)+e,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var r=this.getSequenceSource();this.knownSpace&&this.knownSpace.cancel();this.knownSpace=new J(this.tiers,this.chr,f,e,g,r)}(r=this.knownSpace.bestCacheOverlapping(this.chr,h,b))&&r.min<=h&&r.max>=b?(this.drawnStart=Math.max(r.min,f),this.drawnEnd=Math.min(r.max,e)):(this.drawnStart=f,this.drawnEnd=e);this.knownSpace.retrieveFeatures(a,this.chr,this.drawnStart,
this.drawnEnd,g,d)};l.prototype.queryRegistry=function(a,d){if(this.registry){var e,h;a?(e=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new b),h=this.mappableSources[a]):(e=this.coordSystem,h=this.availableSources);var g=F(f(e));if(d){var r=localStorage["dalliance.registry."+g+".last_queried"];if(r)try{if(k(h,JSON.parse(localStorage["dalliance.registry."+g+".sources"]),a),432E5>(Date.now()|0)-(r|0))return}catch(m){console.log("Bad registry cache: "+m)}}r=this.registry;if(0==
r.indexOf("//")){var y=window.location.protocol;"https:"!=y&&"http:"!=y&&(r="http:"+r)}(new S(r)).sources(function(d){for(var b=[],f=0;f<d.length;++f){var r=d[f];if(r.coords&&0!=r.coords.length){var m=r.coords[0];m.taxon==e.taxon&&m.auth==e.auth&&m.version==e.version&&b.push(r)}}localStorage["dalliance.registry."+g+".sources"]=JSON.stringify(b);localStorage["dalliance.registry."+g+".last_queried"]=""+Date.now();k(h,b,a)},function(a){},e)}};l.prototype.move=function(a,d){var b=this.viewEnd-this.viewStart,
e=this.viewStart-1*a/this.scale,h=e+b;d||(0<this.currentSeqMax&&h>this.currentSeqMax&&(h=this.currentSeqMax,e=this.viewEnd-b),1>e&&(e=1,h=e+b));this.setLocation(null,e,h,null,d)};l.prototype.zoomStep=function(a){var d=1*this.zoomSliderValue;a=d+a;a<this.zoomMin&&(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=d&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};l.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*
this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.notifyLocation();this.refresh()};l.prototype.spaceCheck=function(a){this.knownSpace&&this.knownSpace.chr===this.chr?
(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};l.prototype.resizeViewer=function(a){var d=this.tierHolder.getBoundingClientRect().width|0;if(0!=d){var b=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=d|0;b!=this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*
Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/b,d=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-d+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+d-1),this.positionRuler(),a||this.spaceCheck(),
this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};l.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(300,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-20)+"px"};l.prototype.addTier=function(a){var d=this;a=v(a);a.disabled=!1;return this.makeTier(a).then(function(a){d.refreshTier(a);d.markSelectedTiers();d.positionRuler();d.notifyTier("added",a);return a})};l.prototype.removeTier=function(a,d){var b=-1;if("undefined"!==
typeof a.index&&0<=a.index&&a.index<this.tiers.length)b=a.index;else for(var e=0;e<this.tiers.length;++e)if(B(a,this.tiers[e].dasSource)){b=e;break}if(0>b)throw"Couldn't find requested tier";e=this.tiers[b];this.tiers.splice(b,1);for(var h=[],g=0;g<this.selectedTiers.length;++g){var f=this.selectedTiers[g];f<b?h.push(f):f>b&&h.push(f-1)}this.selectedTiers=h;this.markSelectedTiers();e.destroy();this.knownSpace&&(this.knownSpace.featureCache[e]=null);this.reorderTiers();this.notifyTier("removed",e)};
l.prototype.removeAllTiers=function(){var a=this;this.selectedTiers=[];this.markSelectedTiers();this.tiers.forEach(function(d){d.destroy();a.knownSpace&&(a.knownSpace.featureCache[d]=null)});this.tiers.length=0;this.reorderTiers();this.notifyTier("removedAll",null)};l.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};l.prototype._getSequenceSource=function(){for(var a=0;a<this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;
for(a=0;a<this.defaultSources.length;++a){var d=this.defaultSources[a];if(d.provides_entrypoints||"sequence"==d.tier_type||d.twoBitURI||d.twoBitBlob)return d.twoBitURI||d.twoBitBlob?new W(d):d.ensemblURI?new I(d):new R(d)}};l.prototype.setLocation=function(a,d,b,e,h){if("number"!==typeof d)throw Error("minimum must be a number (got "+JSON.stringify(d)+")");if("number"!==typeof b)throw Error("maximum must be a number (got "+JSON.stringify(b)+")");if(d>b){var g=d;d=b;b=g}else d===b&&(b+=1);e||(e=function(a){if(a)throw a;
});var f=this;if((!a||a==this.chr)&&0<this.currentSeqMax)return this._setLocation(null,d,b,null,e,h);var r=this.getSequenceSource();if(!r)return e("Need a sequence source");var m=a||this.chr;r.getSeqInfo(m,function(g){if(g)return f._setLocation(a,d,b,g,e,h);var y;y=0==m.indexOf("chr")?m.substr(3):"chr"+m;r.getSeqInfo(y,function(g){return!g&&a?e("Couldn't find sequence '"+a+"'"):g?f._setLocation(y,d,b,g,e,h):f._setLocation(null,d,b,null,e,h)})})};l.prototype._setLocation=function(a,d,b,e,h,g){var f=
!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(f=!0),this.chr=a,this.currentSeqMax=e.length);d=parseFloat(d);b=parseFloat(b);a=Math.max(10,b-d+1);g||(g=this.currentSeqMax,0>=g&&(g=1E12),1>d&&(d=1,b=d+a-1),b>g&&(b=g,d=Math.max(1,b-a+1)));this.viewStart=d;this.viewEnd=b;d=Math.max(this.featurePanelWidth||this.offscreenInitWidth,50)/(this.viewEnd-this.viewStart);g=1E-6<Math.abs(d-this.scale);this.scale=d;b=this.zoomSliderValue;this.zoomSliderValue=d=this.zoomExpt*Math.log((this.viewEnd-
this.viewStart+1)/this.zoomBase);if(g||f){for(f=0;f<this.tiers.length;++f)this.tiers[f].viewportHolder.style.left="5000px",this.tiers[f].overlay.style.left="5000px";this.refresh();this.savedZoom?(d-=this.zoomMin,b-=this.zoomMin,f=d-this.savedZoom,Math.abs(d-b)>Math.abs(f)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=b)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(f=0;f<this.tiers.length;++f)this.tiers[f].viewportHolder.style.left=""+((-((this.viewStart-this.tiers[f].norigin)*this.scale)|
0)-1E3)+"px",this.tiers[f].drawOverlay();this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return h()};l.prototype.setCenterLocation=function(a,d){var b=(this.viewEnd-this.viewStart)/2;this.setLocation(a,d-b,d+b)};l.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=0,d=0;d<this.tiers.length;++d)"none"!==this.tiers[d].loaderButton.style.display&&++a;0==a&&(a=Date.now()|0,console.log("Loading took "+(a-
this.activityStartTime)+"ms"),this.activityStartTime=null)}};l.prototype.addInitListener=function(a){this.initListeners.push(a)};l.prototype.addFeatureListener=function(a,d){this.featureListeners.push(a)};l.prototype.removeFeatureListener=function(a,d){var b=arrayIndexOf(this.featureListeners,a);0<=b&&this.featureListeners.splice(b,1)};l.prototype.notifyFeature=function(a,d,b,e){for(var h=0;h<this.featureListeners.length;++h)try{if(this.featureListeners[h](a,d,b,e))break}catch(g){console.log(g.stack)}};
l.prototype.addFeatureHoverListener=function(a,d){this.featureHoverListeners.push(a)};l.prototype.removeFeatureHoverListener=function(a,d){var b=arrayIndexOf(this.featureHoverListeners,a);0<=b&&this.featureHoverListeners.splice(b,1)};l.prototype.notifyFeatureHover=function(a,d,b,e){for(var h=0;h<this.featureHoverListeners.length;++h)try{this.featureHoverListeners[h](a,d,b,e)}catch(g){console.log(g.stack)}};l.prototype.addViewListener=function(a,d){this.viewListeners.push(a)};l.prototype.removeViewListener=
function(a,d){var b=arrayIndexOf(this.viewListeners,a);0<=b&&this.viewListeners.splice(b,1)};l.prototype.notifyLocation=function(){var a=Math.max(1,this.viewStart|0),d=this.viewEnd|0;0<this.currentSeqMax&&d>this.currentSeqMax&&(d=this.currentSeqMax);for(var b=0;b<this.viewListeners.length;++b)try{this.viewListeners[b](this.chr,a,d,this.zoomSliderValue,{current:this.zoomSliderValue,alternate:this.savedZoom+this.zoomMin||this.zoomMin,isSnapZooming:this.isSnapZooming,min:this.zoomMin,max:this.zoomMax},
this.viewStart,this.viewEnd)}catch(e){console.log(e.stack)}};l.prototype.addTierListener=function(a){this.tierListeners.push(a)};l.prototype.removeTierListener=function(a){a=arrayIndexOf(this.tierListeners,a);0<=a&&this.tierListeners.splice(a,1)};l.prototype.notifyTier=function(a,d){for(var b=0;b<this.tierListeners.length;++b)try{this.tierListeners[b](a,d)}catch(e){console.log(e.stack)}};l.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};l.prototype.removeRegionSelectListener=
function(a){a=arrayIndexOf(this.regionSelectListeners,a);0<=a&&this.regionSelectListeners.splice(a,1)};l.prototype.notifyRegionSelect=function(a,d,b){for(var e=0;e<this.regionSelectListeners.length;++e)try{this.regionSelectListeners[e](a,d,b)}catch(h){console.log(h.stack)}};l.prototype.highlightRegion=function(a,d,b){var e=this;if(a==this.chr)return this._highlightRegion(a,d,b);var h=this.getSequenceSource();if(!h)throw"Need a sequence source";h.getSeqInfo(a,function(g){if(g)return e._highlightRegion(a,
d,b);var f;f=0==a.indexOf("chr")?a.substr(3):"chr"+a;h.getSeqInfo(f,function(a){if(a)return e._highlightRegion(f,d,b)})})};l.prototype._highlightRegion=function(a,d,b){for(var e=0;e<this.highlights.length;++e){var h=this.highlights[e];if(h.chr==a&&h.min==d&&h.max==b)return}this.highlights.push(new n(a,d,b));e=this.viewStart-1E3/this.scale;h=this.viewEnd+1E3/this.scale;(a==this.chr||a=="chr"+this.chr)&&d<h&&b>e&&this.drawOverlays();this.notifyLocation()};l.prototype.clearHighlights=function(){this.highlights=
[];this.drawOverlays();this.notifyLocation()};l.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};l.prototype.featuresInRegion=function(a,d,b){var e=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var h=this.tiers[a].currentFeatures||[],g=0;g<h.length;++g){var f=h[g];f.min<=b&&f.max>=d&&e.push(f)}return e};l.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};l.prototype.setSelectedTier=
function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};l.prototype.markSelectedTiers=function(){for(var a=0;a<this.tiers.length;++a){var d=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?d.classList.add("active"):d.classList.remove("active")}0<this.selectedTiers.length&&(a=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/2,a>document.body.scrollTop&&a+100<document.body.scrollTop+window.innerHeight&&this.browserHolder.focus())};l.prototype.addTierSelectionListener=
function(a){this.tierSelectionListeners.push(a)};l.prototype.removeTierSelectionListener=function(a){a=arrayIndexOf(this.tierSelectionListeners,a);0<=a&&this.tierSelectionListeners.splice(a,1)};l.prototype.notifyTierSelection=function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(d){console.log(d.stack)}};l.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};l.prototype.removeTierSelectionWrapListener=
function(a){a=arrayIndexOf(this.tierSelectionWrapListeners,a);0<=a&&this.tierSelectionWrapListeners.splice(a,1)};l.prototype.notifyTierSelectionWrap=function(a){for(var d=0;d<this.tierSelectionWrapListeners.length;++d)try{this.tierSelectionWrapListeners[d](a)}catch(b){console.log(b.stack)}};l.prototype.positionRuler=function(){var a="none",d="",b="";"center"==this.rulerLocation?(a="block",d=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",d="0px"):"right"==this.rulerLocation?
(a="block",b="0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=d;this.ruler.style.right=b;this.singleBaseHighlight?(this.ruler2.style.display="block",this.ruler2.style.borderWidth="1px",1>this.scale?(this.ruler2.style.width="0px",this.ruler2.style.borderRightWidth="0px"):(this.ruler2.style.width=this.scale+"px",this.ruler2.style.borderRightWidth="1px"),this.locSingleBase.style.visibility="visible",this.locSingleBase.style.left=""+(this.featurePanelWidth/2-this.locSingleBase.offsetWidth/
2+this.ruler2.offsetWidth/2|0)+"px"):(this.locSingleBase.style.visibility="hidden",this.ruler2.style.width="1px",this.ruler2.style.borderWidth="0px",this.ruler2.style.display="center"==this.rulerLocation?"none":"block");this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var e=0;e<this.tiers.length;++e){var h=this.tiers[e],g=h.quantOverlay,f;h.subtiers&&0<h.subtiers.length&&(f=h.subtiers[0].quant);g&&(g.style.display=f?a:"none",g.style.left=d,g.style.right=b)}};l.prototype.featureDoubleClick=
function(a,d,b){if(a&&0!=a.length&&(b=a[a.length-1],b.min&&b.max)){var e=((b.min|0)-(this.viewStart|0))*this.scale,h=(b.max-b.min+1)*this.scale;a=((b.min|0)+(b.max|0))/2;10<h&&(d=1*(d-e)/h,.3>d?a=b.min|0:.7<d&&(a=(b.max|0)+1));d=this.viewEnd-this.viewStart;this.setLocation(null,a-d/2,a+d/2)}};l.prototype.zoomForScale=function(a){return.2<a?"high":.01<a?"medium":"low"};l.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};l.prototype.updateHeight=function(){for(var a=0,d=
0;d<this.tiers.length;++d)a+=this.tiers[d].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px";this.browserHolder.style.display="block";this.browserHolder.style.display="-webkit-flex";this.browserHolder.style.display="flex"};l.prototype.scrollArrowKey=function(a,d){this.reverseKeyScrolling&&(d=-d);if(a.ctrlKey||a.metaKey){var b=!1;a.shiftKey&&(b=!0);this.leap(d,b)}else if(1<this.scale){var b=(this.viewStart+this.viewEnd)/2,b=b-Math.round(b),e=1;a.shiftKey&&(e*=10);
0<d?(e=-e-b,0<b&&(e+=1)):(e-=b,0>b&&--e);this.setLocation(null,this.viewStart+e,this.viewEnd+e)}else this.move(a.shiftKey?100*d:25*d)};l.prototype.leap=function(a,d){var b=this,e=(b.viewStart+b.viewEnd+1)/2|0;0<a&&1>=b.viewStart?e-=1E8:0>a&&b.viewEnd>=b.currentSeqMax&&(e+=1E8);var h=b.getSelectedTier();0>h||((h=b.tiers[h])&&(h.featureSource&&this.sourceAdapterIsCapable(h.featureSource,"quantLeap")&&"number"==typeof h.quantLeapThreshold||h.featureSource&&this.sourceAdapterIsCapable(h.featureSource,
"leap"))?h.findNextFeature(b.chr,e,-a,d,function(h){if(h){var g=h.min,f=h.max;d&&(0<a?g>e+1?f=g:(f++,g=f):f<e-1?(f++,g=f):f=g);var r=b.viewEnd-b.viewStart+1;parseFloat(r/2)==parseInt(r/2)&&r--;g=(g+f-r)/2+1;b.setLocation(h.segment,g,g+r-1)}else alert("no next feature")}):this.move(100*a))};l.prototype.nameForCoordSystem=function(a){var d=null,b=null;this.assemblyNamePrimary&&(d=""+a.auth,"undefined"!==typeof a.version&&(d+=a.version));this.assemblyNameUcsc&&(b=a.ucscName);return null!=d&&null!=b?
d+"/"+b:d||b||"unknown"};l.prototype.makeLoader=function(d){var b=1<window.devicePixelRatio;return 20>(d||16)?a("img",null,{src:this.resolveURL("$$img/spinner_"+(b?16:32)+".gif"),width:"16",height:"16"}):a("img",null,{src:this.resolveURL("$$img/spinner_"+(b?24:48)+".gif"),width:"24",height:"24"})};l.prototype.canFetchPlainHTTP=function(){var a=this;if(!this._plainHTTPPromise){var d=this.getWorker();this._plainHTTPPromise=d?new y(function(b,e){d.postCommand({command:"textxhr",uri:a.httpCanaryURL},
function(a,d){a?b(!0):b(!1)})}):new y(function(d,b){z(a.httpCanaryURL,function(a,b){a?d(!0):d(!1)},{timeout:2E3})})}return this._plainHTTPPromise};l.prototype.getWorker=function(){if(!this.useFetchWorkers||!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};l.prototype.registerResolver=function(a){var d="res"+ ++this.resolverSeed;this.resolvers[d]=a;return d};p.prototype.postCommand=
function(a,d,b){var e="x"+ ++this.tagSeed;a.tag=e;this.callbacks[e]=d;this.worker.postMessage(a,b)};if("undefined"!==typeof u){u.exports={Browser:l};c("./browser-ui");c("./track-adder");c("./feature-popup");c("./tier-actions");c("./domui");c("./search");u=c("./sourceadapters");var W=u.TwoBitSequenceSource,I=u.EnsemblSequenceSource,R=u.DASSequenceSource,J=c("./kspace").KnownSpace,S=c("./das").DASRegistry}C.prototype.get=function(a){var d=this.sourcesByURI[D(a)];if(d)for(var b=0;b<d.configs.length;++b)if(r(d.configs[b],
a))return d.sources[b]};C.prototype.put=function(a,d){var b=D(a),e=this.sourcesByURI[b];e||(e={configs:[],sources:[]},this.sourcesByURI[b]=e);e.configs.push(a);e.sources.push(d)}},{"./browser-ui":5,"./chainset":7,"./das":10,"./domui":11,"./feature-popup":19,"./kspace":23,"./numformats":26,"./search":30,"./sha1":33,"./sourceadapters":34,"./sourcecompare":35,"./thub":42,"./tier":45,"./tier-actions":43,"./track-adder":46,"./utils":49,"./version":51,"es6-promise":53}],7:[function(c,u,t){function n(a,
b,d,e){"string"==typeof a?(this.uri=a,this.srcTag=b,this.destTag=d,this.coords=e):(this.uri=a.uri,this.srcTag=a.srcTag,this.destTag=a.destTag,this.coords=f(a.coords),this.type=a.type,this.credentials=a.credentials);this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={};this.fetchedTiles={};this.granularity=1E6;this.chainFetcher="bigbed"==this.type?new k(this.uri,this.credentials):"alias"==this.type?new C(a):new l(this.uri,this.srcTag,this.destTag)}function l(a,g,d){this.source=new b(a);
this.srcTag=g;this.destTag=d}function k(a,b){var d=this;this.uri=a;this.credentials=b;this.bwg=new F(function(a,b){m(new z(d.uri,{credentials:d.credentials,resolver:d.resolver}),function(d,g){d?a(d):b(g)})});this.bwg.then(function(a,d){d&&console.log(d)})}function q(a){return parseInt(a)}function p(a){return 0==a.indexOf("chr")?a.substr(3):a}function x(a){var b={srcChr:p(a.srcChrom),srcMin:parseInt(a.srcStart),srcMax:parseInt(a.srcEnd),srcOri:a.srcOri,destChr:p(a.segment),destMin:a.min-1,destMax:a.max,
destOri:a.ori,blocks:[]},d=a.srcStarts.split(",").map(q),e=a.destStarts.split(",").map(q);a=a.blockLens.split(",").map(q);for(var h=0;h<d.length;++h)b.blocks.push([d[h],e[h],a[h]]);return b}function C(a){this.conf=a;this.forwardAliases={};a=a.sequenceAliases||[];for(var b=0;b<a.length;++b){var d=a[b];if(!(2>d.length)){for(var e=[],h=0;h<d.length-1;++h)e.push(d[h]);this.forwardAliases[d[d.length-1]]=e}}}if("undefined"!==typeof c){t=c("./das");var b=t.DASSource,a=t.DASSegment;t=c("./utils");var g=t.pusho,
f=t.shallowCopy,v=c("./cigar").parseCigar,z=c("./bin").URLFetchable,m=c("./bigwig").makeBwg,F=c("es6-promise").Promise}n.prototype.exportConfig=function(){return{uri:this.uri,srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};n.prototype.mapPoint=function(a,b){for(var d=this.chainsBySrc[a]||[],e=0;e<d.length;++e){var h=d[e];if(b>=h.srcMin&&b<=h.srcMax){var g;g="-"==h.srcOri?h.srcMax-b:b-h.srcMin;for(var f=h.blocks,r=0;r<f.length;++r){var m=f[r],
v=m[0],k=m[1],m=m[2];if(g>=v&&g<=v+m)return d=g-v,{seq:h.destChr,pos:"-"==h.destOri?h.destMax-k-d:d+k+h.destMin,flipped:h.srcOri!=h.destOri}}}}return null};n.prototype.mapSegment=function(a,b,d){a=this.chainsBySrc[a]||[];for(var e=[],h=0;h<a.length;++h){var g=a[h];if(d>=g.srcMin&&b<=g.srcMax){var f,r;"-"==g.srcOri?(f=g.srcMax-d,r=g.srcMax-b):(f=b-g.srcMin,r=d-g.srcMin);for(var m=g.blocks,v=0;v<m.length;++v){var k=m[v],c=k[0],z=k[1],k=k[2];if(r>=c&&f<=c+k){var l={segment:g.destChr,flipped:"-"==g.srcOri^
"-"==g.destOri};"-"==g.destOri?(f>=c?l.max=g.destMax-z-f+c:(l.max=g.destMax-z,l.partialMax=c-f),r<=c+k?l.min=g.destMax-z-r+c:(l.min=g.destMax-z-k,l.partialMin=r-c-k)):(f>=c?l.min=g.destMin+z+f-c:(l.min=g.destMin+z,l.partialMin=c-f),r<=c+k?l.max=g.destMin+z+r-c:(l.max=g.destMin+z+k,l.partialMax=r-c-k));e.push(l)}}}}return e};n.prototype.unmapPoint=function(a,b){for(var d=this.chainsByDest[a]||[],e=0;e<d.length;++e){var h=d[e];if(b>=h.destMin&&b<=h.destMax){var g;g="-"==h.srcOri?h.destMax-b:b-h.destMin;
for(var f=h.blocks,r=0;r<f.length;++r){var m=f[r],v=m[0],k=m[1],m=m[2];if(g>=k&&g<=k+m)return d=g-k,e=d+v+h.srcMin,e="-"==h.destOri?h.srcMax-v-d:d+v+h.srcMin,{seq:h.srcChr,pos:e,flipped:h.srcOri!=h.destOri}}}}return null};n.prototype.sourceBlocksForRange=function(b,f,d,e){for(var h=this,m=f/this.granularity|0,v=d/this.granularity|0,r=!1,k=m;k<=v;++k){var c=b+"_"+k;2!=this.fetchedTiles[c]&&(r=!0,1!=this.fetchedTiles[c]&&(this.fetchedTiles[c]=1))}if(r)this.postFetchQueues[b]||this.chainFetcher.fetchChains(b,
m*this.granularity,(v+1)*this.granularity-1).then(function(a){h.chainsByDest||(h.chainsByDest[b]=[]);for(var d=0;d<a.length;++d){var e=a[d],g=h.chainsBySrc[e.srcChr];if(g){for(var f=!1,r=0;r<g.length;++r){var w=g[r];if(w.srcMin==e.srcMin&&w.srcMax==e.srcMax){f=!0;break}}f||g.push(e)}else h.chainsBySrc[e.srcChr]=[e];if(g=h.chainsByDest[e.destChr]){f=!1;for(r=0;r<g.length;++r)if(w=g[r],w.destMin==e.destMin&&w.destMax==e.destMax){f=!0;break}f||g.push(e)}else h.chainsByDest[e.destChr]=[e]}for(a=m;a<=
v;++a)h.fetchedTiles[b+"_"+a]=2;if(h.postFetchQueues[b]){a=h.postFetchQueues[b];for(d=0;d<a.length;++d)a[d]();h.postFetchQueues[b]=null}}).catch(function(a){console.log(a)}),g(this.postFetchQueues,b,function(){h.sourceBlocksForRange(b,f,d,e)});else{r=[];k=this.chainsByDest[b]||[];for(c=0;c<k.length;++c){var z=k[c];if(f<=z.destMax&&d>=z.destMin){var l,C;"-"==z.srcOri?(l=z.destMax-d,C=z.destMax-f):(l=f-z.destMin,C=d-z.destMin);for(var p=z.blocks,F=0;F<p.length;++F){var n=p[F],q=n[0],w=n[1],E=n[2];C>=
w&&l<=w+E&&(n=Math.max(l,w)-w,w=Math.min(C,w+E)-w,"-"==z.destOri?r.push(new a(z.srcChr,z.srcMax-q-w,z.srcMax-q-n)):r.push(new a(z.srcChr,z.srcMin+n+q,z.srcMin+w+q)))}}}e(r)}};l.prototype.fetchChains=function(a,b,d){var e=this;return new F(function(d,b){e.source.alignments(a,{},function(a){for(var b=[],g=0;g<a.length;++g)for(var f=a[g],m=0;m<f.blocks.length;++m){for(var y=f.blocks[m],k,c,z=0;z<y.segments.length;++z){var l=y.segments[z],C=f.objects[l.object];C.dbSource===e.srcTag?k=l:C.dbSource===e.destTag&&
(c=l)}if(k&&c){for(var y={srcChr:f.objects[k.object].accession,srcMin:k.min|0,srcMax:k.max|0,srcOri:k.strand,destChr:f.objects[c.object].accession,destMin:c.min|0,destMax:c.max|0,destOri:c.strand,blocks:[]},z=v(k.cigar),l=v(c.cigar),w=C=0,E=0,p=0;E<z.length&&p<l.length;)if("M"==z[E].op&&"M"==l[p].op){var A=Math.min(z[E].cnt,l[p].cnt);y.blocks.push([C,w,A]);z[E].cnt==A?++E:z[E].cnt-=A;l[p].cnt==A?++p:l[p]-=A;C+=A;w+=A}else"I"==z[E].op?w+=z[E++].cnt:"I"==l[p].op&&(C+=l[p++].cnt);b.push(y)}}d(b)})})};
k.prototype.fetchChains=function(a,b,d){return this.bwg.then(function(e,h){if(!e)throw Error("No BWG");return new F(function(h,g){e.getUnzoomedView().readWigData(a,b,d,function(a){h(a.map(x))})})})};C.prototype.fetchChains=function(a,b,d){b=[];d=this.forwardAliases[a]||[];for(var e=0;e<d.length;++e)b.push({srcChr:d[e],srcMin:1,srcMax:1E9,srcOri:"+",destChr:a,destMin:1,destMax:1E9,destOri:"+",blocks:[[1,1,1E9]]});return F.resolve(b)};"undefined"!==typeof u&&(u.exports={Chainset:n})},{"./bigwig":3,
"./bin":4,"./cigar":8,"./das":10,"./utils":49,"es6-promise":53}],8:[function(c,u,t){function n(k){for(var c=[],p;null!=(p=l.exec(k));){var n=p[1];0==n.length&&(n=1);c.push({cnt:n|0,op:p[2]})}return c}var l=/([0-9]*)([MIDS])/g;"undefined"!==typeof u&&(u.exports={parseCigar:n})},{}],9:[function(c,u,t){function n(a,b,f,v){this.red=a|0;this.green=b|0;this.blue=f|0;v&&(this.name=v)}function l(a){a="00"+a.toString(16);return a.substring(a.length-2)}function k(a){var g=x[a];g||((g=C.exec(a))?g=new n("0x"+
g[1]|0,"0x"+g[2]|0,"0x"+g[3]|0,a):(g=b.exec(a))?g=new n(g[1]|0,g[2]|0,g[3]|0,a):(console.log("couldn't handle color: "+a),g=x.black),x[a]=g);return g}function q(a,b,f){for(var v=[],c=0;c<f.length;++c)v.push(k(f[c]));f=[];c=0;a:for(;c<a;++c){for(var m=b[0]+1*c/(a-1)*(b[b.length-1]-b[0]),l=0;l<b.length-1;++l)if(m>=b[l]&&m<=b[l+1]){var m=(m-b[l])/(b[l+1]-b[l]),C=v[l],l=v[l+1],l=(new n(C.red*(1-m)+l.red*m|0,C.green*(1-m)+l.green*m|0,C.blue*(1-m)+l.blue*m|0)).toSvgString();f.push(l);continue a}throw"Bad step";
}return f}function p(a,b,f,v){return v?q(a,[0,.5,1],[b,f,v]):q(a,[0,1],[b,f])}n.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};n.prototype.toHexString=function(){return"#"+l(this.red)+l(this.green)+l(this.blue)};var x={red:new n(255,0,0,"red"),green:new n(0,255,0,"green"),blue:new n(0,0,255,"blue"),yellow:new n(255,255,0,"yellow"),white:new n(255,255,255,"white"),black:new n(0,0,0,"black"),gray:new n(180,180,180,"gray"),grey:new n(180,
180,180,"grey"),lightskyblue:new n(135,206,250,"lightskyblue"),lightsalmon:new n(255,160,122,"lightsalmon"),hotpink:new n(255,105,180,"hotpink")},C=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,b=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;"undefined"!==typeof u&&(u.exports={makeColourSteps:q,makeGradient:p,dasColourForName:k})},{}],10:[function(c,u,t){function n(a,d,b,e){this.name=a;this.start=d;this.end=b;this.description=e}function l(a,d){var b;"string"==typeof a?(this.uri=a,b=d||{}):b=a||{};for(var e in b)this[e]=
b[e];this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function k(){}function q(a,d){return a.taxon==d.taxon&&a.auth==d.auth&&a.version==d.version}function p(a,d,b,e,h){this.name=a;this.start=d;this.end=b;this.alphabet=e;this.seq=h}function x(){}function C(a){a&&(this.id=a)}function b(a,d){this.desc=a;this.uri=d}function a(a){this.type=a;this.objects={};this.blocks=[]}function g(){this.styles=
[]}function f(){}function v(a,d){d=d||{};this.uri=a;this.opts=d}function z(a,d){var b=a.getElementsByTagName(d);if(0<b.length&&b[0].firstChild){b=b[0];if(1==b.childNodes.length)return b.firstChild.nodeValue;for(var e="",h=0;h<b.childNodes.length;++h)e+=b.childNodes[h].nodeValue;return e}return null}function m(a){for(var d=[],e=a.getElementsByTagName("LINK"),h=0;h<e.length;++h){var g=e[h];g.parentNode==a&&d.push(new b(g.firstChild?g.firstChild.nodeValue:"Unknown",g.getAttribute("href")))}return d}
function F(a){var d=[];a=a.getElementsByTagName("NOTE");for(var b=0;b<a.length;++b)a[b].firstChild&&d.push(a[b].firstChild.nodeValue);return d}function A(a,d,b,e){if(window.XDomainRequest){var h=new XDomainRequest;h.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(h.responseText);d(a)};h.open("get",a);h.send("")}else try{var h=new XMLHttpRequest,g=setTimeout(function(){console.log("timing out "+a);h.abort();d(null,h)},5E3);h.timeout=5E3;h.ontimeout=function(){console.log("timeout on "+
a)};h.onreadystatechange=function(){4==h.readyState&&(clearTimeout(g),(200<=h.status||0==h.status)&&d(h.responseXML,h))};h.open("get",a,!0);b&&(h.withCredentials=!0);e&&h.setRequestHeader("X-DAS-Authorisation",e);h.overrideMimeType("text/xml");h.setRequestHeader("Accept","application/xml,*/*");h.send("")}catch(f){d(null,h,f)}}function T(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function d(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function e(a){var d=h(a);d.styles=
[];for(var b=0;b<a.styles.length;++b){var e=d.styles[b]=h(a.styles[b]);e._methodRE=e._labelRE=e._typeRE=void 0;e.style=h(e.style);e.style.id=void 0;e.style._gradient=void 0}return d}if("undefined"!==typeof c){t=c("./utils");var h=t.shallowCopy,y=t.pusho,B=c("./color").makeColourSteps}n.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};n.prototype.isBounded=function(){return this.start&&this.end};n.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&
(a+=":"+this.start+","+this.end);return a};l.prototype.getURI=function(a){return this.resolver?this.resolver(a).then(function(a){return"string"===typeof a?a:a.url}):Promise.resolve(a)};l.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(d){if(!d)return a([]);var b=[];d=d.getElementsByTagName("SEGMENT");for(var e=0;e<d.length;++e){var h=d[e],g=h.getAttribute("id"),f=h.getAttribute("size"),m;f?(m=1,f|=0):((m=h.getAttribute("start"))&&(m|=0),(f=h.getAttribute("stop"))&&
(f|=0));var y=null;h.firstChild&&(y=h.firstChild.nodeValue);b.push(new n(g,m,f,y))}a(b)})};l.prototype.sequence=function(a,d){var b=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(b,function(a){if(a){var b=[];a=a.getElementsByTagName("SEQUENCE");for(var e=0;e<a.length;++e){var h=a[e],g=h.getAttribute("id"),f=h.getAttribute("start"),r=h.getAttribute("stop"),w=null;if(h.firstChild)for(var h=h.firstChild.nodeValue,w="",m=0;;){var y=h.indexOf("\n",m);if(0<=y)w+=h.substring(m,y).toUpperCase(),
m=y+1;else{w+=h.substring(m).toUpperCase();break}}b.push(new p(g,f,r,"DNA",w))}d(b)}else d([])})};l.prototype.features=function(a,d,b){d=d||{};var e;if(this.features_uri)e=this.features_uri;else{var h=[];if(a)h.push(a.toDASQuery());else if(d.group)if(a=d.group,"string"==typeof a)h.push("group_id="+a);else for(var g=0;g<a.length;++g)h.push("group_id="+a[g]);if(d.adjacent)for(a=d.adjacent,"string"==typeof a&&(a=[a]),g=0;g<a.length;++g)h.push("adjacent="+a[g]);if(d.type)if("string"==typeof d.type)h.push("type="+
d.type);else for(a=0;a<d.type.length;++a)h.push("type="+d.type[a]);d.maxbins&&h.push("maxbins="+d.maxbins);0<h.length?e=this.dasBaseURI+"features?"+h.join(";"):b([],"No filters specified")}this.doCrossDomainRequest(e,function(a,d){if(a){for(var e=[],h={},g=a.getElementsByTagName("SEGMENT"),f=0;f<g.length;++f){var r=g[f],y=r.getAttribute("id");h[y]={min:r.getAttribute("start"),max:r.getAttribute("stop")};for(var r=r.getElementsByTagName("FEATURE"),v=0;v<r.length;++v){var k=r[v],c=new x;c.segment=y;
c.id=k.getAttribute("id");c.label=k.getAttribute("label");var B=z(k,"START"),l=z(k,"END");(B|0)>(l|0)?(c.min=l|0,c.max=B|0):(c.min=B|0,c.max=l|0);B=k.getElementsByTagName("TYPE");0<B.length&&(B=B[0],B.firstChild&&(c.type=B.firstChild.nodeValue),c.typeId=B.getAttribute("id"),c.typeCv=B.getAttribute("cvId"));c.type=z(k,"TYPE");!c.type&&c.typeId&&(c.type=c.typeId);c.method=z(k,"METHOD");(B=z(k,"ORIENTATION"))||(B="0");c.orientation=B;c.score=z(k,"SCORE");c.links=m(k);c.notes=F(k);B=k.getElementsByTagName("GROUP");
for(l=0;l<B.length;++l){var D=B[l],p=new C;p.type=D.getAttribute("type");p.id=D.getAttribute("id");p.links=m(D);p.notes=F(D);c.groups?c.groups.push(p):c.groups=Array(p)}if(c.notes)for(B=0;B<c.notes.length;++B)l=c.notes[B],0==l.indexOf("Genename=")&&(D=new C,D.type="gene",D.id=l.substring(9),c.groups?c.groups.push(D):c.groups=Array(D));B=k.getElementsByTagName("PART");if(0<B.length){D=[];for(l=0;l<B.length;++l)D.push(B[l].getAttribute("id"));c.parts=D}B=k.getElementsByTagName("PARENT");if(0<B.length){k=
[];for(l=0;l<B.length;++l)k.push(B[l].getAttribute("id"));c.parents=k}e.push(c)}}b(e,void 0,h)}else b([],"Failed request: "+(0==d.status?"server may not support CORS":"status="+d.status))},function(a){b([],a)})};l.prototype.alignments=function(d,b,e){var h=this.dasBaseURI+"alignment?query="+d;this.doCrossDomainRequest(h,function(d){if(d){var b=[];d=d.getElementsByTagName("alignment");for(var g=0;g<d.length;++g){for(var f=d[g],r=new a(f.getAttribute("alignType")),m=f.getElementsByTagName("alignObject"),
w=0;w<m.length;++w){var y=m[w],y={id:y.getAttribute("intObjectId"),accession:y.getAttribute("dbAccessionId"),version:y.getAttribute("objectVersion"),dbSource:y.getAttribute("dbSource"),dbVersion:y.getAttribute("dbVersion")};r.objects[y.id]=y}f=f.getElementsByTagName("block");for(m=0;m<f.length;++m){for(var y=f[m],w={order:y.getAttribute("blockOrder"),segments:[]},y=y.getElementsByTagName("segment"),c=0;c<y.length;++c){var v=y[c],v={object:v.getAttribute("intObjectId"),min:v.getAttribute("start"),
max:v.getAttribute("end"),strand:v.getAttribute("strand"),cigar:z(v,"cigar")};w.segments.push(v)}r.blocks.push(w)}b.push(r)}e(b)}else e([],"Failed request "+h)})};g.prototype.pushStyle=function(a,d,b){a||(a={type:"default"});a=h(a);d&&(a.zoom=d);a.style=b;this.styles.push(a)};l.prototype.stylesheet=function(a,d){var b,e=this.credentials;this.stylesheet_uri?(b=this.stylesheet_uri,e=!1):b=this.dasBaseURI+"stylesheet";this.getURI(b).then(function(b){A(b,function(b){if(b){var e=new g;b=b.getElementsByTagName("TYPE");
for(var h=0;h<b.length;++h){var m=b[h],y={};y.type=m.getAttribute("id");y.label=m.getAttribute("label");y.method=m.getAttribute("method");for(var m=m.getElementsByTagName("GLYPH"),w=0;w<m.length;++w){var c=m[w],v=c.getAttribute("zoom"),k;a:{if(c.hasChildNodes()){c=c.firstChild;do{if(c.nodeType==Node.ELEMENT_NODE){k=c;break a}c=c.nextSibling}while(null!=c)}k=null}c=new f;c.glyph=k.localName;for(k=k.firstChild;k;){if(k.nodeType==Node.ELEMENT_NODE)if("BGGRAD"==k.localName){var l=c,z=k.localName,C,p=
k;C=(C=p.getAttribute("steps"))?C|0:50;for(var A=[],n=[],p=p.getElementsByTagName("STOP"),H=0;H<p.length;++H){var F=p[H];A.push(1*F.getAttribute("score"));n.push(F.firstChild.nodeValue)}C=B(C,A,n);l[z]=C}else c[k.localName]=k.firstChild.nodeValue;k=k.nextSibling}e.pushStyle(y,v,c)}}a(e)}else d&&d()},e)}).catch(function(a){console.log(a);d()})};v.prototype.sources=function(a,d,b){b||(b={});var e=[];b.taxon&&e.push("organism="+b.taxon);b.auth&&e.push("authority="+b.auth);b.version&&e.push("version="+
b.version);b=this.uri;0<e.length&&(b=b+"?"+e.join("&"));A(b,function(b){if(!b&&d)d();else{var e=[];b=b.getElementsByTagName("SOURCE");for(var h=0;h<b.length;++h){var g=b[h],f=g.getElementsByTagName("VERSION");if(!(1>f.length)){for(var m=f[0],w=m.getElementsByTagName("COORDINATES"),f=[],c=0;c<w.length;++c){var v=w[c],B=new k;B.auth=v.getAttribute("authority");B.taxon=v.getAttribute("taxid");B.version=v.getAttribute("version");f.push(B)}for(var w=[],v=m.getElementsByTagName("CAPABILITY"),z,c=0;c<v.length;++c)B=
v[c],w.push(B.getAttribute("type")),"das1:features"==B.getAttribute("type")&&(z=B.getAttribute("query_uri"),z=z.substring(0,z.length-8));c={};m=m.getElementsByTagName("PROP");for(v=0;v<m.length;++v)y(c,m[v].getAttribute("name"),m[v].getAttribute("value"));z&&(g=new l(z,{source_uri:g.getAttribute("uri"),name:g.getAttribute("title"),desc:g.getAttribute("description"),coords:f,props:c,capabilities:w}),e.push(g))}}a(e)}})};l.prototype.doCrossDomainRequest=function(a,d,b){var e;this.xUser&&(e="Basic "+
btoa(this.xUser+":"+this.xPass));try{return A(a,d,this.credentials,e)}catch(h){if(b)b(h);else throw h;}};"undefined"!==typeof u&&(u.exports={DASGroup:C,DASFeature:x,DASStylesheet:g,DASStyle:f,DASSource:l,DASSegment:n,DASRegistry:v,DASSequence:p,DASLink:b,isDasBooleanTrue:T,isDasBooleanNotFalse:d,copyStylesheet:e,coordsMatch:q})},{"./color":9,"./utils":49}],11:[function(c,u,t){function n(c,l,C){function b(){C?(a.className="fa fa-caret-down",l.style.display="table"):(a.className="fa fa-caret-right",
l.style.display="none")}var a=k("i");b();a.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();C=!C;b()},!1);c=k("h6",[a," ",c],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return k("div",[c,l],{})}if("undefined"!==typeof c){var l=c("./cbrowser").Browser;c=c("./utils");var k=c.makeElement,q=c.removeChildren}l.prototype.removeAllPopups=function(){q(this.hPopupHolder);q(this.popupHolder)};l.prototype.makeTooltip=function(c,
l){var C=!1,b=this,a=null,g;g=function(b){C=!1;a&&(clearTimeout(a),a=null);c.removeEventListener("mouseout",g,!1)};var f=function(g){var z=g.clientX+window.scrollX,m=g.clientY+window.scrollY;a||(a=setTimeout(function(){var g;g="function"===typeof l?l():l;var v=k("div",[k("div",null,{className:"tooltip-arrow"}),k("div",g,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(m+20)+"px",left:""+Math.max(z-30,20)+"px"});b.hPopupHolder.appendChild(v);var n;n=function(a){try{b.hPopupHolder.removeChild(v)}catch(e){}window.removeEventListener("mousemove",
n,!1);C&&null!=c.offsetParent&&f(a)};window.addEventListener("mousemove",n,!1);a=null},1E3))};c.addEventListener("mouseover",function(a){C=!0;c.addEventListener("mouseout",g,!1);f(a)},!1);c.addEventListener("DOMNodeRemovedFromDocument",function(b){C=!1;a&&(clearTimeout(a),a=null)},!1)};l.prototype.popit=function(c,l,C,b){var a=this;b||(b={});c||(c={});var g=b.width||200,f;c.clientX?(b=c.clientX,f=c.clientY):(b=500,f=50);b+=document.documentElement.scrollLeft||document.body.scrollLeft;f+=document.documentElement.scrollTop||
document.body.scrollTop;var v=window.innerWidth,z=f,m=Math.min(b-g/2-4,v-g-30),n=k("div");n.className="popover fade "+(c.clientX?"bottom ":"")+"in";n.style.display="block";n.style.position="absolute";n.style.top=""+z+"px";n.style.left=""+m+"px";n.style.width=g+"px";276<g&&(n.style.maxWidth=g+"px");n.appendChild(k("div",null,{className:"arrow"}));if(l){var A=k("button","",{className:"close"});A.innerHTML="&times;";A.addEventListener("mouseover",function(a){A.style.color="red"},!1);A.addEventListener("mouseout",
function(a){A.style.color="black"},!1);A.addEventListener("click",function(d){d.preventDefault();d.stopPropagation();a.removeAllPopups()},!1);c=k("h4",[k("span",l,null,{maxWidth:"200px"}),A],{},{paddingLeft:"10px",paddingRight:"10px"});var q,d,e,h;e=function(a){a.stopPropagation();a.preventDefault();m+=a.clientX-q;8>m&&(m=8);m>v-g-32&&(m=v-g-26);z+=a.clientY-d;z=Math.max(10,z);n.style.top=""+z+"px";n.style.left=""+Math.min(m,v-g-10)+"px";q=a.clientX;d=a.clientY};h=function(a){a.stopPropagation();
a.preventDefault();window.removeEventListener("mousemove",e,!1);window.removeEventListener("mouseup",h,!1)};c.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();q=a.clientX;d=a.clientY;window.addEventListener("mousemove",e,!1);window.addEventListener("mouseup",h,!1)},!1);n.appendChild(c)}n.appendChild(k("div",C,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(n);var y={node:n,displayed:!0};n.addEventListener("DOMNodeRemoved",function(a){a.target==
n&&(y.displayed=!1)},!1);return y};"undefined"!==typeof u&&(u.exports={makeTreeTableSection:n})},{"./cbrowser":6,"./utils":49}],12:[function(c,u,t){function n(c,k){0>c.indexOf("?")&&(c+="?soft=true");return new q(function(l,b){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(300<=a.status)b("Error code "+a.status);else{var g=JSON.parse(a.response);l(k?g:g.location)}};a.open("GET",c,!0);a.setRequestHeader("Accept","application/json");a.responseType="text";a.send("")})}
function l(c){this.rawurl=c}function k(c,k,C,b){b||("object"===typeof k?(b=k,k=void 0):b={});this.url="string"===typeof c?new l(c):c;this.start=k||0;C&&(this.end=C);this.opts=b}if("undefined"!==typeof c)var q=c("es6-promise").Promise;l.prototype.getURLPromise=function(){this.urlPromise&&this.urlPromiseValidity>Date.now()||(this.urlPromise=n(this.rawurl,!0).then(function(c){return c.location}),this.urlPromiseValidity=Date.now()+432E5);return this.urlPromise};k.prototype.slice=function(c,l){if(0>c)throw"Bad slice "+
c;var C=this.start,b=this.end,C=C&&c?C+c:c||C;return new k(this.url,C,l&&C?C+l-1:b||l-1,this.opts)};k.prototype.fetchAsText=function(c){var k=this,l=new XMLHttpRequest;k.url.getURLPromise().then(function(b){l.open("GET",b,!0);if(k.end){if(1E8<k.end-k.start)throw"Monster fetch!";l.setRequestHeader("Range","bytes="+k.start+"-"+k.end)}l.onreadystatechange=function(){if(4==l.readyState)return 200==l.status||206==l.status?c(l.responseText):c(null)};k.opts.credentials&&(l.withCredentials=!0);l.send("")}).catch(function(b){console.log(b);
return c(null)})};k.prototype.salted=function(){return this};k.prototype.fetch=function(c,k,l){var b=this;k=k||1;if(3<k)return c(null);b.url.getURLPromise().then(function(a){var g=new XMLHttpRequest,f;g.open("GET",a,!0);g.overrideMimeType("text/plain; charset=x-user-defined");if(b.end){if(1E8<b.end-b.start)throw"Monster fetch!";g.setRequestHeader("Range","bytes="+b.start+"-"+b.end);f=b.end-b.start+1}g.responseType="arraybuffer";g.onreadystatechange=function(){if(4==g.readyState){if(200==g.status||
206==g.status){if(g.response){var a=g.response.byteLength;return!f||f==a||l&&a==l?c(g.response):b.fetch(c,k+1,a)}if(g.mozResponseArrayBuffer)return c(g.mozResponseArrayBuffer);a=g.responseText;if(!f||f==a.length||l&&a.length==l){if(a=g.responseText){for(var z=new Uint8Array(a.length),m=0;m<z.length;++m)z[m]=a.charCodeAt(m);a=z.buffer}else a=null;return c(a)}return b.fetch(c,k+1,a.length)}return b.fetch(c,k+1)}};b.opts.credentials&&(g.withCredentials=!0);g.send("")}).catch(function(a){console.log(a)})};
"undefined"!==typeof u&&(u.exports={lookupEncodeURI:n,EncodeFetchable:k})},{"es6-promise":53}],13:[function(c,u,t){function n(b){k.call(this);this.source=b;this.base=b.uri||"//rest.ensembl.org";if(0===this.base.indexOf("//")){var a=window.location.protocol;"http:"!=a&&"https:"!=a&&(this.base="http:"+this.base)}this.species=b.species||"human";this.type="string"===typeof b.type?[b.type]:b.type||["regulatory"]}if("undefined"!==typeof c){u=c("./sourceadapters");var l=u.registerSourceAdapterFactory,k=
u.FeatureSourceBase;c=c("./das");var q=c.DASStylesheet,p=c.DASStyle,x=c.DASFeature,C=c.DASGroup}n.prototype=Object.create(k.prototype);n.prototype.constructor=n;n.prototype.getStyleSheet=function(b){var a=new q,g=new p;g.glyph="__NONE";0<=this.type.indexOf("exon")&&a.pushStyle({type:"transcript"},null,g);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&a.pushStyle({type:"gene"},null,g);g=new p;g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="red";g.HEIGHT=8;g.BUMP=!0;g.LABEL=!0;g.ZINDEX=
10;a.pushStyle({type:"cds"},null,g);g=new p;g.glyph="SQUARE";g.BUMP="yes";g.LABEL="no";g.FGCOLOR="blue";a.pushStyle({type:"variation",method:".+_UTR_variant"},null,g);g=new p;g.glyph="TRIANGLE";g.DIRECTION="S";g.BUMP="yes";g.LABEL="no";g.FGCOLOR="blue";a.pushStyle({type:"variation",method:"missense_variant"},null,g);g=new p;g.glyph="TRIANGLE";g.DIRECTION="N";g.BUMP="yes";g.LABEL="no";g.FGCOLOR="blue";a.pushStyle({type:"variation",method:"splice_.+_variant"},null,g);g=new p;g.glyph="STAR";g.POINTS=
6;g.BUMP="yes";g.LABEL="no";g.FGCOLOR="blue";a.pushStyle({type:"variation",method:"regulatory_region_variant"},null,g);g=new p;g.glyph="PLIMSOLL";g.BUMP="yes";g.LABEL="no";g.FGCOLOR="rgb(50,80,255)";g.STROKECOLOR="black";a.pushStyle({type:"variation"},null,g);g=new p;g.glyph="SQUARE";g.BUMP="yes";g.LABEL="no";g.BGCOLOR="#888888";g.FGCOLOR="red";a.pushStyle({type:"indel",method:".+_UTR_variant"},null,g);g=new p;g.glyph="TRIANGLE";g.DIRECTION="S";g.BUMP="yes";g.LABEL="no";g.BGCOLOR="#888888";g.FGCOLOR=
"red";a.pushStyle({type:"indel",method:"missense_variant"},null,g);g=new p;g.glyph="TRIANGLE";g.DIRECTION="N";g.BUMP="yes";g.LABEL="no";g.BGCOLOR="#888888";g.FGCOLOR="red";a.pushStyle({type:"indel",method:"splice_.+_variant"},null,g);g=new p;g.glyph="STAR";g.POINTS=6;g.BUMP="yes";g.LABEL="no";g.BGCOLOR="#888888";g.FGCOLOR="red";a.pushStyle({type:"indel",method:"regulatory_region_variant"},null,g);g=new p;g.glyph="PLIMSOLL";g.BUMP="yes";g.LABEL="no";g.BGCOLOR="#888888";g.FGCOLOR="red";g.STROKECOLOR=
"black";a.pushStyle({type:"indel"},null,g);g=new p;g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="orange";g.HEIGHT=8;g.BUMP=!0;g.LABEL=!0;g.ZINDEX=20;a.pushStyle({type:"default"},null,g);return b(a)};n.prototype.getScales=function(){return[]};n.prototype.fetch=function(b,a,g,f,c,k,m){var l=this;a=this.base+"/overlap/region/"+this.species+"/"+b+":"+a+"-"+g;g=[];for(f=0;f<this.type.length;++f)g.push("feature="+this.type[f]);g.push("content-type=application/json");a=a+"?"+g.join(";");var n=new XMLHttpRequest;
n.onreadystatechange=function(){if(4==n.readyState)if(l.busy--,l.notifyActivity(),300<=n.status){var a="Error code "+n.status;try{var d=JSON.parse(n.response);d.error&&(a=d.error)}catch(e){}m(a,null)}else{for(var a=JSON.parse(n.response),d=[],h=0;h<a.length;++h){var g=a[h],f=[],r=new x;r.segment=b;r.min=g.start|0;r.max=g.end|0;r.type=g.feature_type||"unknown";r.id=g.ID;if(g.Parent){var c=new C;c.id=g.Parent;r.groups=[c]}g.strand&&(0>g.strand?r.orientation="-":0<g.strand&&(r.orientation="+"));g.consequence_type&&
(r.method=g.consequence_type);g.alt_alleles&&(f.push("Alleles="+g.alt_alleles.join("/")),1<g.alt_alleles.length&&(g.alt_alleles[1].length!=g.alt_alleles[0].length||"-"==g.alt_alleles[1])&&(r.type="indel"));0<f.length&&(r.notes=f);d.push(r)}m(null,d)}};l.busy++;l.notifyActivity();n.open("GET",a,!0);n.responseType="text";n.send("")};l("ensembl",function(b){return{features:new n(b)}})},{"./das":10,"./sourceadapters":34}],14:[function(c,u,t){if("undefined"!==typeof c)var n=c("./cbrowser").Browser,l=c("./utils").shallowCopy,
k=c("./sha1").hex_sha1,q=c("./das").copyStylesheet;n.prototype.exportFullConfig=function(c){c={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+k(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),chains:this.exportChains()};this.prefix&&(c.prefix=this.prefix);return c};n.prototype.exportChains=function(){var c={},k=this.chains||{},l;for(l in k)c[l]=k[l].exportConfig();return c};n.prototype.exportSourceConfig=function(c){c=[];for(var k=
0;k<this.tiers.length;++k){var n=this.tiers[k],b=l(n.dasSource);b.noPersist||(b.coords=void 0,b.props=void 0,b.disabled||(b.disabled=void 0),n.config.stylesheet?(b.style=q(n.config.stylesheet).styles,b.stylesheet_uri=void 0):b.style&&(b.style=q({styles:b.style}).styles),"string"===typeof n.config.name&&(b.name=n.config.name),void 0!==n.config.height&&(b.forceHeight=n.config.height),void 0!==n.config.forceMin&&(b.forceMin=n.config.forceMin),n.config.forceMinDynamic&&(b.forceMinDynamic=n.config.forceMinDynamic),
void 0!==n.config.forceMax&&(b.forceMax=n.config.forceMax),void 0!==n.config.bumped&&(b.bumped=n.config.bumped),n.config.forceMaxDynamic&&(b.forceMaxDynamic=n.config.forceMaxDynamic),c.push(b))}return c};n.prototype.exportPageTemplate=function(c){c=c||{};return'<html>\n  <head>\n    <script language="javascript" src="'+this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+JSON.stringify(this.exportFullConfig(c),
null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},{"./cbrowser":6,"./das":10,"./sha1":33,"./utils":49}],15:[function(c,u,t){if("undefined"!==typeof c)var n=c("./cbrowser").Browser,l=c("./glyphs").OverlayLabelCanvas,k=c("./numformats").formatQuantLabel,q=c("./sequence-draw").drawSeqTierGC;n.prototype.exportImage=function(c){c=c||{};for(var n=this.featurePanelWidth,C=0,b=0;b<this.tiers.length;++b){0<b&&(C+=3);var a=this.tiers[b];
void 0!==a.layoutHeight&&(C+=a.layoutHeight)}var g=c.resolutionMultiplier||1,b=(n+200)*g|0,a=C*g|0,C=makeElement("canvas",null,{width:b,height:a}),f=C.getContext("2d");f.fillStyle="white";f.fillRect(0,0,b,a);f.scale(g,g);for(b=g=0;b<this.tiers.length;++b){var a=this.tiers[b],v=(a.glyphCacheOrigin-this.viewStart)*this.scale,z=new l;f.save();f.translate(0,g);f.save();f.beginPath();f.moveTo(200,0);f.lineTo(200+n,0);f.lineTo(200+n,a.layoutHeight);f.lineTo(200,a.layoutHeight);f.closePath();f.clip();f.translate(200,
0);f.save();f.translate(v,0);a.subtiers?a.paintToContext(f,z,v+1E3):q(a,a.currentSequence,f);f.restore();f.save();f.translate(v,0);z.draw(f,-v,n-v);f.restore();f.restore();for(var z=!1,m=0,F=a.subtiers||[],A=0;A<F.length;++A){var t=F[A];if(t.quant){var z=!0,d=t.quant,e=t.height,h=2;40<e&&(h=1+(e/20|0));var e=e/(h-1),y=(d.max-d.min)/(h-1);f.beginPath();f.moveTo(205,m);f.lineTo(200,m);f.lineTo(200,m+t.height);f.lineTo(205,m+t.height);for(var B=1;B<h-1;++B){var r=B*e;f.moveTo(200,m+r);f.lineTo(203,m+
r)}f.strokeStyle="black";f.strokeWidth=2;f.stroke();f.fillStyle="black";var B=k(d.max),D=m+7;f.fillText(B,197-f.measureText(B).width,D);B=k(d.min);D=m+t.height;f.fillText(B,197-f.measureText(B).width,D);for(B=1;B<h-1;++B)r=B*e,D=k(1*d.max-B*y),r=m+r+3,f.fillText(D,197-f.measureText(D).width,r)}m+=t.height+3}m="string"===typeof a.config.name?a.config.name:a.dasSource.name;F=f.measureText(m).width;f.fillStyle="black";f.fillText(m,200-(z?22:12)-F,(a.layoutHeight+6)/2);f.restore();g+=a.layoutHeight+3}if(c.highlights){f.save();
f.beginPath();f.moveTo(200,0);f.lineTo(200+n,0);f.lineTo(200+n,g);f.lineTo(200,g);f.closePath();f.clip();f.translate(200+v,0);v=n=this.viewStart;b=this.viewEnd;for(a=0;a<this.highlights.length;++a)e=this.highlights[a],(e.chr===this.chr||e.chr==="chr"+this.chr)&&e.min<b&&e.max>v&&(f.globalAlpha=this.defaultHighlightAlpha,f.fillStyle=this.defaultHighlightFill,f.fillRect((e.min-n)*this.scale,0,(e.max-e.min)*this.scale,g));f.restore()}n=-1;"center"==c.ruler?n=200+(this.viewEnd-this.viewStart+1)*this.scale/
2:"left"==c.ruler?n=200:"right"==c.ruler&&(n=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=n&&(f.strokeStyle="blue",f.beginPath(),f.moveTo(n,0),f.lineTo(n,g),f.stroke());return C.toDataURL("image/png")}},{"./cbrowser":6,"./glyphs":21,"./numformats":26,"./sequence-draw":31}],16:[function(c,u,t){if("undefined"!==typeof c){var n=c("./cbrowser").Browser;c=c("./utils");var l=c.makeElement,k=c.removeChildren}n.prototype.openExportPanel=function(){var c=this;if("export"===this.uiMode)this.hideToolPanel(),
this.setUiMode("none");else{var n=l("div",null,{className:"export-form"}),x=l("select");x.appendChild(l("option","SVG",{value:"svg"}));x.appendChild(l("option","Image",{value:"png"}));x.appendChild(l("option","Dalliance config",{value:"config"}));x.appendChild(l("option","Dalliance sources",{value:"sources"}));x.appendChild(l("option","Dalliance page",{value:"page"}));x.value="svg";x.addEventListener("change",function(a){k(f);A()},!1);n.appendChild(l("p",["Export as: ",x]));var C=l("input",null,{type:"checkbox",
checked:this.exportHighlights});C.addEventListener("change",function(a){c.exportHighlights=C.checked;c.storeStatus()},!1);var b=l("input",null,{type:"checkbox",checked:this.exportRuler});b.addEventListener("change",function(a){c.exportRuler=b.checked;c.storeStatus()},!1);var a=l("input",null,{type:"text",value:"1.0"}),g=l("button","Export",{className:"btn btn-primary"});g.addEventListener("click",function(g){k(f);var d,e,h,m;if("svg"===x.value)d=URL.createObjectURL(c.makeSVG({highlights:C.checked,
ruler:b.checked?c.rulerLocation:"none"})),e="SVG",h="image/svg",m="dalliance-view.svg";else if("png"===x.value){h=parseFloat(a.value);if(.1>h||10<h){alert("bad scale "+h);return}d=c.exportImage({highlights:C.checked,ruler:b.checked?c.rulerLocation:"none",resolutionMultiplier:h});e="Image";h="image/png";m="dalliance-view.png"}else"config"===x.value?(h=JSON.stringify(c.exportFullConfig(),null,2),e=new Blob([h],{type:"text/plain"}),d=URL.createObjectURL(e),e="Configuration",h="text/plain",m="dalliance-config.json"):
"sources"===x.value?(h=JSON.stringify(c.exportSourceConfig(),null,2),e=new Blob([h],{type:"text/plain"}),d=URL.createObjectURL(e),e="Source array",h="text/plain",m="dalliance-sources.json"):"page"===x.value&&(e=c.exportPageTemplate(),h="text/html",e=new Blob([e],{type:h}),d=URL.createObjectURL(e),e="Page template",m="dalliance-view.html");d&&(g=l("a","[Download]",{href:d,download:m,type:h}),h=l("a","[Preview in browser]",{href:d,type:h,target:"_new"}),f.appendChild(l("p",[""+e+" created: ",g,h])))},
!1);c.addViewListener(function(){k(f)});c.addTierListener(function(){k(f)});var f=l("p",""),v=l("tr",[l("th","Include highlights",{},{width:"200px",textAlign:"right"}),l("td",C)]),z=l("tr",[l("th","Include vertical guideline"),l("td",b)]),m=l("tr",[l("th","Scale multiplier"),l("td",a)]),F=l("table",[v,z,m]),A=function(){var a=x.value;v.style.display="svg"==a||"png"==a?"table-row":"none";z.style.display="svg"==a||"png"==a?"table-row":"none";m.style.display="png"==a?"table-row":"none"};A();n.appendChild(F);
n.appendChild(g);n.appendChild(f);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(n,this.svgHolder);this.activeToolPanel=n;this.setUiMode("export")}}},{"./cbrowser":6,"./utils":49}],17:[function(c,u,t){u=c("./cbrowser");t=c("./chainset");var n=c("./sourceadapters"),l=c("./utils"),k=c("./das");c=c("./sourcecompare");window.Browser=u.Browser;window.sourcesAreEqual=c.sourcesAreEqual;window.Chainset=t.Chainset;window.makeElement=l.makeElement;window.dalliance_registerSourceAdapterFactory=
n.registerSourceAdapterFactory;window.dalliance_registerParserFactory=n.registerParserFactory;window.dalliance_makeParser=n.makeParser;window.DASSequence=k.DASSequence;window.DASFeature=k.DASFeature;window.DASGroup=k.DASGroup;window.DASStylesheet=k.DASStylesheet;window.DASStyle=k.DASStyle;window.DASSource=k.DASSource},{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":34,"./sourcecompare":35,"./utils":49}],18:[function(c,u,t){function n(){this.glyphs=[];this.height=0;this.quant=null}function l(a){Date.now();
Y=a.viewport.getContext("2d");a.padding="number"===typeof a.dasSource.padding?a.dasSource.padding:3;a.scaleVertical="boolean"===typeof a.dasSource.scaleVertical?a.dasSource.scaleVertical:!1;var d=[],e={},h={},g;for(g in a.ungroupedFeatures)for(var f=a.ungroupedFeatures[g],w=0;w<f.length;++w){var c=f[w];if(!c.parts){var m=a.styleForFeature(c);if(m)if("LINEPLOT"==m.glyph)b(e,m.id,c),h[m.id]=m;else{var r=q(c,0,m,a);r&&d.push(r)}}}for(var y in e)g=e[y],m=h[y],"LINEPLOT"==m.glyph&&d.push(p(g,m,a));if(a.dasSource.collapseSuperGroups&&
!a.bumped)for(var v in a.superGroups){e=a.superGroups[v];a.groups[v]=C(a.groups[v]);a.groups[v].isSuperGroup=!0;h={};y=1E10;f=-1E10;w=null;for(r=0;r<e.length;++r)if(g=a.groupedFeatures[e[r]]){for(m=0;m<g.length;++m)c=g[m],b(h,c.type,c),y=Math.min(c.min,y),f=Math.max(c.max,f),c.segment&&!w&&(w=c.segment);if(a.groups[v]&&!a.groups[v].links||0==a.groups[v].links.length)a.groups[v].links=a.groups[e[0]].links;delete a.groupedFeatures[e[r]]}a.groups[v].max=f;a.groups[v].min=y;a.groups[v].segment=w;for(var l in h){g=
h[l];y=g[0];f=null;for(m=0;m<g.length;++m)c=g[m],c=new E(c.min,c.max),f=f?U(f,c):c;f=f.ranges();for(w=0;w<f.length;++w){for(var B=f[w],z=((B.max()|0)-(B.min()|0)+1)*e.length,D=0,m=0;m<g.length;++m)if(c=g[m],(c.min|0)<=B.max()&&(c.max|0)>=B.min())var A=Math.max(c.min|0,B.min()),c=Math.min(c.max|0,B.max()),D=D+(c-A+1);var c=new K,H;for(H in y)c[H]=y[H];c.min=B.min();c.max=B.max();c.label&&1<e.length&&(c.label+=" ("+e.length+" vars)");c.visualWeight=1*D/z;b(a.groupedFeatures,v,c)}}delete a.superGroups[v]}H=
[];for(var F in a.groupedFeatures)H.push(F);H.sort(function(d,b){var e=a.groupedFeatures[d][0].score-a.groupedFeatures[b][0].score;return 0<e?-1:0==e?0:1});l={};for(c=0;c<H.length;++c)if(F=H[c],r=k(a.groupedFeatures[F],0,a.groups[F],a,a.dasSource.collapseSuperGroups&&!a.bumped?"collapsed_gene":"tent"))r.group=a.groups[F],l[F]=r;for(v in a.superGroups){e=a.superGroups[v];F=[];y=1E10;f=-1E10;for(H=0;H<e.length;++H)c=l[e[H]],l[e[H]]=null,c&&(F.push(c),y=Math.min(y,c.min()),f=Math.max(f,c.max()));for(H=
0;H<F.length;++H)c=F[H],d.push(new T(c,y,f))}for(r in l)(c=l[r])&&d.push(c);v=new n;F=[];l=a.subtierMax||a.dasSource.subtierMax||a.browser.defaultSubtierMax;H=!1;c=0;a:for(;c<d.length;++c)if(r=d[c],r.bump&&(a.bumped||a.dasSource.collapseSuperGroups)){for(e=0;e<F.length;++e)if(h=F[e],h.hasSpaceFor(r)){h.add(r);continue a}F.length>=l?H=!0:(h=new n,h.add(r),F.push(h))}else v.add(r);0<v.glyphs.length&&(F=[v].concat(F));for(e=0;e<F.length;++e)h=F[e],h.quant&&h.glyphs.unshift(new J(h.height));for(e=0;e<
F.length;++e)h=F[e],h.glyphs.sort(function(a,d){return(a.zindex||0)-(d.zindex||0)});a.subtiers=F;a.glyphCacheOrigin=a.browser.viewStart;H?a.updateStatus("Bumping limit exceeded, use the track editor to see more features"):a.updateStatus()}function k(a,d,b,e,h){h=e.styleForFeature(b);var f,w=!1,c=[];d=null;for(var m=0;m<a.length;++m){var r=a[m];r.orientation&&null==d&&(d=r.orientation);!f&&r.label&&(f=r.label);var k=e.styleForFeature(r);k&&!r.parts&&(L(k.LABEL)&&(w=!0),(r=q(r,0,k,e,null,!0))&&c.push(r))}if(0==
c.length)return null;a="flat";h&&"LINE"===h.glyph||(e.dasSource.collapseSuperGroups&&!e.bumped?"+"===d?a="collapsed+":"-"===d&&(a="collapsed-"):"+"===d?a="hat+":"-"===d&&(a="hat-"));e=null;if(f&&w||h&&(L(h.LABEL)||L(h.LABELS)))e=b.label||f;b=new g(c,a);e&&("+"===d?e=">"+e:"-"===d&&(e="<"+e),b=new v(Y,b,e,!1));b.bump=!0;return b}function q(b,f,c,k,l,n){function C(a,d,b){var e=null;if(a.currentSequence){var h=a.currentSequence.start|0,g=a.currentSequence.end|0;if(h<=b&&g>=d){for(var f=Math.max(d,h),
g=Math.min(b,g),e=a.currentSequence.seq.substr(f-h,g-f+1);d<f;)e="N"+e,f--;for(;b>g;)e+="N",g++}}return e}var E=k.browser.scale,q=k.browser.viewStart,p=c.glyph||"BOX",x=b.min,M=b.max,t=b.orientation,u=b.score,U=b.label||b.id,K=(x-q)*E,J=Math.max((M-q+1)*E,K+1),Q=k.forceHeight||c.HEIGHT||l||12,N=Q*=1,q=c.BUMP&&L(c.BUMP),fa;if("CROSS"===p||"EX"===p||"TRIANGLE"===p||"DOT"===p||"SQUARE"===p||"STAR"===p||"PLIMSOLL"===p){var X=c.FGCOLOR||"black",P=c.BGCOLOR||"none",x=c.STROKECOLOR;c.BGITEM&&b.itemRgb?X=
b.itemRgb:L(c.COLOR_BY_SCORE2)&&(E=c.BGGRAD||c._gradient,E||(E=w(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=E),Q=b.score2,void 0==Q&&X||(N=c.MIN2?1*c.MIN2:0,M=(1*(Q||0)-N)/((c.MAX2?1*c.MAX2:1)-N)*E.length|0,0>M&&(M=0),M>=E.length&&(M=E.length-1),X=E[M]));Q=k.forceHeight||c.HEIGHT||l||12;N=Q*=1;M=c.SIZE||Q;c.RSIZE&&(M=1*c.RSIZE*Q);c.STROKETHRESHOLD&&M<1*c.STROKETHRESHOLD&&(x=null);M*=1;Q=(K+J)/2;E=M/2;"EX"===p?x=new m(Q,M,X):"TRIANGLE"===p?x=new F(Q,M,c.DIRECTION||"N",c.LINEWIDTH||M,X,x):"DOT"===p?
x=new A(Q,M,X,x):"PLIMSOLL"===p?x=new G(Q,M,.2*M,X,x):"SQUARE"===p?x=new a(Q-E,0,M,M,X,x):"STAR"===p?(p=5,c.POINTS&&(p=c.POINTS|0),x=new S(Q,E,p,X,x)):x=new z(Q,M,X);P&&"none"!=P&&5<J-K&&(K=new a(K,0,J-K,M,P),x=new g([K,x]));if(L(c.SCATTER)){P=k.quantMin(c);(M=k.quantMax(c))||(M=0>P?0:10);P||(P=0);k=(1*u-P)/(M-P);u=-1*P/(M-P);if(0>k||1<k)return null;k>=u?(Q=Math.max(1,(k-u)*N),f=f+(1-u)*N-Q):(Q=Math.max(1,(k-u)*N),f+=(1-u)*N);fa={min:P,max:M};K=0;J="undefined"!==typeof b.forceLabel?b.forceLabel:c.LABEL;
aa(J)&&U&&!n&&(x=new v(Y,x,U,!0,null,"above"==J?"above":"below"),"above"==J&&(K=x.textHeight+2),n=!0);x=new I(x,0,f-E-K,N)}}else if("HISTOGRAM"===p||"GRADIENT"===p&&"undefined"!==u)P=k.quantMin(c),(M=k.quantMax(c))||(M=0>P?0:10),P||(P=0),1*u<1*P&&(u=P),1*u>1*M&&(u=M),k=(1*u-P)/(M-P),u=-1*P/(M-P),"HISTOGRAM"===p&&(k>=u?(Q=(k-Math.max(0,u))*N,f=f+(1-Math.max(0,u))*N-Q):(Q=(Math.max(0,u)-k)*N,f+=(1-Math.max(0,u))*N),fa={min:P,max:M}),X=c.FGCOLOR||null,P=c.BGCOLOR||c.COLOR1||"green",c.BGITEM&&b.itemRgb&&
(P=b.itemRgb),u=c.ALPHA?1*c.ALPHA:null,c.BGGRAD&&(E=c.BGGRAD,M=k*E.length|0,0>M&&(M=0),M>=E.length&&(M=E.length-1),P=E[M]),c.COLOR2&&(E=c._gradient,E||(E=w(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=E),M=k*E.length|0,0>M&&(M=0),M>=E.length&&(M=E.length-1),P=E[M]),x=new a(K,f,J-K,Q,P,X,u),x=new I(x,0,0,N);else if("HIDDEN"===p)x=new T(null,K,J),n=!0;else if("ARROW"===p)k=c.FGCOLOR||"purple",f=L(c.PARALLEL),N=L(c.SOUTHWEST),u=L(c.NORTHEAST),x=new B(K,J,Q,k,f,N,u);else if("ANCHORED_ARROW"===p)X=c.FGCOLOR||
"none",P=c.BGCOLOR||"green",x=new d(K,J,Q,P,X,t),x.bump=!0;else if("SPAN"===p)X=c.FGCOLOR||"black",x=new e(K,J,Q,X);else if("LINE"===p)X=c.FGCOLOR||"black",x=new h(K,J,Q,c.STYLE||"solid",t,X);else if("PRIMERS"===p)X=c.FGCOLOR||"black",P=c.BGCOLOR||"red",x=new y(K,J,Q,P,X);else if("TEXT"===p)k=c.STRING||"text",P=c.FGCOLOR||"black",x=new D(Y,K,J,Q,P,k);else if("TOOMANY"===p)X=c.FGCOLOR||"gray",P=c.BGCOLOR||"orange",x=new r(K,J,Q,P,X);else if("POINT"===p)Q=k.forceHeight||c.HEIGHT||30,P=k.quantMin(c),
M=k.quantMax(c),k=(1*u-P)/(M-P),f=1*Q/(M-P)*(u-1*P)|0,fa={min:P,max:M},P=c.FGCOLOR||c.COLOR1||"black",c.COLOR2&&(E=c._gradient,E||(E=w(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=E),M=k*E.length|0,0>M&&(M=0),M>=E.length&&(M=E.length-1),P=E[M]),x=new R((K+J)/2,Q-f,Q,P);else if("__SEQUENCE"===p){u=p=b.seq;P=X=b.quals;f=L(c.__INSERTIONS);N=[];if(b.cigar){l=ha(b.cigar);for(var P=u="",Z=t=0;Z<l.length;++Z){var da=l[Z];if("M"==da.op)u+=p.substr(t,da.cnt),P+=X.substr(t,da.cnt),t+=da.cnt;else if("D"==da.op)for(var ca=
0;ca<da.cnt;++ca)u+="-",P+="Z";else if("I"==da.op){var va=p.substr(t,da.cnt),ca=new F(K+u.length*E,5,"S",5,k.browser.baseColors.I);f&&(ca=new v(Y,ca,va,!1,"center","above","7px sans-serif"));ca.feature={label:"Insertion: "+va,type:"insertion",method:"insertion"};N.push(ca);t+=da.cnt}else"S"==da.op?t+=da.cnt:console.log("unknown cigop"+da.op)}}E=C(k,x,M);if(u&&E&&("mismatch"===c.__SEQCOLOR||"mismatch-all"===c.__SEQCOLOR)){x=[];M="-"===b.orientation?",":".";for(p=0;p<u.length;++p)x.push(u[p]==E[p]?
M:u[p]);u=x.join("")}x="-"===b.orientation?c._minusColor||"lightskyblue":c._plusColor||"lightsalmon";c.__disableQuals&&(P=!1);x=new H(k.browser.baseColors,x,K,J,Q,u,E,c.__SEQCOLOR,P,!L(c.__CLEARBG),k.scaleVertical);f&&(x=new I(x,0,7));0<N.length&&(N.splice(0,0,x),x=new g(N))}else if("__INSERTION"===p)ca=new F(K,5,"S",5,k.browser.baseColors.I),x=new v(Y,ca,b.insertion||b.altAlleles[0],!1,"center","above","7px sans-serif"),1<J-K&&(P=c.BGCOLOR||c.COLOR1||"green",K=new a(K,5,J-K,Q,P,X),x=new g([K,x]));
else{if("__NONE"===p)return null;X=c.FGCOLOR||null;P=c.BGCOLOR||c.COLOR1||"green";c.BGITEM&&b.itemRgb&&(P=b.itemRgb);E=(J-K)/(M-x);"translation"==b.type&&("protein_coding"==b.method||b.readframeExplicit)&&(!b.tags||0>b.tags.indexOf("cds_start_NF")||b.readframeExplicit)&&(!k.dasSource.collapseSuperGroups||k.bumped)&&.5<=E?(E=C(k,x,M),x=new W(K,J,Q,P,E,b.orientation,b.readframe)):x=new a(K,0,J-K,Q,P,X)}(L(c.LABEL)||b.forceLabel)&&U&&!n&&(x=new v(Y,x,U,!1));q&&(x.bump=!0);x.feature=b;fa&&(x.quant=fa);
c.ZINDEX&&(x.zindex=c.ZINDEX|0);return x}function p(a,d,b){var e=b.browser.viewStart,h=b.browser.scale,g=b.forceHeight||d.HEIGHT||30,c=b.quantMin(d);b=b.quantMax(d);for(var w=1*g/(b-c),m=d.FGCOLOR||d.COLOR1||"black",r=[],k=0;k<a.length;++k){var v=a[k],y=g-((v.score-1*c)*w|0);r.push((((v.min|0)+(v.max|0))/2-e)*h);r.push(y)}a=new f(r,m,g);a.quant={min:c,max:b};d.ZINDEX&&(a.zindex=d.ZINDEX|0);return a}if("undefined"!==typeof c){var x=c("./utils"),C=x.shallowCopy,b=x.pusho,x=c("./tier").DasTier;t=c("./glyphs");
var a=t.BoxGlyph,g=t.GroupGlyph,f=t.LineGraphGlyph,v=t.LabelledGlyph,z=t.CrossGlyph,m=t.ExGlyph,F=t.TriangleGlyph,A=t.DotGlyph,T=t.PaddedGlyph,d=t.AArrowGlyph,e=t.SpanGlyph,h=t.LineGlyph,y=t.PrimersGlyph,B=t.ArrowGlyph,r=t.TooManyGlyph,D=t.TextGlyph,H=t.SequenceGlyph,W=t.AminoAcidGlyph,I=t.TranslatedGlyph,R=t.PointGlyph,J=t.GridGlyph,S=t.StarGlyph,G=t.PlimsollGlyph,N=t.OverlayLabelCanvas,w=c("./color").makeGradient;t=c("./spans");var E=t.Range,U=t.union;t=c("./das");var K=t.DASFeature,L=t.isDasBooleanTrue,
aa=t.isDasBooleanNotFalse,ha=c("./cigar").parseCigar,Z=c("./numformats").formatQuantLabel}n.prototype.indexFor=function(a){a=a.min();for(var d=0,b=this.glyphs.length;b>d;){var e=(d+b)/2|0;if(e>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[e].min()?b=e:d=e+1}return b};n.prototype.add=function(a){var d=this.indexFor(a);this.glyphs.splice(d,0,a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};n.prototype.hasSpaceFor=function(a){var d=this.indexFor(a);
return 0<d&&this.glyphs[d-1].max()>=a.min()||d<this.glyphs.length&&this.glyphs[d].min()<=a.max()?!1:!0};var Y;x.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,d=this.subtiers;if(d){var b=this.browser.featurePanelWidth+2E3;a&&(b*=2);var e=this.viewport.width|0;e<b-50&&(this.viewport.width=e=b);for(var b=this.padding,h=0;h<d.length;++h)b=b+d[h].height+this.padding;h=b=Math.max(b+6,this.browser.minTierHeight);a&&(h*=2);h!=this.viewport.height&&(this.viewport.height=h);
Math.max(b,this.browser.minTierHeight);this.viewportHolder.style.left="-1000px";this.viewport.style.width=a?""+e/2+"px":""+e+"px";this.viewport.style.height=""+b+"px";this.layoutHeight=Math.max(b,this.browser.minTierHeight);this.updateHeight();this.norigin=this.browser.viewStart;d=this.viewport.getContext("2d");d.clearRect(0,0,e,h);d.save();a&&d.scale(2,2);e=this.browser.viewStart-1E3/this.browser.scale;h=this.browser.viewEnd+1E3/this.browser.scale;a=[];if(this.knownCoverage)for(var g=this.knownCoverage.ranges(),
f=0;f<g.length;++f){var c=g[f];0==f?c.min()>e&&a.push({min:e,max:c.min()-1}):a.push({min:g[f-1].max()+1,max:c.min()-1});f==g.length-1&&c.max()<h&&a.push({min:c.max()+1,max:h})}if(0<a.length)for(d.fillStyle="gray",e=0;e<a.length;++e)h=a[e],g=(h.min-this.browser.viewStart)*this.browser.scale+1E3,d.fillRect(g,0,(h.max-this.browser.viewStart)*this.browser.scale+1E3-g,b);b=new N;a=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;d.translate(a,this.padding);b.translate(0,this.padding);
this.paintToContext(d,b,a);this.overlayLabelCanvas=0<b.glyphs.length?b:null;d.restore();this.drawOverlay();this.paintQuant()}};x.prototype.paintToContext=function(a,d,b){var e=this.subtiers,h=this.viewport.width|0;a.save();for(var g=0;g<e.length;++g){for(var f=null,c=e[g].glyphs,w=0;w<c.length;++w){var m=c[w];m.min()<h-b&&m.max()>-b&&(m=c[w],m.draw(a,d),m.quant&&(f=m.quant))}this.scaleVertical?(c=this.browser.scale,a.translate(0,c+this.padding),d.translate(0,c+this.padding)):(a.translate(0,e[g].height+
this.padding),d.translate(0,e[g].height+this.padding))}a.restore();f&&this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(d=e[0].height*(1-(this.quantLeapThreshold-f.min)/(f.max-f.min)),a.save(),a.strokeStyle="red",a.lineWidth=.3,a.beginPath(),a.moveTo(-1E3,d),a.lineTo(h+1E3,d),a.stroke(),a.restore())};x.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,d;this.subtiers&&0<this.subtiers.length&&
(d=this.subtiers[0].quant);if(d){var b=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var e=this.quantOverlay.getContext("2d");a&&e.scale(2,2);a=2;40<b&&(a=1+(b/20|0));var h=(b+2*this.padding)/(a-1),g=(d.max-d.min)/(a-1);e.fillStyle="white";e.globalAlpha=.6;"right"==this.browser.rulerLocation?
e.fillRect(20,0,30,b+2*this.padding):e.fillRect(0,0,30,b+2*this.padding);e.globalAlpha=1;e.strokeStyle="black";e.lineWidth=1;e.beginPath();if("right"==this.browser.rulerLocation){e.moveTo(42,this.padding);e.lineTo(50,this.padding);e.lineTo(50,b+this.padding);e.lineTo(42,b+this.padding);for(var f=1;f<a-1;++f){var c=f*h;e.moveTo(50,c);e.lineTo(45,c)}}else for(e.moveTo(8,this.padding),e.lineTo(0,this.padding),e.lineTo(0,b+this.padding),e.lineTo(8,b+this.padding),f=1;f<a-1;++f)c=f*h,e.moveTo(0,c),e.lineTo(5,
c);e.stroke();e.fillStyle="black";if("right"==this.browser.rulerLocation)for(e.textAlign="right",e.fillText(Z(d.max),41,8),e.fillText(Z(d.min),41,b+this.padding),f=1;f<a-1;++f)c=f*h,e.fillText(Z(1*d.max-f*g),41,c+3);else for(e.textAlign="left",e.fillText(Z(d.max),9,8),e.fillText(Z(d.min),9,b+this.padding),f=1;f<a-1;++f)c=f*h,e.fillText(Z(1*d.max-f*g),9,c+3)}else this.quantOverlay.style.display="none"}};x.prototype.styleForFeature=function(a){var d=this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;
for(var b=null,e=this.stylesheet.styles,h=0;h<e.length;++h){var g=e[h];if(!(g.zoom&&g.zoom!=d||g.orientation&&g.orientation!=a.orientation)){var f=g._labelRE;f&&f.test||(f=new RegExp("^"+g.label+"$"),g._labelRE=f);if(!g.label||f.test(a.label))if(f=g._methodRE,f&&f.test||(f=new RegExp("^"+g.method+"$"),g._methodRE=f),!g.method||f.test(a.method)){if(g.type)if("default"==g.type){b||(b=g.style);continue}else if(f=g._typeRE,f&&f.test||(f=new RegExp("^"+g.type+"$"),g._typeRE=f),!f.test(a.type))continue;
return g.style}}}return b};x.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||0};x.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==typeof u&&(u.exports={drawFeatureTier:l})},{"./cigar":8,"./color":9,"./das":10,"./glyphs":21,"./numformats":26,
"./spans":36,"./tier":45,"./utils":49}],19:[function(c,u,t){function n(b,a,g){var f=q(g.type,a.type),c=q(g.label,a.label,g.id,a.id);c&&0!=c.indexOf("__dazzle")&&(f=f+": "+c);this.hit=b;this.feature=a;this.group=g;this.title=f;this.sections=[]}function l(b,a){var g=[];if(b)for(var f=0;f<b.length;++f)p(g,b[f]);if(a)for(f=0;f<a.length;++f)p(g,a[f]);return g}if("undefined"!==typeof c){var k=c("./cbrowser").Browser;c=c("./utils");var q=c.pick,p=c.pushnew,x=c.makeElement}var C=/^([A-Za-z_-]+)=(.+)/;k.prototype.addFeatureInfoPlugin=
function(b){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(b)};n.prototype.setTitle=function(b){this.title=b};n.prototype.add=function(b,a){"string"===typeof a&&(a=x("span",a));this.sections.push({label:b,info:a})};k.prototype.featurePopup=function(b,a,g,f){var c=g.length;a=0<=--c?g[c]:{};var k=0<=--c?g[c]:{};g=new n(g,a,k);g.tier=f;for(var c=this.featureInfoPlugins||[],m=0;m<c.length;++m)try{c[m](a,g)}catch(p){console.log(p.stack||p)}c=f.featureInfoPlugins||[];
for(m=0;m<c.length;++m)try{c[m](a,g)}catch(A){console.log(A.stack||A)}this.removeAllPopups();f=x("table",null,{className:"table table-striped table-condensed"});f.style.width="100%";f.style.margin="0px";c=0;a.method&&(m=x("tr",[x("th","Method"),x("td",a.method)]),f.appendChild(m),++c);m=k.segment?k:a;m=x("tr",[x("th","Location"),x("td",m.segment+":"+m.min+"-"+m.max,{},{minWidth:"200px"})]);f.appendChild(m);++c;void 0===a.score||null===a.score||"-"==a.score||a.suppressScore||(m=x("tr",[x("th","Score"),
x("td",""+a.score)]),f.appendChild(m),++c);(m=l(k.links,a.links))&&0<m.length&&(m=x("tr",[x("th","Links"),x("td",m.map(function(a){return x("div",x("a",a.desc,{href:a.uri,target:"_new"}))}))]),f.appendChild(m),++c);a=l(k.notes,a.notes);for(k=0;k<a.length;++k){var m="Note",q=a[k],d=q.match(C);d&&(m=d[1],q=d[2]);m=x("tr",[x("th",m),x("td",q)]);f.appendChild(m);++c}for(a=0;a<g.sections.length;++a)c=g.sections[a],f.appendChild(x("tr",[x("th",c.label),x("td",c.info)]));this.popit(b,g.title||"Feature",
f,{width:450})}},{"./cbrowser":6,"./utils":49}],20:[function(c,u,t){function n(c){for(var n=c.browser.drawnStart,x=c.browser.drawnEnd,C={},b={},a={},g={},f={},v={},z={},m={},F=[],A,t,d,e=function(){d={};for(var a=0;a<c.currentFeatures.length;++a){var b=c.currentFeatures[a];b.id&&(d[b.id]=b)}},h=function(a){var b=[];if(a.parents)for(var e=0;e<a.parents.length;++e){var h=a.parents[e],g=d[h];g&&"SO:0000704"==g.typeCv&&pushnew(b,h)}return b},y=0;y<c.currentFeatures.length;++y){var B=c.currentFeatures[y];
if(!B.parts){var r=B.min<=x&&B.max>=n;if(B.min&&B.max){if(B.score&&"."!=B.score&&"-"!=B.score){var D=1*B.score;if(!A||D<A)A=D;if(!t||D>t)t=D}var D=[],H=null;if(B.groups)for(var u=0;u<B.groups.length;++u){var I=B.groups[u],R=I.id;if("gene"==I.type)H=R,v[R]=I;else if("translation"!=I.type){l(b,R,B);v[R]=I;D.push(R);I=g[R];if(!I||B.min<I)g[R]=B.min;I=f[R];if(!I||B.max>I)f[R]=B.max}}if(B.parents)for(d||e(),u=0;u<B.parents.length;++u){var J=B.parents[u],S=d[J];if(S){S.parts||(S.parts=[B]);k(b,J,S);l(b,
J,B);v[J]||(v[J]={type:S.type,id:S.id,label:S.label||S.id});D.push(J);I=g[J];if(!I||B.min<I)g[J]=B.min;I=f[J];if(!I||B.max>I)f[J]=B.max;I=h(S);0<I.length&&(H=I[0],J=d[I[0]],v[I[0]]={type:J.type,id:J.id,label:J.label||J.id},c.dasSource.collapseSuperGroups||(c.dasSource.collapseSuperGroups=!0))}}if(0==D.length)r&&l(C,B.type,B);else if(H)for(I=0;I<D.length;++I)R=D[I],k(z,H,R),m[R]=H}else F.push(B)}}for(R in b)F=v[R],"number"!==typeof F.min&&(F.min=g[R]),"number"!==typeof F.max&&(F.max=f[R]),f[R]>=n&&
g[R]<=x&&(a[R]=b[R]);c.ungroupedFeatures=C;c.groupedFeatures=a;c.groups=v;c.superGroups=z;c.groupsToSupers=m;A&&(0<A?A=0:0>t&&(t=0),c.currentFeaturesMinScore=A,c.currentFeaturesMaxScore=t)}if("undefined"!==typeof c){c=c("./utils");var l=c.pusho,k=c.pushnewo}"undefined"!==typeof u&&(u.exports={sortFeatures:n})},{"./utils":49}],21:[function(c,u,t){function n(a,d){this._stroke=a;this._fill=d}function l(a,d,b,e,h,g,f,c){this.x=a;this.y=d;this._width=b;this._height=e;this.fill=h;this.stroke=g;this._alpha=
f;this._radius=c||0}function k(a,d){this.glyphs=a;this.connector=d;this.h=a[0].height();for(var b=[],e=0;e<a.length;++e){var h=a[e];b.push(new R(h.min(),h.max()));this.h=Math.max(this.h,h.height())}this.coverage=I(b)}function q(a,d,b){this.points=a;this.color=d;this._height=b||50}function p(a,d,b,e,h,g,f){this.glyph=d;this.text=b;this.anchor=h||"left";this.align=g||"below";f&&(this.font=f);this.font&&(a.save(),a.font=this.font);b=a.measureText(b);this.font&&a.restore();this.textLen=b.width;this.textHeight=
5;this.bump=d.bump;this.measured=!e}function x(a,d,b){this._x=a;this._height=d;this._stroke=b}function C(a,d,b){this._x=a;this._height=d;this._stroke=b}function b(a,d,b,e,h,g){n.call(this,g,h);this._x=a;this._height=d;this._dir=b;this._width=e}function a(a,d,b,e){this._x=a;this._height=d;this._fill=b;this._stroke=e}function g(a,d,b){this.glyph=a;this._min=d;this._max=b;a&&(this.bump=a.bump)}function f(a,d,b,e,h,g){n.call(this,h,e);this._min=a;this._max=d;this._height=b;this._ori=g}function v(a,d,
b,e){n.call(this,e,null);this._min=a;this._max=d;this._height=b}function z(a,d,b,e,h,g){this._min=a;this._max=d;this._height=b;this._style=e;this._strand=h;this._stroke=g}function m(a,d,b,e,h){this._min=a;this._max=d;this._height=b;this._fill=e;this._stroke=h}function F(a,d,b,e,h,g,f){n.call(this,null,e);this._min=a;this._max=d;this._height=b;this._color=e;this._parallel=h;this._sw=g;this._ne=f}function A(a,d,b,e,h){this._min=a;this._max=d;this._height=b;this._fill=e;this._stroke=h}function T(a,d,
b,e,h,g){this._min=d;this._max=b;this._height=e;this._fill=h;this._string=g;this._textLen=a.measureText(g).width}function d(a,d,b){var e={red:"darkred",purple:"mediumpurple",blue:"darkblue",green:"darkgreen"}[b.toLowerCase()];b=e?[b,e]:["rgb(73, 68, 149)","rgb(9, 0, 103)"];return"?"==a?"black":"M"==a?"greenyellow":"*"==a?"crimson":b[d%2]}function e(a){var d={A:"T",T:"A",G:"C",C:"G"};a=a.split("").reverse().join("");for(var b=[],e=0;e<a.length;++e){var h=a.substr(e,1).toUpperCase();b.push(h in d?d[h]:
"N")}return b.join("")}function h(a,d,b,e,h,g,f){this._min=a;this._max=d;this._height=b;this._fill=e;this._seq=h;this._orientation=g;this._readframe=f}function y(a,d,b,e){this.glyph=a;this._height=e;this._x=d;this._y=b}function B(a,d,b,e){this._x=a;this._y=d;this._height=b;this._fill=e}function r(a){this._height=a||50}function D(a,d,b,e,h){n.call(this,h,e);this._x=a;this._r=d;this._points=b}function H(a,d,b,e,h){this._x=a;this._height=d;this._overhang=b;this._fill=e;this._stroke=h;this._hh=d/2}function W(){this.oy=
this.ox=0;this.glyphs=[]}if("undefined"!==typeof c){t=c("./spans");var I=t.union,R=t.Range;t=c("./utils");var J=t.makeElementNS,S=t.AMINO_ACID_TRANSLATION;c=c("./svg-utils");var G=c.NS_SVG,N=c.SVGPath}n.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};n.prototype.toSVG=function(){var a=new N;this.drawPath(a);return J(G,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||
"none"})};n.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};l.prototype.draw=function(a){var d=this._radius;0<d?(a.beginPath(),a.moveTo(this.x+d,this.y),a.lineTo(this.x+this._width-d,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+d,d),a.lineTo(this.x+this._width,this.y+this._height-d),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-d,this.y+this._height,d),a.lineTo(this.x+d,this.y+this._height),a.arcTo(this.x,this.y+
this._height,this.x,this.y+this._height-d,d),a.lineTo(this.x,this.y+d),a.arcTo(this.x,this.y,this.x+d,this.y,d),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=.5,a.strokeRect(this.x,
this.y,this._width,this._height)));null!=this._alpha&&a.restore()};l.prototype.toSVG=function(){var a=J(G,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};l.prototype.min=function(){return this.x};l.prototype.max=function(){return this.x+this._width};l.prototype.height=function(){return this.y+this._height};k.prototype.drawConnectors=function(a){for(var d=
this.coverage.ranges(),b=1;b<d.length;++b){var e=d[b],h=d[b-1];if(h&&e.min()>h.max()){var h=h.max(),e=e.min(),g=(h+e)/2;"hat+"===this.connector?(a.moveTo(h,this.h/2),a.lineTo(g,0),a.lineTo(e,this.h/2)):"hat-"===this.connector?(a.moveTo(h,this.h/2),a.lineTo(g,this.h),a.lineTo(e,this.h/2)):"collapsed+"===this.connector?(a.moveTo(h,this.h/2),a.lineTo(e,this.h/2),4<e-h&&(a.moveTo(g-2,this.h/2-3),a.lineTo(g+2,this.h/2),a.lineTo(g-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(h,this.h/2),a.lineTo(e,
this.h/2),4<e-h&&(a.moveTo(g+2,this.h/2-3),a.lineTo(g-2,this.h/2),a.lineTo(g+2,this.h/2+3))):(a.moveTo(h,this.h/2),a.lineTo(e,this.h/2))}}};k.prototype.draw=function(a,d){for(var b=0;b<this.glyphs.length;++b)this.glyphs[b].draw(a,d);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};k.prototype.toSVG=function(){for(var a=J(G,"g"),d=0;d<this.glyphs.length;++d)a.appendChild(this.glyphs[d].toSVG());d=new N;this.drawConnectors(d);0<d.toPathData().length&&(d=J(G,"path",null,{d:d.toPathData(),
fill:"none",stroke:"black",strokeWidth:.5}),a.appendChild(d));return a};k.prototype.min=function(){return this.coverage.min()};k.prototype.max=function(){return this.coverage.max()};k.prototype.height=function(){return this.h};q.prototype.min=function(){return this.points[0]};q.prototype.max=function(){return this.points[this.points.length-2]};q.prototype.height=function(){return this._height};q.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var d=0;d<
this.points.length;d+=2){var b=this.points[d],e=this.points[d+1];0==d?a.moveTo(b,e):a.lineTo(b,e)}a.stroke();a.restore()};q.prototype.toSVG=function(){for(var a=new N,d=0;d<this.points.length;d+=2){var b=this.points[d],e=this.points[d+1];0==d?a.moveTo(b,e):a.lineTo(b,e)}return J(G,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};p.prototype.toSVG=function(){var a=this.glyph.toSVG(),d={};"above"==this.align?(a=J(G,"g",a,{transform:"translate(0, "+(this.textHeight|2)+
")"}),d.y=this.textHeight):d.y=this.glyph.height()+15;this.font&&(d.fontSize=7);d.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return J(G,"g",[a,J(G,"text",this.text,d)])};p.prototype.min=function(){return this.glyph.min()};p.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};p.prototype.height=function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+
2):a+20);return a};p.prototype.draw=function(a,d){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();d.registerGlyph(this)};p.prototype.drawOverlay=function(a,d,b){a.fillStyle="black";this.font&&(a.save(),a.font=this.font);"center"==this.anchor?b=(this.glyph.min()+this.glyph.max()-this.textLen)/2:(b=this.glyph.min(),b<d&&(b=Math.min(d,this.glyph.max()-this.textLen)));a.fillText(this.text,b,"above"==this.align?this.textHeight:this.glyph.height()+
15);this.font&&a.restore()};x.prototype.draw=function(a){var d=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-d,d);a.lineTo(this._x+d,d);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};x.prototype.toSVG=function(){var a=this._height/2,d=new N;d.moveTo(this._x,0);d.lineTo(this._x,this._height);d.moveTo(this._x-a,a);d.lineTo(this._x+a,a);return J(G,"path",null,{d:d.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};x.prototype.min=
function(){return this._x-this._height/2};x.prototype.max=function(){return this._x+this._height/2};x.prototype.height=function(){return this._height};C.prototype.draw=function(a){var d=this._height/2;a.beginPath();a.moveTo(this._x-d,0);a.lineTo(this._x+d,this._height);a.moveTo(this._x-d,this._height);a.lineTo(this._x+d,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};C.prototype.toSVG=function(){var a=this._height/2,d=new N;d.moveTo(this._x-a,0);d.lineTo(this._x+a,this._height);d.moveTo(this._x-
a,this._height);d.lineTo(this._x+a,0);return J(G,"path",null,{d:d.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};C.prototype.min=function(){return this._x-this._height/2};C.prototype.max=function(){return this._x+this._height/2};C.prototype.height=function(){return this._height};b.prototype=Object.create(n.prototype);b.prototype.drawPath=function(a){var d=this._height/2,b=this._width/2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-b,0),a.lineTo(this._x+b,0)):
"W"===this._dir?(a.moveTo(this._x+b,d),a.lineTo(this._x-b,0),a.lineTo(this._x-b,this._height)):"E"===this._dir?(a.moveTo(this._x-b,d),a.lineTo(this._x+b,0),a.lineTo(this._x+b,this._height)):(a.moveTo(this._x,0),a.lineTo(this._x+b,this._height),a.lineTo(this._x-b,this._height));a.closePath()};b.prototype.min=function(){return this._x-this._height/2};b.prototype.max=function(){return this._x+this._height/2};b.prototype.height=function(){return this._height};a.prototype.draw=function(a){var d=this._height/
2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,d,d,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};a.prototype.toSVG=function(){var a=this._height/2;return J(G,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};a.prototype.min=function(){return this._x-this._height/2};a.prototype.max=function(){return this._x+this._height/2};a.prototype.height=function(){return this._height};
g.prototype.draw=function(a,d){this.glyph&&this.glyph.draw(a,d)};g.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():J(G,"g")};g.prototype.min=function(){return this._min};g.prototype.max=function(){return this._max};g.prototype.height=function(){return this.glyph?this.glyph.height():1};f.prototype=Object.create(n.prototype);f.prototype.min=function(){return this._min};f.prototype.max=function(){return this._max};f.prototype.height=function(){return this._height};f.prototype.drawPath=
function(a){var d=this._max,b=this._min,e=this._height,h=0,g=0,f=this._height+2,c=.333333*this._height;this._ori&&("+"===this._ori?g=.5*this._height:"-"===this._ori&&(h=.5*this._height));d-b<f&&(b=(d+b-f)/2,d=b+f);a.moveTo(b+h,0+c);a.lineTo(d-g,0+c);a.lineTo(d-g,0);a.lineTo(d,0+this._height/2);a.lineTo(d-g,0+e);a.lineTo(d-g,0+c+c);a.lineTo(b+h,0+c+c);a.lineTo(b+h,0+e);a.lineTo(b,0+e/2);a.lineTo(b+h,0);a.lineTo(b+h,0+c)};v.prototype=Object.create(n.prototype);v.prototype.min=function(){return this._min};
v.prototype.max=function(){return this._max};v.prototype.height=function(){return this._height};v.prototype.drawPath=function(a){var d=this._min,b=this._max,e=this._height,h=e/2;a.moveTo(d,h);a.lineTo(b,h);a.moveTo(d,0);a.lineTo(d,e);a.moveTo(b,0);a.lineTo(b,e)};z.prototype.min=function(){return this._min};z.prototype.max=function(){return this._max};z.prototype.height=function(){return this._height};z.prototype.drawPath=function(a){var d=this._min,b=this._max,e=this._height,h=e/2;"hat"===this._style?
(a.moveTo(d,h),a.lineTo((d+b)/2,"-"===this._strand?e:0)):a.moveTo(d,h);a.lineTo(b,h)};z.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};z.prototype.toSVG=function(){var a=new N;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return J(G,"path",null,a)};m.prototype.min=function(){return this._min};
m.prototype.max=function(){return this._max};m.prototype.height=function(){return this._height};m.prototype.drawStemPath=function(a){var d=this._max,b=this._height/2;a.moveTo(this._min,b);a.lineTo(d,b)};m.prototype.drawTrigsPath=function(a){var d=this._min,b=this._max,e=this._height,h=e/2;a.moveTo(d,0);a.lineTo(d+e,h);a.lineTo(d,e);a.lineTo(d,0);a.moveTo(b,0);a.lineTo(b-e,h);a.lineTo(b,e);a.lineTo(b,0)};m.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();
a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};m.prototype.toSVG=function(){var a=new N;this.drawStemPath(a);var d=new N;this.drawTrigsPath(d);return J(G,"g",[J(G,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),J(G,"path",null,{d:d.toPathData(),fill:this._fill||"none"})])};F.prototype=Object.create(n.prototype);F.prototype.min=function(){return this._min};F.prototype.max=function(){return this._max};F.prototype.height=function(){return this._height};F.prototype.drawPath=
function(a){var d=this._min,b=this._max,e=this._height;if(this._parallel){var h=e/2,g=.4*e;this._sw?(a.moveTo(d+h,e-g),a.lineTo(d+h,e),a.lineTo(d,h),a.lineTo(d+h,0),a.lineTo(d+h,g)):(a.moveTo(d,e-g),a.lineTo(d,g));this._ne?(a.lineTo(b-h,g),a.lineTo(b-h,0),a.lineTo(b,h),a.lineTo(b-h,e),a.lineTo(b-h,e-g)):(a.lineTo(b,g),a.lineTo(b,e-g))}else{var h=(d+b)/2,g=.4*(b-d),f=e/3;this._ne?(a.moveTo(d+g,f),a.lineTo(d,f),a.lineTo(h,0),a.lineTo(b,f),a.lineTo(b-g,f)):(a.moveTo(d+g,0),a.lineTo(b-g,0));this._sw?
(a.lineTo(b-g,e-f),a.lineTo(b,e-f),a.lineTo(h,e),a.lineTo(d,e-f),a.lineTo(d+g,e-f)):(a.lineTo(b-g,e),a.lineTo(d+g,e))}a.closePath()};A.prototype.min=function(){return this._min};A.prototype.max=function(){return this._max};A.prototype.height=function(){return this._height};A.prototype.toSVG=function(){return J(G,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};A.prototype.draw=function(a){this._fill&&(a.fillStyle=this._fill,
a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var d=2;d<this._height;d+=3)a.moveTo(this._min,d),a.lineTo(this._max,d);a.stroke()}};T.prototype.min=function(){return this._min};T.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};T.prototype.height=function(){return this._height};T.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,
this._min,this._height-4)};T.prototype.toSVG=function(){return J(G,"text",this._string,{x:this._min,y:this._height-4})};h.prototype.min=function(){return this._min};h.prototype.max=function(){return this._max};h.prototype.height=function(){return this._height};h.prototype.draw=function(a){var b=this._seq,h=this._fill;if(b){var g=(this._max-this._min+1)/b.length,f=(3-this._readframe)%3,c=(b.length-f)%3,f="+"==this._orientation?f:c;0<f&&(a.fillStyle=h,a.fillRect(this._min,0,g*f,this._height));for(;f<
b.length;f+=3){c=b.substr(f,3).toUpperCase();"-"==this._orientation&&(c=e(c));var m=c in S?S[c]:"?",h=3==c.length?d(m,f,this._fill):this._fill;a.fillStyle=h;a.fillRect(this._min+f*g,0,g*c.length,this._height);8<=g&&3==c.length&&(a.fillStyle="white",a.fillText(m,this._min+(f+1)*g,this._height))}}};h.prototype.toSVG=function(){var a=J(G,"g"),b=this._seq,h=this._fill;if(!b)return a;var g=(this._max-this._min+1)/b.length,f=(3-this._readframe)%3,c=(b.length-f)%3,f="+"==this._orientation?f:c;for(0<f&&a.appendChild(J(G,
"rect",null,{x:this._min,y:0,width:g*f,height:this._height,fill:h}));f<b.length;f+=3){c=b.substr(f,3).toUpperCase();"-"==this._orientation&&(c=e(c));var m=c in S?S[c]:"?",h=3==c.length?d(m,f,this._fill):this._fill;a.appendChild(J(G,"rect",null,{x:this._min+f*g,y:0,width:g*c.length,height:this._height,fill:h}));8<=g&&3==c.length&&a.appendChild(J(G,"text",m,{x:this._min+(f+1)*g,y:this._height,fill:"white"}))}return a};(function(a){function d(a,b,e,h,g,f,c,m,r,k,y){this.baseColors=a;this._strandColor=
b;this._min=e;this._max=h;this._height=g;this._seq=f;this._ref=c;this._scheme=m;this._quals=r;this._fillbg=k;this._scaleVertical=y}var b=1<window.devicePixelRatio,e={},h=/^[ACGT-]$/;d.prototype.min=function(){return this._min};d.prototype.max=function(){return this._max};d.prototype.height=function(){return this._height};d.prototype.alphaForQual=function(a){return.1+.9*Math.max(0,Math.min(1*a/30,1))};d.prototype.draw=function(a){var d=this._seq,g=this._ref,f="mismatch-all"===this._scheme,c=d?d.length:
this._max-this._min+1,m=(this._max-this._min+1)/c;"mismatch"!==this._scheme&&"mismatch-all"!==this._scheme||8<=m||(a.fillStyle=this._strandColor,this._scaleVertical?a.fillRect(this._min,m,this._max-this._min,m):a.fillRect(this._min,this._height/4,this._max-this._min,this._height/2));for(var r=0;r<c;++r){var k=d?d.substr(r,1).toUpperCase():"N";if(h.test(k)||8<=m){var y=this.baseColors[k];if(this._quals){var l=this._quals.charCodeAt(r)-33,v=a.globalAlpha;a.globalAlpha=this.alphaForQual(l)}y||(l=g?g.substr(r,
1).toUpperCase():"N",y="N"==k||"N"==l?"gray":this._strandColor,f&&(k=l));a.fillStyle=y;l=h.test(k);!this._fillbg&&8<=m&&l||(this._scaleVertical?a.fillRect(this._min+r*m,m,m,m):a.fillRect(this._min+r*m,0,m,this._height));if(8<=m&&l){var B=y+"_"+k,l=e[B];if(!l){l=document.createElement("canvas");b?(l.width=16,l.height=20):(l.width=8,l.height=10);var z=l.getContext("2d");b&&z.scale(2,2);z.fillStyle=this._fillbg?"black":y;y=z.measureText(k).width;z.fillText(k,.5*(8-y),8);e[B]=l}k=this._scaleVertical?
m:0;b?a.drawImage(l,this._min+r*m+.5*(m-8),k,8,10):a.drawImage(l,this._min+r*m+.5*(m-8),k)}this._quals&&(a.globalAlpha=v)}}};d.prototype.toSVG=function(){for(var a=this._seq,d=this._ref,b="mismatch-all"===this._scheme,e=(this._max-this._min+1)/this._seq.length,g=J(G,"g"),f=0;f<a.length;++f){var c=a?a.substr(f,1).toUpperCase():"N",m=this.baseColors[c];if(!m){var r=d?d.substr(f,1).toUpperCase():"N",m="N"==c||"N"==r?"gray":this._strandColor;b&&(c=r)}r=1;this._quals&&(r=this._quals.charCodeAt(f)-33,r=
this.alphaForQual(r));var k=h.test(c);!this._fillbg&&8<=e&&k||g.appendChild(J(G,"rect",null,{x:this._min+f*e,y:0,width:e,height:this._height,fill:m,fillOpacity:r}));8<=e&&k&&g.appendChild(J(G,"text",c,{x:this._min+(.5+f)*e,y:8,textAnchor:"middle",fill:this._fillbg?"black":m,fillOpacity:r}))}return g};a.SequenceGlyph=d})(this);y.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};y.prototype.min=function(){return this.glyph.min()+this._x};y.prototype.max=function(){return this.glyph.max()+
this._x};y.prototype.minY=function(){return this._y};y.prototype.maxY=function(){return this._y+this.glyph.height()};y.prototype.draw=function(a,d){a.save();a.translate(this._x,this._y);this.glyph.draw(a,d);a.restore()};y.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};B.prototype.min=function(){return this._x-2};B.prototype.max=function(){return this._x+2};B.prototype.height=function(){return this._height};B.prototype.draw=
function(a){a.save();a.globalAlpha=.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};B.prototype.toSVG=function(){return J(G,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};r.prototype.notSelectable=!0;r.prototype.min=function(){return-1E5};r.prototype.max=function(){return 1E5};r.prototype.height=function(){return this._height};r.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=.1;a.beginPath();for(var d=
0;d<=this._height;d+=10)a.moveTo(-5E3,d),a.lineTo(5E3,d);a.stroke();a.restore()};r.prototype.toSVG=function(){for(var a=new N,d=0;d<=this._height;d+=10)a.moveTo(-5E3,d),a.lineTo(5E3,d);return J(G,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};D.prototype=Object.create(n.prototype);D.prototype.min=function(){return this._x-this._r};D.prototype.max=function(){return this._x+this._r};D.prototype.height=function(){return 2*this._r};D.prototype.drawPath=function(a){for(var d=
this._x,b=this._r,e=this._r,h=0;h<this._points;++h){var g=6.28*h/this._points,f=d+e*Math.sin(g),g=b-e*Math.cos(g);0==h?a.moveTo(f,g):a.lineTo(f,g);g=6.28*(h+.5)/this._points;f=d+.4*e*Math.sin(g);g=b-.4*e*Math.cos(g);a.lineTo(f,g)}a.closePath()};H.prototype.draw=function(a){var d=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,d,d-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=
this._stroke,a.stroke())};H.prototype.toSVG=function(){var a=this._hh;return J(G,"g",[J(G,"circle",null,{cx:this._x,cy:a,r:a-this._overhang}),J(G,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};H.prototype.min=function(){return this._x-this._hh};H.prototype.max=function(){return this._x+this._hh};H.prototype.height=function(){return this._height};W.prototype.translate=function(a,d){this.ox+=a;this.oy+=d};W.prototype.registerGlyph=
function(a){this.glyphs.push({x:this.ox,y:this.oy,glyph:a})};W.prototype.draw=function(a,d,b){for(var e=0;e<this.glyphs.length;++e){var h=this.glyphs[e];a.save();a.translate(h.x,h.y);h.glyph.drawOverlay(a,d,b);a.restore()}};"undefined"!==typeof u&&(u.exports={BoxGlyph:l,GroupGlyph:k,LineGraphGlyph:q,LabelledGlyph:p,CrossGlyph:x,ExGlyph:C,TriangleGlyph:b,DotGlyph:a,PaddedGlyph:g,AArrowGlyph:f,SpanGlyph:v,LineGlyph:z,PrimersGlyph:m,ArrowGlyph:F,TooManyGlyph:A,TextGlyph:T,SequenceGlyph:this.SequenceGlyph,
AminoAcidGlyph:h,TranslatedGlyph:y,GridGlyph:r,StarGlyph:D,PointGlyph:B,PlimsollGlyph:H,OverlayLabelCanvas:W})},{"./spans":36,"./svg-utils":39,"./utils":49}],22:[function(c,u,t){function n(b,a){this.base=b;this.query=a}function l(b){if(0<b)return"+";if(0>b)return"-"}if("undefined"!==typeof c)var k=c("./das").DASFeature,q=c("./utils").shallowCopy,p=c("./spans"),x=p.Range,C=p.union;n.prototype.features=function(b,a,g){url=this.base+"/features/"+b.name;a=[];this.query&&a.push(this.query);b.isBounded&&
(a.push("start="+b.start),a.push("end="+b.end));0<a.length&&(url=url+"?"+a.join("&"));var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4==f.readyState)if(300<=f.status)g(null,"Error code "+f.status);else{var a=JSON.parse(f.response).features,c=[];for(fi=0;fi<a.length;++fi){var m=a[fi],n=new k;n.segment=b.name;n.min=(m.start|0)+1;n.max=m.end|0;m.name&&(n.label=m.name);m.strand&&(n.orientation=l(m.strand));n.type=m.type||"unknown";if(m.subfeatures&&0<m.subfeatures.length){n.id=m.uniqueID;
for(var A=[],t=[],d=[],e=0;e<m.subfeatures.length;++e){var h=m.subfeatures[e],y=q(n);y.min=h.start+1;y.max=h.end;y.groups=[n];d.push(y);A.push(new x(y.min,y.max));"CDS"===h.type&&t.push(y)}if(0<t.length){p=C(A);var B=q(n);B.type="transcript";p.ranges().forEach(function(a){c.push({segment:b.name,min:a.min(),max:a.max(),orientation:n.orientation,groups:[B],type:"transcript"})});var r=q(n);t.forEach(function(a){a.type="translation";a.groups=[r];c.push(a)})}else d.forEach(function(a){c.push(a)})}else c.push(n)}g(c)}};
f.open("GET",url,!0);f.responseType="text";f.send("")};"undefined"!==typeof u&&(u.exports={JBrowseStore:n})},{"./das":10,"./spans":36,"./utils":49}],23:[function(c,u,t){function n(){var a=this;this.reqs=[];this.awaitedFeatures={};this.requestsIssued=new y(function(d,b){a.notifyRequestsIssued=d})}function l(a,d,b,e,h,g,f){this.chr=a;this.min=d;this.max=b;this.coverage=f;this.scale=e;this.features=h||[];this.status=g}function k(a,d,b,e,h,g){this.tierMap=a;this.chr=d;this.min=b;this.max=e;this.scale=
h;this.seqSource=g||new z;this.viewCount=0;this.featureCache={};this.latestViews={}}function q(a,d,b){for(var e=[],h={},g=0;g<a.length;++g){var f=a[g];f.min&&f.max?f.groups&&0<f.groups.length?x(h,f.groups[0].id,f):f.min<=b&&f.max>=d&&e.push(f):e.push(f)}for(var c in h){a=h[c];for(var m=1E11,k=-1E11,g=0;g<a.length;++g)f=a[g],m=Math.min(m,f.min),k=Math.max(k,f.max);if(m<=b||k>=d)for(g=0;g<a.length;++g)e.push(a[g])}return e}if("undefined"!==typeof c){t=c("./utils");var p=t.Awaited,x=t.pusho;t=c("./sourceadapters");
var C=t.MappedFeatureSource,b=t.CachingFeatureSource,a=t.BWGFeatureSource,g=t.RemoteBWGFeatureSource,f=t.BAMFeatureSource,v=t.RemoteBAMFeatureSource,z=t.DummySequenceSource,m=t.DummyFeatureSource,F=c("./overlay").OverlayFeatureSource;t=c("./spans");var A=t.Range,T=t.intersection;t=c("./sample");var d=t.downsample,e=t.getBaseCoverage,h=c("./das").DASSequence,y=c("es6-promise").Promise}n.prototype.addRequest=function(a){this.reqs.push(a)};n.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};
l.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};k.prototype.cancel=function(){this.cancelled=!0};k.prototype.bestCacheOverlapping=function(a,d,b){return(a=this.featureCache[this.tierMap[0]])?a:null};k.prototype.retrieveFeatures=function(a,d,b,e,h,g){if(h!=h)throw"retrieveFeatures called with silly scale";if(d!=this.chr)throw"Can't extend Known Space to a new chromosome";1>b&&(b=1);this.min=b;this.max=e;this.scale=h;this.pool&&this.pool.abortAll();this.pool=
new n;this.awaitedSeq=new p;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(a,g);this.pool.notifyRequestsIssued()};k.prototype.invalidate=function(a,d){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a],d))};k.prototype.startFetchesForTiers=function(a,d){for(var b=this,e=this.awaitedSeq,g=!1,f,c=0;c<a.length;++c)try{this.startFetchesFor(a[c],e,d)&&(g=!0)}catch(m){var k=a[c];k.currentFeatures=[];k.currentSequence=null;console.log("Error fetching tier source");console.log(m);
f=m;d(m,k)}if(g&&!this.seqWasFetched){this.seqWasFetched=!0;var l=this.min,y=this.max;if(this.cs&&this.cs.start<=l&&this.cs.end>=y)return g=this.cs.start==l&&this.cs.end==y?this.cs:new h(this.cs.name,l,y,this.cs.alphabet,this.cs.seq.substring(l-this.cs.start,y+1-this.cs.start)),e.provide(g);this.seqSource.fetch(this.chr,l,y,this.pool,function(a,d){if(d){if(!b.cs||l<=b.cs.start&&y>=b.cs.end||l>=b.cs.end||y<=b.cs.start||y-l>b.cs.end-b.cs.start)b.cs=d;e.provide(d)}else console.log("Sequence loading failed",
a),e.provide(null)})}if(f)throw f;};k.prototype.startFetchesFor=function(a,d,b){var e=this,h=this.viewCount,g=a.getSource()||new m,f=a.needsSequence(this.scale),c=e.featureCache[a],k=a.getActiveStyleFilters(this.scale),y;k&&(y=k.typeList());var v=this.chr,z=this.min,n=this.max;if(void 0===y)return!1;if(c&&c.chr===this.chr&&c.min<=z&&c.max>=n){var C=c.features;if(c.min<z||c.max>n)C=q(C,z,n);e.provision(a,c.chr,T(c.coverage,new A(z,n)),c.scale,y,C,c.status,f?d:null,b);C=g.getScales();if(c.scale<=this.scale||
!C)return f}g.instrument&&console.log("Starting  fetch "+h+" ("+z+", "+n+")");g.fetch(v,z,n,this.scale,y,this.pool,function(m,k,C,p){g.instrument&&console.log("Finishing fetch "+h);var x=e.latestViews[a]||-1;if(!(e.cancelled||x>h)){p||(p=new A(z,n));if(!c||z<c.min||n>c.max)e.featureCache[a]=new l(v,z,n,C,k,m,p);e.latestViews[a]=h;e.provision(a,v,p,C,y,k,m,f?d:null,b)}},k);return f};k.prototype.provision=function(h,c,m,k,y,l,z,n,p){if(z)h.setFeatures(c,m,k,[],null),p(z,h);else{for(var A=!1,x=!1,w=
h.getSource();C.prototype.isPrototypeOf(w)||b.prototype.isPrototypeOf(w)||F.prototype.isPrototypeOf(w);)w=F.prototype.isPrototypeOf(w)?w.sources[0]:w.source;if(a.prototype.isPrototypeOf(w)||g.prototype.isPrototypeOf(w)||f.prototype.isPrototypeOf(w)||v.prototype.isPrototypeOf(w))A=!0;w.opts&&(w.opts.forceReduction||w.opts.noDownsample)||A&&y&&1==y.length&&0<=y.indexOf("density")&&(l=d(l,this.scale));y&&1==y.length&&0<=y.indexOf("base-coverage")&&(x=!0);n?n.await(function(a){x&&(l=e(l,a,h.browser.baseColors));
h.setFeatures(c,m,k,l,a);p(z,h)}):(h.setFeatures(c,m,k,l),p(z,h))}};"undefined"!==typeof u&&(u.exports={KnownSpace:k})},{"./das":10,"./overlay":27,"./sample":29,"./sourceadapters":34,"./spans":36,"./utils":49,"es6-promise":53}],24:[function(c,u,t){function n(a,b){this.block=a;this.offset=b}function l(a,b,f){var c=4294967296*(a[b+6]&255)+16777216*(a[b+5]&255)+65536*(a[b+4]&255)+256*(a[b+3]&255)+(a[b+2]&255);a=a[b+1]<<8|a[b];return 0!=c||0!=a||f?new n(c,a):null}function k(a,g){g=Math.min(g||1,a.byteLength-
50);for(var f=[],c=[0],k=0;c[0]<g;){var m=new Uint8Array(a,c[0],12),m=m[11]<<8|m[10],m=C(a,12+m+c[0],Math.min(65536,a.byteLength-12-m-c[0]),c);c[0]+=8;k+=m.byteLength;f.push(m)}if(1==f.length)return f[0];c=new Uint8Array(k);for(m=k=0;m<f.length;++m){var l=new Uint8Array(f[m]);b(l,0,c,k,l.length);k+=l.length}return c.buffer}function q(a,b){this.minv=a;this.maxv=b}function p(a,b){--b;return a>>14==b>>14?4681+(a>>14):a>>17==b>>17?585+(a>>17):a>>20==b>>20?73+(a>>20):a>>23==b>>23?9+(a>>23):a>>26==b>>26?
1+(a>>26):0}function x(a,b){var f,c=[];--b;c.push(0);for(f=1+(a>>26);f<=1+(b>>26);++f)c.push(f);for(f=9+(a>>23);f<=9+(b>>23);++f)c.push(f);for(f=73+(a>>20);f<=73+(b>>20);++f)c.push(f);for(f=585+(a>>17);f<=585+(b>>17);++f)c.push(f);for(f=4681+(a>>14);f<=4681+(b>>14);++f)c.push(f);return c}if("undefined"!==typeof c){c=c("jszlib");var C=c.inflateBuffer,b=c.arrayCopy}n.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof u&&(u.exports={unbgzf:k,readVob:l,reg2bin:p,reg2bins:x,
Chunk:q})},{jszlib:65}],25:[function(c,u,t){function n(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}function l(b){this.source=b;p.call(this);this.storeHolder=new x;this.parser=q(b.payload);if(!this.parser)throw"Unsupported memstore payload: "+b.payload;var a=this;this._load(function(b,f){if(b){for(var c=new n,k=[],m=b.split("\n"),l=a.parser.createSession(function(a){k.push(a)}),C=0;C<m.length;++C){var p=m[C];0<p.length&&l.parse(p)}l.flush();c.addFeatures(k);a.storeHolder.provide(c)}else a.error=
f||"No data",a.storeHolder.provide(null)})}if("undefined"!==typeof c){u=c("./sourceadapters");var k=u.registerSourceAdapterFactory,q=u.makeParser,p=u.FeatureSourceBase;c("./das");c=c("./utils");var x=c.Awaited,C=c.textXHR}n.prototype.addFeatures=function(b){for(var a={},g=0;g<b.length;++g){var f=b[g],c=f.segment||f.chr,k=this.featuresByChr[c];k||(k=[],this.featuresByChr[c]=k);k.push(f);a[c]=!0;f=f.max-f.min+1;f>this.maxLength&&(this.maxLength=f)}for(c in a)k=this.featuresByChr[c],k.sort(function(a,
b){var g=a.min-b.min;return 0!=g?g:a.max-b.max});this.chrRing=null};n.prototype._indexFor=function(b,a){for(var g=0,f=b.length;f>g;){var c=(g+f)/2|0;if(c>=b.length)return b.length;a<b[c].min?f=c:g=c+1}return f};n.prototype.fetch=function(b,a,g){var f=this.featuresByChr[b];f||(f=0==b.indexOf("chr")?this.featuresByChr[b.substring(3)]:this.featuresByChr["chr"+b]);if(!f)return[];var c=Math.max(0,this._indexFor(f,a-this.maxLength-1));b=Math.min(f.length-1,this._indexFor(f,g));for(var k=[];c<=b;++c){var m=
f[c];m.min<=g&&m.max>=a&&k.push(m)}return k};n.prototype.findNextFeature=function(b,a,g){if(null==this.chrRing){this.chrRing=[];for(b in this.featuresByChr)this.chrRing.push(b);this.chrRing.sort()}var f=this.featuresByChr[b];f||(b=0==b.indexOf("chr")?b.substring(3):"chr"+b,f=this.featuresByChr[b]);if(!f)return null;var c=Math.max(0,Math.min(this._indexFor(f,a),f.length-1));if(0<g){for(;c<f.length;){var k=f[c++];if(k.min>a)return k}b=this.chrRing.indexOf(b)+1;b>=this.chrRing.length&&(b=0);return this.findNextFeature(this.chrRing[b],
0,g)}for(;0<=c;)if(k=f[c--],k.max<a)return k;b=this.chrRing.indexOf(b)-1;0>b&&(b=this.chrRing.length-1);return this.findNextFeature(this.chrRing[b],1E10,g)};l.prototype=Object.create(p.prototype);l.prototype._load=function(b){if(this.source.blob){var a=new FileReader;a.onloadend=function(){return b(a.result,a.error)};a.readAsText(this.source.blob)}else{if(this.source.credentials)var g={credentials:this.source.credentials};C(this.source.uri,b,g)}};l.prototype.fetch=function(b,a,g,f,c,k,m){var l=this;
this.storeHolder.await(function(f){return f?(f=f.fetch(b,a,g),m(null,f,1E8)):m(l.error)})};l.prototype.getStyleSheet=function(b){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(b)};l.prototype.getDefaultFIPs=function(b){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(b)};l.prototype.getScales=function(){return 1E8};l.prototype.findNextFeature=function(b,a,g,f){var c=this;this.storeHolder.await(function(k){return k?f(k.findNextFeature(b,a,g)):f(null,c.error)})};
l.prototype.capabilities=function(){return{leap:!0}};k("memstore",function(b){return{features:new l(b)}})},{"./das":10,"./sourceadapters":34,"./utils":49}],26:[function(c,u,t){function n(c){return(c|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function l(c){c=""+c;var l=c.indexOf(".");if(0>l)return c;var n=2;"-"==c.substring(0,1)&&++n;return l>=n?c.substring(0,l):c.substring(0,l+2)}"undefined"!==typeof u&&(u.exports={formatLongInt:n,formatQuantLabel:l})},{}],27:[function(c,u,t){function n(c,
b){this.sources=c;this.opts=b||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var a=0;a<this.sources.length;++a)this.initN(a);"function"===typeof b.merge?this.merge=b.merge:"concat"==b.merge?this.merge=q:"alternates"==b.merge?(this.merge=q,this.filterDispatchOnMethod=!0):this.merge=k}function l(c,b,a){this.source=c;this.callback=b;this.sources=a;this.count=a.length;this.statusCount=this.returnCount=0;this.returns=[];this.features=
[];this.statuses=[];this.scale=null}function k(c){for(var b=[],a=1;a<c.length;++a){for(var g={},f=c[a],k=0;k<f.length;++k)g[this.keyForFeature(f[k])]=f[k];b.push(g)}a=[];c=c[0];for(k=0;k<c.length;++k){for(var l=c[k],m=0;m<b.length;++m)if(g=b[m],f=g[this.keyForFeature(l)])for(var n in f)"score"===n?l.score2=f.score:"min"!==n&&"max"!==n&&"segment"!==n&&"_cachedStyle"!==n&&(l[n]=f[n]);a.push(l)}return a}function q(c,b){for(var a=[],g=0;g<c.length;++g)for(var f=c[g],k=b[g].name,l=0;l<f.length;++l){var m=
f[l];m.method=k;a.push(m)}return a}if("undefined"!==typeof c){c=c("./utils");var p=c.shallowCopy,x=c.arrayIndexOf}n.prototype.initN=function(c){var b=this.sources[c],a=this;this.business[c]=0;b.addActivityListener&&b.addActivityListener(function(b){a.business[c]=b;a.notifyActivity()});b.addChangeListener&&b.addChangeListener(function(){a.notifyChange()});b.addReadinessListener&&b.addReadinessListener(function(b){a.readiness[c]=b;a.notifyReadiness()})};n.prototype.addReadinessListener=function(c){this.readinessListeners.push(c);
this.notifyReadinessListener(c)};n.prototype.removeReadinessListener=function(c){c=x(this.readinessListeners,c);0<=c&&this.readinessListeners.splice(c,1)};n.prototype.notifyReadiness=function(){for(var c=0;c<this.readinessListeners.length;++c)this.notifyReadinessListener(this.readinessListeners[c])};n.prototype.notifyReadinessListener=function(c){for(var b=null,a=0;a<this.readiness.length;++a)if(null!=this.readiness[a]){b=this.readiness[a];break}try{c(b)}catch(g){console.log(g)}};n.prototype.addActivityListener=
function(c){this.activityListeners.push(c)};n.prototype.removeActivityListener=function(c){c=x(this.activityListeners,c);0<=c&&this.activityListeners.splice(c,1)};n.prototype.notifyActivity=function(){for(var c=0,b=0;b<this.business.length;++b)c+=this.business[b];for(b=0;b<this.activityListeners.length;++b)try{this.activityListeners[b](c)}catch(a){console.log(a)}};n.prototype.addChangeListener=function(c){this.changeListeners.push(c)};n.prototype.removeChangeListener=function(c){c=x(this.changeListeners,
c);0<=c&&this.changeListeners.splice(c,1)};n.prototype.notifyChange=function(){for(var c=0;c<this.changeListeners.length;++c)try{this.changeListeners[c](this.busy)}catch(b){console.log(b)}};n.prototype.getScales=function(){return this.sources[0].getScales()};n.prototype.getStyleSheet=function(c){return this.sources[0].getStyleSheet(c)};n.prototype.capabilities=function(){var c={},b=this.sources[0];b.capabilities&&(c=p(b.capabilities()));for(b=1;b<this.sources.length;++b){var a=this.sources[b];a.capabilities&&
(a=a.capabilities(),a.search&&(c.search=a.search))}return c};n.prototype.search=function(c,b){for(var a=0;a<this.sources.length;++a){var g;g=this.sources[a];g=g.capabilities?g.capabilities().search:!1;if(g)return this.sources[a].search(c,b)}};n.prototype.fetch=function(c,b,a,g,f,k,n,m){var p;if(this.filterDispatchOnMethod){p=[];for(var A=m.list(),x=0;x<this.sources.length;++x)for(var d=this.sources[x],e=0;e<A.length;++e){var h=A[e];if(!h.method||h.method==d.name){p.push(d);break}}}else p=this.sources;
n=new l(this,n,p);for(x=0;x<p.length;++x)this.fetchN(n,x,p[x],c,b,a,g,f,k,m)};n.prototype.fetchN=function(c,b,a,g,f,k,l,m,n,p){a.fetch(g,f,k,l,m,n,function(a,d,e){return c.completed(b,a,d,e)},p)};n.prototype.quantFindNextFeature=function(c,b,a,g,f){return this.sources[0].quantFindNextFeature(c,b,a,g,f)};n.prototype.findNextFeature=function(c,b,a,g){return this.sources[0].findNextFeature(c,b,a,g)};l.prototype.completed=function(c,b,a,g){if(null==this.scale||0==c)this.scale=g;if(this.returns[c])throw"Multiple returns for source "+
c;this.returns[c]=!0;this.returnCount++;this.features[c]=a;b&&(this.statuses[c]=b,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){c="";for(b=0;b<this.count;++b)if(a=this.statuses[b])0<c.length&&(c+=", "),c+=a;return this.callback(c,null,this.scale)}this.callback(null,this.source.merge(this.features,this.sources),this.scale)}};n.prototype.getDefaultFIPs=function(c){for(var b=0;b<this.sources.length;++b){var a=this.sources[b];a.getDefaultFIPs&&a.getDefaultFIPs(c)}};n.prototype.keyForFeature=
function(c){return""+c.min+".."+c.max};"undefined"!==typeof u&&(u.exports={OverlayFeatureSource:n})},{"./utils":49}],28:[function(c,u,t){function n(c,m,F){var A=/^\w+\s[0-9]+\s[0-9]+.*$/,t=/([^=]+)=\"?([^\"]+)\"?/,d=/^##\s*fileformat=VCFv4\..+/;(c.blob?new q(c.blob):"encode"==c.transport?new v(c.uri):new k(c.uri,{credentials:c.credentials})).slice(0,65536).salted().fetch(function(e,h){if(!e)return F||(c.credentials=!0,n(c,m,!0)),m(c,"Couldn't fetch data");var k=new Uint8Array(e),v=(new Uint32Array(e,
0,1))[0];if(v==x||v==C){c.tier_type="bwg";k=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(k=k.exec(c.uri||c.blob.name))c.name=k[1];return m(c,null)}if(v==g)return c.tier_type="bai",m(c,null);if(31==k[0]||139==k[1]){k=b(e);k=new Uint8Array(k);v=p(k,0);if(v==a){c.tier_type="bam";k=/\/?([^/]+?)(.bam)?$/;if(k=k.exec(c.uri||c.blob.name))c.name=k[1];return m(c,null)}if(v==f)return c.tier_type="tabix-index",m(c,null);if(1768301347==v){c.tier_type="tabix";c.payload="vcf";k=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(k=
k.exec(c.uri||c.blob.name))c.name=k[1];return m(c,null)}console.log("magic = "+v.toString(16));return m(c,"Unsupported format")}k=String.fromCharCode.apply(null,k).split("\n");if(0<k.length&&d.test(k[0]))return c.tier_type="memstore",c.payload="vcf",k=/\/?([^/]+?)(.vcf)?$/,(k=k.exec(c.uri||c.blob.name))&&!c.name&&(c.name=k[1]),m(c,null);for(var r=0;r<k.length;++r)if(v=k[r].replace("\r",""),0!=v.length&&0!=v.indexOf("browser")){if(0==v.indexOf("track")){k="bed";v=v.split(/\s/);for(r=1;r<v.length;++r){var D=
t.exec(v[r]);D&&("type"==D[1]&&"wiggle_0"==D[2]?k="wig":"name"==D[0]&&(c.name=D[2]))}l(c,k);return m(c,null)}if(0==v.indexOf("fixedStep")||0==v.indexOf("variableStep"))return l(c,"wig"),m(c,null);if(A.test(v))return l(c,null),m(c,null);break}return m(c,"Unsupported format")},{timeout:1500})}function l(a,b){a.tier_type="memstore";var c=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);c&&(a.name||(a.name=c[1]),!b&&c[3]&&(b=c[3]));a.payload=b||"bed"}if("undefined"!==typeof c){t=c("./bin");var k=
t.URLFetchable,q=t.BlobFetchable,p=t.readInt;t=c("./bigwig");var x=t.BIG_WIG_MAGIC,C=t.BIG_BED_MAGIC,b=c("./lh3utils").unbgzf;t=c("./bam");var a=t.BAM_MAGIC,g=t.BAI_MAGIC,f=c("./tabix").TABIX_MAGIC,v=c("./encode").EncodeFetchable}"undefined"!==typeof u&&(u.exports={probeResource:n})},{"./bam":1,"./bigwig":3,"./bin":4,"./encode":12,"./lh3utils":24,"./tabix":41}],29:[function(c,u,t){function n(a){return g[a%g.length]*Math.pow(10,a/g.length|0)}function l(a,b,c){this.scale=a;this.cnt=this.tot=0;this.hasScore=
!1;this.min=b;this.max=c;this.features=[]}function k(a,b){return a.min<b.min?-1:a.min>b.min?1:a.max<b.max?-1:b.max>a.max?1:0}function q(a,b){for(var c=0;n(c+1)<b;)++c;for(var c=n(c),g=[],k=-1E10,p=1E10,x=0;x<a.length;++x){var d=a[x];if(d.groups&&0<d.groups.length)return a;for(var e=d.min/c|0,h=d.max/c|0,k=Math.max(k,h),p=Math.min(p,e);e<=h;++e){var y=g[e];y||(y=new l(c,e*c,(e+1)*c-1),g[e]=y);y.feature(d)}}x=[];for(e=p;e<=k;++e)if(y=g[e])d=new C,d.segment=a[0].segment,d.min=e*c+1,d.max=(e+1)*c,d.score=
y.score(),d.type="density",x.push(d);Date.now();return x}function p(a){this._pos=a;this._bases={};this._totalCount=0}function x(c,g,k){for(var m,l,n=null,x=null,d=[],e=0;e<c.length;++e){var h=c[e];if(h.groups&&0<h.groups.length)return c;m=h.seq;var y=h.quals,B=b(h.cigar),r=[];l=[];for(var D=0,H=0;H<B.length;++H){var q=B[H];if("M"==q.op)r.push(m.substr(D,q.cnt)),l.push(y.substr(D,q.cnt)),D+=q.cnt;else if("D"==q.op)for(var t=0;t<q.cnt;++t)r.push("-"),l.push("Z");else"I"==q.op?D+=q.cnt:"S"==q.op?D+=
q.cnt:console.log("unknown cigop"+q.op)}m=r.join("");l=l.join("");r=m;D=l;H=h.orientation;q=h.min||0;h=h.max||0;l=0;for(m=q;m<=h;++m)B=d[m],B||(B=new p(m),d[m]=B),y=r.charAt(l),t=D.charCodeAt(l)-33,B.recordBase(y,t,H),l++;n=n?Math.min(n,q):q;x=x?Math.max(x,h):h}h=n;e=x;l=[];if(g&&(m=g.start|0,B=g.end|0,m<=e&&B>=h)){y=Math.max(h,m);B=Math.min(e,B);for(r=0;r<y-h;r++)l.push("N");l.push(g.seq.substr(y-m,B-y+1));for(r=0;r<e-B;r++)l.push("N")}g=l.join("");e=[];l=0;for(m=n;m<=x;++m){if(B=d[m])if(h=new C,
h.segment=c[0].segment,h.min=B.pos(),h.max=h.min,h.notes=[],h.notes=h.notes.concat(B.infoList()),h.type="base-coverage",h.suppressScore=!0,g)for(n=g.charAt(l),h.notes.unshift("Ref="+n),B=B.baseScoreList(n,.2),r=0;r<B.length;r++){y=B[r].base;D=B[r].score;H=a(h);H.score=D;if(1<B.length||y!=n)H.itemRgb=k[y];e.push(H)}else e.push(h);l++}return e}if("undefined"!==typeof c)var C=c("./das").DASFeature,b=c("./cigar").parseCigar,a=c("./utils").shallowCopy;var g=[1,2,5];l.prototype.score=function(){if(0==this.cnt)return 0;
if(this.hasScore)return this.tot/this.cnt;var a=this.features;a.sort(k);for(var b=-1E10,c=0,g=0,l=1;l<a.length;++l){var n=a[l],p=Math.max(n.min,this.min),n=Math.min(n.max,this.max),g=g+(n-p+1);p>b?(c+=n-p+1,b=n):n>b&&(c+=n-b,b=n)}return 0<c?1*g/c:0};l.prototype.feature=function(a){void 0!==a.score&&(this.tot+=a.score,this.hasScore=!0);++this.cnt;this.features.push(a)};p.prototype.recordBase=function(a,b,c){if(this._bases[a])a=this._bases[a],a.cnt++,a.totalQual+=b,a.strandCnt[c]++;else{var g={"+":0,
"-":0};g[c]++;this._bases[a]={cnt:1,totalQual:b,strandCnt:g}}this._totalCount++};p.prototype.totalCount=function(){return this._totalCount};p.prototype.pos=function(){return this._pos};p.prototype.infoList=function(){var a=[],b=this._totalCount;a.push("Depth="+b.toString());for(var c in this._bases){var g=this._bases[c],k=g.cnt,l=g.strandCnt["+"],n=g.strandCnt["-"],g=g.totalQual/k,k=[c,"=",k," (",(100*k/b).toFixed(0),"%, ",l," +, ",n," -, Qual: ",g.toFixed(0),")"];a.push(k.join(""))}return a};p.prototype.baseScoreList=
function(a,b){var c=[],g=this._totalCount,k=b*g,l;for(l in this._bases){var n=this._bases[l].cnt;n<k||l==a||(c.push({base:l,score:g}),g-=n)}c.push({base:a,score:g});return c};"undefined"!==typeof u&&(u.exports={downsample:q,getBaseCoverage:x})},{"./cigar":8,"./das":10,"./utils":49}],30:[function(c,u,t){function n(c,k){var b=parseFloat(c.replace(/,/g,""));return"k"===k||"K"===k?1E3*b|0:"m"==k||"M"===k?1E6*b|0:b|0}if("undefined"!==typeof c)var l=c("./cbrowser").Browser,k=c("./bin").URLFetchable,q=c("./trix").connectTrix;
var p=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;l.prototype.search=function(c,l){var b=this,a=p.exec(c);if(a){var g=a[1],f;if(a[6])f=n(a[2],a[3]),a=n(a[6],a[7]);else{var v=this.viewEnd-this.viewStart+1;f=n(a[2],a[3])-v/2|0;a=f+v-1}this.setLocation(g,f,a,l)}else{if(!c||0==c.length)return!1;var z=0,m=!1,F=function(a,d){--z;if(d)return l(d);a||(a=[]);for(var e=5E8,h=-1E8,g=null,f=0;f<a.length;++f){var k=a[f];null==g&&(g=k.segment);e=Math.min(e,k.min);h=Math.max(h,
k.max)}if(g)m=!0,b.highlightRegion(g,e,h),f=Math.max(2500,.3*(h-e+1)|0),b.setLocation(g,e-f,h+f,l);else if(0==z&&!m)return l("no match for '"+c+"'")},A=function(a,d){d.lookup(c,function(d,b){if(null==d||2>d.length)return a.featureSource.search(c,F);var g=d[1].split(",")[0];return a.featureSource.search(g,F)})};if(this.searchEndpoint)return z=1,this.doDasSearch(b.searchEndpoint,c,F);for(g=0;g<this.tiers.length;++g)(function(a){if(b.sourceAdapterIsCapable(a.featureSource,"search"))if(a.dasSource.trixURI)if(++z,
a.trix)A(a,a.trix);else{var d=new k(a.dasSource.trixURI,{credentials:a.dasSource.credentials,resolver:a.dasSource.resolver}),e=new k(a.dasSource.trixxURI||a.dasSource.trixURI+"x",{credentials:a.dasSource.credentials,resolver:a.dasSource.resolver});q(d,e,function(d){a.trix=d;A(a,d)})}else++z,a.featureSource.search(c,F);else a.dasSource.provides_search&&(++z,b.doDasSearch(a.dasSource,c,F))})(this.tiers[g])}};l.prototype.doDasSearch=function(c,k,b){c.features(null,{group:k,type:"transcript"},function(a){a||
(a=[]);for(var c=[],f=0;f<a.length;++f){var l=a[f];l.label.toLowerCase()==k.toLowerCase()&&c.push(l)}return b(c)},!1)}},{"./bin":4,"./cbrowser":6,"./trix":47}],31:[function(c,u,t){function n(a,c){c||(c=100);for(var f=b.length;a*b[f%b.length]*Math.pow(10,f/b.length|0)<c;)++f;return b[f%b.length]*Math.pow(10,f/b.length|0)}function l(a,b){var c=a.viewport.getContext("2d"),l=a.browser.retina&&1<window.devicePixelRatio,n=a.browser.featurePanelWidth+2E3;l&&(n*=2);var m=a.viewport.width|0;m<n-50&&(a.viewport.width=
m=n);n=50;b&&b.seq&&(n+=25);var p=n;l&&(p*=2);a.viewport.height=p;a.viewport.style.height=""+n+"px";a.viewport.style.width=l?""+m/2+"px":""+m+"px";a.layoutHeight=n;a.updateHeight();a.background&&(c.fillStyle=a.background,c.fillRect(0,0,m,a.viewport.height));l&&c.scale(2,2);c.translate(1E3,0);k(a,b,c);a.norigin=a.browser.viewStart;a.viewportHolder.style.left="-1000px"}function k(a,b,c){var k=a.browser.scale,l=a.browser.viewStart-1E3/k|0,m=a.browser.viewEnd+2E3/k,x=a.browser.currentSeqMax,q=m;0<x&&
x<m&&(q=x);for(var C=n(k),d=Math.max(0,(l/C|0)*C),x=a.browser.viewStart;d<=q;)c.fillStyle=0==d/C%2?"white":"black",c.strokeStyle="black",c.fillRect((d-x)*k,8,C*k,3),c.strokeRect((d-x)*k,8,C*k,3),c.fillStyle="black",c.fillText(p(d),(d-x)*k,22),d+=C;if(b&&b.seq)for(;l<=m;++l)l>=b.start&&l<=b.end&&(q=b.seq.substr(l-b.start,1).toUpperCase(),(C=a.browser.baseColors[q])||(C="gray"),c.fillStyle=C,8<=k?(C=c.measureText(q).width,c.fillText(q,(l-x)*k+.5*(k-C),52)):c.fillRect((l-x)*k,42,k,12))}function q(a,
b){var c=a.browser.scale,k=a.browser.viewStart-1E3/c|0,l=a.browser.viewEnd+2E3/c,m=a.browser.currentSeqMax,q=l;0<m&&m<l&&(q=m);for(var A=n(c),t=Math.max(0,(k/A|0)*A),m=a.browser.viewStart,d=x(C,"g",[],{fontSize:"8pt"});t<=q;)d.appendChild(x(C,"rect",null,{x:(t-m)*c,y:8,width:A*c,height:3,fill:0==t/A%2?"white":"black",stroke:"black"})),d.appendChild(x(C,"text",p(t),{x:(t-m)*c,y:28,fill:"black",stroke:"none"})),t+=A;if(b&&b.seq)for(;k<=l;++k)k>=b.start&&k<=b.end&&(q=b.seq.substr(k-b.start,1).toUpperCase(),
(A=a.browser.baseColors[q])||(A="gray"),8<=c?d.appendChild(x(C,"text",q,{x:(.5+k-m)*c,y:52,textAnchor:"middle",fill:A})):d.appendChild(x(C,"rect",null,{x:(k-m)*c,y:42,width:c,height:12,fill:A})));return d}if("undefined"!==typeof c){t=c("./utils");var p=t.formatLongInt,x=t.makeElementNS,C=c("./svg-utils").NS_SVG,p=c("./numformats").formatLongInt}var b=[1,2,5],C="http://www.w3.org/2000/svg";"undefined"!==typeof u&&(u.exports={drawSeqTier:l,drawSeqTierGC:k,svgSeqTier:q})},{"./numformats":26,"./svg-utils":39,
"./utils":49}],32:[function(c,u,t){if("undefined"!=typeof c){var n=c("./cbrowser").Browser;u=c("./sourcecompare");var l=u.sourceDataURI,k=u.sourcesAreEqual,q=c("./version"),p=c("./utils").miniJSONify,x=c("./sha1").hex_sha1}n.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".current-seq-length"];
delete localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+this.cookieKey+
".ruler-location"]};n.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};n.prototype.storeViewStatus=function(){!this.cookieKey||this.noPersist||this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+
this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};n.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var c=[],b=0;b<this.tiers.length;++b){var a=this.tiers[b];a.dasSource.noPersist||c.push({source:a.dasSource,config:a.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(c);c={};b=[];for(a=0;a<this.hubObjects.length;++a){var g=this.hubObjects[a],
f={url:g.hub.url,genome:g.genome};g.credentials&&(f.credentials=g.credentials);g.mapping&&(f.mapping=g.mapping);c[f.url]=!0;b.push(f)}for(a=0;a<this.hubs.length;++a)f=this.hubs[a],"string"===typeof f&&(f={url:f}),c[f.url]||b.push(f);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(b);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+
this.cookieKey+".single-base-highlight"]=this.singleBaseHighlight;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=q.CONFIG}};n.prototype.restoreStatus=function(){if(!this.noPersist){var c=localStorage["dalliance."+this.cookieKey+".version"];if(q.CONFIG==(c?
c|0:-100)){var c=localStorage["dalliance."+this.cookieKey+".configHash"]||"",b=x(p({sources:this.sources,hubs:this.hubs}));if(b!=c)localStorage["dalliance."+this.cookieKey+".configHash"]=b;else{c={};for(b=0;b<this.sources.length;++b){var a=this.sources[b];if(a){var g=l(a),f=c[g];f||(c[g]=f=[]);f.push(a)}}if(!this.noPersistView&&(b=localStorage["dalliance."+this.cookieKey+".view-chr"],a=localStorage["dalliance."+this.cookieKey+".view-start"]|0,f=localStorage["dalliance."+this.cookieKey+".view-end"]|
0,b&&a&&f)){this.chr=b;this.viewStart=a;this.viewEnd=f;if(b=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=b|0;this.isSnapZooming="true"==localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];b=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof b||isNaN(b)||(this.savedZoom=b)}this.reverseScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==b;this.reverseKeyScrolling=(b=localStorage["dalliance."+
this.cookieKey+".reverse-key-scrolling"])&&"true"==b;this.singleBaseHighlight=(b=localStorage["dalliance."+this.cookieKey+".single-base-highlight"])&&"true"==b;if(b=localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=b;if(b=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".sources"]){var n=
JSON.parse(b);this.sources=[];this.restoredConfigs=[];for(b=0;b<n.length;++b)for(a=this.sources[b]=n[b].source,this.restoredConfigs[b]=n[b].config,g=l(a),f=c[g]||[],g=0;g<f.length;++g){var z=f[g];if(k(a,z))for(var m in z)z.hasOwnProperty(m)&&("function"===typeof z[m]||z[m]instanceof Blob)&&(a[m]=z[m])}}if(m=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(m);return!0}}}};n.prototype.reset=function(){for(var c=this.tiers.length-1;0<=c;--c)this.removeTier({index:c},!0);for(c=0;c<
this.defaultSources.length;++c)this.defaultSources[c].disabled||this.addTier(this.defaultSources[c]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,this.defaultEnd)}},{"./cbrowser":6,"./sha1":33,"./sourcecompare":35,"./utils":49,"./version":51}],33:[function(c,u,t){function n(c){c=k(q(c));for(var l="",b,a=0;a<c.length;a++)b=c.charCodeAt(a),l+="0123456789abcdef".charAt(b>>>4&15)+"0123456789abcdef".charAt(b&15);return l}function l(c){c=k(q(c));for(var l=
"",b=c.length,a=0;a<b;a+=3)for(var g=c.charCodeAt(a)<<16|(a+1<b?c.charCodeAt(a+1)<<8:0)|(a+2<b?c.charCodeAt(a+2):0),f=0;4>f;f++)l=8*a+6*f>8*c.length?l+"":l+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>6*(3-f)&63);return l}function k(c){for(var k=Array(c.length>>2),b=0;b<k.length;b++)k[b]=0;for(b=0;b<8*c.length;b+=8)k[b>>5]|=(c.charCodeAt(b/8)&255)<<24-b%32;c=8*c.length;k[c>>5]|=128<<24-c%32;k[(c+64>>9<<4)+15]=c;c=Array(80);for(var b=1732584193,a=-271733879,g=-1732584194,
f=271733878,l=-1009589776,n=0;n<k.length;n+=16){for(var m=b,q=a,A=g,t=f,d=l,e=0;80>e;e++){if(16>e)c[e]=k[n+e];else{var h=c[e-3]^c[e-8]^c[e-14]^c[e-16];c[e]=h<<1|h>>>31}var h=b<<5|b>>>27,y;y=20>e?a&g|~a&f:40>e?a^g^f:60>e?a&g|a&f|g&f:a^g^f;h=p(p(h,y),p(p(l,c[e]),20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514));l=f;f=g;g=a<<30|a>>>2;a=b;b=h}b=p(b,m);a=p(a,q);g=p(g,A);f=p(f,t);l=p(l,d)}k=[b,a,g,f,l];c="";for(b=0;b<32*k.length;b+=8)c+=String.fromCharCode(k[b>>5]>>>24-b%32&255);return c}function q(c){for(var k=
"",b=-1,a,g;++b<c.length;)a=c.charCodeAt(b),g=b+1<c.length?c.charCodeAt(b+1):0,55296<=a&&56319>=a&&56320<=g&&57343>=g&&(a=65536+((a&1023)<<10)+(g&1023),b++),127>=a?k+=String.fromCharCode(a):2047>=a?k+=String.fromCharCode(192|a>>>6&31,128|a&63):65535>=a?k+=String.fromCharCode(224|a>>>12&15,128|a>>>6&63,128|a&63):2097151>=a&&(k+=String.fromCharCode(240|a>>>18&7,128|a>>>12&63,128|a>>>6&63,128|a&63));return k}function p(c,k){var b=(c&65535)+(k&65535);return(c>>16)+(k>>16)+(b>>16)<<16|b&65535}"undefined"!==
typeof u&&(u.exports={b64_sha1:l,hex_sha1:n})},{}],34:[function(c,u,t){function n(a,d){ia[a]=d}function l(a,d){ja[a]=d}function k(a){if(ja[a])return ja[a](a)}function q(a){var d=this;this.source=a;this.cfsid="cfs"+ ++na;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){d.cfsid="cfs"+ ++na})}function p(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}function x(a){this.dasSource=new R(a);this.busy=0;this.activityListeners=[]}function C(a){this.dasSource=
new R(a);this.awaitedEntryPoints=new B;var d=this;this.dasSource.entryPoints(function(a){d.awaitedEntryPoints.provide(a)})}function b(a){var d=this;this.source=a;this.twoBit=new B;if(a.twoBitURI)a=new w(a.twoBitURI,{credentials:a.credentials,resolver:a.resolver});else if(a.twoBitBlob)a=new E(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");U(a,function(a,b){b?console.log(b):d.twoBit.provide(a)})}function a(a){this.source=a}function g(a){p.call(this);var d=this;this.readiness=
"Connecting";this.bwgSource=this.opts=a;d.bwgHolder=new B;if(this.opts.preflight){var b=ba[this.opts.preflight];if(!b){b=new B;ba[this.opts.preflight]=b;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?b.provide("success"):b.provide("failure"))};e.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(e.withCredentials=!0);e.send("")}b.await(function(a){"success"===a&&d.init()})}else d.init()}function f(a,d,b){p.call(this);
this.worker=d;this.readiness="Connecting";this.bwgSource=this.opts=a;this.keyHolder=new B;a.resolver&&(this.resolverKey=b.registerResolver(a.resolver));this.init()}function v(a,d){if(!(a.flag&aa.SEGMENT_UNMAPPED)){var b;b=a.seq?a.seq.length:a.seqLength;if(a.cigar){b=0;for(var e=Y(a.cigar),c=0;c<e.length;++c){var h=e[c];if("M"==h.op||"D"==h.op)b+=h.cnt}}e=new S;e.min=a.pos+1;e.max=a.pos+b;e.segment=a.segment;e.type="bam";e.id=a.readName;e.notes=["MQ="+a.mq];e.cigar=a.cigar;e.seq=a.seq;e.quals=a.quals;
e.orientation=a.flag&aa.REVERSE_COMPLEMENT?"-":"+";e.bamRecord=a;d&&a.flag&aa.MULTIPLE_SEGMENTS&&(e.groups=[{id:a.readName,type:"readpair"}]);return e}}function z(a){p.call(this);var d=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new B;if(this.opts.preflight){var b=ba[this.opts.preflight];if(!b){b=new B;ba[this.opts.preflight]=b;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?b.provide("success"):
b.provide("failure"))};e.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(e.withCredentials="true");e.send("")}b.await(function(a){"success"===a&&d.init()})}else d.init()}function m(a,d){p.call(this);this.bamSource=a;this.worker=d;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.keyHolder=new B;bwgSource.resolver&&(this.resolverKey=e.registerResolver(bwgSource.resolver));this.init()}function F(a,d){this.source=a;this.mapping=
d;this.activityListeners=[];this.busy=0}function A(){}function T(){}function d(a){this.store=new ma(a.jbURI,a.jbQuery)}if("undefined"!==typeof c){var e=c("./cbrowser"),h=e.Browser,y=c("./tier").DasTier;t=c("./utils");var B=t.Awaited,r=t.arrayIndexOf,D=t.shallowCopy,H=t.resolveUrlToPage;t=c("./das");var W=t.DASStylesheet,I=t.DASStyle,R=t.DASSource,J=t.DASSegment,S=t.DASFeature,G=t.DASSequence,N=t.DASLink;t=c("./bin");var w=t.URLFetchable,E=t.BlobFetchable,U=c("./twoBit").makeTwoBit,K=c("./bigwig").makeBwg;
t=c("./bam");var L=t.makeBam,aa=t.BamFlags;t=c("./spans");var ha=t.Range,Z=t.union,Y=c("./cigar").parseCigar,la=c("./overlay").OverlayFeatureSource,ma=c("./jbjson").JBrowseStore,qa=c("./chainset").Chainset;c("./style");var ra=c("./encode").EncodeFetchable}var ia={},ja={};y.prototype.initSources=function(){var a=this,d=this.browser.createSources(this.dasSource);this.featureSource=d.features||new A;this.sequenceSource=d.sequence;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};
h.prototype.createSources=function(e){var c=this.sourceCache.get(e);if(c)return c;var h,k;if("sequence"==e.tier_type||e.twoBitURI||e.twoBitBlob)k=e.twoBitURI||e.twoBitBlob?new b(e):e.ensemblURI?new a(e):new C(e);else if(e.tier_type&&ia[e.tier_type])k=(0,ia[e.tier_type])(e),h=k.features,k=k.sequence;else if(e.bwgURI||e.bwgBlob)h=(h=this.getWorker())?new f(e,h,this):new g(e);else if(e.bamURI||e.bamBlob)h=(h=this.getWorker())?new m(e,h,this):new z(e);else if(e.jbURI)h=new d(e);else if(e.uri||e.features_uri)h=
new x(e);if(e.overlay){c=[];h&&c.push(new q(h));for(h=0;h<e.overlay.length;++h){var l=this.createSources(e.overlay[h]);l&&l.features&&c.push(l.features)}h=new la(c,e)}e.sequenceAliases&&(h=new F(h,new qa({type:"alias",sequenceAliases:e.sequenceAliases})));e.mapping&&(h=new F(h,this.chains[e.mapping]));e.name&&h&&!h.name&&(h.name=e.name);null!=h&&(h=new q(h));if(null!=h||null!=k)c={features:h,sequence:k},this.sourceCache.put(e,c);return c};y.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri||
!(this.dasSource.tier_type||this.dasSource.bwgURI||this.dasSource.bwgBlob||this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.twoBitURI||this.dasSource.twoBitBlob||this.dasSource.jbURI||this.dasSource.overlay)?new x(this.dasSource):this.getSource()).getStyleSheet(a)};var na=0;q.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};q.prototype.removeReadinessListener=function(a){if(this.source.removeReadinessListener)return this.source.removeReadinessListener(a)};
q.prototype.search=function(a,d){if(this.source.search)return this.source.search(a,d)};q.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};q.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};q.prototype.getScales=function(){return this.source.getScales()};q.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};q.prototype.removeActivityListener=function(a){this.source.removeActivityListener&&
this.source.removeActivityListener(a)};q.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};q.prototype.removeChangeListener=function(a){this.source.removeChangeListener&&this.source.removeChangeListener(a)};q.prototype.findNextFeature=function(a,d,b,e){this.source.findNextFeature(a,d,b,e)};q.prototype.quantFindNextFeature=function(a,d,b,e,c){this.source.quantFindNextFeature(a,d,b,e,c)};q.prototype.capabilities=function(){return this.source.capabilities?
this.source.capabilities():{}};q.prototype.fetch=function(a,d,b,e,c,h,g,f){if(!h)throw Error("Fetch pool is null");var k=this,m=this.cfsid,l=h.awaitedFeatures[m];if(l&&l.started){if(l.styleFilters.doesNotContain(f)){k.source.fetch(a,d,b,e,c,h,g,f);return}}else l?l.styleFilters.addAll(f):(l=new B,l.styleFilters=f,h.awaitedFeatures[m]=l,h.requestsIssued.then(function(){l.started=!0;k.source.fetch(a,d,b,e,l.styleFilters.typeList(),h,function(a,d,b,e){l.res||l.provide({status:a,features:d,scale:b,coverage:e})},
l.styleFilters)}).catch(function(a){console.log(a)}));l.await(function(a){g(a.status,a.features,a.scale,a.coverage)})};p.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};p.prototype.removeReadinessListener=function(a){a=r(this.readinessListeners,a);0<=a&&this.readinessListeners.splice(a,1)};p.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(d){console.log(d)}};p.prototype.addActivityListener=
function(a){this.activityListeners.push(a)};p.prototype.removeActivityListener=function(a){a=r(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};p.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(d){console.log(d)}};p.prototype.getScales=function(){return null};p.prototype.fetch=function(a,d,b,e,c,h,g){return g(null,[],1E9)};p.prototype.getStyleSheet=function(a){var d=new W,b=new I;b.glyph="BOX";b.BGCOLOR=
"blue";b.FGCOLOR="black";d.pushStyle({type:"default"},null,b);return a(d)};x.prototype.addActivityListener=function(a){this.activityListeners.push(a)};x.prototype.removeActivityListener=function(a){a=r(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};x.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(d){console.log(d)}};x.prototype.getStyleSheet=function(a){this.dasSource.stylesheet(function(d){a(d)},
function(){a(null,"Couldn't fetch DAS stylesheet")})};x.prototype.fetch=function(a,d,b,e,c,h,g){if(c&&0==c.length)g(null,[],e);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return g(null,this.cachedStaticFeatures,this.cachedStaticScale);var f=!1!==this.dasSource.maxbins;c={type:c};f&&(c.maxbins=1+((b-d)/e|0));var k=this;k.busy++;k.notifyActivity();this.dasSource.features(new J(a,d,b),c,function(a,d){k.busy--;k.notifyActivity();
var b=e;f||(b=.1);!d&&k.dasSource.dasStaticFeatures&&(k.cachedStaticFeatures=a,k.cachedStaticScale=b);g(d,a,b)})}};x.prototype.findNextFeature=this.sourceFindNextFeature=function(a,d,b,e){if(this.dasSource.capabilities&&0<=r(this.dasSource.capabilities,"das1:adjacent-feature")){var c=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(d|0)+":"+(0<b?"F":"B")};if(d=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=
d;thisTier.dasSource.features(null,a,function(a){c.dasAdjLock=!1;0<a.length&&null!=a[0]&&e(a[0])})}};C.prototype.fetch=function(a,d,b,e,c){this.dasSource.sequence(new J(a,d,b),function(a){return 1==a.length?c(null,a[0]):c("Didn't get sequence")})};C.prototype.getSeqInfo=function(a,d){this.awaitedEntryPoints.await(function(b){for(var e=0;e<b.length;++e)if(b[e].name==a)return d({length:b[e].end});return d()})};b.prototype.fetch=function(a,d,b,e,c){this.twoBit.await(function(e){e.fetch(a,d,b,function(e,
h){if(h)return c(h,null);var g=new G(a,d,b,"DNA",e);return c(null,g)})})};b.prototype.getSeqInfo=function(a,d){this.twoBit.await(function(b){b.getSeq(a)?b.getSeq(a).length(function(a){d({length:a})}):d()})};a.prototype.fetch=function(a,d,b,e,c){e=this.source.ensemblURI+"/sequence/region/"+this.source.species+"/"+a+":"+d+".."+b+":1?content-type=application/json";var h=new XMLHttpRequest;h.onreadystatechange=function(){if(4==h.readyState)if(300<=h.status){var e="Error code "+h.status;try{var g=JSON.parse(h.response);
g.error&&(e=g.error)}catch(f){}c(e,null)}else return g=JSON.parse(h.response),e=new G(a,d,b,"DNA",g.seq),c(null,e)};h.open("GET",e,!0);h.responseType="text";h.send("")};a.prototype.getSeqInfo=function(a,d){var b=this.source.ensemblURI+"/info/assembly/"+this.source.species+"/"+a+"?content-type=application/json",e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState)if(300<=e.status)d();else{var a=JSON.parse(e.response);d(a)}};e.open("GET",b,!0);e.responseType="text";e.send("")};x.prototype.getScales=
function(){return[]};var ba={};g.prototype=Object.create(p.prototype);g.prototype.init=function(){var a=this,d;d=(d=this.bwgSource.uri||this.bwgSource.bwgURI)?"encode"===this.bwgSource.transport?new ra(d,{credentials:this.opts.credentials}):new w(d,{credentials:this.opts.credentials,resolver:this.opts.resolver}):new E(this.bwgSource.bwgBlob);K(d,function(d,b){b?(a.error=b,a.readiness=null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(d),a.readiness=null,a.notifyReadiness(),"bigbed"==
d.type&&d.getExtraIndices(function(d){a.extraIndices=d}))})};g.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&0<this.extraIndices.length){a.search=[];for(var d=0;d<this.extraIndices.length;++d)a.search.push(this.extraIndices[d].field)}return a};g.prototype.fetch=function(a,d,b,e,c,h,g){var f=this;this.bwgHolder.await(function(h){if(null==h)return g(f.error||"Can't access binary file",null,null);var k;
k=!c||0==c.length||0<=r(c,"density");f.opts.clientBin&&(k=!1);if("bigwig"==h.type||k||"undefined"!==typeof f.opts.forceReduction){k=-1;for(var m=0;m<h.zoomLevels.length;++m)if(h.zoomLevels[m].reduction<=e)k=m;else break;"undefined"!==typeof f.opts.forceReduction&&(k=f.opts.forceReduction);k=0>k?h.getUnzoomedView():h.getZoomedView(k)}else k=h.getUnzoomedView();f.busy++;f.notifyActivity();k.readWigData(a,d,b,function(a){f.busy--;f.notifyActivity();var e=1E9;if("bigwig"===h.type){var c=(b-d)/a.length/
2;c<e&&(e=c)}if(f.opts.link)for(c=0;c<a.length;++c){var k=a[c];k.label&&(k.links=[new N("Link",f.opts.link.replace(/\$\$/,k.label))])}g(null,a,e)})})};g.prototype.quantFindNextFeature=function(a,d,b,e,c){var h=this;h.busy++;h.notifyActivity();this.bwgHolder.res.thresholdSearch(a,d,b,e,function(a,d){h.busy--;h.notifyActivity();return c(a,d)})};g.prototype.findNextFeature=function(a,d,b,e){var c=this;c.busy++;c.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,d,b,function(a){c.busy--;
c.notifyActivity();0<a.length&&null!=a[0]&&e(a[0])})};g.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var d=[1],b=0;b<a.zoomLevels.length;++b)d.push(a.zoomLevels[b].reduction);return d}return null};g.prototype.search=function(a,d){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,d):d(null,"No indices available")};g.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(d){d&&d.schema&&d.definedFieldCount<
d.schema.fields.length&&a(function(a,b){for(var e=0;e<b.hit.length;++e)if(b.hit[e].isSuperGroup)return;for(e=d.definedFieldCount;e<d.schema.fields.length;++e){var c=d.schema.fields[e];b.add(c.comment,a[c.name])}})})};g.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(d){if(!d)return a(null,"bbi error");var b=new W;if("bigbed"==d.type){var e=new I;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="blue";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!0;e.ZINDEX=20;b.pushStyle({type:"bigbed"},null,e);e.glyph=
"BOX";e.FGCOLOR="black";e.BGCOLOR="red";e.HEIGHT=10;e.BUMP=!0;e.ZINDEX=20;b.pushStyle({type:"translation"},null,e);e=new I;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="white";e.HEIGHT=10;e.ZINDEX=10;e.BUMP=!0;e.LABEL=!0;b.pushStyle({type:"transcript"},null,e);e=new I;e.glyph="HISTOGRAM";e.COLOR1="white";e.COLOR2="black";e.HEIGHT=30;b.pushStyle({type:"density"},null,e)}else e=new I,e.glyph="HISTOGRAM",e.COLOR1="white",e.COLOR2="black",e.HEIGHT=30,b.pushStyle({type:"default"},null,e);12==d.definedFieldCount&&
14<=d.fieldCount&&(b.geneHint=!0);return a(b)})};f.prototype=Object.create(p.prototype);f.prototype.init=function(){var a=this,d=this.uri||this.bwgSource.uri||this.bwgSource.bwgURI,b=this.bwgSource.blob||this.bwgSource.bwgBlob,e=function(d,b){a.readiness=null;a.notifyReadiness();d?a.worker.postCommand({command:"meta",connection:d},function(b,e){e?(a.error=e,a.keyHolder.provide(null)):(a.meta=b,a.keyHolder.provide(d))}):(a.error=b,a.keyHolder.provide(null))};b?this.worker.postCommand({command:"connectBBI",
blob:b},e):this.worker.postCommand({command:"connectBBI",uri:H(d),resolver:this.resolverKey,transport:this.bwgSource.transport,credentials:this.bwgSource.credentials},e)};f.prototype.capabilities=function(){var a={leap:!0};this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=[];for(var d=0;d<this.meta.extraIndices.length;++d)a.search.push(this.meta.extraIndices[d].field)}return a};f.prototype.fetch=function(a,d,b,e,c,
h,g){var f=this;f.busy++;f.notifyActivity();this.keyHolder.await(function(h){if(!h)return f.busy--,f.notifyActivity(),g(f.error||"Can't access binary file",null,null);var k=-1,m=!c||0==c.length||0<=r(c,"density");f.opts.clientBin&&(m=!1);if("bigwig"==f.meta.type||m||"undefined"!==typeof f.opts.forceReduction){for(m=1;m<f.meta.zoomLevels.length;++m)if(f.meta.zoomLevels[m]<=e)k=m-1;else break;"undefined"!==typeof f.opts.forceReduction&&(k=f.opts.forceReduction)}f.worker.postCommand({command:"fetch",
connection:h,chr:a,min:d,max:b,zoom:k},function(a,e){f.busy--;f.notifyActivity();var c=1E9;if("bigwig"===f.meta.type){var h=(b-d)/a.length/2;h<c&&(c=h)}if(f.opts.link)for(h=0;h<a.length;++h){var k=a[h];k.label&&(k.links=[new N("Link",f.opts.link.replace(/\$\$/,k.label))])}g(e,a,c)})})};f.prototype.quantFindNextFeature=function(a,d,b,e,c){var h=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:d,dir:b,threshold:e,under:!1},function(a,
d){console.log(a,d);h.busy--;h.notifyActivity();return c(a,d)})};f.prototype.findNextFeature=function(a,d,b,e){var c=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,chr:a,pos:d,dir:b},function(a,d){c.busy--;c.notifyActivity();0<a.length&&null!=a[0]&&e(a[0])})};f.prototype.getScales=function(){var a=this.meta;return a?a.zoomLevels:null};f.prototype.search=function(a,d){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return d(null,
"No indices available");var b=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,e){b.busy--;b.notifyActivity();d(a,e)})};f.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var d=this;this.keyHolder.await(function(b){var e=d.meta;e&&e.schema&&e.definedFieldCount<e.schema.fields.length&&a(function(a,d){for(var b=0;b<d.hit.length;++b)if(d.hit[b].isSuperGroup)return;
for(b=e.definedFieldCount;b<e.schema.fields.length;++b){var c=e.schema.fields[b];d.add(c.comment,a[c.name])}})})};f.prototype.getStyleSheet=function(a){var d=this;this.keyHolder.await(function(b){b=d.meta;if(!b)return a(null,"bbi error");var e=new W;if("bigbed"==b.type){var c=new I;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;e.pushStyle({type:"bigbed"},null,c);c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="red";c.HEIGHT=10;c.BUMP=!0;c.ZINDEX=20;e.pushStyle({type:"translation"},
null,c);c=new I;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="white";c.HEIGHT=10;c.ZINDEX=10;c.BUMP=!0;c.LABEL=!0;e.pushStyle({type:"transcript"},null,c);c=new I;c.glyph="HISTOGRAM";c.COLOR1="white";c.COLOR2="black";c.HEIGHT=30;e.pushStyle({type:"density"},null,c)}else c=new I,c.glyph="HISTOGRAM",c.COLOR1="white",c.COLOR2="black",c.HEIGHT=30,e.pushStyle({type:"default"},null,c);12==b.definedFieldCount&&14<=b.fieldCount&&(e.geneHint=!0);return a(e)})};z.prototype=Object.create(p.prototype);z.prototype.init=
function(){var a=this,d,b;this.bamSource.bamBlob?(d=new E(this.bamSource.bamBlob),b=new E(this.bamSource.baiBlob)):(d=new w(this.bamSource.bamURI,{credentials:this.opts.credentials,resolver:this.opts.resolver}),b=new w(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials,resolver:this.opts.resolver}));L(d,b,null,function(d,b){a.readiness=null;a.notifyReadiness();d?a.bamHolder.provide(d):(a.error=b,a.bamHolder.provide(null))})};z.prototype.fetch=function(a,d,b,e,c,
h,g){var f=c&&1==c.length&&"density"==c[0],k=this;k.busy++;k.notifyActivity();this.bamHolder.await(function(e){if(!e)return k.busy--,k.notifyActivity(),g(k.error||"Couldn't fetch BAM");e.fetch(a,d,b,function(a,d){k.busy--;k.notifyActivity();if(d)g(d,null,null);else{for(var b=[],e=0;e<a.length;++e){var c=v(a[e],k.opts.bamGroup);c&&b.push(c)}g(null,b,1E9)}},{light:f})})};z.prototype.getScales=function(){return 1E9};z.prototype.getStyleSheet=function(a){this.bamHolder.await(function(d){d=new W;var b=
new I;b.glyph="HISTOGRAM";b.COLOR1="black";b.COLOR2="red";b.HEIGHT=30;d.pushStyle({type:"density"},"low",b);d.pushStyle({type:"density"},"medium",b);b=new I;b.glyph="__SEQUENCE";b.FGCOLOR="black";b.BGCOLOR="blue";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!1;b.ZINDEX=20;d.pushStyle({type:"bam"},"high",b);return a(d)})};m.prototype=Object.create(p.prototype);m.prototype.init=function(){var a=this,d=this.bamSource.uri||this.bamSource.bamURI,b=this.bamSource.indexUri||this.bamSource.baiURI||d+".bai",e=this.bamSource.bamBlob||
this.bamSource.blob,c=this.bamSource.baiBlob||this.bamSource.indexBlob,h=function(d,b){a.readiness=null;a.notifyReadiness();d?a.keyHolder.provide(d):(a.error=b,a.keyHolder.provide(null))};e?this.worker.postCommand({command:"connectBAM",blob:e,indexBlob:c},h):this.worker.postCommand({command:"connectBAM",uri:H(d),resolver:this.resolverKey,indexUri:H(b),credentials:this.bamSource.credentials,indexChunks:this.bamSource.indexChunks},h)};m.prototype.fetch=function(a,d,b,e,c,h,g){var f=c&&1==c.length&&
"density"==c[0],k=this;k.busy++;k.notifyActivity();this.keyHolder.await(function(e){if(!e)return k.busy--,k.notifyActivity(),g(k.error||"Couldn't fetch BAM");k.worker.postCommand({command:"fetch",connection:e,chr:a,min:d,max:b,opts:{light:f}},function(a,d){k.busy--;k.notifyActivity();if(d)g(d,null,null);else{for(var b=[],e=0;e<a.length;++e){var c=v(a[e],k.opts.bamGroup);c&&b.push(c)}g(null,b,1E9)}})})};m.prototype.getScales=function(){return 1E9};m.prototype.getStyleSheet=function(a){this.keyHolder.await(function(d){d=
new W;var b=new I;b.glyph="HISTOGRAM";b.COLOR1="black";b.COLOR2="red";b.HEIGHT=30;d.pushStyle({type:"density"},"low",b);d.pushStyle({type:"density"},"medium",b);b=new I;b.glyph="__SEQUENCE";b.FGCOLOR="black";b.BGCOLOR="blue";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!1;b.ZINDEX=20;d.pushStyle({type:"bam"},"high",b);return a(d)})};F.prototype.addActivityListener=function(a){this.activityListeners.push(a)};F.prototype.removeActivityListener=function(a){a=r(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,
0)};F.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(d){console.log(d)}};F.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};F.prototype.getScales=function(){return this.source.getScales()};F.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};F.prototype.simplifySegments=function(a,d){if(0==a.length)return a;a.sort(function(a,d){var b=a.name-
d.name;return b?b:(b=a.start-d.start)?b:a.end-d.end});for(var b=[],e=a[0],c=0;c<a.length;++c){var h=a[c];h.name!=e.name||h.start>e.end+d?(b.push(e),e=h):e=new J(e.name,Math.min(e.start,h.start),Math.max(e.end,h.end))}b.push(e);return b};F.prototype.fetch=function(a,d,b,e,c,h,g,f){var k=this,m=b-d+1;k.busy++;k.notifyActivity();this.mapping.sourceBlocksForRange(a,d,b,function(a){if(0==a.length)k.busy--,k.notifyActivity(),g("No mapping available for this regions",[],e);else{a=k.simplifySegments(a,Math.max(100,
.05*m));var d=[],b=null,l=a.length,r;a.map(function(a){k.source.fetch(a.name,a.start,a.end,e,c,h,function(e,c,h){e&&!r&&(r=e);if(c)for(e=0;e<c.length;++e){var f=c[e],m=f.segment;0==m.indexOf("chr")&&(m=m.substr(3));m=k.mapping.mapSegment(m,f.min,f.max);if(0==m.length)f.parts&&0<f.parts.length&&d.push(f);else for(var y=0;y<m.length;++y){var n=m[y],B=D(f);B.segment=n.segment;B.min=n.min;B.max=n.max;n.partialMin&&(B.partialMin=n.partialMin);n.partialMax&&(B.partialMax=n.partialMax);n.flipped&&("-"==
f.orientation?B.orientation="+":"+"==f.orientation&&(B.orientation="-"));d.push(B)}}c=k.mapping.mapPoint(a.name,a.start);e=k.mapping.mapPoint(a.name,a.end);c&&e&&(c=new ha(c.pos,e.pos),b=b?Z(b,c):c);--l;0==l&&(k.busy--,k.notifyActivity(),g(r,d,h,b))},f)})}})};A.prototype.getScales=function(){return null};A.prototype.fetch=function(a,d,b,e,c,h,g){return g(null,[],1E9)};A.prototype.getStyleSheet=function(a){var d=new W,b=new I;b.glyph="BOX";b.BGCOLOR="blue";b.FGCOLOR="black";d.pushStyle({type:"default"},
null,b);return a(d)};T.prototype.fetch=function(a,d,b,e,c){return c(null,null)};d.prototype.getScales=function(){return null};d.prototype.getStyleSheet=function(a){var d=new W,b=new I;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="red";b.HEIGHT=10;b.BUMP=!0;b.ZINDEX=20;d.pushStyle({type:"translation"},null,b);b=new I;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="white";b.HEIGHT=10;b.ZINDEX=10;b.BUMP=!0;b.LABEL=!0;d.pushStyle({type:"transcript"},null,b);b=new I;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="green";
b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=20;d.pushStyle({type:"default"},null,b);return a(d)};d.prototype.fetch=function(a,d,b,e,c,h,g){c&&0==c.length?g(null,[],e):this.store.features(new J(a,d,b),{},function(a,d){g(d,a,1E5)})};h.prototype.sourceAdapterIsCapable=function(a,d){return a.capabilities?a.capabilities()[d]:!1};"undefined"!==typeof u&&(u.exports={FeatureSourceBase:p,TwoBitSequenceSource:b,EnsemblSequenceSource:a,DASSequenceSource:C,MappedFeatureSource:F,CachingFeatureSource:q,BWGFeatureSource:g,
RemoteBWGFeatureSource:f,BAMFeatureSource:z,RemoteBAMFeatureSource:m,DummyFeatureSource:A,DummySequenceSource:T,registerSourceAdapterFactory:n,registerParserFactory:l,makeParser:k},c("./ensembljson"),c("./tabix-source"),c("./memstore"),c("./bedwig"),c("./vcf"))},{"./bam":1,"./bedwig":2,"./bigwig":3,"./bin":4,"./cbrowser":6,"./chainset":7,"./cigar":8,"./das":10,"./encode":12,"./ensembljson":13,"./jbjson":22,"./memstore":25,"./overlay":27,"./spans":36,"./style":37,"./tabix-source":40,"./tier":45,"./twoBit":48,
"./utils":49,"./vcf":50}],35:[function(c,u,t){function n(c){return c.uri?c.uri:c.blob?"file:"+c.blob.name:c.bwgBlob?"file:"+c.bwgBlob.name:c.bamBlob?"file:"+c.bamBlob.name:c.twoBitBlob?"file:"+c.twoBitBlob.name:c.bwgURI||c.bamURI||c.jbURI||c.twoBitURI||"https://www.biodalliance.org/magic/no_uri"}function l(c){return c.stylesheet_uri?c.stylesheet_uri:"sequence"==c.tier_type||c.twoBitURI||c.twoBitBlob?"https://www.biodalliance.org/magic/sequence":n(c)}function k(c,l){if(n(c)!=n(l)||c.mapping!=l.mapping||
c.tier_type!=l.tier_type)return!1;if(c.overlay){if(!l.overlay||l.overlay.length!=c.overlay.length)return!1;for(var q=0;q<c.overlay.length;++q)if(!k(c.overlay[q],l.overlay[q]))return!1}else if(l.overlay)return!1;return!0}function q(c,k){if(n(c)!=n(k)||l(c)!=l(k)||c.mapping!=k.mapping||c.tier_type!=k.tier_type)return!1;if(c.overlay){if(!k.overlay||k.overlay.length!=c.overlay.length)return!1;for(var t=0;t<c.overlay.length;++t)if(!q(c.overlay[t],k.overlay[t]))return!1}else if(k.overlay)return!1;return!0}
"undefined"!==typeof u&&(u.exports={sourcesAreEqual:q,sourcesAreEqualModuloStyle:k,sourceDataURI:n,sourceStyleURI:l})},{}],36:[function(c,u,t){function n(b,a){if("number"!=typeof b||"number"!=typeof a)throw"Bad range "+b+","+a;this._min=b;this._max=a}function l(b){b=b.sort(C);var a=[],c=b.shift();b.forEach(function(b){b._min<=c._max?b._max>c._max&&(c._max=b._max):(a.push(c),c=b)});a.push(c);this._ranges=a}function k(b,a){b instanceof l||(b instanceof Array||(b=[b]),b=new l(b));a&&b.insertRange(a);
return b}function q(b,a){for(var c=b.ranges(),f=a.ranges(),k=c.length,q=f.length,m=0,p=0,A=[];m<k&&p<q;){b=c[m];a=f[p];var x=Math.max(b.min(),a.min()),d=Math.min(b.max(),a.max());d>=x&&A.push(new n(x,d));b.max()>a.max()?++p:++m}return 0==A.length?null:1==A.length?A[0]:new l(A)}function p(b){var a=0;b=b.ranges();for(var c=0;c<b.length;++c)var f=b[c],a=a+(f.max()-f.min()+1);return a}function x(b,a){return b.min()<a.min()?-1:b.min()>a.min()?1:b.max()<a.max()?-1:a.max()>b.max()?1:0}function C(b,a){return b._min<
a._min?-1:b._min>a._min?1:b._max<a._max?-1:a._max>b._max?1:0}n.prototype.min=function(){return this._min};n.prototype.max=function(){return this._max};n.prototype.contains=function(b){return b>=this._min&&b<=this._max};n.prototype.isContiguous=function(){return!0};n.prototype.ranges=function(){return[this]};n.prototype._pushRanges=function(b){b.push(this)};n.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};l.prototype.min=function(){return this._ranges[0].min()};l.prototype.max=
function(){return this._ranges[this._ranges.length-1].max()};l.prototype.lower_bound=function(b){var a=this.ranges();if(b>this.max())return a.length;if(b<this.min())return 0;for(var c=0,f=a.length-1;c<=f;){var k=Math.floor((c+f)/2);if(b>a[k]._max)c=k+1;else if(b<a[k]._min)f=k-1;else return k}return c};l.prototype.contains=function(b){var a=this.lower_bound(b);return a<this._ranges.length&&this._ranges[a].contains(b)?!0:!1};l.prototype.insertRange=function(b){var a=this.lower_bound(b._min);if(a===
this._ranges.length)this._ranges.push(b);else{var c=this.ranges();if(b._max<c[a]._min)this._ranges.splice(a,0,b);else{c[a]._min<b._min&&(b._min=c[a]._min);for(var f=a+1;f<c.length&&c[f]._min<=b._max;)f++;f--;c[f]._max>b._max&&(b._max=c[f]._max);this._ranges.splice(a,f-a+1,b)}}};l.prototype.isContiguous=function(){return 1<this._ranges.length};l.prototype.ranges=function(){return this._ranges};l.prototype._pushRanges=function(b){for(var a=0;a<this._ranges.length;++a)b.push(this._ranges[a])};l.prototype.toString=
function(){for(var b="",a=0;a<this._ranges.length;++a)0<a&&(b+=","),b+=this._ranges[a].toString();return b};"undefined"!==typeof u&&(u.exports={Range:n,union:k,intersection:q,coverage:p,rangeOver:x,_rangeOrder:C})},{}],37:[function(c,u,t){function n(c,l,n){this.type=c;this.method=l;this.label=n}function l(c){this._filters={};if(c)for(var l=0;l<c.length;++l)this.add(c[l])}n.prototype.equals=function(c){return this.type==c.type&&this.method==c.method&&this.label==c.label};n.prototype.toString=function(){var c=
[];this.type&&c.push("type="+this.type);this.method&&c.push("method="+this.method);this.label&&c.push("label="+this.label);return"StyleFilter<"+c.join(";")+">"};l.prototype.add=function(c){var l=c.toString();this._filters[l]||(this._filters[l]=c,this._list=null)};l.prototype.addAll=function(c){c=c.list();for(var l=0;l<c.length;++l)this.add(c[l])};l.prototype.doesNotContain=function(c){c=c.list();for(var l=0;l<c.length;++l)if(!this._filters[l.toString()])return!0;return!1};l.prototype.list=function(){if(!this._list){this._list=
[];for(var c in this._filters)this._filters.hasOwnProperty(c)&&this._list.push(this._filters[c])}return this._list};l.prototype.typeList=function(){for(var c=[],l=this.list(),n=0;n<l.length;++n){var x=l[n].type;if(!x||"default"==x)return null;0>c.indexOf(x)&&c.push(x)}return c};"undefined"!==typeof u&&(u.exports={StyleFilter:n,StyleFilterSet:l})},{}],38:[function(c,u,t){if("undefined"!==typeof c){var n=c("./cbrowser").Browser,l=c("./utils").makeElementNS,k=c("./version"),q=c("./sequence-draw").svgSeqTier;
u=c("./svg-utils");var p=u.NS_SVG,x=u.NS_XLINK,C=u.SVGPath,b=c("./numformats").formatQuantLabel}n.prototype.makeSVG=function(a){a=a||{};var c=a.minTierHeight||20,f=document.implementation.createDocument(p,"svg",null),n=l(p,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});f.documentElement.appendChild(n);var z=l(p,"a",l(p,"text","Graphics from Dalliance "+k,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",textAnchor:"middle",fill:"blue"}));z.setAttribute("xmlns:xlink",x);z.setAttribute("xlink:href",
"http://www.biodalliance.org/");n.appendChild(z);z=l(p,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});z=l(p,"clipPath",z,{id:"featureClip"});n.appendChild(z);for(var z=70,m=l(p,"g",null,{}),t=0;t<this.tiers.length;++t){var A=this.tiers[t],u=l(p,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),d=l(p,"g"),e=z,h=l(p,"rect",null,{x:0,y:e,width:"10000",height:50,fill:A.background});u.appendChild(h);if(A.sequenceSource){var y=q(A,A.currentSequence);u.appendChild(l(p,"g",y,
{transform:"translate(200, "+z+")"}));z+=80}else{if(!A.subtiers)continue;for(var y=(A.glyphCacheOrigin-this.viewStart)*this.scale,B=!1,r=0;r<A.subtiers.length;++r){for(var z=z+3,D=A.subtiers[r],H=[],W=0;W<D.glyphs.length;++W)H.push(D.glyphs[W].toSVG());u.appendChild(l(p,"g",H,{transform:"translate("+(200+y)+", "+z+")"}));if(D.quant){var B=!0,H=D.quant,I=D.height,W=2;40<I&&(W=1+(I/20|0));var I=I/(W-1),R=(H.max-H.min)/(W-1),J=new C;J.moveTo(205,z);J.lineTo(200,z);J.lineTo(200,z+D.height);J.lineTo(205,
z+D.height);for(var S=1;S<W-1;++S){var G=S*I;J.moveTo(200,z+G);J.lineTo(203,z+G)}d.appendChild(l(p,"path",null,{d:J.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));d.appendChild(l(p,"text",b(H.max),{x:197,y:z+7,textAnchor:"end"}));d.appendChild(l(p,"text",b(H.min),{x:197,y:z+D.height,textAnchor:"end"}));for(S=1;S<W-1;++S)G=S*I,d.appendChild(l(p,"text",b(1*H.max-S*R),{x:197,y:z+G+3,textAnchor:"end"}))}z+=D.height+3}z-e<c&&(z=e+c)}d.appendChild(l(p,"text","string"===typeof A.config.name?
A.config.name:A.dasSource.name,{x:200-(B?20:12),y:(z+e+8)/2,fontSize:"10pt",textAnchor:"end"}));h.setAttribute("height",z-e);m.appendChild(l(p,"g",[u,d]))}if(a.highlights)for(c=this.highlights||[],B=0;B<c.length;++B)I=c[B],(I.chr==this.chr||I.chr=="chr"+this.chr)&&I.min<this.viewEnd&&I.max>this.viewStart&&(t=(Math.max(I.min,this.viewStart)-this.viewStart)*this.scale,A=(Math.min(I.max,this.viewEnd)-this.viewStart)*this.scale,m.appendChild(l(p,"rect",null,{x:200+t,y:70,width:A-t,height:z-70,stroke:"none",
fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));c=-1;"center"==a.ruler?c=200+(this.viewEnd-this.viewStart)*this.scale/2:"left"==a.ruler?c=200:"right"==a.ruler&&(c=200+(this.viewEnd-this.viewStart)*this.scale);0<=c&&m.appendChild(l(p,"line",null,{x1:c,y1:70,x2:c,y2:z,stroke:"blue"}));n.appendChild(m);f.documentElement.setAttribute("width",this.featurePanelWidth+20+200);f.documentElement.setAttribute("height",z+50);return new Blob([(new XMLSerializer).serializeToString(f)],
{type:"image/svg+xml"})}},{"./cbrowser":6,"./numformats":26,"./sequence-draw":31,"./svg-utils":39,"./utils":49,"./version":51}],39:[function(c,u,t){function n(){this.ops=[]}n.prototype.moveTo=function(c,k){this.ops.push("M "+c+" "+k)};n.prototype.lineTo=function(c,k){this.ops.push("L "+c+" "+k)};n.prototype.closePath=function(){this.ops.push("Z")};n.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof u&&(u.exports={NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",
SVGPath:n})},{}],40:[function(c,u,t){function n(a){q.call(this);this.readiness="Connecting";this.source=a;this.tabixHolder=new C;var c=this,f=k(a.payload);if(f)this.parser=f;else throw"Unsuported tabix payload "+a.payload;var l;this.source.blob?(a=new x(this.source.blob),l=new x(this.source.indexBlob)):(a=new p(this.source.uri,{credentials:this.source.credentials,resolver:this.source.resolver}),l=new p(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials,resolver:this.source.resolver}));
b(a,l,function(a,b){c.tabixHolder.provide(a);a.fetchHeader(function(a,b){if(a){for(var c=f.createSession(function(){}),d=0;d<a.length;++d)c.parse(a[d]);c.flush()}});c.readiness=null;c.notifyReadiness()})}if("undefined"!==typeof c){u=c("./sourceadapters");var l=u.registerSourceAdapterFactory,k=u.makeParser,q=u.FeatureSourceBase;u=c("./bin");var p=u.URLFetchable,x=u.BlobFetchable,C=c("./utils").Awaited,b=c("./tabix").connectTabix}n.prototype=Object.create(q.prototype);n.prototype.fetch=function(a,b,
c,k,l,m,n){var p=this;p.busy++;p.notifyActivity();this.tabixHolder.await(function(k){k.fetch(a,b,c,function(a,b){p.busy--;p.notifyActivity();for(var c=[],g=p.parser.createSession(function(a){c.push(a)}),f=0;f<a.length;++f)g.parse(a[f]);g.flush();n(null,c,1E9)})})};n.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};n.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};l("tabix",function(a){return{features:new n(a)}})},
{"./bin":4,"./sourceadapters":34,"./tabix":41,"./utils":49}],41:[function(c,u,t){function n(){}function l(b,a,c){var f=new n;f.data=b;f.tbi=a;f.tbi.fetch(function(a){if(!a)return c(null,"Couldn't access Tabix");a=p(a,a.byteLength);var b=new Uint8Array(a);if(21578324!=k(b,0))return c(null,"Not a tabix index");var m=k(b,4);f.format=k(b,8);f.colSeq=k(b,12);f.colStart=k(b,16);f.colEnd=k(b,20);f.meta=k(b,24);f.skip=k(b,28);k(b,32);f.indices=[];var l=36;f.chrToIndex={};f.indexToChr=[];for(var n=0;n<m;++n){for(var x=
"";;){var d=b[l++];if(0==d)break;x+=String.fromCharCode(d)}f.chrToIndex[x]=n;0==x.indexOf("chr")?f.chrToIndex[x.substring(3)]=n:f.chrToIndex["chr"+x]=n;f.indexToChr.push(x)}x=1E9;for(d=0;d<m;++d){for(var e=l,h=k(b,l),l=l+4,n=0;n<h;++n){k(b,l);var y=k(b,l+4),l=l+(8+16*y)}for(var y=k(b,l),B=l+=4,n=0;n<y;++n){var r=q(b,B),B=B+8;if(r){n=r.block;0<r.offset&&(n+=65536);n<x&&(x=n);break}}l+=8*y;0<h&&(f.indices[d]=new Uint8Array(a,e,l-e))}f.headerMax=x;c(f)},{timeout:5E3})}if("undefined"!==typeof c){c("./spans");
var k=c("./bin").readInt;c=c("./lh3utils");var q=c.readVob,p=c.unbgzf,x=c.reg2bins,C=c.Chunk}n.prototype.blocksForRange=function(b,a,c){var f=this.indices[b];if(!f)return[];b=x(a,c);for(var l=[],n=0;n<b.length;++n)l[b[n]]=!0;b=[];for(var m=[],n=k(f,0),p=4,A=0;A<n;++A){var t=k(f,p),d=k(f,p+4),p=p+8;if(l[t])for(var e=0;e<d;++e){var h=q(f,p,!0),y=q(f,p+8,!0);(4681>t?m:b).push(new C(h,y));p+=16}else p+=16*d}n=k(f,p);l=null;a=Math.min(a>>14,n-1);c=Math.min(c>>14,n-1);for(n=a;n<=c;++n)(a=q(f,p+4+8*n))&&
(!l||a.block<l.block||a.offset<l.offset)&&(l=a);f=[];if(null!=l)for(n=0;n<m.length;++n)c=m[n],c.maxv.block>=l.block&&c.maxv.offset>=l.offset&&f.push(c);m=f;f=[];for(n=0;n<m.length;++n)f.push(m[n]);for(n=0;n<b.length;++n)f.push(b[n]);f.sort(function(a,d){var b=a.minv.block-d.minv.block;return 0!=b?b:a.minv.offset-d.minv.offset});b=[];if(0<f.length){m=f[0];for(n=1;n<f.length;++n)c=f[n],c.minv.block==m.maxv.block?m=new C(m.minv,c.maxv):(b.push(m),m=c);b.push(m)}return b};n.prototype.fetch=function(b,
a,c,f){function k(){if(x>=n.length)return f(q);if(d){var b=new Uint8Array(d);l.readRecords(b,n[x].minv.offset,q,a,c,m);d=null;++x;return k()}var h=n[x],b=h.minv.block;l.data.slice(b,h.maxv.block+65536-b).fetch(function(a){d=p(a,h.maxv.block-h.minv.block+1);return k()})}var l=this;b=this.chrToIndex[b];if(void 0==b)return f([]);var m=this.indexToChr[b],n;void 0===b?n=[]:(n=this.blocksForRange(b,a,c))||f(null,"Error in index fetch");var q=[],x=0,d;k()};n.prototype.readRecords=function(b,a,c,f,k,l){a:for(;;){for(var m=
"";a<b.length;){var n=b[a++];if(10==n){n=m.split("\t");if(n[this.colSeq-1]==l){var p=parseInt(n[this.colStart-1]),q=p;0<this.colEnd&&(q=parseInt(n[this.colEnd-1]));this.format&65536&&++p;p<=k&&q>=f&&c.push(m)}continue a}else m+=String.fromCharCode(n)}break}};n.prototype.fetchHeader=function(b){var a=this;a.data.slice(0,a.headerMax).fetch(function(c){if(!c)return b(null,"Fetch failed");c=new Uint8Array(p(c,c.byteLength));for(var f=0,k="",l=[];f<c.length;){var m=c[f++];if(10==m)if(k.charCodeAt(0)==
a.meta)l.push(k),k="";else return b(l);else k+=String.fromCharCode(m)}b(l)})};"undefined"!==typeof u&&(u.exports={connectTabix:l,TABIX_MAGIC:21578324})},{"./bin":4,"./lh3utils":24,"./spans":36}],42:[function(c,u,t){function n(a){this.genomes={};this.url=a}function l(){}function k(a){this.hub=a}function q(a,b,c){c=c||{};c.salt=!0;x(a,function(g,d){if(d)return b(null,d);var e=g.split(v),h=new n(a);c.credentials&&(h.credentials=c.credentials);for(var l=0;l<e.length-2;l+=3)h[e[l+1]]=e[l+2];if(h.genomesFile){var B=
C(a,h.genomesFile);x(B,function(a,d){if(d)return b(null,d);for(var e=a.split(f),g=0;g<e.length;++g){var l=e[g].split(v),m=new k(h);c.credentials&&(m.credentials=c.credentials);for(var n=0;n<l.length-2;n+=3)m[l[n+1]]=l[n+2];m.twoBitPath&&(m.twoBitPath=C(B,m.twoBitPath));m.genome&&m.trackDb&&(m.absURL=C(B,m.trackDb),h.genomes[m.genome]=m)}b(h)},c)}else b(null,"No genomesFile")},c)}function p(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}
if("undefined"!==typeof c){t=c("./utils");var x=t.textXHR,C=t.relativeURL,b=t.shallowCopy;c=c("./das");var a=c.DASStylesheet,g=c.DASStyle}var f=/\n\s*\n/,v=/(\w+) +(.+)\n?/,z=/subGroup[1-9]/;l.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};k.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);x(this.absURL,function(c,g){if(g)return a(null,g);c=c.replace("\\\n"," ");for(var d=[],e={},h=c.split(f),k=0;k<h.length;++k){var n=
h[k].replace(/\#.*/g,"").split(v),r=new l;r._db=b;for(var p=0;p<n.length-2;p+=3){var q=n[p+1],x=n[p+2];if(q.match(z)){r.subgroups||(r.subgroups={});for(var q=x.split(/\s/),x=q[0],t={name:q[1],tags:[],titles:[]},u=2;u<q.length;++u){var C=q[u].split(/=/);t.tags.push(C[0]);t.titles.push(C[1])}r.subgroups[x]=t}else if("subGroups"===q)for(q=x.split(/(\w+)=(\w+)/),r.sgm={},u=0;u<q.length-2;u+=3)r.sgm[q[u+1]]=q[u+2];else r[n[p+1]]=n[p+2]}r.track&&(r.type||r.container||r.view||r.bigDataUrl)&&(d.push(r),e[r.track]=
r)}h=[];k=[];for(q=0;q<d.length;++q)r=d[q],n=!0,r.parent&&(p=r.parent.split(/\s+/),(x=e[p[0]])?(r._parent=x,x.children||(x.children=[]),x.children.push(r),x&&(n=!1)):console.log("Couldn't find parent "+p[0]+"("+r.parent+")")),r.compositeTrack?k.push(r):n&&h.push(r);for(d=0;d<k.length;++d)if(e=k[d],e.children){r=!1;for(n=0;n<e.children.length;++n)q=e.children[n],q.view&&(q.shortLabel=e.shortLabel+": "+q.shortLabel,h.push(q),r=!0);r||h.push(e)}b._tracks=h;return a(b._tracks,null)},{credentials:this.credentials,
salt:!0})};l.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&(a.mapping=this._db.mapping);var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant="http://genome.ucsc.edu/images/"+b[0]);if(b=this.get("searchTrix"))a.trixURI=C(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var c=0;c<b.length;++c){var g=b[c],d=g.toDallianceSource();a.overlay.push(d);if(d.style)for(var e=
0;e<d.style.length;++e){var h=d.style[e];h.method=g.shortLabel;"transparentOverlay"==this.aggregate&&(h.style.ALPHA=.5);a.style.push(h)}}return a}b=this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){c=b.split(/\s+/);if("bigBed"==c[0]&&this.bigDataUrl)return b=c[1]|0,c="+"==c[2],a.bwgURI=C(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&c&&(a.collapseSuperGroups=!0),a;if("bigWig"==c[0]&&this.bigDataUrl)return a.bwgURI=
C(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==c[0]&&this.bigDataUrl)return a.bamURI=C(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;if("vcfTabix"==c[0]&&this.bigDataUrl)return a.uri=C(this._db.absURL,this.bigDataUrl),a.tier_type="tabix",a.payload="vcf",this._db.credentials&&(a.credentials=
!0),a;console.log("Unsupported "+this.type)}};l.prototype.bigwigStyles=function(){var b=this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){var b=b.split(/\s+/),c,f;3<=b.length&&(c=1*b[1],f=1*b[2]);var k;this.maxHeightPixels&&(b=this.maxHeightPixels.split(/:/),3==b.length?k=b[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));b="bars";this.graphTypeDefault&&(b=this.graphTypeDefault);var d="black",e=null;this.color&&(d="rgb("+this.color+")");this.altColor&&
(e="rgb("+this.altColor+")");var h=new a,l=new g;l.glyph="points"==b?"POINT":"HISTOGRAM";e?(l.COLOR1=d,l.COLOR2=e):l.BGCOLOR=d;l.HEIGHT=k||30;if(c||f)l.MIN=c,l.MAX=f;h.pushStyle({type:"default"},null,l);return h.styles}};l.prototype.bigbedStyles=function(){var c="on"==(""+this.get("itemRgb")).toLowerCase(),f=this.get("visibility")||"full",k=this.get("color"),k=k?"rgb("+k+")":"blue",l=new a,d=new g;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR=k;d.HEIGHT="full"==f||"pack"==f?12:8;d.BUMP="full"==f||"pack"==
f;d.LABEL="full"==f||"pack"==f;d.ZINDEX=20;c&&(d.BGITEM=!0);(f=this.get("colorByStrand"))?(f=f.split(/\s+/),k=b(d),k.BGCOLOR="rgb("+f[0]+")",l.pushStyle({type:"bigwig",orientation:"+"},null,k),d=b(d),d.BGCOLOR="rgb("+f[1]+")",l.pushStyle({type:"bigwig",orientation:"-"},null,d)):l.pushStyle({type:"bigwig"},null,d);d=new g;d.glyph="BOX";d.FGCOLOR="black";c&&(d.BGITEM=!0);d.BGCOLOR="red";d.HEIGHT=10;d.BUMP=!0;d.ZINDEX=20;l.pushStyle({type:"translation"},null,d);c=new g;c.glyph="BOX";c.FGCOLOR="black";
c.BGCOLOR="white";c.HEIGHT=10;c.ZINDEX=10;c.BUMP=!0;c.LABEL=!0;l.pushStyle({type:"transcript"},null,c);return l.styles};"undefined"!==typeof u&&(u.exports={connectTrackHub:q,THUB_COMPARE:p})},{"./das":10,"./utils":49}],43:[function(c,u,t){if("undefined"!==typeof c)var n=c("./cbrowser").Browser,l=c("./utils").shallowCopy;n.prototype.mergeSelectedTiers=function(){for(var c=[],n=[],p=0;p<this.selectedTiers.length;++p){var x=this.tiers[this.selectedTiers[p]];c.push(l(x.dasSource));for(var t=x.stylesheet.styles,
b=0;b<t.length;++b){var a=t[b],g=l(a);g.method=x.dasSource.name.replace(/[()+*?]/g,"\\$&");g._methodRE=null;g.style=l(a.style);void 0===g.style.ZINDEX&&(g.style.ZINDEX=p);x.forceMin&&(g.style.MIN=x.forceMin);x.forceMax&&(g.style.MAX=x.forceMax);n.push(g)}}this.addTier({name:"Merged",merge:"concat",overlay:c,noDownsample:!0,style:n});this.setSelectedTier(this.tiers.length-1)}},{"./cbrowser":6,"./utils":49}],44:[function(c,u,t){function n(a){for(var b=0;b<a.styles.length;++b){var c=a.styles[b].style;
if("__SEQUENCE"===c.glyph)return c}}if("undefined"!==typeof c){var l=c("./cbrowser").Browser,k=c("./utils").makeElement;u=c("./das");var q=u.isDasBooleanTrue,p=u.copyStylesheet,x=c("./color").dasColourForName,C=c("./sourcecompare").sourceDataURI}var b={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};l.prototype.openTierPanel=function(a){if("tier"===this.uiMode&&this.manipulatingTier===a)this.hideToolPanel(),this.setUiMode("none");else if(a){var c=function(a){a.BGGRAD||(1==R?("LINEPLOT"==
a.glyph||b[a.glyph]?a.FGCOLOR=y.value:a.BGCOLOR=y.value,a.COLOR1=a.COLOR2=a.COLOR3=null):(a.COLOR1=y.value,a.COLOR2=B.value,a.COLOR3=2<R?r.value:null),a._gradient=null,a._plusColor=D.value,a._minusColor=H.value)},f=function(d){for(var b=p(a.stylesheet),e=a.browser.zoomForCurrentScale(),c=0;c<b.styles.length;++c){var h=b.styles[c];h.zoom&&h.zoom!=e||d(h.style)}return b},l=function(d){a.mergeStylesheet(f(c))};this.manipulatingTier=a;var z=k("div",null,{className:"tier-edit"}),m=k("div","About '"+(a.config.Name||
a.dasSource.name)+"'",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"});z.appendChild(m);var m=k("div",[k("p",a.dasSource.desc)]),t=[],A=C(a.dasSource);!A||0!=A.indexOf("http://")&&0!=A.indexOf("https://")&&0!=A.indexOf("//")||"https://www.biodalliance.org/magic/no_uri"===A||t.push(k("li",k("a","(Download data)",{href:A})));a.dasSource.mapping&&(A=this.chains[a.dasSource.mapping].coords,t.push(k("li","Mapped from "+A.auth+A.version)));0<t.length&&m.appendChild(k("ul",
t));z.appendChild(m);var u=k("span"," (styles for current zoom level)",null,{display:"none"}),m=k("div",["Edit",u],null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"});z.appendChild(m);var d=k("input",null,{type:"text"}),e=k("input",null,{type:"checkbox",disabled:this.disablePinning}),h=k("select");h.appendChild(k("option","Histogram",{value:"HISTOGRAM"}));h.appendChild(k("option","Line Plot",{value:"LINEPLOT"}));h.appendChild(k("option","Ribbon",{value:"GRADIENT"}));
h.appendChild(k("option","Scatter",{value:"SCATTER"}));var y=k("input",null,{type:"text",value:"#dd00dd"}),B=k("input",null,{type:"text",value:"#dd00dd"}),r=k("input",null,{type:"text",value:"#dd00dd"}),D=k("input",null,{type:"text",value:"#ffa07a"}),H=k("input",null,{type:"text",value:"#87cefa"});try{y.type=B.type=r.type="color",D.type=H.type="color"}catch(W){}var I=[y,B,r],m=k("i",null,{className:"fa fa-plus-circle"}),t=k("i",null,{className:"fa fa-minus-circle"}),R=1,A=k("td",I),J=function(a){R=
a;for(var d=0;d<a;++d)I[d].style.display="block";for(d=a;d<I.length;++d)I[d].style.display="none"};m.addEventListener("click",function(a){3>R&&(J(R+1),l(null))},!1);t.addEventListener("click",function(a){1<R&&(J(R-1),l(null))},!1);var S=k("input",null,{type:"text",value:"0.0"}),G=k("input",null,{type:"text",value:"10.0"}),N=k("input",null,{type:"checkbox"}),w=k("input",null,{type:"checkbox"}),E=k("input",null,{type:"checkbox",checked:void 0!==a.quantLeapThreshold}),U=k("input",null,{type:"text",value:a.quantLeapThreshold,
disabled:!E.checked}),K=k("input",null,{type:"text",value:"50"}),L=k("input",null,{type:"checkbox"}),aa=k("input",null,{type:"text"}),ha=k("input",null,{type:"checkbox"}),Z=null;0<a.stylesheet.styles.length&&(Z=a.stylesheet.styles[0].style);var Y=function(){d.value="string"===typeof a.config.name?a.config.name:a.dasSource.name;e.checked=a.pinned;a.forceHeight?K.value=""+a.forceHeight:Z&&Z.HEIGHT&&(K.value=""+Z.HEIGHT);"number"==typeof a.quantLeapThreshold?(E.checked=!0,U.disabled=!1,parseFloat(U.value)!=
a.quantLeapThreshold&&(U.value=a.quantLeapThreshold)):(E.checked=!1,U.disabled=!0);aa.value="number"==typeof a.subtierMax?""+a.subtierMax:""+(a.dasSource.subtierMax||a.browser.defaultSubtierMax);if(0<a.stylesheet.styles.length){for(var b=null,c=!1,f=!1,f=a.browser.zoomForCurrentScale(),g=0,k=0;k<a.stylesheet.styles.length;++k){var l=a.stylesheet.styles[k];if(!l.zoom||l.zoom==f)if(++g,l=a.stylesheet.styles[k].style,b||(b=Z=l),"LINEPLOT"==l.glyph||"HISTOGRAM"==l.glyph||"GRADIENT"==l.glyph||q(l.SCATTER))c||
(b=Z=l),c=!0}if(!b)return;u.style.display=g==a.stylesheet.styles.length?"none":"inline";f=c&&1==g;c?(pa.style.display="table-row",M.style.display="table-row",ua.style.display="none",V.style.display="none"):(pa.style.display="none",M.style.display="none",ua.style.display="table-row",L.checked=q(Z.BUMP),aa.disabled=!q(Z.BUMP),V.style.display="table-row",ha.checked=q(Z.LABEL));f?(na.style.display="table-row",ba.style.display="table-row"):(na.style.display="none",ba.style.display="none");g=1;b.COLOR1?
(y.value=x(b.COLOR1).toHexString(),b.COLOR2&&(B.value=x(b.COLOR2).toHexString(),b.COLOR3?(r.value=x(b.COLOR3).toHexString(),g=3):g=2)):"LINEPLOT"==b.glyph||"DOT"==b.glyph&&b.FGCOLOR?y.value=x(b.FGCOLOR).toHexString():b.BGCOLOR&&(y.value=x(b.BGCOLOR).toHexString());J(g);b._plusColor&&(D.value=x(b._plusColor).toHexString()||b._plusColor);b._minusColor&&(H.value=x(b._minusColor).toHexString()||b._minusColor);q(b.SCATTER)?h.value="SCATTER":h.value=b.glyph;var m,p;void 0!==b.MIN&&(g=parseFloat(b.MIN),
isNaN(g)||(m=g));a.forceMinDynamic||void 0===b.MIN&&void 0===a.forceMin?(N.checked=!1,S.disabled=!0):(N.checked=!0,S.disabled=!1);void 0!==b.MAX&&(g=parseFloat(b.MAX),isNaN(g)||(p=g));a.forceMaxDynamic||void 0===b.MAX&&void 0===a.forceMax?(w.checked=!1,G.disabled=!0):(w.checked=!0,G.disabled=!1);void 0!=a.forceMin&&(m=a.forceMin);void 0!=a.forceMax&&(p=a.forceMax);"number"==typeof m&&m!=parseFloat(S.value)&&(S.value=m);"number"==typeof p&&p!=parseFloat(G.value)&&(G.value=p);(b=n(a.stylesheet))?(ma.style.display=
"table-row",la.checked="mismatch"===b.__SEQCOLOR,ra.style.display="table-row",qa.checked=q(b.__INSERTIONS),ja.style.display="table-row",ia.checked=void 0===b.__disableQuals||!1===b.__disableQuals,console.log(b.__disableQuals)):(ma.style.display="none",ra.style.display="none",ja.style.display="none");b&&la.checked&&!f?(sa.style.display="table-row",oa.style.display="table-row"):(sa.style.display="none",oa.style.display="none")}c&&a.browser.sourceAdapterIsCapable(a.featureSource,"quantLeap")?ta.style.display=
"table-row":ta.style.display="none"},la=k("input",null,{type:"checkbox"}),ma=k("tr",[k("th","Highlight mismatches & strands"),k("td",la)]);la.addEventListener("change",function(d){d=p(a.stylesheet);n(d).__SEQCOLOR=la.checked?"mismatch":"base";a.mergeStylesheet(d)});var qa=k("input",null,{type:"checkbox"}),ra=k("tr",[k("th","Show insertions"),k("td",qa)]);qa.addEventListener("change",function(d){d=p(a.stylesheet);n(d).__INSERTIONS=qa.checked?"yes":"no";a.mergeStylesheet(d)});var ia=k("input",null,
{type:"checkbox"}),ja=k("tr",[k("th","Reflect base quality as base color transparency"),k("td",ia)]);ia.addEventListener("change",function(d){d=p(a.stylesheet);var b=n(d);b.__disableQuals=!ia.checked;console.log(b.__disableQuals);a.mergeStylesheet(d)});var na=k("tr",[k("th","Style"),k("td",h)]),ba=k("tr",[k("th",["Colour(s)",m,t]),A]),sa=k("tr",[k("th","Plus Strand Color"),k("td",D)]),oa=k("tr",[k("th","Minus Strand Color"),k("td",H)]),pa=k("tr",[k("th","Min value"),k("td",[N," ",S])]),M=k("tr",[k("th",
"Max value"),k("td",[w," ",G])]),ta=k("tr",[k("th","Threshold leap:"),k("td",[E," ",U])]),ua=k("tr",[k("th","Bump overlaps"),k("td",[L," limit: ",aa])]),V=k("tr",[k("th","Label features"),k("td",ha)]),m=k("table",[k("tr",[k("th","Name",{},{width:"150px",textAlign:"right"}),d]),k("tr",[k("th","Pin to top"),e]),k("tr",[k("th","Height"),k("td",K)]),na,ba,sa,oa,pa,M,ta,ua,V,ma,ra,ja]);Y();z.appendChild(m);m=k("button","Reset track",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});
m.addEventListener("click",function(d){a.setConfig({})},!1);z.appendChild(m);d.addEventListener("input",function(b){a.mergeConfig({name:d.value})},!1);e.addEventListener("change",function(d){a.mergeConfig({pinned:e.checked})},!1);for(m=0;m<I.length;++m)I[m].addEventListener("change",l,!1);D.addEventListener("change",l,!1);H.addEventListener("change",l,!1);h.addEventListener("change",function(d){d=f(function(a){"SCATTER"===h.value?(a.SCATTER=!0,a.glyph="DOT",a.SIZE="3"):(a.glyph=h.value,a.SCATTER=
void 0);c(a)});a.mergeStylesheet(d)},!1);N.addEventListener("change",function(d){d={forceMinDynamic:!N.checked};S.disabled=!N.checked;var b=parseFloat(S.value);N.checked&&"number"==typeof b&&!isNaN(b)&&(d.forceMin=parseFloat(b));a.mergeConfig(d)});S.addEventListener("input",function(d){d=parseFloat(S.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({forceMin:d})},!1);w.addEventListener("change",function(d){d={forceMaxDynamic:!w.checked};G.disabled=!w.checked;var b=parseFloat(G.value);w.checked&&
"number"==typeof b&&!isNaN(b)&&(d.forceMax=parseFloat(b));a.mergeConfig(d)});G.addEventListener("input",function(d){d=parseFloat(G.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({forceMax:d})},!1);K.addEventListener("input",function(d){d=parseFloat(K.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({height:Math.min(500,d|0)})},!1);var ea=function(){U.disabled=!E.checked;if(E.checked){var d=parseFloat(U.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({quantLeapThreshold:parseFloat(U.value)})}else a.mergeConfig({quantLeapThreshold:null})};
E.addEventListener("change",function(a){ea()},!1);U.addEventListener("input",function(a){ea()},!1);ha.addEventListener("change",function(d){d=f(function(a){a.LABEL=ha.checked?"yes":"no"});a.mergeStylesheet(d)},!1);L.addEventListener("change",function(d){d=f(function(a){a.BUMP=L.checked?"yes":"no"});a.mergeStylesheet(d)},!1);aa.addEventListener("input",function(d){d=parseInt(aa.value);"number"==typeof d&&0<d&&a.mergeConfig({subtierMax:d})},!1);this.showToolPanel(z);this.setUiMode("tier");a.addTierListener(Y);
var O=a.browser.scale;a.browser.addViewListener(function(){a.browser.scale!=O&&(O=a.browser.scale,Y())})}}},{"./cbrowser":6,"./color":9,"./das":10,"./sourcecompare":35,"./utils":49}],45:[function(c,u,t){function n(a,b,c,g){this.config=c||{};this.id="tier"+ ++F;this.browser=a;this.dasSource=q(b);this.background=g;this.viewport=l("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport_12_5"},{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=
l("div",this.viewport,{className:"viewport-holder_12_5"},{background:g,position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=l("canvas",null,{width:+(this.browser.featurePanelWidth|0),height:"30",className:"viewport-overlay"});this.notifier=l("div","",{className:"notifier"});this.notifierHolder=l("div",this.notifier,{className:"notifier-holder"});this.quantOverlay=l("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=
l("i",null,{className:"fa fa-times"});this.bumpButton=l("i",null,{className:"fa fa-plus-circle"});this.loaderButton=a.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=l("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=l("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);b.pennant?this.nameButton.appendChild(l("img",null,{src:b.pennant,width:"16",height:"16"})):b.mapping&&(c=null,this.browser.chains[b.mapping]&&(c=this.browser.chains[b.mapping].coords.version),
c&&this.nameButton.appendChild(l("span",""+c,null,{fontSize:"8pt",background:"black",color:"white",paddingLeft:"3px",paddingRight:"3px",paddingTop:"1px",paddingBottom:"1px",marginLeft:"2px",borderRadius:"10px"})));this.nameElement=l("span",b.name);this.nameButton.appendChild(l("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=l("span",[this.nameButton],{className:"btn-group track-label"});
this.row=l("div",[this.viewportHolder,this.overlay,this.quantOverlay],{className:"tier"+(b.className?" "+b.className:"")});g||(this.row.style.background="none");a.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);
this.initSources();var f=this;this.featureSource&&this.featureSource.getDefaultFIPs&&!b.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&f.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&(this.readinessListener=function(a){f.notify(a,-1)},this.featureSource.addReadinessListener(this.readinessListener));this.featureSource&&this.featureSource.addActivityListener&&(this.activityListener=function(a){f.loaderButton.style.display=0<a?"inline-block":
"none";f.browser.pingActivity()},this.featureSource.addActivityListener(this.activityListener));this.listeners=[];this.featuresLoadedListeners=[]}if("undefined"!==typeof c){t=c("./utils");var l=t.makeElement,k=t.removeChildren,q=t.shallowCopy,p=t.miniJSONify,x=t.arrayIndexOf;t=c("./das");var C=t.DASStylesheet,b=t.DASStyle,a=c("./sha1").b64_sha1;t=c("./style");var g=t.StyleFilter,f=t.StyleFilterSet,v=c("./sourcecompare").sourceDataURI,z=c("es6-promise").Promise,m=c("./features").sortFeatures}var F=
0;n.prototype.destroy=function(){this.featureSource.removeReadinessListener&&this.featureSource.removeReadinessListener(this.readinessListener);this.featureSource.removeActivityListener&&this.featureSource.removeActivityListener(this.activityListener)};n.prototype.setBackground=function(a){this.background=a;this.viewportHolder.style.background=a};n.prototype.toString=function(){return this.id};n.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};
n.prototype.init=function(){var a=this;return new z(function(c,h){a.dasSource.style?(a.setStylesheet({styles:a.dasSource.style}),c(a)):(a.status="Fetching stylesheet",a.fetchStylesheet(function(h,g){if(g||!h){a.error="No stylesheet";h=new C;var f=new b;f.glyph="BOX";f.BGCOLOR="blue";f.FGCOLOR="black";h.pushStyle({type:"default"},null,f);a.setStylesheet(h)}else a.setStylesheet(h),h.geneHint&&(a.dasSource.collapseSuperGroups=!0,a.bumped=!1,a.updateLabel()),a._updateFromConfig();c(a)}))})};n.prototype.setStylesheet=
function(d){this.baseStylesheet=q(d);for(d=0;d<this.baseStylesheet.styles.length;++d){var b=this.baseStylesheet.styles[d]=q(this.baseStylesheet.styles[d]);b._methodRE=b._labelRE=b._typeRE=null;b.style=q(b.style);b.style.id="style"+ ++this.styleIdSeed}this.baseStylesheetValidity=a(p(this.baseStylesheet));this._updateFromConfig()};n.prototype.getSource=function(){return this.featureSource};n.prototype.getDesiredTypes=function(a){if(a=this.getActiveStyleFilters(a))return a.typeList()};n.prototype.getActiveStyleFilters=
function(a){a=this.browser.zoomForCurrentScale();if(this.stylesheet){for(var b=new f,c=this.stylesheet.styles,k=0;k<c.length;++k){var l=c[k];l.zoom&&l.zoom!=a||b.add(new g(l.type,l.method,l.label))}return b}};n.prototype.needsSequence=function(a){return this.sequenceSource&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.bwgURI||this.dasSource.bwgBlob)&&20>a?!0:!1};n.prototype.setFeatures=function(a,b,c,f,g){this.currentFeatures=f;this.currentSequence=g;this.knownChr=a;this.knownCoverage=
b;f&&(m(this),this.notifyFeaturesLoaded())};n.prototype.draw=function(){var a=this.currentSequence;this.sequenceSource?T(this,a):A(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};n.prototype.findNextFeature=function(a,b,c,f,g){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*c/2|0,this.featureSource.quantFindNextFeature(a,b,c,this.quantLeapThreshold,g);else{if(this.knownCoverage&&b>=this.knownCoverage.min()&&b<=this.knownCoverage.max()&&this.currentFeatures){for(var k=
null,l=0;l<this.currentFeatures.length;++l){var m=this.currentFeatures[l];if(m.min&&m.max&&!(m.parents&&0<m.parents.length))if(0>c)if(1==f&&m.max>=b&&m.min<b){if(!k||m.min>k.min||m.min==k.min&&m.max<k.max)k=m}else m.max<b&&(!k||m.max>k.max||m.max==k.max&&m.min<k.min||m.min==k.mmin&&k.max>=b)&&(k=m);else if(1==f&&m.min<=b&&m.max>b){if(!k||m.max<k.max||m.max==k.max&&m.min>k.min)k=m}else m.min>b&&(!k||m.min<k.min||m.min==k.min&&m.max>k.max||m.max==k.max&&k.min<=b)&&(k=m)}if(k)return g(k);b=0>c?this.browser.knownSpace.min:
this.browser.knownSpace.max}this.trySourceFNF(a,b,c,g)}};n.prototype.trySourceFNF=function(a,b,c,f){var g=this;this.featureSource.findNextFeature(a,b,c,function(a){a||f(a);var b=g.browser.getSequenceSource();b||f(a);b.getSeqInfo(a.segment,function(b){b?f(a):g.trySourceFNF(a.segment,0<c?1E10:0,c,f)})})};n.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};
n.prototype.updateHeight=function(){this.currentHeight=Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};n.prototype.drawOverlay=function(){var a=this.browser,b=a.retina&&1<window.devicePixelRatio;this.overlay.height=this.viewport.height;this.overlay.width=b?2*a.featurePanelWidth:a.featurePanelWidth;var c=this.overlay.getContext("2d");b&&c.scale(2,2);var f=b=a.viewStart,g=a.viewEnd;
if(this.overlayLabelCanvas){var k=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale;c.save();c.translate(k,0);var l=-k+2;this.dasSource.tierGroup&&(l+=15);this.overlayLabelCanvas.draw(c,l,a.featurePanelWidth-k);c.restore()}for(k=0;k<a.highlights.length;++k)l=a.highlights[k],(l.chr===a.chr||l.chr==="chr"+a.chr)&&l.min<g&&l.max>f&&(c.globalAlpha=a.defaultHighlightAlpha,c.fillStyle=a.defaultHighlightFill,c.fillRect((l.min-b)*a.scale,0,(l.max-l.min)*a.scale,this.overlay.height));this.overlay.style.width=
a.featurePanelWidth;this.overlay.style.height=this.viewport.style.height;this.overlay.style.left="0px"};n.prototype.updateStatus=function(a){var b=this;a?(this.status=a,this._notifierToStatus(),v(this.dasSource),"https:"!==window.location.protocol||0!=v(this.dasSource).indexOf("http:")||this.checkedHTTP||(this.checkedHTTP=!0,this.browser.canFetchPlainHTTP().then(function(a){a||(b.warnHTTP=!0,b._notifierToStatus())}))):this.status&&(this.status=null,this._notifierToStatus())};n.prototype.notify=function(a,
b){"number"!==typeof b&&(b=2E3);this.notifierFadeTimeout&&(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(a){if(this._notifierOn(a),0<b){var c=this;this.notifierFadeTimeout=setTimeout(function(){c._notifierToStatus()},b)}}else this._notifierToStatus()};n.prototype._notifierOn=function(a,b){k(this.notifier);b?this.notifier.appendChild(l("span",[l("a","[HTTP Warning] ",{href:this.browser.httpWarningURL,target:"_blank"}),a])):this.notifier.textContent=a;this.notifier.style.opacity=
.8};n.prototype._notifierOff=function(){this.notifier.style.opacity=0};n.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status,this.warnHTTP):this._notifierOff()};n.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();this.notifyTierListeners()};n.prototype.mergeStylesheet=function(a){this.mergeConfig({stylesheet:a,stylesheetValidity:this.baseStylesheetValidity})};n.prototype.mergeConfig=function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();
this.notifyTierListeners()};n.prototype._updateFromConfig=function(){var a=!1,b=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var c=this.config.height||this.dasSource.forceHeight;c!=this.forceHeight&&(this.forceHeight=c,a=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);c=void 0!=this.config.forceMin?this.config.forceMin:this.dasSource.forceMin;this.forceMin!=c&&(this.forceMin=c,
a=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);c=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=c&&(this.forceMax=c,a=!0);c=null;void 0!==this.config.quantLeapThreshold?c=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(c=this.dasSource.quantLeapThreshold);c!=this.quantLeapThreshold&&(this.quantLeapThreshold=c,a=!0);c=null;this.config.stylesheetValidity==this.baseStylesheetValidity&&
(c=this.config.stylesheet);c=c||this.baseStylesheet;this.stylesheet!==c&&(this.stylesheet=c,a=!0);c=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;c!==this.pinned&&(this.pinned=c,b=!0);c=typeof("number"===this.config.subtierMax)?this.config.subtierMax:this.dasSource.subtierMax||this.browser.defaultSubtierMax;c!=this.subtierMax&&(this.subtierMax=c,a=!0);c=void 0!==this.config.bumped?this.config.bumped:void 0!==this.dasSource.bumped?this.dasSource.bumped:this.dasSource.collapseSuperGroups?
!1:!0;c!==this.bumped&&(this.bumped=c,a=!0,this.updateLabel());a&&this.scheduleRedraw();b&&this.browser.reorderTiers()};n.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();a.redrawTimeout=null},10))}};n.prototype.clearTierListeners=function(){this.listeners=[]};n.prototype.addTierListener=function(a){this.listeners.push(a)};n.prototype.removeTierListener=function(a){a=x(this.listeners,a);0<=a&&this.listeners.splice(a,
1)};n.prototype.notifyTierListeners=function(a){for(var b=0;b<this.listeners.length;++b)try{this.listeners[b](a)}catch(c){console.log(c)}this.browser.notifyTier()};n.prototype.clearFeaturesLoadedListeners=function(){this.featuresLoadedListeners=[]};n.prototype.addFeaturesLoadedListener=function(a){this.featuresLoadedListeners.push(a)};n.prototype.removeFeaturesLoadedListener=function(a){a=x(this.featuresLoadedListeners,a);0<=a&&this.featuresLoadedListeners.splice(a,1)};n.prototype.notifyFeaturesLoaded=
function(){for(var a=0;a<this.featuresLoadedListeners.length;++a)try{this.featuresLoadedListeners[a].call(this)}catch(b){console.log(b)}};if("undefined"!==typeof u){u.exports={DasTier:n};var A=c("./feature-draw").drawFeatureTier,T=c("./sequence-draw").drawSeqTier}},{"./das":10,"./feature-draw":18,"./features":20,"./sequence-draw":31,"./sha1":33,"./sourcecompare":35,"./style":37,"./utils":49,"es6-promise":53}],46:[function(c,u,t){function n(a,b){for(var d=0;d<a.length;++d){var c=a[d];c===b?c.classList.add("active"):
c.classList.remove("active")}}if("undefined"!==typeof c){var l=c("./cbrowser").Browser,k=c("./sourcecompare").sourcesAreEqual;u=c("./utils");var q=u.makeElement,p=u.removeChildren,x=u.Observed;u=c("./thub");var C=u.THUB_COMPARE,b=u.connectTrackHub,a=c("./domui").makeTreeTableSection,g=c("./probe").probeResource;u=c("./bin");var f=u.URLFetchable,v=u.BlobFetchable,z=u.readInt,m=c("./lh3utils").unbgzf,F=c("./bam").BAI_MAGIC,A=c("./tabix").TABIX_MAGIC;u=c("./das");var T=u.DASSource,d=u.DASSegment,e=u.DASRegistry,
h=u.coordsMatch,y=c("./encode").EncodeFetchable}l.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(k(this.tiers[b].dasSource,a))return this.tiers[b];return!1};l.prototype.makeButton=function(a,b){var d=q("a",a,{href:"#"});b&&this.makeTooltip(d,b);return q("li",d)};l.prototype.showTrackAdder=function(c){function k(b){ga.style.display="none";fa.style.display="none";ka.style.display="none";V=!1;p(O);for(var d=q("div",null,{},{width:"100%"}),c=[],e=0;e<b.length;++e)c.push(b[e]);
c.sort(function(a,b){return a.shortLabel.toLowerCase().trim().localeCompare(b.shortLabel.toLowerCase().trim())});b=[];for(var h=[],e=0;e<c.length;++e){var f=c[e];f.children&&0<f.children.length&&"multiWig"!=f.container?b.push(f):h.push(f)}0<h.length&&b.push({shortLabel:"Others",priority:-1E8,children:h});b.sort(C);for(var g=[],c=0;c<b.length;++c){f=h=b[c];!f.dimensions&&f._parent&&f._parent.dimensions&&(f=f._parent);e={};if(f.dimensions)for(var l=f.dimensions.split(/(\w+)=(\w+)/),m=0;m<l.length-2;m+=
3)e[l[m+1]]=l[m+2];if(e.dimX&&e.dimY){for(var n=e.dimX,r=e.dimY,e=f.subgroups[n],l=f.subgroups[r],m={},y=0;y<h.children.length;++y){var B=h.children[y],f=B.sgm[n],v=B.sgm[r];m[f]||(m[f]={});m[f][v]=B}r=q("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});f=q("tr");f.appendChild(q("th",null,{},{width:"150px",height:"100px"}));for(v=0;v<e.titles.length;++v)n=q("th",q("div",e.titles[v],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",
webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),f.appendChild(n);r.appendChild(f);for(var x=q("tbody",null,{className:"table table-striped table-condensed"}),D=0;D<l.titles.length;++D){var v=l.tags[D],t=q("tr");t.appendChild(q("th",l.titles[D]),{});for(var z=0;z<e.titles.length;++z){var f=e.tags[z],H=q("td");if(m[f]&&m[f][v]){f=m[f][v];y=f.toDallianceSource();if(!y)continue;n=q("tr");B=q("td");B.style.textAlign="center";var u=q("input");
u.type="checkbox";u.dalliance_source=y;Q&&(u.dalliance_mapping=Q);g.push(u);H.appendChild(u);u.addEventListener("change",function(a){a.target.checked?w.addTier(a.target.dalliance_source):w.removeTier(a.target.dalliance_source)})}t.appendChild(H)}x.appendChild(t)}r.appendChild(x);d.appendChild(a(h.shortLabel,r,0==c))}else{l=q("tbody",null,{className:"table table-striped table-condensed"});m=q("table",l,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});v=0;h.children.sort(C);
for(e=0;e<h.children.length;++e)if(f=h.children[e],y=f.toDallianceSource())n=q("tr"),B=q("td",null,{},{width:"30px"}),B.style.textAlign="center",u=q("input"),u.type="checkbox",u.dalliance_source=y,Q&&(u.dalliance_mapping=Q),g.push(u),B.appendChild(u),u.addEventListener("change",function(a){a.target.checked?w.addTier(a.target.dalliance_source):w.removeTier(a.target.dalliance_source)}),n.appendChild(B),r=q("td"),r.appendChild(document.createTextNode(f.shortLabel)),f.longLabel&&0<f.longLabel.length&&
w.makeTooltip(r,f.longLabel),n.appendChild(r),l.appendChild(n),++v;1<b.length||"Others"!==h.shortLabel?d.appendChild(a(h.shortLabel,m,0==c)):d.appendChild(m)}}var A=function(){for(var a=0;a<g.length;++a){var b=g[a],d=w.currentlyActive(b.dalliance_source);d?(b.checked=!0,b.disabled=null!=d.sequenceSource):b.checked=!1}};A();w.addTierListener(function(a){A()});O.appendChild(d)}function l(){n(E,ia);V="bin";ga.style.display="none";fa.style.display="inline";ka.style.display="none";p(O);var a=q("div",null,
{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(q("h3","Add custom URL-based data"));a.appendChild(q("p",["You can add indexed binary data hosted on an web server that supports CORS (",q("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(q("br"));a.appendChild(document.createTextNode("URL: "));ba=q("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});
a.appendChild(ba);a.appendChild(q("br"));a.appendChild(q("b","- or -"));a.appendChild(q("br"));a.appendChild(document.createTextNode("File: "));M=q("input",null,{type:"file",multiple:"multiple"});a.appendChild(M);a.appendChild(q("p",'Clicking the "Add" button below will initiate a series of test queries.'));O.appendChild(a);ba.focus()}function t(){n(E,ja);ga.style.display="none";fa.style.display="inline";ka.style.display="none";V="hub-connect";ga.style.visibility="hidden";p(O);var a=q("div",null,
{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(q("h3","Connect to a track hub."));a.appendChild(q("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));ba=q("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild(ba);O.appendChild(a);ba.focus()}function u(){n(E,ra);ga.style.display="none";fa.style.display="inline";ka.style.display="none";V="das";p(O);var a=q("div",null,{},{paddingLeft:"10px",
paddingRight:"10px"});a.appendChild(q("h3","Add custom DAS data"));a.appendChild(q("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(q("br"));ba=q("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild(ba);a.appendChild(q("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));
O.appendChild(a);ba.focus()}function I(){if(V)if("das"===V){var a=ba.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);a=new T({name:"temporary",uri:a});X(a)}else if("bin"===V){var b=M.files;if(b&&0<b.length){a=ca=[];V="multiple";for(var d=0;d<b.length;++d){var c=b[d];c&&a.push({blob:c})}for(d=0;d<a.length;++d)va(a[d]);xa()}else a=ba.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),b={uri:a},a=a.toLowerCase(),0==a.indexOf("https://www.encodeproject.org/")&&0<=a.indexOf("@@download")&&(b.transport=
"encode"),ya(b)}else if("reset"===V)u();else if("reset-bin"===V)l();else if("reset-hub"===V)t();else if("prompt-bai"===V)(b=M.files)&&0<b.length&&b[0]?(ea.baiBlob=b[0],S(ea)):(b=ea,ga.style.display="none",fa.style.display="inline",ka.style.display="inline",p(O),V="prompt-bai",O.appendChild(q("h2","Select an index file")),O.appendChild(q("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
O.appendChild(document.createTextNode("Index file: ")),M=q("input",null,{type:"file"}),O.appendChild(M),ea=b);else if("prompt-tbi"===V)(b=M.files)&&0<b.length&&b[0]?(ea.indexBlob=b[0],G(ea)):(b=ea,ga.style.display="none",fa.style.display="inline",ka.style.display="inline",p(O),V="prompt-tbi",O.appendChild(q("h2","Select an index file")),O.appendChild(q("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
O.appendChild(document.createTextNode("Index file: ")),M=q("input",null,{type:"file"}),O.appendChild(M),ea=b);else if("finalize"===V||"finalize-bin"===V)ea.name=sa.value,b=oa.value,ea.mapping="__default__"!=b?b:void 0,pa&&(ea.maxbins=pa.checked),1<ta.value.length&&1<ua.value.length&&(ea.xUser=ta.value,ea.xPass=ua.value),w.addTier(ea),"finalize-bin"==V?l():u();else if("hub-connect"===V)a=ba.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),R(a);else{if("multiple"===V){for(b=0;b<ca.length;++b)if(a=ca[b],
!a.hidden&&("bam"!=a.tier_type||a.indexBlob||a.indexUri)&&("tabix"!=a.tier_type||a.indexBlob||a.indexUri)&&(a=P(a)))a.noPersist=!0,w.addTier(a);l()}}else w.removeAllPopups()}function R(a,d,c){d=d||{};for(var e=0;e<w.hubObjects.length;++e){var h=w.hubObjects[e];if(h.hub.url==a){for(e=0;e<E.length;++e)E[e].hub==h&&n(E,E[e]);h.getTracks(function(a,b){b&&console.log(b);k(a)});return}}b(a,function(b,e){if(e){if(!c)return R(a,{credentials:!0},!0);p(O);O.appendChild(q("h2","Error connecting to track hub"));
O.appendChild(q("p",e));V="reset-hub"}else{var h=null,f=null,g;for(g in b.genomes){var l=null,m=!1;if(g==w.coordSystem.ucscName)m=!0;else for(var y in w.chains)g==w.chains[y].coords.ucscName&&(l=y,m=!0);m&&(m={url:a,genome:g},d.credentials&&(m.credentials=!0),l&&(m.mapping=l,b.genomes[g].mapping=l),w.hubs.push(m),w.hubObjects.push(b.genomes[g]),m=la(b.genomes[g]),na.appendChild(m),l&&h||(h=b.genomes[g],f=m))}h?(w.notifyTier(),n(E,f),h.getTracks(function(a,b){k(a)})):(p(O),O.appendChild(q("h2","No data for this genome")),
O.appendChild(q("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),O.appendChild(q("p","coordSystem.ucscName = "+w.coordSystem.ucscName)),V="reset-hub")}},d)}function J(a,b){var d=a.uri;if(b){var c=/(.+)\/[^\/]+\/?/.exec(d);c&&(d=c[1]+"/sources")}(new e(d,{credentials:a.credentials})).sources(function(d){if(!d||0==d.length)return b?da(a):J(a,!0);var c=null;if(1==d.length)c=d[0];else for(var e=0;e<d.length;++e)if(d[e].uri===a.uri){c=
d[e];break}e=d=!1;if(c&&(a.name=c.name,a.desc=c.desc,a.maxbins=c.maxbins?!0:!1,c.capabilities&&(a.capabilities=c.capabilities),e=!0,c.coords&&1==c.coords.length))if(c=c.coords[0],h(c,w.coordSystem))d=!0;else if(w.chains)for(var f in w.chains)h(c,w.chains[f].coords)&&(a.mapping=f,d=!0);return da(a,d,e)},function(){return b?da(a):J(a,!0)})}function S(a){(a.baiBlob?new v(a.baiBlob):"encode"==a.transport?new y(a.bamURI+".bai"):new f(a.bamURI+".bai",{credentials:a.credentials})).slice(0,256).fetch(function(b){var d=
!1;b&&(b=new Uint8Array(b),d=z(b,0)==F);return d?da(a,!1,!1,!0):N("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function G(a){(a.indexBlob?new v(a.indexBlob):new f(a.uri+".tbi")).slice(0,65536).fetch(function(b){var d=!1;if(b){var c=new Uint8Array(b);if(31==c[0]||139==c[1])b=m(b),c=new Uint8Array(b),d=z(c,0)==A}return d?da(a,!1,!1,!0):N('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
function N(a){ga.style.display="none";fa.style.display="inline";ka.style.display="inline";p(O);a=a||"Custom data format not recognized";O.appendChild(q("h2","Error adding custom data"));O.appendChild(q("p",a));O.appendChild(q("p","Currently supported formats are bigBed, bigWig, and BAM."));V="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var w=this;c=q("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top",paddingRight:"15px"});var E=[],U,K;if(!this.noRegistryTabs){var L=this.makeButton("Registry","Browse compatible datasources from the DAS registry");E.push(L);for(var aa in this.mappableSources)(function(a){var b=w.makeButton(w.chains[a].srcTag,"Browse datasources mapped from "+w.chains[a].srcTag);E.push(b);b.addEventListener("click",function(d){d.preventDefault();d.stopPropagation();n(E,b);U(w.mappableSources[a],a)},!1)})(aa)}aa={};for(var ha=0;ha<this.defaultSources.length;++ha){var Z=
this.defaultSources[ha],Y=Z.group||"Defaults";aa[Y]?aa[Y].push(Z):aa[Y]=[Z]}var la=function(a){var b=a.hub,d=q("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),c=b.altLabel||b.shortLabel||"Unknown";a.mapping&&(c=c+" ("+a.genome+")");var c=q("span",[c," ",d]),e=w.makeButton(c,b.longLabel);e.hub=a;E.push(e);e.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();n(E,e);p(O);b=w.makeLoader(24);b.style.marginLeft="auto";b.style.marginRight="auto";b.style.marginTop=
"100px";O.appendChild(q("div",b,null,{textAlign:"center"}));ga.style.display="none";fa.style.display="none";ka.style.display="none";a.getTracks(function(a,b){b&&console.log(b);k(a)})},!1);d.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();var d=q("li",q("a","Remove hub")),c=q("li",q("a","Enable all")),h=q("li",q("a","Disable all")),f=q("ul",[d,c,h],{className:"dropdown-menu"},{display:"block"}),g=b.clientX;b=b.clientY;g+=document.documentElement.scrollLeft||document.body.scrollLeft;
b+=document.documentElement.scrollTop||document.body.scrollTop;f.style.position="absolute";f.style.top=""+(b+10)+"px";f.style.left=""+(g-30)+"px";w.hPopupHolder.appendChild(f);var k=function(a){console.log("cc");document.body.removeEventListener("click",k,!0);w.hPopupHolder.removeChild(f)};document.body.addEventListener("click",k,!0);d.addEventListener("click",function(b){for(b=0;b<w.hubObjects.length;++b)if(w.hubObjects[b].absURL==a.absURL){w.hubObjects.splice(b,1);break}for(b=0;b<w.hubs.length;++b){var d=
w.hubs[b];"string"===typeof d&&(d={url:d});if(d.url==a.hub.url&&!d.genome||d.genome==a.genome){w.hubs.splice(b,1);break}}w.notifyTier();na.removeChild(e);n(E,ja);t()},!1);c.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var d=0;d<a.length;++d){var c=a[d].toDallianceSource();w.currentlyActive(c)||w.addTier(c)}})},!1);h.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var d=0;d<a.length;++d){var c=a[d].toDallianceSource();w.currentlyActive(c)&&
w.removeTier(c)}})},!1)},!1);return e},ma=null,qa=null;for(Y in aa)(function(a,b){var d=w.makeButton(a,"Browse the default set of data for this browser");d.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();n(E,d);U(new x(b))},!1);E.push(d);ma||(ma=d,qa=b)})(Y,aa[Y]);var ra=this.makeButton("DAS","Add arbitrary DAS data");E.push(ra);var ia=this.makeButton("Binary","Add data in bigwig or bigbed format");E.push(ia);for(Y=0;Y<this.hubObjects.length;++Y)la(this.hubObjects[Y]);
var ja=this.makeButton("+","Connect to a new track-hub");E.push(ja);var na=q("ul",E,{className:"nav nav-tabs"},{marginBottom:"0px"});c.appendChild(na);var ba,sa,oa,pa,M,ta,ua,V=!1,ea=null,Y=q("form",null,{},{display:"inline-block",width:"100%"});Y.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();I();return!1},!0);var O=q("div");O.style.position="relative";O.style.overflow="scroll";Y.appendChild(O);var Q,wa;U=function(a,b){ga.style.display="none";fa.style.display="none";
ka.style.display="none";wa&&wa.removeListener(K);Q=b;wa=a;wa.addListenerAndFire(K)};K=function(a){V=!1;var b=[];p(O);if(a){for(var d=q("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),c=q("table",d,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),e=0,h=[],f=0;f<a.length;++f)h.push(a[f]);h.sort(function(a,b){return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim())});for(f=0;f<h.length;++f){a=h[f];var g=q("tr"),
k=q("td",null,{},{width:"30px"});k.style.textAlign="center";if(!a.props||a.props.cors){var l=q("input");l.type="checkbox";l.dalliance_source=a;Q&&(l.dalliance_mapping=Q);k.appendChild(l);b.push(l);l.addEventListener("change",function(a){a.target.checked?w.addTier(a.target.dalliance_source):w.removeTier(a.target.dalliance_source)})}else k.appendChild(document.createTextNode("!")),w.makeTooltip(k,q("span",["This data source isn't accessible because it doesn't support ",q("a","CORS",{href:"http://www.w3.org/TR/cors/"}),
"."]));g.appendChild(k);k=q("td");k.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&w.makeTooltip(k,a.desc);g.appendChild(k);d.appendChild(g);++e}var m=function(){for(var a=0;a<b.length;++a){var d=b[a];w.currentlyActive(d.dalliance_source)?d.checked=!0:d.checked=!1}};m();w.addTierListener(function(a){m()});O.appendChild(c)}else O.appendChild(q("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};L&&L.addEventListener("click",
function(a){a.preventDefault();a.stopPropagation();n(E,L);U(w.availableSources)},!1);ia.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();l()},!1);ja.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();t()},!1);ra.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();u()},!1);var fa=q("button","Add",{className:"btn btn-primary"});fa.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();I()},!1);var X=function(a,
b){var c=w.knownSpace;if(c){var e=Math.max(c.min,(c.min+c.max-100)/2)|0,c=new d(c.chr,e,Math.min(e+99,c.max));a.features(c,{},function(d,c){if(c)b?(p(O),O.appendChild(q("h2","Custom data not found")),O.appendChild(q("p","DAS uri: "+a.uri+" is not answering features requests")),V="reset"):(a.credentials=!0,X(a,!0));else{var e=/\/([^/]+)\/?$/.exec(a.uri);e&&(a.name=e[1]);J(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},P=function(a){var b={name:a.name};a.credentials&&(b.credentials=
a.credentials);a.mapping&&"__default__"!=a.mapping&&(b.mapping=a.mapping);a.transport&&(b.transport=a.transport);if("bwg"==a.tier_type)return a.blob?b.bwgBlob=a.blob:a.uri&&(b.bwgURI=a.uri),b;if("bam"==a.tier_type)return a.blob?(b.bamBlob=a.blob,b.baiBlob=a.indexBlob):(b.bamURI=a.uri,b.baiURI=a.indexUri),b;if("tabix"==a.tier_type)return b.tier_type="tabix",b.payload=a.payload,a.blob?(b.blob=a.blob,b.indexBlob=a.indexBlob):(b.uri=a.uri,b.indexUri=a.indexUri),b;if("memstore"==a.tier_type)return b.tier_type=
"memstore",b.payload=a.payload,a.blob?b.blob=a.blob:b.uri=a.uri,b},ya=function(a){g(a,function(a,b){if(b){p(O);var d=q("div");d.appendChild(q("h2","Couldn't access custom data"));d.appendChild(q("p",""+b));O.appendChild(d);console.log(a);"https:"===window.location.protocol&&0==a.uri.indexOf("http:")&&w.canFetchPlainHTTP().then(function(a){a||d.appendChild(q("p",[q("strong","HTTP warning: "),"you may not be able to access HTTP resources from an instance of Biodalliance which you are accessing via HTTPS.",
q("a","[More info]",{href:w.httpWarningURL,target:"_blank"})]))});V="reset-bin"}else{var c=P(a);return"bam"==a.tier_type?S(c):"tabix"==a.tier_type?G(c):da(c,!1,!1,!0)}})},da=function(a,b,d,c){ga.style.display="none";fa.style.display="inline";ka.style.display="inline";p(O);O.appendChild(q("h2","Add custom data: step 2"));O.appendChild(document.createTextNode("Label: "));sa=q("input","",{value:a.name});O.appendChild(sa);ta=q("input","");ua=q("input","");O.appendChild(q("br"));O.appendChild(q("br"));
O.appendChild(q("h4","Coordinate system: "));oa=q("select",null);oa.appendChild(q("option",w.nameForCoordSystem(w.coordSystem),{value:"__default__"}));if(w.chains)for(var e in w.chains)oa.appendChild(q("option",w.nameForCoordSystem(w.chains[e].coords),{value:e}));oa.value=a.mapping||"__default__";O.appendChild(oa);b?O.appendChild(q("p","(Based on server response, probably doesn't need changing.)")):(O.appendChild(q("p",[q("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),
O.appendChild(q("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));c||(O.appendChild(document.createTextNode("Quantitative: ")),pa=q("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(pa.checked=a.maxbins),O.appendChild(pa),d?O.appendChild(q("p","(Based on server response, probably doesn't need changing.)")):O.appendChild(q("p",[q("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&
O.appendChild(q("p",[q("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));sa.focus();V="bin"===V||"prompt-bai"===V||"prompt-tbi"===V?"finalize-bin":"finalize";ea=a},ca=null,va=function(a){g(a,function(a,b){b&&(a.error=b);for(var d=[],c={},e={},h=0;h<ca.length;++h){var f=ca[h];"bam"!=f.tier_type||f.indexBlob||(c[f.blob.name]=f);"tabix"!=f.tier_type||f.indexBlob||(e[f.blob.name]=f)}for(h=0;h<ca.length;++h)if(f=ca[h],
"bai"===f.tier_type){var g=/(.+)\.bai$/.exec(f.blob.name);g&&c[g[1]]&&(c[g[1]].indexBlob=f.blob,d.push(h))}else"tabix-index"===f.tier_type&&(g=/(.+)\.tbi$/.exec(f.blob.name))&&e[g[1]]&&(e[g[1]].indexBlob=f.blob,d.push(h));for(c=d.length-1;0<=c;--c)ca.splice(d[c],1);xa()})},xa=function(){p(O);var a=!1,b=q("table",ca.filter(function(a){return!a.hidden}).map(function(b){q("tr").appendChild(q("td",b.name||b.blob.name));var d;d=b.error?q("span","Error",null,{color:"red"}):b.tier_type?b.payload||b.tier_type:
w.makeLoader(16);var c,e="unknown";"bwg"==b.tier_type||"memstore"==b.tier_type?e="okay":"bam"==b.tier_type?e=b.indexBlob?"okay":"needs-index":"tabix"==b.tier_type&&(e=b.indexBlob?"okay":"needs-index");if("okay"==e){c=q("select",null,null,{width:"150px"});c.appendChild(q("option",w.nameForCoordSystem(w.coordSystem),{value:"__default__"}));if(w.chains)for(var h in w.chains)c.appendChild(q("option",w.nameForCoordSystem(w.chains[h].coords),{value:h}));c.value=b.mapping||"__default__";c.addEventListener("change",
function(a){b.mapping=c.value;console.log(b)},!1)}else"needs-index"==e&&(c=q("span","Needs index",{},{color:"red"}),a=!0);return q("tr",[q("td",b.name||b.blob.name),q("td",d),q("td",c)])}),{className:"table table-striped table-condensed"});O.appendChild(b);if(a){O.appendChild(q("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
O.appendChild(document.createTextNode("Index file(s): "));var d=q("input",null,{type:"file",multiple:"multiple"});O.appendChild(d);d.addEventListener("change",function(a){console.log("fileset changed");a=d.files||[];for(var b=0;b<a.length;++b){var c=a[b];c&&(c={blob:c,hidden:!0},ca.push(c),va(c))}},!1)}},ka=q("button","Cancel",{className:"btn"});ka.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===V?l():u()},!1);var ga=q("button","Refresh",{className:"btn"});
ga.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();w.queryRegistry(Q)},!1);this.makeTooltip(ga,"Click to re-fetch data from the DAS registry");aa=q("div",[fa," ",ka," ",ga]);aa.style.margin="10px";Y.appendChild(aa);c.appendChild(Y);U(w.availableSources);this.showToolPanel(c);this.setUiMode("add");ma&&(n(E,ma),U(new x(qa)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./encode":12,"./lh3utils":24,"./probe":28,"./sourcecompare":35,"./tabix":41,"./thub":42,
"./utils":49}],47:[function(c,u,t){function n(c,n,p){n.fetchAsText(function(n){if(!n)return p(null,"Couldn't fetch index-index");n=n.split(/(.+)([0-9A-F]{10})\n/);for(var q=[],b=[],a=1;a<n.length;a+=3)q.push(n[a]),b.push(parseInt(n[a+1],16));return p(new l(q,b,c))})}function l(c,l,n){this.keys=c;this.offsets=l;this.ix=n}l.prototype.lookup=function(c,l){for(var n,x=(c+"     ").substring(0,5).toLowerCase(),t=0;t<this.keys.length;++t)if(0>x.localeCompare(this.keys[t])){n=this.ix.slice(this.offsets[t-
1],this.offsets[t]-this.offsets[t-1]);break}n||(n=this.ix.slice(this.offsets[this.offsets.length-1]));n.fetchAsText(function(b){b=b.split("\n");for(var a=0;a<b.length;++a)if(0==b[a].indexOf(c.toLowerCase()+" "))return l(b[a].split(" "));return l(null)})};"undefined"!==typeof u&&(u.exports={connectTrix:n})},{}],48:[function(c,u,t){function n(){}function l(a,b){var c=new n;c.data=a;var l=12500,m=0;c.data.slice(0,l).fetch(function(a){if(!a)return b(null,"Couldn't access data");var g=new Uint8Array(a);
a=q(g,0);if(440477507==a)c.readInt=q;else if(1126646042==a)c.readInt=p;else return b(null,"Not a .2bit file, magic=0x"+a.toString(16));a=c.readInt(g,4);if(0!=a)return b(null,"Unsupported version "+a);c.seqCount=c.readInt(g,8);c.seqDict={};var n=16,d=0,e=0,h=function(){for(;d<c.seqCount;){var a=g[n];if(n+a+6>=g.length)return m+=l,l=Math.max(12500,Math.floor(m*c.seqCount/d)),c.data.slice(e+n,l).fetch(function(a){e+=n;n=0;g=new Uint8Array(a);h()});++n;for(var B="",r=1;r<=a;++r)B+=String.fromCharCode(g[n++]);
a=c.readInt(g,n);n+=4;c.seqDict[B]=new k(c,a);++d}return b(c)};h()})}function k(a,b){this.tbf=a;this.offset=b}if("undefined"!==typeof c){t=c("./bin");var q=t.readInt,p=t.readIntBE;c=c("./spans");var x=c.Range,C=c.union,b=c.intersection}n.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};n.prototype.fetch=function(a,b,c,k){var l=this.getSeq(a);if(l){if(c<=b)return k("");l.fetch(b,c,k)}else return k(null,"Couldn't find "+a)};k.prototype.init=function(a){if(this.seqOffset)return a();
var b=this;b.tbf.data.slice(b.offset,8).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);b._length=b.tbf.readInt(c,0);b.nBlockCnt=b.tbf.readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);for(var k=null,l=0;l<b.nBlockCnt;++l)var n=b.tbf.readInt(c,4*l),p=b.tbf.readInt(c,4*(l+b.nBlockCnt)),n=new x(n,n+p-1),k=k?C(k,n):n;b.nBlocks=k;b.mBlockCnt=b.tbf.readInt(c,8*b.nBlockCnt);b.seqLength=(b._length+3)/4|0;b.seqOffset=
b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var a=["T","C","A","G"];k.prototype.fetch=function(c,f,k){--c;--f;var l=this;this.init(function(m){if(m)return k(null,m);var n=c>>2;m=f+3>>2;if(0>n||m>l.seqLength)return k("Coordinates out of bounds: "+c+":"+f);l.tbf.data.slice(l.seqOffset+n,m-n).salted().fetch(function(m){function p(b){for(;y<=b;){var c=y&3,e=d[(y>>2)-n];h+=a[0==c?e>>6&3:1==c?e>>4&3:2==c?e>>2&3:e&3];++y}}if(null==m)return k("SeqFetch failed");var d=new Uint8Array(m);m=[];if(l.nBlocks){var e=
b(new x(c,f),l.nBlocks);e&&(m=e.ranges())}for(var h="",y=c,e=0;e<m.length;++e){var B=m[e];if(y>B.min())throw"N mismatch...";for(y<B.min()&&p(B.min()-1);y<=B.max();)h+="N",++y}y<=f&&p(f);return k(h)})})};k.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b._length)})};"undefined"!==typeof u&&(u.exports={makeTwoBit:l})},{"./bin":4,"./spans":36}],49:[function(c,u,t){function n(a,b){for(var d=0;d<a.length;++d)if(a[d]==b)return;a.push(b)}function l(a,b,d){a[b]?a[b].push(d):
a[b]=[d]}function k(a,b,d){var c=a[b];if(c){for(a=0;a<c.length;++a)if(c[a]==d)return;c.push(d)}else a[b]=[d]}function q(a,b,d,c){if(a)return a;if(b)return b;if(d)return d;if(c)return c}function n(a,b){for(var d=0;d<a.length;++d)if(a[d]==b)return;a.push(b)}function p(a,b){if(!a)return-1;for(var d=0;d<a.length;++d)if(a[d]===b)return d;return-1}function x(a,b,d,c){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var f=0;f<b.length;++f){var g=b[f];g&&("string"==typeof g?g=document.createTextNode(g):
"number"==typeof g&&(g=document.createTextNode(""+g)),a.appendChild(g))}}if(d)for(var k in d)try{a[k]=d[k]}catch(l){throw console.log("error setting "+k),l;}if(c)for(k in c)a.style[k]=c[k];return a}function C(a,b,d,c){a=document.createElementNS(a,b);if(d)for(d instanceof Array||(d=[d]),b=0;b<d.length;++b){var f=d[b];"string"==typeof f&&(f=document.createTextNode(f));a.appendChild(f)}if(c)for(var g in c){d=a;b=g;var f=c[g],k=T[b];if(!k){for(var k="",l=0;l<b.length;++l)var m=b.substring(l,l+1),n=m.toLowerCase(),
k=n!=m?k+"-"+n:k+m;T[b]=k}d.setAttribute(k,f)}return a}function b(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}function a(b,d){if("undefined"===typeof b)return"undefined";if(null==b)return"null";if("string"==typeof b)return"'"+b+"'";if("number"==typeof b||"boolean"==typeof b)return""+b;if("object"==typeof b){if(b instanceof Array){for(var c=null,f=0;f<b.length;++f)c=(null==c?"":c+", ")+a(b[f],d);return"["+(c?c:"")+"]"}d=d||{};c=null;for(f in b)d[f]||void 0!=f&&"function"!=
typeof b[f]&&(c=(null==c?"":c+", ")+f+": "+a(b[f],d));return"{"+(c?c:"")+"}"}return typeof b}function g(a){var b={},d;for(d in a)b[d]=a[d];return b}function f(a){this.value=a;this.listeners=[]}function v(){this.queue=[]}function z(a,b,c){c&&c.salt&&(a=a+"?salt="+A(""+Date.now()+","+ ++d));try{var f;c.timeout&&(f=setTimeout(function(){console.log("timing out "+a);g.abort();return b(null,"Timeout")},c.timeout));var g=new XMLHttpRequest;g.onreadystatechange=function(){4==g.readyState&&(f&&clearTimeout(f),
200>g.status||300<=g.status?b(null,"Error code "+g.status):b(g.responseText))};g.open("GET",a,!0);g.responseType="text";c&&c.credentials&&(g.withCredentials=!0);g.send("")}catch(k){b(null,"Exception "+k)}}function m(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;var d=a.lastIndexOf("/");return 0<=d?a.substr(0,d+1)+b:b}function F(a){return x("a",null,{href:a}).href}if("undefined"!==typeof c)var A=c("./sha1").b64_sha1;var T={};f.prototype.addListener=function(a){this.listeners.push(a)};
f.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};f.prototype.removeListener=function(a){var b=this.listeners;a=p(b,a);0<=a&&b.splice(a,1)};f.prototype.get=function(){return this.value};f.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};v.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};v.prototype.await=
function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var d=0;c={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"*",TAG:"*",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"*",TGG:"W",
CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"undefined"!==typeof u&&(u.exports={textXHR:z,relativeURL:m,resolveUrlToPage:F,shallowCopy:g,pusho:l,pushnew:n,pushnewo:k,arrayIndexOf:p,pick:q,makeElement:x,makeElementNS:C,removeChildren:b,miniJSONify:a,Observed:f,Awaited:v,AMINO_ACID_TRANSLATION:c})},{"./sha1":33}],50:[function(c,u,t){function n(){this.info=
[]}function l(a,b){this.parser=a;this.sink=b}if("undefined"!==typeof c){var k=c("./sourceadapters").registerParserFactory;c=c("./das");var q=c.DASStylesheet,p=c.DASStyle,x=c.DASFeature}var C=/([^;=]+)(=([^;]+))?;?/,b=/##INFO=<([^>]+)>/,a=/([^,=]+)=([^,]+|"[^"]+"),?/;n.prototype.createSession=function(a){return new l(this,a)};l.prototype.parse=function(c){if(0!=c.length)if("#"==c[0]){if(1<c.length&&"#"==c[1]&&(c=b.exec(c))){var f=c[1].split(a),k=null,l=null;for(c=0;c<f.length-1;c+=3){var m=f[c+1],
n=f[c+2].replace(/"/g,"");"ID"==m?k=n:"Description"==m&&(l=n)}k&&l&&this.parser.info.push({id:k,desc:l})}}else{f=c.split("\t");k=new x;k.segment=f[0];k.id=f[2];k.refAllele=f[3];k.altAlleles=f[4].split(",");k.min=parseInt(f[1]);k.max=k.min+k.refAllele.length-1;f=f[7].split(C);k.info={};for(c=0;c<f.length;c+=4)k.info[f[c+1]]=f[c+3];c=k.altAlleles[0];f=k.refAllele;c.length>f.length?(k.type="insertion",0==c.indexOf(f)?(k.insertion=c.substr(f.length),k.min+=f.length,k.max=k.min-1):k.insertion=c):k.type=
c.length<f.length?"deletion":"substitution";this.sink(k)}};l.prototype.flush=function(){};n.prototype.getStyleSheet=function(a){var b=new q,c=new p;c.glyph="__INSERTION";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(50,80,255)";c.BGCOLOR="#888888";c.STROKECOLOR="black";b.pushStyle({type:"insertion"},null,c);c=new p;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(255, 60, 60)";c.BGCOLOR="#888888";c.STROKECOLOR="black";b.pushStyle({type:"deletion"},null,c);c=new p;c.glyph="PLIMSOLL";c.BUMP="yes";
c.LABEL="no";c.FGCOLOR="rgb(50,80,255)";c.BGCOLOR="#888888";c.STROKECOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};n.prototype.getDefaultFIPs=function(a){var b=this;a(function(a,c){c.add("Ref. allele",a.refAllele);c.add("Alt. alleles",a.altAlleles.join(","));if(a.info)for(var g=0;g<b.info.length;++g){var k=b.info[g],l=a.info[k.id];void 0!==l&&c.add(k.desc,l)}})};k("vcf",function(){return new n})},{"./das":10,"./sourceadapters":34}],51:[function(c,u,t){c={CONFIG:5,MAJOR:0,MINOR:13,
MICRO:6,PATCH:"a",BRANCH:"dev",toString:function(){var c=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(c+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(c=c+"-"+this.BRANCH);return c}};"undefined"!==typeof u&&(u.exports=c)},{}],52:[function(c,u,t){function n(c){function n(b){b=Math.min(b,x);a=b=Math.max(b,0);v.style.left=""+a+"px"}function p(a){a=Math.min(a,x);g=a=Math.max(a,0);z.style.left=""+g+"px"}c=c||{};var x=c.width||200,t=0,b=200,a=50,g=100,f=[];c=l("hr",null,{className:"slider-track"},
{width:""+(x|0)+"px"});var v=l("hr",null,{className:"slider-thumb active"}),z=l("hr",null,{className:"slider-thumb"}),m=l("div",[c,v,z],{className:"slider"},{width:""+((x|0)+10)+"px"});m.removeLabels=function(){for(var a=0;a<f.length;++a)m.removeChild(f[a]);f=[]};m.addLabel=function(a,d){var c=l("div",d,{className:"slider-label"},{left:""+(0+(a-t)*(x-0)/(b-t)|0)+"px"});m.appendChild(c);f.push(c)};var u=document.createEvent("HTMLEvents");u.initEvent("change",!0,!1);Object.defineProperty(m,"value",
{get:function(){return t+(a-0)*(b-t)/(x-0)},set:function(a){n(0+(a-t)*(x-0)/(b-t))}});Object.defineProperty(m,"value2",{get:function(){return t+(g-0)*(b-t)/(x-0)},set:function(a){p(0+(a-t)*(x-0)/(b-t))}});Object.defineProperty(m,"active",{get:function(){return v.classList.contains("active")?1:2},set:function(a){1==a?(v.classList.add("active"),z.classList.remove("active")):(z.classList.add("active"),v.classList.remove("active"))}});Object.defineProperty(m,"min",{get:function(){return t},set:function(a){t=
a}});Object.defineProperty(m,"max",{get:function(){return b},set:function(a){b=a}});var A,T;c=function(b){T=this==v?1:2;T!=m.active&&(m.active=T,m.dispatchEvent(u));b.stopPropagation();b.preventDefault();window.addEventListener("mousemove",d,!1);window.addEventListener("mouseup",e,!1);A=b.clientX-(1==T?a:g)};v.addEventListener("mousedown",c,!1);z.addEventListener("mousedown",c,!1);var d=function(a){1==T?n(a.clientX-A):p(a.clientX-A);m.dispatchEvent(u)},e=function(a){window.removeEventListener("mousemove",
d,!1);window.removeEventListener("mouseup",e,!1)};return m}if("undefined"!==typeof c)var l=c("./utils").makeElement;"undefined"!==typeof u&&(u.exports=n)},{"./utils":49}],53:[function(c,u,t){u=c("./promise/promise").Promise;c=c("./promise/polyfill").polyfill;t.Promise=u;t.polyfill=c},{"./promise/polyfill":58,"./promise/promise":59}],54:[function(c,u,t){var n=c("./utils").isArray,l=c("./utils").isFunction;t.all=function(c){if(!n(c))throw new TypeError("You must pass an array to all.");return new this(function(n,
p){function t(a){return function(c){u[a]=c;0===--b&&n(u)}}var u=[],b=c.length,a;0===b&&n([]);for(var g=0;g<c.length;g++)(a=c[g])&&l(a.then)?a.then(t(g),p):(u[g]=a,0===--b&&n(u))})}},{"./utils":63}],55:[function(c,u,t){(function(c,l){function k(){return function(){c.nextTick(x)}}function q(){var a=0,c=new b(x),f=document.createTextNode("");c.observe(f,{characterData:!0});return function(){f.data=a=++a%2}}function p(){return function(){a.setTimeout(x,1)}}function x(){for(var a=0;a<g.length;a++){var b=
g[a];(0,b[0])(b[1])}g=[]}var u="undefined"!==typeof window?window:{},b=u.MutationObserver||u.WebKitMutationObserver,a="undefined"!==typeof l?l:void 0===this?window:this,g=[],f;f="undefined"!==typeof c&&"[object process]"==={}.toString.call(c)?k():b?q():p();t.asap=function(a,b){1===g.push([a,b])&&f()}}).call(this,c("1YiZ5S"),"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"1YiZ5S":64}],56:[function(c,u,t){t.cast=function(c){return c&&"object"===typeof c&&c.constructor===this?
c:new this(function(l){l(c)})}},{}],57:[function(c,u,t){var n={instrument:!1};t.config=n;t.configure=function(c,k){if(2===arguments.length)n[c]=k;else return n[c]}},{}],58:[function(c,u,t){(function(n){var l=c("./promise").Promise,k=c("./utils").isFunction;t.polyfill=function(){var c;c="undefined"!==typeof n?n:"undefined"!==typeof window&&window.document?window:self;"Promise"in c&&"cast"in c.Promise&&"resolve"in c.Promise&&"reject"in c.Promise&&"all"in c.Promise&&"race"in c.Promise&&function(){var l;
new c.Promise(function(c){l=c});return k(l)}()||(c.Promise=l)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./promise":59,"./utils":63}],59:[function(c,u,t){function n(a){if(!m(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof n))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=
[];l(a,this)}function l(b,d){function c(a){C(d,a)}function e(b){a(d,b)}try{b(c,e)}catch(h){e(h)}}function k(b,d,c,e){var h=m(c),f,g,k,l;if(h)try{f=c(e),k=!0}catch(n){l=!0,g=n}else f=e,k=!0;x(d,f)||(h&&k?C(d,f):l?a(d,g):b===y?C(d,f):b===B&&a(d,f))}function q(a,b,d,c){a=a._subscribers;var e=a.length;a[e]=b;a[e+y]=d;a[e+B]=c}function p(a,b){for(var d,c,e=a._subscribers,h=a._detail,f=0;f<e.length;f+=3)d=e[f],c=e[f+b],k(b,d,c,h);a._subscribers=null}function x(d,c){var e=null,h;try{if(d===c)throw new TypeError("A promises callback cannot return that same promise.");
if(z(c)&&(e=c.then,m(e)))return e.call(c,function(a){if(h)return!0;h=!0;c!==a?C(d,a):b(d,a)},function(b){if(h)return!0;h=!0;a(d,b)}),!0}catch(f){if(h)return!0;a(d,f);return!0}return!1}function C(a,d){a===d?b(a,d):x(a,d)||b(a,d)}function b(a,b){a._state===e&&(a._state=h,a._detail=b,v.async(g,a))}function a(a,b){a._state===e&&(a._state=h,a._detail=b,v.async(f,a))}function g(a){p(a,a._state=y)}function f(a){p(a,a._state=B)}var v=c("./config").config;c("./config");var z=c("./utils").objectOrFunction,
m=c("./utils").isFunction;c("./utils");u=c("./cast").cast;var F=c("./all").all,A=c("./race").race,T=c("./resolve").resolve,d=c("./reject").reject;c=c("./asap").asap;v.async=c;var e=void 0,h=0,y=1,B=2;n.prototype={constructor:n,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var d=this,c=new this.constructor(function(){});if(this._state){var e=arguments;v.async(function(){k(d._state,c,e[d._state-1],d._detail)})}else q(this,c,a,b);return c},"catch":function(a){return this.then(null,
a)}};n.all=F;n.cast=u;n.race=A;n.resolve=T;n.reject=d;t.Promise=n},{"./all":54,"./asap":55,"./cast":56,"./config":57,"./race":60,"./reject":61,"./resolve":62,"./utils":63}],60:[function(c,u,t){var n=c("./utils").isArray;t.race=function(c){if(!n(c))throw new TypeError("You must pass an array to race.");return new this(function(k,n){for(var p,t=0;t<c.length;t++)(p=c[t])&&"function"===typeof p.then?p.then(k,n):k(p)})}},{"./utils":63}],61:[function(c,u,t){t.reject=function(c){return new this(function(l,
k){k(c)})}},{}],62:[function(c,u,t){t.resolve=function(c){return new this(function(l,k){l(c)})}},{}],63:[function(c,u,t){function n(c){return"function"===typeof c}c=Date.now||function(){return(new Date).getTime()};t.objectOrFunction=function(c){return n(c)||"object"===typeof c&&null!==c};t.isFunction=n;t.isArray=function(c){return"[object Array]"===Object.prototype.toString.call(c)};t.now=c},{}],64:[function(c,u,t){function n(){}c=u.exports={};c.nextTick=function(){if("undefined"!==typeof window&&
window.setImmediate)return function(c){return window.setImmediate(c)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var c=[];window.addEventListener("message",function(k){var n=k.source;n!==window&&null!==n||"process-tick"!==k.data||(k.stopPropagation(),0<c.length&&c.shift()())},!0);return function(k){c.push(k);window.postMessage("process-tick","*")}}return function(c){setTimeout(c,0)}}();c.title="browser";c.browser=!0;c.env={};c.argv=[];c.on=n;c.addListener=n;c.once=
n;c.off=n;c.removeListener=n;c.removeAllListeners=n;c.emit=n;c.binding=function(c){throw Error("process.binding is not supported");};c.cwd=function(){return"/"};c.chdir=function(c){throw Error("process.chdir is not supported");}},{}],65:[function(c,u,t){function n(){}function l(){this.was=[0]}function k(a,b,c){this.hufts=new Int32Array(4320);this.window=new Uint8Array(c);this.end=c;this.checkfn=b;this.mode=0;this.reset(a,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);
this.tb=new Int32Array(1);this.codes=new q;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new p}function q(){}function p(){}function x(a,b,c,f,g){if(0!=g){if(!a)throw"Undef src";if(!c)throw"Undef dest";if(0==b&&g==a.length)c.set(a,f);else if(T)a=a.subarray(b,b+g),c.set(a,f);else if(1==a.BYTES_PER_ELEMENT&&100<g)a=new Uint8Array(a.buffer,a.byteOffset+b,g),c.set(a,f);else for(var k=0;k<g;++k)c[f+k]=a[b+k]}}function C(a,b,c,f){a=b?c?new Uint8Array(a,b,c):new Uint8Array(a,
b,a.byteLength-b):new Uint8Array(a);c=new n;c.inflateInit(15,!0);c.next_in=a;c.next_in_index=0;c.avail_in=a.length;a=[];for(var g=0;;){var k=new Uint8Array(32E3);c.next_out=k;c.next_out_index=0;c.avail_out=k.length;var l=c.inflate(0);if(0!=l&&1!=l&&-5!=l)throw c.msg;if(0!=c.avail_out){var m=new Uint8Array(k.length-c.avail_out);x(k,0,m,0,k.length-c.avail_out);k=m}a.push(k);g+=k.length;if(1==l||-5==l)break}f&&(f[0]=(b||0)+c.next_in_index);if(1==a.length)return a[0].buffer;b=new Uint8Array(g);for(c=
f=0;c<a.length;++c)g=a[c],x(g,0,b,f,g.length),f+=g.length;return b.buffer}var b=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],a=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,
8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,
0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,
154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,
0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,
7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,
0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,
8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],
g=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],v=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,
385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],m=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];n.prototype.inflateInit=function(a,b){a||(a=15);b&&(b=!1);this.istate=new l;return this.istate.inflateInit(this,b?-a:a)};n.prototype.inflate=function(a){return null==this.istate?-2:this.istate.inflate(this,a)};n.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);this.istate=null;return a};n.prototype.inflateSync=function(){return istate.inflateSync(this)};
n.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};l.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,null);return 0};l.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return 0};l.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),
-2;this.wbits=b;a.istate.blocks=new k(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return 0};l.prototype.inflate=function(a,b){var c,f;if(null==a||null==a.istate||null==a.next_in)return-2;b=4==b?-5:0;for(c=-5;;)switch(a.istate.mode){case 0:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;if(8!=((a.istate.method=a.next_in[a.next_in_index++])&15)){a.istate.mode=13;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=13;
a.msg="invalid window size";a.istate.marker=5;break}a.istate.mode=1;case 1:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;f=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+f)%31){a.istate.mode=13;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(f&32)){a.istate.mode=7;break}a.istate.mode=2;case 2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=3;case 3:if(0==a.avail_in)return c;
c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=4;case 4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=5;case 5:if(0==a.avail_in)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=6;return 2;case 6:return a.istate.mode=13,a.msg="need dictionary",a.istate.marker=0,-2;case 7:c=a.istate.blocks.proc(a,
c);if(-3==c){a.istate.mode=13;a.istate.marker=0;break}0==c&&(c=b);if(1!=c)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=12;break}a.istate.mode=8;case 8:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=9;case 9:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=10;case 10:if(0==a.avail_in)return c;
c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=11;case 11:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=13;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=12;case 12:return 1;case 13:return-3;default:return-2}};l.prototype.inflateSetDictionary=function(a,b,c){var f=0,g=c;if(null==a||null==a.istate||6!=a.istate.mode)return-2;
if(a._adler.adler32(1,b,0,c)!=a.adler)return-3;a.adler=a._adler.adler32(0,null,0,0);g>=1<<a.istate.wbits&&(g=(1<<a.istate.wbits)-1,f=c-g);a.istate.blocks.set_dictionary(b,f,g);a.istate.mode=7;return 0};var F=[0,0,255,255];l.prototype.inflateSync=function(a){var b,c,f;if(null==a||null==a.istate)return-2;13!=a.istate.mode&&(a.istate.mode=13,a.istate.marker=0);if(0==(b=a.avail_in))return-5;c=a.next_in_index;for(f=a.istate.marker;0!=b&&4>f;)a.next_in[c]==F[f]?f++:f=0!=a.next_in[c]?0:4-f,c++,b--;a.total_in+=
c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=f;if(4!=f)return-3;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=7;return 0};l.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};var A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];k.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&this.codes.free(a);this.read=this.write=this.bitb=this.bitk=this.mode=
0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};k.prototype.proc=function(c,e){var h,f,k,l,m,n,p;l=c.next_in_index;m=c.avail_in;f=this.bitb;k=this.bitk;n=this.write;for(p=n<this.read?this.read-n-1:this.end-n;;)switch(this.mode){case 0:for(;3>k;){if(0!=m)e=0;else return this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e);m--;f|=(c.next_in[l++]&255)<<k;k+=8}h=f&7;this.last=h&1;switch(h>>>1){case 0:f>>>=3;k-=3;h=
k&7;f>>>=h;k-=h;this.mode=1;break;case 1:var q=new Int32Array(1),t=new Int32Array(1),v=[],u=[];h=t;var z=v,C=u;q[0]=9;h[0]=5;z[0]=a;C[0]=g;this.codes.init(q[0],t[0],v[0],0,u[0],0,c);f>>>=3;k-=3;this.mode=6;break;case 2:f>>>=3;k-=3;this.mode=3;break;case 3:return f>>>=3,k-=3,this.mode=13,c.msg="invalid block type",e=-3,this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e)}break;case 1:for(;32>k;){if(0!=m)e=0;else return this.bitb=
f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e);m--;f|=(c.next_in[l++]&255)<<k;k+=8}if((~f>>>16&65535)!=(f&65535))return this.mode=13,c.msg="invalid stored block lengths",e=-3,this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e);this.left=f&65535;f=k=0;this.mode=0!=this.left?2:0!=this.last?7:0;break;case 2:if(0==m)return this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=
l-c.next_in_index,c.next_in_index=l,write=n,this.inflate_flush(c,e);if(0==p&&(n==end&&0!=read&&(n=0,p=n<this.read?this.read-n-1:this.end-n),0==p&&(this.write=n,e=this.inflate_flush(c,e),n=this.write,p=n<this.read?this.read-n-1:this.end-n,n==this.end&&0!=this.read&&(n=0,p=n<this.read?this.read-n-1:this.end-n),0==p)))return this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e);e=0;h=this.left;h>m&&(h=m);h>p&&(h=p);x(c.next_in,l,this.window,
n,h);l+=h;m-=h;n+=h;p-=h;if(0!=(this.left-=h))break;this.mode=0!=this.last?7:0;break;case 3:for(;14>k;){if(0!=m)e=0;else return this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e);m--;f|=(c.next_in[l++]&255)<<k;k+=8}this.table=h=f&16383;if(29<(h&31)||29<(h>>5&31))return this.mode=9,c.msg="too many length or distance symbols",e=-3,this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,
e);h=258+(h&31)+(h>>5&31);if(null==this.blens||this.blens.length<h)this.blens=new Int32Array(h);else for(p=0;p<h;p++)this.blens[p]=0;f>>>=14;k-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>k;){if(0!=m)e=0;else return this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e);m--;f|=(c.next_in[l++]&255)<<k;k+=8}this.blens[A[this.index++]]=f&7;f>>>=3;k-=3}for(;19>this.index;)this.blens[A[this.index++]]=0;this.bb[0]=
7;h=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,c);if(0!=h)return e=h,-3==e&&(this.blens=null,this.mode=9),this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,write=n,this.inflate_flush(c,e);this.index=0;this.mode=5;case 5:for(;;){h=this.table;if(!(this.index<258+(h&31)+(h>>5&31)))break;for(h=this.bb[0];k<h;){if(0!=m)e=0;else return this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,
e);m--;f|=(c.next_in[l++]&255)<<k;k+=8}h=this.hufts[3*(this.tb[0]+(f&b[h]))+1];t=this.hufts[3*(this.tb[0]+(f&b[h]))+2];if(16>t)f>>>=h,k-=h,this.blens[this.index++]=t;else{p=18==t?7:t-14;for(q=18==t?11:3;k<h+p;){if(0!=m)e=0;else return this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e);m--;f|=(c.next_in[l++]&255)<<k;k+=8}f>>>=h;k-=h;q+=f&b[p];f>>>=p;k-=p;p=this.index;h=this.table;if(p+q>258+(h&31)+(h>>5&31)||16==t&&1>p)return this.blens=
null,this.mode=9,c.msg="invalid bit length repeat",e=-3,this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e);t=16==t?this.blens[p-1]:0;do this.blens[p++]=t;while(0!=--q);this.index=p}}this.tb[0]=-1;q=new Int32Array(1);t=new Int32Array(1);v=new Int32Array(1);u=new Int32Array(1);q[0]=9;t[0]=6;h=this.table;h=this.inftree.inflate_trees_dynamic(257+(h&31),1+(h>>5&31),this.blens,q,t,v,u,this.hufts,c);if(0!=h)return-3==h&&(this.blens=null,
this.mode=13),e=h,this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e);this.codes.init(q[0],t[0],this.hufts,v[0],this.hufts,u[0],c);this.mode=6;case 6:this.bitb=f;this.bitk=k;c.avail_in=m;c.total_in+=l-c.next_in_index;c.next_in_index=l;this.write=n;if(1!=(e=this.codes.proc(this,c,e)))return this.inflate_flush(c,e);e=0;this.codes.free(c);l=c.next_in_index;m=c.avail_in;f=this.bitb;k=this.bitk;n=this.write;p=n<this.read?this.read-n-
1:this.end-n;if(0==this.last){this.mode=0;break}this.mode=7;case 7:this.write=n;e=this.inflate_flush(c,e);n=this.write;if(this.read!=this.write)return this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e);mode=12;case 8:return e=1,this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e);case 9:return e=-3,this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,
c.next_in_index=l,this.write=n,this.inflate_flush(c,e);default:return e=-2,this.bitb=f,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,e)}};k.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};k.prototype.set_dictionary=function(a,b,c){x(a,b,window,0,c);this.read=this.write=c};k.prototype.sync_point=function(){return 1==this.mode};k.prototype.inflate_flush=function(a,b){var c,f,g;f=a.next_out_index;g=this.read;c=(g<=
this.write?this.write:this.end)-g;c>a.avail_out&&(c=a.avail_out);0!=c&&-5==b&&(b=0);a.avail_out-=c;a.total_out+=c;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,g,c));x(this.window,g,a.next_out,f,c);f+=c;g+=c;g==this.end&&(g=0,this.write==this.end&&(this.write=0),c=this.write-g,c>a.avail_out&&(c=a.avail_out),0!=c&&-5==b&&(b=0),a.avail_out-=c,a.total_out+=c,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,g,c)),x(this.window,g,a.next_out,
f,c),f+=c,g+=c);a.next_out_index=f;this.read=g;return b};q.prototype.init=function(a,b,c,f,g,k,l){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=f;this.dtree=g;this.dtree_index=k;this.tree=null};q.prototype.proc=function(a,c,f){var g,k,l=0,m=0,n=0,p,q,t,n=c.next_in_index;p=c.avail_in;l=a.bitb;m=a.bitk;q=a.write;for(t=q<a.read?a.read-q-1:a.end-q;;)switch(this.mode){case 0:if(258<=t&&10<=p&&(a.bitb=l,a.bitk=m,c.avail_in=p,c.total_in+=n-c.next_in_index,c.next_in_index=n,a.write=
q,f=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,c),n=c.next_in_index,p=c.avail_in,l=a.bitb,m=a.bitk,q=a.write,t=q<a.read?a.read-q-1:a.end-q,0!=f)){this.mode=1==f?7:9;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=1;case 1:for(g=this.need;m<g;){if(0!=p)f=0;else return a.bitb=l,a.bitk=m,c.avail_in=p,c.total_in+=n-c.next_in_index,c.next_in_index=n,a.write=q,a.inflate_flush(c,f);p--;l|=(c.next_in[n++]&255)<<
m;m+=8}g=3*(this.tree_index+(l&b[g]));l>>>=this.tree[g+1];m-=this.tree[g+1];k=this.tree[g];if(0==k){this.lit=this.tree[g+2];this.mode=6;break}if(0!=(k&16)){this.get=k&15;this.len=this.tree[g+2];this.mode=2;break}if(0==(k&64)){this.need=k;this.tree_index=g/3+this.tree[g+2];break}if(0!=(k&32)){this.mode=7;break}this.mode=9;c.msg="invalid literal/length code";f=-3;a.bitb=l;a.bitk=m;c.avail_in=p;c.total_in+=n-c.next_in_index;c.next_in_index=n;a.write=q;return a.inflate_flush(c,f);case 2:for(g=this.get;m<
g;){if(0!=p)f=0;else return a.bitb=l,a.bitk=m,c.avail_in=p,c.total_in+=n-c.next_in_index,c.next_in_index=n,a.write=q,a.inflate_flush(c,f);p--;l|=(c.next_in[n++]&255)<<m;m+=8}this.len+=l&b[g];l>>=g;m-=g;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=3;case 3:for(g=this.need;m<g;){if(0!=p)f=0;else return a.bitb=l,a.bitk=m,c.avail_in=p,c.total_in+=n-c.next_in_index,c.next_in_index=n,a.write=q,a.inflate_flush(c,f);p--;l|=(c.next_in[n++]&255)<<m;m+=8}g=3*(this.tree_index+
(l&b[g]));l>>=this.tree[g+1];m-=this.tree[g+1];k=this.tree[g];if(0!=(k&16)){this.get=k&15;this.dist=this.tree[g+2];this.mode=4;break}if(0==(k&64)){this.need=k;this.tree_index=g/3+this.tree[g+2];break}this.mode=9;c.msg="invalid distance code";f=-3;a.bitb=l;a.bitk=m;c.avail_in=p;c.total_in+=n-c.next_in_index;c.next_in_index=n;a.write=q;return a.inflate_flush(c,f);case 4:for(g=this.get;m<g;){if(0!=p)f=0;else return a.bitb=l,a.bitk=m,c.avail_in=p,c.total_in+=n-c.next_in_index,c.next_in_index=n,a.write=
q,a.inflate_flush(c,f);p--;l|=(c.next_in[n++]&255)<<m;m+=8}this.dist+=l&b[g];l>>=g;m-=g;this.mode=5;case 5:for(g=q-this.dist;0>g;)g+=a.end;for(;0!=this.len;){if(0==t&&(q==a.end&&0!=a.read&&(q=0,t=q<a.read?a.read-q-1:a.end-q),0==t&&(a.write=q,f=a.inflate_flush(c,f),q=a.write,t=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,t=q<a.read?a.read-q-1:a.end-q),0==t)))return a.bitb=l,a.bitk=m,c.avail_in=p,c.total_in+=n-c.next_in_index,c.next_in_index=n,a.write=q,a.inflate_flush(c,f);a.window[q++]=a.window[g++];
t--;g==a.end&&(g=0);this.len--}this.mode=0;break;case 6:if(0==t&&(q==a.end&&0!=a.read&&(q=0,t=q<a.read?a.read-q-1:a.end-q),0==t&&(a.write=q,f=a.inflate_flush(c,f),q=a.write,t=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,t=q<a.read?a.read-q-1:a.end-q),0==t)))return a.bitb=l,a.bitk=m,c.avail_in=p,c.total_in+=n-c.next_in_index,c.next_in_index=n,a.write=q,a.inflate_flush(c,f);f=0;a.window[q++]=this.lit;t--;this.mode=0;break;case 7:7<m&&(m-=8,p++,n--);a.write=q;f=a.inflate_flush(c,f);q=a.write;
if(a.read!=a.write)return a.bitb=l,a.bitk=m,c.avail_in=p,c.total_in+=n-c.next_in_index,c.next_in_index=n,a.write=q,a.inflate_flush(c,f);this.mode=8;case 8:return f=1,a.bitb=l,a.bitk=m,c.avail_in=p,c.total_in+=n-c.next_in_index,c.next_in_index=n,a.write=q,a.inflate_flush(c,f);case 9:return f=-3,a.bitb=l,a.bitk=m,c.avail_in=p,c.total_in+=n-c.next_in_index,c.next_in_index=n,a.write=q,a.inflate_flush(c,f);default:return f=-2,a.bitb=l,a.bitk=m,c.avail_in=p,c.total_in+=n-c.next_in_index,c.next_in_index=
n,a.write=q,a.inflate_flush(c,f)}};q.prototype.free=function(a){};q.prototype.inflate_fast=function(a,c,f,g,k,l,m,n){var p,q,t,v,u,z,A,w,C,F,K,L;z=n.next_in_index;A=n.avail_in;v=m.bitb;u=m.bitk;w=m.write;C=w<m.read?m.read-w-1:m.end-w;a=b[a];F=b[c];do{for(;20>u;)A--,v|=(n.next_in[z++]&255)<<u,u+=8;p=v&a;q=f;t=g;L=3*(t+p);if(0==(c=q[L]))v>>=q[L+1],u-=q[L+1],m.window[w++]=q[L+2],C--;else{do{v>>=q[L+1];u-=q[L+1];if(0!=(c&16)){c&=15;K=q[L+2]+(v&b[c]);v>>=c;for(u-=c;15>u;)A--,v|=(n.next_in[z++]&255)<<u,
u+=8;p=v&F;q=k;t=l;L=3*(t+p);c=q[L];do if(v>>=q[L+1],u-=q[L+1],0!=(c&16)){for(c&=15;u<c;)A--,v|=(n.next_in[z++]&255)<<u,u+=8;p=q[L+2]+(v&b[c]);v>>=c;u-=c;C-=K;if(w>=p)p=w-p,m.window[w++]=m.window[p++],m.window[w++]=m.window[p++],K-=2;else{p=w-p;do p+=m.end;while(0>p);c=m.end-p;if(K>c){K-=c;if(0<w-p&&c>w-p){do m.window[w++]=m.window[p++];while(0!=--c)}else x(m.window,p,m.window,w,c),w+=c;p=0}}do m.window[w++]=m.window[p++];while(0!=--K);break}else if(0==(c&64))p+=q[L+2],p+=v&b[c],L=3*(t+p),c=q[L];
else return n.msg="invalid distance code",K=n.avail_in-A,K=u>>3<K?u>>3:K,A+=K,z-=K,u-=K<<3,m.bitb=v,m.bitk=u,n.avail_in=A,n.total_in+=z-n.next_in_index,n.next_in_index=z,m.write=w,-3;while(1);break}if(0==(c&64)){if(p+=q[L+2],p+=v&b[c],L=3*(t+p),0==(c=q[L])){v>>=q[L+1];u-=q[L+1];m.window[w++]=q[L+2];C--;break}}else{if(0!=(c&32))return K=n.avail_in-A,K=u>>3<K?u>>3:K,A+=K,z-=K,u-=K<<3,m.bitb=v,m.bitk=u,n.avail_in=A,n.total_in+=z-n.next_in_index,n.next_in_index=z,m.write=w,1;n.msg="invalid literal/length code";
K=n.avail_in-A;K=u>>3<K?u>>3:K;A+=K;z-=K;u-=K<<3;m.bitb=v;m.bitk=u;n.avail_in=A;n.total_in+=z-n.next_in_index;n.next_in_index=z;m.write=w;return-3}}while(1)}}while(258<=C&&10<=A);K=n.avail_in-A;K=u>>3<K?u>>3:K;z-=K;m.bitb=v;m.bitk=u-(K<<3);n.avail_in=A+K;n.total_in+=z-n.next_in_index;n.next_in_index=z;m.write=w;return 0};p.prototype.huft_build=function(a,b,c,f,g,k,l,m,n,p,q){var t,v,u,z,w,A,C,F,L;A=0;v=c;do this.c[a[b+A]]++,A++,v--;while(0!=v);if(this.c[0]==c)return l[0]=-1,m[0]=0;w=m[0];for(u=1;15>=
u&&0==this.c[u];u++);z=u;w<u&&(w=u);for(v=15;0!=v&&0==this.c[v];v--);p=v;w>v&&(w=v);m[0]=w;for(m=1<<u;u<v;u++,m<<=1)if(0>(m-=this.c[u]))return-3;if(0>(m-=this.c[v]))return-3;this.c[v]+=m;this.x[1]=u=0;A=1;for(C=2;0!=--v;)this.x[C]=u+=this.c[A],C++,A++;A=v=0;do 0!=(u=a[b+A])&&(this.v[this.x[u]++]=v),A++;while(++v<c);c=this.x[p];A=this.x[0]=v=0;b=-1;F=-w;for(L=C=this.u[0]=0;z<=p;z++)for(a=this.c[z];0!=a--;){for(;z>F+w;){b++;F+=w;L=p-F;L=L>w?w:L;if((t=1<<(u=z-F))>a+1&&(t-=a+1,C=z,u<L))for(;++u<L&&!((t<<=
1)<=this.c[++C]);)t-=this.c[C];L=1<<u;if(1440<this.hn[0]+L)return-3;this.u[b]=C=this.hn[0];this.hn[0]+=L;0!=b?(this.x[b]=v,this.r[0]=u,this.r[1]=w,u=v>>>F-w,this.r[2]=C-this.u[b-1]-u,x(this.r,0,n,3*(this.u[b-1]+u),3)):l[0]=C}this.r[1]=z-F;A>=c?this.r[0]=192:q[A]<f?(this.r[0]=256>this.v[A]?0:96,this.r[2]=this.v[A++]):(this.r[0]=k[this.v[A]-f]+16+64,this.r[2]=g[this.v[A++]-f]);t=1<<z-F;for(u=v>>>F;u<L;u+=t)x(this.r,0,n,3*(C+u),3);for(u=1<<z-1;0!=(v&u);u>>>=1)v^=u;v^=u;for(u=(1<<F)-1;(v&u)!=this.x[b];)b--,
F-=w,u=(1<<F)-1}return 0!=m&&1!=p?-5:0};p.prototype.inflate_trees_bits=function(a,b,c,f,g){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,f,this.hn,this.v);if(-3==a)g.msg="oversubscribed dynamic bit lengths tree";else if(-5==a||0==b[0])g.msg="incomplete dynamic bit lengths tree",a=-3;return a};p.prototype.inflate_trees_dynamic=function(a,b,c,g,k,l,n,p,q){this.initWorkArea(288);this.hn[0]=0;l=this.huft_build(c,0,a,257,f,v,l,g,p,this.hn,this.v);if(0!=l||0==g[0])return-3==
l?q.msg="oversubscribed literal/length tree":-4!=l&&(q.msg="incomplete literal/length tree",l=-3),l;this.initWorkArea(288);l=this.huft_build(c,a,b,0,z,m,n,k,p,this.hn,this.v);return 0!=l||0==k[0]&&257<a?(-3==l?q.msg="oversubscribed distance tree":-5==l?(q.msg="incomplete distance tree",l=-3):-4!=l&&(q.msg="empty distance tree with lengths",l=-3),l):0};p.prototype.initWorkArea=function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),this.c=new Int32Array(16),this.r=new Int32Array(3),
this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;x(this.c,0,this.u,0,15);x(this.c,0,this.x,0,16)};var T="function"===typeof(new Uint8Array(1)).subarray;"undefined"!==typeof u&&(u.exports={inflateBuffer:C,arrayCopy:x})},{}]},{},[17]);
