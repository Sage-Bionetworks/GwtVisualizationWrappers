(function e$$0(v,t,m){function l(r,q){if(!t[r]){if(!v[r]){var C="function"==typeof require&&require;if(!q&&C)return C(r,!0);if(g)return g(r,!0);throw Error("Cannot find module '"+r+"'");}C=t[r]={exports:{}};v[r][0].call(C.exports,function(b){var a=v[r][1][b];return l(a?a:b)},C,C.exports,e$$0,v,t,m)}return t[r].exports}for(var g="function"==typeof require&&require,q=0;q<m.length;q++)l(m[q]);return l})({1:[function(d,v,t){function m(){}function l(a,b,c,h,f){a.slice(0,10).fetch(function(p){return p?
g(a,b,c,h,f):h(null,"Couldn't access BAM.")},{timeout:5E3})}function g(b,f,p,F,n){function H(e){if(!e)return F(null,"Couldn't access BAM");e=c(e,e.byteLength);e=new Uint8Array(e);var a=r(e,0);if(a!=s)return F(null,"Not a BAM file, magic=0x"+a.toString(16));for(var b=r(e,4),h="",a=0;a<b;++a)h+=String.fromCharCode(e[a+8]);h=r(e,b+8);b+=12;u.chrToIndex={};u.indexToChr=[];for(a=0;a<h;++a){for(var f=r(e,b),y="",E=0;E<f-1;++E)y+=String.fromCharCode(e[b+4+E]);r(e,b+f+4);u.chrToIndex[y]=a;0==y.indexOf("chr")?
u.chrToIndex[y.substring(3)]=a:u.chrToIndex["chr"+y]=a;u.indexToChr.push(y);b=b+8+f}if(u.indices)return F(u)}var u=new m;u.data=b;u.bai=f;u.indexChunks=p;var K=u.indexChunks?u.indexChunks.minBlockIndex:1E9;if(u.indexChunks){f=u.indexChunks.chunks;u.indices=[];for(var e=0;e<f.length;e++)u.indices[e]=null;u.data.slice(0,K).fetch(H)}else u.bai.fetch(function(e){var c,f,D;if(e){var s=new Uint8Array(e),y=r(s,0);if(y!=h)e=F(null,"Not a BAI file, magic=0x"+y.toString(16));else{y=r(s,4);u.indices=[];for(var E=
8,k=0;k<y;++k){var I=E;c=s;var J=D=I;f=r(c,J);for(var J=J+4,Q=0;Q<f;++Q){r(c,J);var L=r(c,J+4),J=J+(8+16*L)}for(var Q=r(c,J),J=J+4,L=1E9,Y=J,d=0;d<Q;++d){var C=a(c,Y),Y=Y+8;if(C){c=C.block;0<C.offset&&(c+=65536);c<L&&(L=c);break}}J+=8*Q;c=L;D=J-D;E+=D;K=Math.min(c,K);0<f&&(u.indices[k]=new Uint8Array(e,I,E-I))}e=!0}}else e="Couldn't access BAI";!0!==e?u.bai.url&&"undefined"===typeof n?(u.bai.url=u.data.url.replace(/.bam$/,".bai"),g(b,u.bai,p,F,!0)):F(null,e):u.data.slice(0,K).fetch(H)})}function q(){}
if("undefined"!==typeof d){d("./spans");t=d("./bin");var r=t.readInt,x=t.readShort,C=t.readByte,b=t.readFloat;d=d("./lh3utils");var a=d.readVob,c=d.unbgzf,f=d.reg2bins,n=d.Chunk}var s=21840194,h=21578050;d={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};m.prototype.blocksForRange=function(b,c,h){var p=this.indices[b];
if(!p)return[];b=f(c,h);for(var F=[],s=0;s<b.length;++s)F[b[s]]=!0;b=[];for(var u=[],s=r(p,0),K=4,e=0;e<s;++e){var z=r(p,K),A=r(p,K+4),K=K+8;if(F[z])for(var N=0;N<A;++N){var g=a(p,K),d=a(p,K+8);(4681>z?u:b).push(new n(g,d));K+=16}else K+=16*A}s=r(p,K);F=null;c=Math.min(c>>14,s-1);h=Math.min(h>>14,s-1);for(s=c;s<=h;++s)(c=a(p,K+4+8*s))&&(!F||c.block<F.block||c.offset<F.offset)&&(F=c);p=[];if(null!=F)for(s=0;s<u.length;++s)h=u[s],h.maxv.block>=F.block&&h.maxv.offset>=F.offset&&p.push(h);u=p;p=[];for(s=
0;s<u.length;++s)p.push(u[s]);for(s=0;s<b.length;++s)p.push(b[s]);p.sort(function(e,a){var k=e.minv.block-a.minv.block;return 0!=k?k:e.minv.offset-a.minv.offset});b=[];if(0<p.length){u=p[0];for(s=1;s<p.length;++s)h=p[s],h.minv.block==u.maxv.block?u=new n(u.minv,h.maxv):(b.push(u),u=h);b.push(u)}return b};m.prototype.fetch=function(a,b,h,f,p){function F(){if(s>=e.length)return f(A);if(n){var a=new Uint8Array(n),a=u.readBamRecords(a,e[s].minv.offset,A,b,h,K,p);n=null;++s;return a?f(A):F()}var y=e[s],
a=y.minv.block;u.data.slice(a,y.maxv.block+65536-a).fetch(function(e){n=c(e,y.maxv.block-y.minv.block+1);return F()})}var u=this;p=p||{};var K=this.chrToIndex[a],e;if(void 0===K)e=[];else{if(null===this.indices[K]&&this.indexChunks.chunks[K]){var z=this.indexChunks.chunks[K];return this.bai.slice(z[0],z[1]).fetch(function(e){e=new Uint8Array(e);this.indices[K]=e;return this.fetch(a,b,h,f,p)}.bind(this))}(e=this.blocksForRange(K,b,h))||f(null,"Error in index fetch")}var A=[],s=0,n;F()};var p="=ACxGxxxTxxxxxxN".split(""),
F="MIDNSHP=X???????".split("");m.prototype.readBamRecords=function(a,c,h,f,s,n,u){for(;;){var K=r(a,c),K=c+K+4;if(K>=a.length)return!1;var e=new q,z=r(a,c+4),A=r(a,c+8),N=r(a,c+12),g=(N&65280)>>8,d=N&255,N=r(a,c+16),y=(N&4294901760)>>16,E=N&65535,N=r(a,c+20),k=r(a,c+24),I=r(a,c+28);r(a,c+32);e.segment=this.indexToChr[z];e.flag=y;e.pos=A;e.mq=g;u.light&&(e.seqLength=N);if(!u.light){0<=k&&(e.nextSegment=this.indexToChr[k],e.nextPos=I);g="";for(A=0;A<d-1;++A)g+=String.fromCharCode(a[c+36+A]);e.readName=
g;c=c+36+d;d="";for(A=0;A<E;++A)g=r(a,c),d=d+(g>>4)+F[g&15],c+=4;e.cigar=d;E="";d=N+1>>1;for(A=0;A<d;++A)g=a[c+A],E+=p[(g&240)>>4],E.length<N&&(E+=p[g&15]);c+=d;e.seq=E;E="";for(A=0;A<N;++A)E+=String.fromCharCode(a[c+A]+33);c+=N;for(e.quals=E;c<K;){E=String.fromCharCode(a[c],a[c+1]);d=String.fromCharCode(a[c+2]);if("A"==d)d=String.fromCharCode(a[c+3]),c+=4;else if("i"==d||"I"==d)d=r(a,c+3),c+=7;else if("c"==d||"C"==d)d=a[c+3],c+=4;else if("s"==d||"S"==d)d=x(a,c+3),c+=5;else if("f"==d)d=b(a,c+3),c+=
7;else if("Z"==d||"H"==d)for(c+=3,d="";A=a[c++],0!=A;)d+=String.fromCharCode(A);else if("B"==d){d=String.fromCharCode(a[c+3]);A=r(a,c+4);if("i"==d||"I"==d||"f"==d)g=4,y="f"==d?b:r;else if("s"==d||"S"==d)g=2,y=x;else if("c"==d||"C"==d)g=1,y=C;else throw"Unknown array type "+d;c+=8;d=[];for(k=0;k<A;++k)d.push(y(a,c)),c+=g}else throw"Unknown type "+d;e[E]=d}}if(!f||e.pos<=s&&e.pos+N>=f)void 0!==n&&z!=n||h.push(e);if(e.pos>s)return!0;c=K}};"undefined"!==typeof v&&(v.exports={makeBam:l,BAM_MAGIC:s,BAI_MAGIC:h,
BamFlags:d})},{"./bin":4,"./lh3utils":24,"./spans":36}],2:[function(d,v,t){function m(a){this.type=a}function l(a,c){this.parser=a;this.sink=c}function g(a,c){this.parser=a;this.sink=c;this.wigState=null}if("undefined"!==typeof d){var q=d("./spans"),r=q.Range,x=q.union,C=q.intersection,q=d("./sourceadapters").registerParserFactory;v=d("./das");var b=v.DASStylesheet,a=v.DASStyle,c=v.DASGroup,f=d("./utils").shallowCopy}m.prototype.createSession=function(a){return"wig"==this.type?new g(this,a):new l(this,
a)};var n=/([^=]+)=(.+)/,s=/\s/,h=/^[0-9]+,[0-9]+,[0-9]+/;l.prototype.parse=function(a){var b=a.split(s);if(!(3>b.length)){var n=parseInt(b[1])+1;a=parseInt(b[2]);a={segment:b[0],min:n,max:a};3<b.length&&"."!==b[3]&&(a.label=b[3]);4<b.length&&(a.score=parseFloat(b[4]));5<b.length&&(a.orientation=b[5]);if(8<b.length){var d=b[8];h.test(d)&&(a.itemRgb="rgb("+d+")")}if(12<=b.length){var d=parseInt(b[6]),w=parseInt(b[7]),g=parseInt(b[9]),B=b[10].split(",").map(function(e){return parseInt(e)}),q=b[11].split(",").map(function(e){return parseInt(e)});
a.type="transcript";var u=new c;u.id=b[3];u.type="transcript";u.notes=[];a.groups=[u];if(12<b.length){var K=u=b[12];13<b.length&&(K=b[13]);b=new c;b.id=u;b.label=K;b.type="gene";a.groups.push(b)}b=null;for(u=0;u<g;++u)K=q[u]+n,K=new r(K,K+B[u]),b=b?x(b,K):K;q=b.ranges();for(n=0;n<q.length;++n)B=q[n],g=f(a),g.min=B.min(),g.max=B.max(),this.sink(g);if(w>d&&(d="+"==a.orientation?new r(d,w+3):new r(d-3,w),d=C(b,d)))for(a.type="translation",d=d.ranges(),n=w=0;n<d.length;++n)g=n,"-"==a.orientation&&(g=
d.length-n-1),B=d[g],g=f(a),g.min=B.min(),g.max=B.max(),a.readframe=w,B=B.max()-B.min(),w=(w+B)%3,this.sink(g)}else this.sink(a)}};l.prototype.flush=function(){};g.prototype.parse=function(a){a=a.split(s);if("fixedStep"==a[0]){this.wigState="fixedStep";this.chr=this.pos=this.step=null;for(var c=this.span=1;c<a.length;++c){var b=n.exec(a[c]);b&&("chrom"==b[1]?this.chr=b[2]:"start"==b[1]?this.pos=parseInt(b[2]):"step"==b[1]?this.step=parseInt(b[2]):"span"==b[1]&&(this.span=parseInt(b[2])))}}else if("variableStep"==
a[0])for(this.wigState="variableStep",this.chr=null,c=this.span=1;c<a.length;++c)b=n.exec(a[c]),"chrom"==b[1]?this.chr=b[2]:"span"==b[1]&&(this.span=parseInt(b[2]));else this.wigState?"fixedStep"==this.wigState?1==a.length&&(a=parseFloat(a[0]),a={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:a},this.pos+=this.step,this.sink(a)):"variableStep"==this.wigState&&2==a.length&&(c=parseInt(a[0]),a=parseFloat(a[1]),a={segment:this.chr,min:c,max:c+this.span-1,score:a},this.sink(a)):4>a.length||
(a={segment:a[0],min:parseInt(a[1])+1,max:parseInt(a[2]),score:parseFloat(a[3])},this.sink(a))};g.prototype.flush=function(){};m.prototype.getStyleSheet=function(c){var h=new b;if("wig"==this.type){var f=new a;f.glyph="HISTOGRAM";f.BGCOLOR="blue";f.HEIGHT=30;h.pushStyle({type:"default"},null,f)}else f=new a,f.glyph="BOX",f.FGCOLOR="black",f.BGCOLOR="blue",f.HEIGHT=8,f.BUMP=!0,f.LABEL=!0,f.ZINDEX=20,h.pushStyle({type:"default"},null,f),f=new a,f.glyph="BOX",f.FGCOLOR="black",f.BGCOLOR="red",f.HEIGHT=
10,f.BUMP=!0,f.ZINDEX=20,h.pushStyle({type:"translation"},null,f),f=new a,f.glyph="BOX",f.FGCOLOR="black",f.BGCOLOR="white",f.HEIGHT=10,f.ZINDEX=10,f.BUMP=!0,f.LABEL=!0,h.pushStyle({type:"transcript"},null,f),f=new a,f.glyph="HISTOGRAM",f.COLOR1="white",f.COLOR2="black",f.HEIGHT=30,h.pushStyle({type:"density"},null,f);return c(h)};q("bed",function(a){return new m(a)});q("wig",function(a){return new m(a)})},{"./das":10,"./sourceadapters":34,"./spans":36,"./utils":49}],3:[function(d,v,t){function m(a,
e){return a[e]+a[e+1]*w+a[e+2]*G+a[e+3]*B+a[e+4]*H}function l(){}function g(a,e,c,b){this.bwg=a;this.cirTreeOffset=e;this.cirTreeLength=c;this.isSummary=b}function q(a,e,c){var b=new l;b.data=a;b.name=c;b.data.slice(0,512).salted().fetch(function(a){if(!a)return e(null,"Couldn't fetch file");var c=new Uint8Array(a),f=new Int16Array(a);a=new Int32Array(a);var y=c[0]+w*c[1]+G*c[2]+B*c[3];if(y==p)b.type="bigwig";else if(y==S)b.type="bigbed";else return y==F||y==D?e(null,"Currently don't support big-endian BBI files"):
e(null,"Not a supported format, magic=0x"+y.toString(16));b.version=f[2];b.numZoomLevels=f[3];b.chromTreeOffset=m(c,8);b.unzoomedDataOffset=m(c,16);b.unzoomedIndexOffset=m(c,24);b.fieldCount=f[16];b.definedFieldCount=f[17];b.asOffset=m(c,36);b.totalSummaryOffset=m(c,44);b.uncompressBufSize=a[13];b.extHeaderOffset=m(c,56);b.zoomLevels=[];for(f=0;f<b.numZoomLevels;++f){var y=a[6*f+16],E=m(c,24*f+72),k=m(c,24*f+80);b.zoomLevels.push({reduction:y,dataOffset:E,indexOffset:k})}b.readChromTree(function(){b.getAutoSQL(function(k){b.schema=
k;return e(b)})})},{timeout:5E3})}function r(a,e,b,c,f){this.bbi=a;this.type=e;this.fieldCount=b;this.offset=c;this.field=f}if("undefined"!==typeof d){t=d("./spans");var x=t.Range,C=t.union,b=t.intersection;t=d("./das");var a=t.DASFeature,c=t.DASGroup,f=d("./utils").shallowCopy,n=d("./bin").readInt;d=d("jszlib");var s=d.inflateBuffer,h=d.arrayCopy}var p=2291137574,F=654086024,S=2273964779,D=3958540679,w=256,G=65536,B=16777216,H=4294967296,u=/^[0-9]+,[0-9]+,[0-9]+/;l.prototype.readChromTree=function(a){var e=
this;this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var b=this.unzoomedDataOffset,b=b+4-(b-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,b-this.chromTreeOffset).fetch(function(b){var c=new Uint8Array(b),f=new Int16Array(b),h=(new Int32Array(b))[2];m(c,16);var y=function(a){var k=c[a],b=f[a/2+1];a+=4;for(var z=0;z<b;++z)if(0==k){a+=h;var A=m(c,a);a+=8;A-=e.chromTreeOffset;y(A)}else{for(var A="",L=0;L<h;++L){var u=c[a++];0!=u&&(A+=String.fromCharCode(u))}L=c[a+3]<<24|c[a+2]<<16|
c[a+1]<<8|c[a+0];a+=8;e.chromsToIDs[A]=L;0==A.indexOf("chr")&&(e.chromsToIDs[A.substr(3)]=L);e.idsToChroms[L]=A;e.maxID=Math.max(e.maxID,L)}};y(32);a(e)})};g.prototype.readWigData=function(a,e,b,c){a=this.bwg.chromsToIDs[a];if(void 0===a)return c([]);this.readWigDataById(a,e,b,c)};g.prototype.readWigDataById=function(a,e,b,c){var f=this;if(this.cirHeader){var h=[],u=0;Date.now();var y=function(k,y,c,I){return(0>a||k==a)&&y<=b&&c>=e},E=function(e,a){f.bwg.instrument&&console.log("level="+a+"; offset="+
e+"; time="+(Date.now()|0));u+=e.length;if(1==e.length&&48==e[0]-f.cirTreeOffset&&f.cachedCirRoot)I(f.cachedCirRoot,0,a),--u,0==u&&f.fetchFeatures(y,h,c);else{for(var b=4+32*f.cirBlockSize,E,z=0;z<e.length;++z){var n=new x(e[z],e[z]+b);E=E?C(E,n):n}b=E.ranges();for(E=0;E<b.length;++E)k(e,b[E],a)}},k=function(k,e,a,b){e.max();e.min();f.bwg.data.slice(e.min(),e.max()-e.min()).fetch(function(b){for(var E=0;E<k.length;++E)e.contains(k[E])&&(I(b,k[E]-e.min(),a),48==k[E]-f.cirTreeOffset&&0==k[E]-e.min()&&
(f.cachedCirRoot=b),--u,0==u&&f.fetchFeatures(y,h,c))})},I=function(k,y,c){var I=new Uint8Array(k),f=new Int16Array(k);k=new Int32Array(k);var A=I[y],f=f[y/2+1];y+=4;if(0!=A)for(A=0;A<f;++A){var u=y/4,n=k[u],p=k[u+1],s=k[u+2],u=k[u+3],d=m(I,y+16);c=m(I,y+24);(0>a||n<a||n==a&&p<=b)&&(0>a||s>a||s==a&&u>=e)&&h.push({offset:d,size:c});y+=32}else{for(var F=[],A=0;A<f;++A)u=y/4,n=k[u],p=k[u+1],s=k[u+2],u=k[u+3],d=m(I,y+16),(0>a||n<a||n==a&&p<=b)&&(0>a||s>a||s==a&&u>=e)&&F.push(d),y+=24;0<F.length&&E(F,
c+1)}};E([f.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(k){f.cirHeader=k;k=new Int32Array(f.cirHeader);f.cirBlockSize=k[1];f.readWigDataById(a,e,b,c)})};g.prototype.fetchFeatures=function(b,e,c){var f=this;e.sort(function(e,a){return(e.offset|0)-(a.offset|0)});if(0==e.length)c([]);else{var u=[],n=function(e,b,k,c){c||(c={});var h=new a;h._chromId=e;h.segment=f.bwg.idsToChroms[e];h.min=b;h.max=k;h.type=f.bwg.type;for(var z in c)h[z]=c[z];u.push(h)},p=function(){if(0==
e.length)Date.now(),c(u);else{var y=e[0];if(y.data)f.parseFeatures(y.data,n,b),e.splice(0,1),p();else{for(var a=y.offset,k=y.size,y=1;y<e.length&&e[y].offset==a+k;)k+=e[y].size,++y;f.bwg.data.slice(a,k).fetch(function(y){for(var a=0,b=0;a<k;){var c=e[b],E;0<f.bwg.uncompressBufSize?E=s(y,a+2,c.size-2):(E=new Uint8Array(c.size),h(new Uint8Array(y,a,c.size),0,E,0,c.size),E=E.buffer);c.data=E;a+=c.size;++b}p()})}}};p()}};g.prototype.parseFeatures=function(a,e,h){var A=new Uint8Array(a);if(this.isSummary)for(var n=
new Int16Array(a),p=new Int32Array(a),s=new Float32Array(a),A=a.byteLength/32,n=0;n<A;++n){a=p[8*n];var y=p[8*n+1],E=p[8*n+2],k=p[8*n+3],I=s[8*n+5],J=s[8*n+6];h(a,y+1,E)&&(k={type:"bigwig",score:J/k,maxScore:I},"bigbed"==this.bwg.type&&(k.type="density"),e(a,y+1,E,k))}else if("bigwig"==this.bwg.type)if(n=new Int16Array(a),p=new Int32Array(a),s=new Float32Array(a),a=p[0],I=p[1],J=p[3],k=p[4],y=A[20],A=n[11],3==y)for(n=0;n<A;++n){var d=s[n+6],p=I+n*J+1,y=I+n*J+k;h(a,p,y)&&e(a,p,y,{score:d})}else if(2==
y)for(n=0;n<A;++n)y=p[2*n+6]+1,E=y+k-1,d=s[2*n+7],h(a,y,E)&&e(a,y,E,{score:d});else if(1==y)for(n=0;n<A;++n)y=p[3*n+6]+1,E=p[3*n+7],d=s[3*n+8],y>E&&(y=E),h(a,y,E)&&e(a,y,E,{score:d});else console.log("Currently not handling bwgType="+y);else if("bigbed"==this.bwg.type)for(n=0,k=this.bwg.definedFieldCount,I=this.bwg.schema;n<A.length;){a=A[n+3]<<24|A[n+2]<<16|A[n+1]<<8|A[n+0];y=A[n+7]<<24|A[n+6]<<16|A[n+5]<<8|A[n+4];E=A[n+11]<<24|A[n+10]<<16|A[n+9]<<8|A[n+8];n+=12;for(d="";;)if(J=A[n++],0!=J)d+=String.fromCharCode(J);
else break;var J={},L;L=0<d.length?d.split("\t"):[];0<L.length&&3<k&&(J.label=L[0]);1<L.length&&4<k&&(d=parseInt(L[1]),isNaN(d)||(J.score=d));2<L.length&&5<k&&(J.orientation=L[2]);5<L.length&&8<k&&(d=L[5],u.test(d)&&(J.itemRgb="rgb("+d+")"));if(L.length>k-3&&I)for(d=k-3;d<L.length;++d)J[I.fields[d+3].name]=L[d];if(h(a,y+1,E,L))if(12>k)e(a,y+1,E,J);else{var d=L[3]|0,F=L[4]|0,w=L[6]|0,g=L[7].split(","),D=L[8].split(",");J.exonFrames&&(s=J.exonFrames.split(","),J.exonFrames=void 0);J.type="transcript";
var B=new c;for(p in J)B[p]=J[p];B.id=L[0];B.segment=this.bwg.idsToChroms[a];B.min=y+1;B.max=E;B.notes=[];J.groups=[B];if(9<L.length){var G=E=J.geneName||L[9];10<L.length&&(G=L[10]);J.geneName2&&(G=J.geneName2);L=f(B);L.id=E;L.label=G;L.type="gene";J.groups.push(L)}E=[];for(L=0;L<w;++L)B=(D[L]|0)+y,B=new x(B,B+(g[L]|0)),E.push(B);g=C(E);w=g.ranges();for(y=0;y<w.length;++y)E=w[y],e(a,E.min()+1,E.max(),J);if(F>d&&(y="+"==J.orientation?new x(d,F+3):new x(d-3,F),y=b(g,y))){J.type="translation";d=y.ranges();
for(g=F=0;d[0].min()>w[g].max();)g++;for(y=0;y<d.length;++y)w=y,"-"==J.orientation&&(w=d.length-y-1),E=d[w],J.readframe=F,s&&(w=parseInt(s[w+g]),"number"===typeof w&&0<=w&&2>=w&&(J.readframe=w,J.readframeExplicit=!0)),w=E.max()-E.min(),F=(F+w)%3,e(a,E.min()+1,E.max(),J)}}}else throw Error("Don't know what to do with "+this.bwg.type);};g.prototype.getFirstAdjacent=function(a,e,b,c){a=this.bwg.chromsToIDs[a];if(void 0===a)return c([]);this.getFirstAdjacentById(a,e,b,c)};g.prototype.getFirstAdjacentById=
function(a,e,b,c){var f=this;if(this.cirHeader){var h=null,n=-1,y=-1,E=0;Date.now();var k=function(k,e){E+=k.length;for(var a=4+32*f.cirBlockSize,y,b=0;b<k.length;++b){var c=new x(k[b],k[b]+a);y=y?C(y,c):c}a=y.ranges();for(y=0;y<a.length;++y)I(k,a[y],e)},I=function(k,y,I,n){y.max();y.min();f.bwg.data.slice(y.min(),y.max()-y.min()).fetch(function(n){for(var p=0;p<k.length;++p)if(y.contains(k[p])&&(u(n,k[p]-y.min(),I),--E,0==E)){if(!h)return 0<b&&(0!=a||0<e)?f.getFirstAdjacentById(0,0,b,c):0>b&&(a!=
f.bwg.maxID||1E9>e)?f.getFirstAdjacentById(f.bwg.maxID,1E9,b,c):c([]);f.fetchFeatures(function(k,y,c,f){return 0>b&&(k<a||c<e)||0<b&&(k>a||y>e)},[h],function(k){for(var e=null,a=-1,y=-1,f=0;f<k.length;++f){var I=k[f],E=I._chromId,h=I.min,L=I.max;if(null==e||0>b&&(E>a||L>y)||0<b&&(E<a||h<y))e=I,y=0>b?L:h,a=E}return null!=e?c([e]):c([])})}})},u=function(c,I,E){var A=new Uint8Array(c),u=new Int16Array(c);c=new Int32Array(c);var p=A[I],u=u[I/2+1];I+=4;if(0!=p)for(p=0;p<u;++p){var J=I/4,s=c[J],d=c[J+1],
F=c[J+2],w=c[J+3],J=m(A,I+16);E=m(A,I+24);(0>b&&(s<a||s==a&&d<=e)||0<b&&(F>a||F==a&&w>=e))&&!/_random/.exec(f.bwg.idsToChroms[s])&&(null==h||0>b&&(F>n||F==n&&w>y)||0<b&&(s<n||s==n&&d<y))&&(h={offset:J,size:E},y=0>b?w:d,n=0>b?F:s);I+=32}else{for(var g=A=-1,p=0;p<u;++p){J=I/4;s=c[J];d=c[J+1];F=c[J+2];w=c[J+3];J=c[J+4]<<32|c[J+5];if(0>b&&(s<a||s==a&&d<=e)&&F>=a||0<b&&(F>a||F==a&&w>=e)&&s<=a)if(0>A||w>g)A=J,g=0>b?w:d;I+=24}0<=A&&k([A],E+1)}};k([f.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,
48).fetch(function(k){f.cirHeader=k;k=new Int32Array(f.cirHeader);f.cirBlockSize=k[1];f.getFirstAdjacentById(a,e,b,c)})};l.prototype.readWigData=function(a,e,b,c){this.getUnzoomedView().readWigData(a,e,b,c)};l.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new g(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};l.prototype.getZoomedView=function(a){a=this.zoomLevels[a];
a.view||(a.view=new g(this,a.indexOffset,4E3,!0));return a.view};l.prototype._tsFetch=function(a,e,b,c,f){var h=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var n=[],y=this.topLevelReductionCache,E=0;E<y.length;++E)y[E]._chromId==e&&n.push(y[E]);return f(n)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(k){h.topLevelReductionCache=k;return h._tsFetch(a,e,b,c,f)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(e,
b,c,f)};l.prototype.thresholdSearch=function(a,e,b,c,f){function h(){if(0==y.length)return f(null);y.sort(function(k,e){var a=k.zoom-e.zoom;if(0!=a)return a;a=k.chrOrd-e.chrOrd;return 0!=a?a:k.min-e.min*b});var k=y.splice(0,1)[0];n._tsFetch(k.zoom,k.chr,k.min,k.max,function(a){var E=0<b?0:3E8;k.fromRef&&(E=e);for(var L=0;L<a.length;++L){var n=a[L],u;u=void 0!=n.maxScore?n.maxScore:n.score;if(0<b){if(u>c)if(0>k.zoom){if(n.min>E)return f(n)}else n.max>E&&y.push({chr:k.chr,chrOrd:k.chrOrd,zoom:k.zoom-
2,min:n.min,max:n.max,fromRef:k.fromRef})}else if(u>c)if(0>k.zoom){if(n.max<E)return f(n)}else n.min<E&&y.push({chr:k.chr,chrOrd:k.chrOrd,zoom:k.zoom-2,min:n.min,max:n.max,fromRef:k.fromRef})}h()})}b=0>b?-1:1;var n=this;a=this.chromsToIDs[a];for(var y=[{chrOrd:0,chr:a,zoom:n.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],E=1;E<=this.maxID+1;++E){var k=(a+b*E)%(this.maxID+1);0>k&&(k+=this.maxID+1);y.push({chrOrd:E,chr:k,zoom:n.zoomLevels.length-1,min:0,max:3E8})}h()};l.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);
this.data.slice(this.asOffset,2048).fetch(function(e){var b=new Uint8Array(e);e="";for(var c=0;c<b.length&&0!=b[c];++c)e+=String.fromCharCode(b[c]);var b=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,f=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(e);if(f){c={declType:f[1],name:f[2],comment:f[4],fields:[]};e=e.substring(f[0]);for(f=b.exec(e);null!=f;f=b.exec(e))c.fields.push({type:f[1],name:f[2],comment:f[4]});return a(c)}})};l.prototype.getExtraIndices=function(a){var e=this;if(4>this.version||0==this.extHeaderOffset||
"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(b){if(!b)return a(null,"Couldn't fetch extension header");var c=new Uint8Array(b),f=new Int16Array(b);new Int32Array(b);var h=f[1];b=m(c,4);if(0==h)return a(null);e.data.slice(b,20*h).fetch(function(b){if(!b)return a(null,"Couldn't fetch index info");var y=new Uint8Array(b),c=new Int16Array(b);new Int32Array(b);b=[];for(var k=0;k<h;++k){var f=c[10*k],n=c[10*k+1],A=m(y,20*k+4),f=new r(e,f,n,A,c[10*k+8]);b.push(f)}a(b)})})};
r.prototype.lookup=function(a,e){var b=this;this.bbi.data.slice(this.offset,32).fetch(function(c){function f(k){b.bbi.data.slice(k,4+u*(y+E)).fetch(function(k){var c=new Uint8Array(k),h=new Uint16Array(k);new Uint32Array(k);h=h[1];k=4;if(0==c[0]){for(var L=null,u=0;u<h;++u){for(var A="",p=0;p<y;++p){var s=c[k++];0!=s&&(A+=String.fromCharCode(s))}p=m(c,k);k+=8;if(0>a.localeCompare(A)&&L){f(L);return}L=p}f(L)}else{for(u=0;u<h;++u){A="";for(p=0;p<y;++p)s=c[k++],0!=s&&(A+=String.fromCharCode(s));if(A==
a)return h=m(c,k),c=n(c,k+8),b.bbi.getUnzoomedView().fetchFeatures(function(k,e,y,c){if(c&&c.length>b.field-3)return c[b.field-3]==a},[{offset:h,size:c}],e);k+=E}return e([])}})}var h=new Uint8Array(c);new Int16Array(c);c=new Int32Array(c);var u=c[1],y=c[2],E=c[3];m(h,16);f(b.offset+32)})};"undefined"!==typeof v&&(v.exports={makeBwg:q,BIG_BED_MAGIC:S,BIG_WIG_MAGIC:p})},{"./bin":4,"./das":10,"./spans":36,"./utils":49,jszlib:65}],4:[function(d,v,t){function m(a){this.blob=a}function l(a,c,b,f){f||("object"===
typeof c?(f=c,c=void 0):f={});this.url=a;this.start=c||0;b&&(this.end=b);this.opts=f}function g(a){if(!a)return null;for(var c=new Uint8Array(a.length),b=0;b<c.length;++b)c[b]=a.charCodeAt(b);return c.buffer}function q(a,c){return a[c+7]<<24|a[c+6]<<16|a[c+5]<<8|a[c+4]}function r(a,c){return a[c+3]<<24|a[c+2]<<16|a[c+1]<<8|a[c]}function x(a,c){return a[c+1]<<8|a[c]}function C(a,c){return a[c]}function b(a,c){return a[c]<<24|a[c+1]<<16|a[c+2]<<8|a[c+3]}if("undefined"!==typeof d)var a=d("./utils").shallowCopy,
c=d("./sha1").b64_sha1,f=d("es6-promise").Promise;m.prototype.slice=function(a,c){var b;b=this.blob.slice?c?this.blob.slice(a,a+c):this.blob.slice(a):c?this.blob.webkitSlice(a,a+c):this.blob.webkitSlice(a);return new m(b)};m.prototype.salted=function(){return this};m.prototype.fetch="undefined"!==typeof FileReader?function(a){var c=new FileReader;c.onloadend=function(b){a(g(c.result))};c.readAsBinaryString(this.blob)}:function(a){var c=new FileReaderSync;try{var b=c.readAsArrayBuffer(this.blob);a(b)}catch(f){a(null,
f)}};l.prototype.slice=function(a,c){if(0>a)throw"Bad slice "+a;var b=this.start,f=this.end,b=b&&a?b+a:a||b;return new l(this.url,b,c&&b?b+c-1:f||c-1,this.opts)};var n=0,s=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");l.prototype.fetchAsText=function(a){try{var b=new XMLHttpRequest,f=this.url;(s||this.opts.salt)&&0>f.indexOf("?")&&(f=f+"?salt="+c(""+Date.now()+","+ ++n));b.open("GET",f,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";b.setRequestHeader("Range",
"bytes="+this.start+"-"+this.end)}b.onreadystatechange=function(){if(4==b.readyState)return 200==b.status||206==b.status?a(b.responseText):a(null)};this.opts.credentials&&(b.withCredentials=!0);b.send("")}catch(d){return a(null)}};l.prototype.salted=function(){var c=a(this.opts);c.salt=!0;return new l(this.url,this.start,this.end,c)};l.prototype.getURL=function(){return this.opts.resolver?this.opts.resolver(this.url).then(function(a){return"string"===typeof a?a:a.url}):f.resolve(this.url)};l.prototype.fetch=
function(a,b){var f=this;b=b||{};var d=b.attempt||1,D=b.truncatedLength;if(3<d)return a(null);this.getURL().then(function(w){try{var G;b.timeout&&!f.opts.credentials&&(G=setTimeout(function(){console.log("timing out "+w);B.abort();return a(null,"Timeout")},b.timeout));var B=new XMLHttpRequest,r;(s||f.opts.salt)&&0>w.indexOf("?")&&(w=w+"?salt="+c(""+Date.now()+","+ ++n));B.open("GET",w,!0);B.overrideMimeType("text/plain; charset=x-user-defined");if(f.end){if(1E8<f.end-f.start)throw"Monster fetch!";
B.setRequestHeader("Range","bytes="+f.start+"-"+f.end);r=f.end-f.start+1}B.responseType="arraybuffer";B.onreadystatechange=function(){if(4==B.readyState){G&&clearTimeout(G);if(200==B.status||206==B.status){if(B.response){var c=B.response.byteLength;return!r||r==c||D&&c==D?a(B.response):f.fetch(a,{attempt:d+1,truncatedLength:c})}if(B.mozResponseArrayBuffer)return a(B.mozResponseArrayBuffer);c=B.responseText;return!r||r==c.length||D&&c.length==D?a(g(B.responseText)):f.fetch(a,{attempt:d+1,truncatedLength:c.length})}return f.fetch(a,
{attempt:d+1})}};f.opts.credentials&&(B.withCredentials=!0);B.send("")}catch(u){return a(null)}}).catch(function(c){console.log(c);return a(null,c)})};(function(a){var c=new ArrayBuffer(8),b=new Uint8Array(c),f=new Float32Array(c);a.readFloat=function(a,c){b[0]=a[c];b[1]=a[c+1];b[2]=a[c+2];b[3]=a[c+3];return f[0]}})(this);"undefined"!==typeof v&&(v.exports={BlobFetchable:m,URLFetchable:l,readInt:r,readIntBE:b,readInt64:q,readShort:x,readByte:C,readFloat:this.readFloat})},{"./sha1":33,"./utils":49,
"es6-promise":53}],5:[function(d,v,t){function m(d){var g="bp";1E9<d?(d/=1E9,g="Gb"):1E6<d?(d/=1E6,g="Mb"):1E3<d&&(d/=1E3,g="kb");return""+Math.round(d)+g}if("undefined"!==typeof d){var l=d("./cbrowser").Browser,g=d("./utils").makeElement,q=d("./numformats").formatLongInt,r=d("./zoomslider");d("./tier-edit");d("./export-config");d("./export-ui");d("./export-image");d("./svg-export");d("./session")}l.prototype.initUI=function(d,C){this.noSourceCSS||["bootstrap-scoped.css","dalliance-scoped.css","font-awesome.min.css"].forEach(function(a){document.head.appendChild(g("link",
"",{rel:"stylesheet",href:this.resolveURL("$$css/"+a)}))}.bind(this));var b=this;b.disableDefaultFeaturePopup||this.addFeatureListener(function(a,k,e,c){b.featurePopup(a,k,e,c)});d.classList.add("dalliance");var a=b.toolbar=g("div",null,{className:"btn-toolbar toolbar"}),c=b.coordSystem.speciesName+" "+b.nameForCoordSystem(b.coordSystem);this.setDocumentTitle&&(document.title=c+" :: dalliance");var f=g("input","",{className:"loc-field"});b.makeTooltip(f,"Enter a genomic location or gene name");var n=
g("p","",{className:"loc-status"}),s=g("a",[g("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),h=new r({width:b.zoomSliderWidth});b.makeTooltip(h,"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).");var p=g("a",[g("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),F=g("a",[g("i",null,{className:"fa fa-eraser"})],{className:"btn"}),l=g("a",[g("i",null,{className:"fa fa-plus"})],{className:"btn"}),D=g("a",[g("i",
null,{className:"fa fa-bookmark"})],{className:"btn"}),w=g("a",[g("i",null,{className:"fa fa-print"})],{className:"btn"});g("a",[g("i",null,{className:"fa fa-refresh"})],{className:"btn"});var G=g("a",[g("i",null,{className:"fa fa-cogs"})],{className:"btn"}),B=g("a",[g("i",null,{className:"fa fa-question"})],{className:"btn"}),H=g("a",[g("i",null,{className:"fa fa-road"})],{className:"btn"});b.makeTooltip(H,"Configure currently selected track(s) (E)");var u=g("a",[g("i",null,{className:"fa fa-angle-left"})],
{className:"btn"},{width:"5px"}),K=g("a",[g("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),e=g("div",null,{className:"btn-group pull-right"});this.noTrackAdder||e.appendChild(l);this.noTrackEditor||e.appendChild(H);this.noExport||e.appendChild(w);this.noOptions||e.appendChild(G);this.noHelp||e.appendChild(B);this.setUiMode=function(a){this.uiMode=a;var k={help:B,add:l,opts:G,"export":w,tier:H},e;for(e in k)e==a?k[e].classList.add("active"):k[e].classList.remove("active")};
this.noLeapButtons||a.appendChild(K);e.firstChild&&a.appendChild(e);this.noLeapButtons||a.appendChild(u);this.noTitle||a.appendChild(g("div",g("h4",c,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||a.appendChild(g("div",[f,n],{className:"btn-group loc-group"}));this.noClearHighlightsButton||a.appendChild(F);this.noZoomSlider||a.appendChild(g("div",[s,g("span",h,{className:"btn"}),p],{className:"btn-group"}));this.toolbarBelow?(d.appendChild(C),d.appendChild(a)):(d.appendChild(a),
d.appendChild(C));var z=Math.log(2)/Math.log(10),A=Math.log(5)/Math.log(10),N=function(a){var k=(a/b.zoomExpt+Math.log(b.zoomBase))/Math.log(10);a=k|0;k-=a;return((0.01>k?a:k<=z+0.01?a+z:k<=A+0.01?a+A:a+1)*Math.log(10)-Math.log(b.zoomBase))*b.zoomExpt},M=function(a){h.addLabel(a,m(Math.exp(a/b.zoomExpt)*b.zoomBase))};this.addViewListener(function(a,k,e,c,y){f.value=a+":"+q(k)+".."+q(e);h.min=y.min|0;h.max=y.max|0;y.isSnapZooming?(h.value=y.alternate,h.value2=y.current,h.active=2):(h.value=y.current,
h.value2=y.alternate,h.active=1);y.current==y.min?s.classList.add("disabled"):s.classList.remove("disabled");y.current==y.max?p.classList.add("disabled"):p.classList.remove("disabled");h.removeLabels();a=y.min;y=y.max;k=y-a;e=4;b.zoomSliderWidth&&150>b.zoomSliderWidth&&(e=3);M(N(a));for(c=1;c<e-1;++c)M(N(a+1*c*k/(e-1)));M(N(y));b.storeStatus&&b.storeViewStatus();F.style.display=0<b.highlights.length?"inline-block":"none"});this.addTierListener(function(){b.storeStatus&&b.storeTierStatus()});f.addEventListener("keydown",
function(a){40==a.keyCode&&(a.preventDefault(),a.stopPropagation(),b.setSelectedTier(0));if(10==a.keyCode||13==a.keyCode)a.preventDefault(),b.search(f.value,function(k){n.textContent=k?""+k:""})},!1);var U;l.addEventListener("click",function(a){U&&U.displayed?b.removeAllPopups():U=b.showTrackAdder(a)},!1);b.makeTooltip(l,"Add a new track from the registry or an indexed file. (A)");s.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.zoomStep(-10)},!1);b.makeTooltip(s,"Zoom in (+)");
p.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.zoomStep(10)},!1);b.makeTooltip(p,"Zoom out (-)");h.addEventListener("change",function(a){a=2==h.active;a!=b.isSnapZooming&&(b.savedZoom=b.zoomSliderValue-b.zoomMin,b.isSnapZooming=a);a=1==h.active?h.value:h.value2;b.zoomSliderValue=1*a;b.zoom(Math.exp(1*a/b.zoomExpt))},!1);D.addEventListener("click",function(a){a.stopPropagation();a.preventDefault()},!1);b.makeTooltip(D,"Favourite regions");w.addEventListener("click",
function(a){a.stopPropagation();a.preventDefault();b.openExportPanel()},!1);b.makeTooltip(w,"Export publication-quality SVG. (X)");G.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.toggleOptsPopup(a)},!1);b.makeTooltip(G,"Configure options.");B.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.toggleHelpPopup(a)});b.makeTooltip(B,"Help; Keyboard shortcuts. (H)");H.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();
1==b.selectedTiers.length&&b.openTierPanel(b.tiers[b.selectedTiers[0]])},!1);u.addEventListener("click",function(a){b.leap(b.reverseKeyScrolling?-1:1,!1)},!1);b.makeTooltip(u,function(a){a=b.getSelectedTier();var k;0<=a&&(k=b.tiers[a]);return k&&k.featureSource&&b.sourceAdapterIsCapable(k.featureSource,"quantLeap")&&"number"==typeof k.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(k.config.name||k.dasSource.name)+'"" (ctrl+LEFT)':k&&k.featureSource&&
b.sourceAdapterIsCapable(k.featureSource,"leap")?'Jump to the next feature in the selected track "'+(k.config.name||k.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});K.addEventListener("click",function(a){b.leap(b.reverseKeyScrolling?1:-1,!1)},!1);b.makeTooltip(K,function(a){a=b.getSelectedTier();var k;0<=a&&(k=b.tiers[a]);return k&&k.featureSource&&b.sourceAdapterIsCapable(k.featureSource,"quantLeap")&&"number"==typeof k.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+
(k.config.name||k.dasSource.name)+'"" (ctrl+RIGHT)':k&&k.featureSource&&b.sourceAdapterIsCapable(k.featureSource,"leap")?'Jump to the next feature in the selected track "'+(k.config.name||k.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});b.addTierSelectionListener(function(){var a=b.getSelectedTier(),k;0<=a&&(k=b.tiers[a]);a=!1;k&&k.featureSource&&(b.sourceAdapterIsCapable(k.featureSource,"quantLeap")&&"number"==typeof k.quantLeapThreshold?a=!0:b.sourceAdapterIsCapable(k.featureSource,
"leap")&&(a=!0));u.firstChild.className=a?"fa fa-angle-double-left":"fa fa-angle-left";K.firstChild.className=a?"fa fa-angle-double-right":"fa fa-angle-right"});F.addEventListener("click",function(a){b.clearHighlights()},!1);b.makeTooltip(F,"Clear highlights (C)");b.addTierSelectionWrapListener(function(a){0>a&&(b.setSelectedTier(null),f.focus())});b.addTierSelectionListener(function(a){"tier"===b.uiMode&&(0==a.length?(b.hideToolPanel(),b.manipulatingTier=null,b.uiMode="none"):(a=b.tiers[a[0]],a!=
b.manipulatingTier&&b.openTierPanel(a)))});var y=function(a){if(65==a.keyCode||97==a.keyCode)a.preventDefault(),a.stopPropagation(),b.showTrackAdder();else if(72==a.keyCode||104==a.keyCode)a.stopPropagation(),a.preventDefault(),b.toggleHelpPopup(a);else if(69==a.keyCode||101==a.keyCode)a.stopPropagation(),a.preventDefault(),1==b.selectedTiers.length&&b.openTierPanel(b.tiers[b.selectedTiers[0]]);else if(88==a.keyCode||120==a.keyCode)a.stopPropagation(),a.preventDefault(),b.openExportPanel();else if(67==
a.keyCode||99==a.keyCode)a.stopPropagation(),a.preventDefault(),b.clearHighlights()};d.addEventListener("focus",function(a){d.addEventListener("keydown",y,!1)},!1);d.addEventListener("blur",function(a){d.removeEventListener("keydown",y,!1)},!1);d.addEventListener("keydown",function(a){27===a.keyCode&&"none"!==b.uiMode&&(a.preventDefault(),a.stopPropagation(),b.setUiMode("none"),b.hideToolPanel(),b.selectedTiers&&0<b.selectedTiers.length&&b.browserHolder.focus())},!1)};l.prototype.showToolPanel=function(d,
r){var b=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);var a;a=r?d:g("div",d,{},{overflowY:"auto",width:"100%"});var c=g("div",g("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});c.addEventListener("click",function(a){b.hideToolPanel();b.setUiMode("none")},!1);this.makeTooltip(c,"Close tool panel (ESC)");this.activeToolPanel=g("div",[c,a],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();
b=this};l.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};l.prototype.toggleHelpPopup=function(d){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(d=g("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.resolveURL("$$help/index.html"),className:"help-panel"}),this.showToolPanel(d,!1),this.setUiMode("help"))};l.prototype.toggleOptsPopup=
function(d){var r=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{d=g("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var b=g("table");b.cellPadding=5;var a=g("input","",{type:"checkbox",checked:r.reverseScrolling});a.addEventListener("change",function(c){r.reverseScrolling=a.checked;r.storeStatus()},!1);b.appendChild(g("tr",[g("td","Reverse trackpad scrolling",{align:"right"}),g("td",
a)]));var c=g("input","",{type:"checkbox",checked:r.reverseKeyScrolling});c.addEventListener("change",function(a){r.reverseKeyScrolling=c.checked;r.storeStatus()},!1);b.appendChild(g("tr",[g("td","Reverse scrolling buttons and keys",{align:"right"}),g("td",c)]));var f=g("select");f.appendChild(g("option","Left",{value:"left"}));f.appendChild(g("option","Center",{value:"center"}));f.appendChild(g("option","Right",{value:"right"}));f.appendChild(g("option","None",{value:"none"}));f.value=r.rulerLocation;
f.addEventListener("change",function(a){r.rulerLocation=f.value;r.positionRuler();for(a=0;a<r.tiers.length;++a)r.tiers[a].paintQuant();r.storeStatus()},!1);b.appendChild(g("tr",[g("td","Vertical guideline",{align:"right"}),g("td",f)]));var n=g("input","",{type:"checkbox",checked:r.singleBaseHighlight});n.addEventListener("change",function(a){r.singleBaseHighlight=n.checked;r.positionRuler();r.storeStatus()},!1);n.setAttribute("id","singleBaseHightlightButton");b.appendChild(g("tr",[g("td","Display and highlight current genome location",
{align:"right"}),g("td",n)]));d.appendChild(b);b=g("button","Reset browser",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});b.addEventListener("click",function(a){r.reset()},!1);d.appendChild(b);this.showToolPanel(d);this.setUiMode("opts")}}},{"./cbrowser":6,"./export-config":14,"./export-image":15,"./export-ui":16,"./numformats":26,"./session":32,"./svg-export":38,"./tier-edit":44,"./utils":49,"./zoomslider":52}],6:[function(d,v,t){function m(a,e,k){this.min=e;this.max=
k;this.chr=a}function l(a){a||(a={});this.prefix="//www.biodalliance.org/release-0.14/";this.sources=[];this.tiers=[];this.tierGroups={};this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=1;this.maxPixelsPerBase=10;this.origin=0;this.targetQuantRes=
1;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=0.3;this.singleBaseHighlight=this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)","white"];this.minTierHeight=20;this.noDefaultLabels=
!1;this.availableSources=new b;this.defaultSources=[];this.mappableSources={};this.registry=null;this.noRegistryTabs=!0;this.hubs=[];this.hubObjects=[];this.sourceCache=new C;this.useFetchWorkers=this.retina=!0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.resolvers={};this.resolverSeed=1;this.assemblyNameUcsc=this.assemblyNamePrimary=!0;this.httpCanaryURL="http://www.biodalliance.org/http-canary.txt";this.httpWarningURL="//www.biodalliance.org/https.html";this.initListeners=[];this.baseColors=
a.baseColors?a.baseColors:{A:"green",C:"blue",G:"orange",T:"red","-":"hotpink",I:"red"};if(void 0!==a.viewStart&&"number"!==typeof a.viewStart)throw Error("viewStart must be an integer");if(void 0!==a.viewEnd&&"number"!==typeof a.viewEnd)throw Error("viewEnd must be an integer");if(void 0!==a.offscreenInitWidth&&"number"!==typeof a.offscreenInitWidth)throw Error("offscreenInitWidth must be an integer");for(var e in a)this[e]=a[e];"string"===typeof a.uiPrefix&&"string"!==typeof a.prefix&&(this.prefix=
a.uiPrefix);0>this.prefix.indexOf("//")&&0===this.prefix.indexOf("/")&&(a=window.location.hostname,window.location.port&&(a+=":"+window.location.port),this.prefix="//"+a+this.prefix);0===this.prefix.indexOf("//")&&(a=window.location.protocol,"http:"!=a&&"https:"!=a&&(console.log(window.location.protocol),console.log("WARNING: prefix is set to a protocol-relative URL ("+this.prefix+" when loading from a non-HTTP source"),this.prefix="http:"+this.prefix));if(!this.coordSystem)throw Error("Coordinate system must be configured");
if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var k=this;if("complete"===document.readyState)k.realInit();else{var c=function(a){window.removeEventListener("load",c,!1);k.realInit()};window.addEventListener("load",c,!1)}}function g(a,e,k){if(k)for(var c=0;c<e.length;++c)e[c].mapping=k;a.set(e)}function q(a,e,k,c){c=c||[];for(var b=a.length-1;0<=b;--b){var f=a[b];if(!f.notSelectable&&f.min()<=e&&f.max()>=e&&(!f.minY||
!(k<f.minY()||k>f.maxY()))){f.feature?c.push(f.feature):f.group&&c.push(f.group);if(f.glyphs)return q(f.glyphs,e,k,c);if(f.glyph)return q([f.glyph],e,k,c);break}}return c}function r(a,e){var k=this;this.tagSeed=0;this.callbacks={};this.browser=a;this.worker=e;this.worker.onmessage=function(a){var e=a.data;if(e.cmd)"resolve"==e.cmd?(a=k.browser.resolvers[e.resolver])?a(e.url).then(function(a){k.worker.postMessage({tag:e.tag,url:a})}).catch(function(a){console.log(a);k.worker.postMessage({tag:e.tag,
err:a.toString()})}):console.log("No resolver "+e.resolver):console.log("Bad worker callback "+e.cmd);else if(a=k.callbacks[e.tag])a(e.result,e.error),delete k.callbacks[e.tag]}}function x(a){var e=a.resolveURL(a.workerPath);0==e.indexOf("//")&&(e="https:"==window.location.protocol?"https:"+e:"http:"+e);var k=new Blob(['importScripts("'+e+"?version="+S+'");'],{type:"application/javascript"});return new B(function(e,c){var b=new Worker(URL.createObjectURL(k));b.onmessage=function(k){"init"===k.data.tag&&
(console.log("Worker initialized"),e(new r(a,b)))};b.onerror=function(a){c(a.message)}})}function C(){this.sourcesByURI={}}if("undefined"!==typeof d){t=d("./utils");var b=t.Observed,a=t.makeElement,c=t.removeChildren,f=t.miniJSONify,n=t.shallowCopy,s=t.textXHR,h=d("./tier").DasTier,p=d("./sha1").hex_sha1,F=d("./thub").connectTrackHub,S=d("./version");t=d("./numformats");var D=t.formatQuantLabel,w=t.formatLongInt,G=d("./chainset").Chainset,B=d("es6-promise").Promise;t=d("./sourcecompare");var H=t.sourcesAreEqual,
u=t.sourcesAreEqualModuloStyle,K=t.sourceDataURI}l.prototype.resolveURL=function(a){return a.replace("$$",this.prefix)};l.prototype.destroy=function(){window.removeEventListener("resize",this.resizeListener,!1)};l.prototype.realInit=function(){var e=this;if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");else{this.wasInitialized=!0;var b=navigator.userAgent||"dummy";0<=b.indexOf("Trident")&&0<=b.indexOf("rv:11")&&(this.disablePinning=!0);
this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(b=0;b<this.sources.length;++b){var k=this.sources[b];k&&this.defaultSources.push(k)}this.restoreStatus&&(this.statusRestored=this.restoreStatus());var f=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");this.browserHolder=a("div",null,{className:"dalliance dalliance-root",tabIndex:-1});this.maxHeight?
this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=this.maxHeight&&(this.browserHolder.style.maxHeight=null);c(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=a("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=a("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=a("div",this.makeLoader(24),{className:"tier-holder tier-holder-rest"});this.locSingleBase=a("span",
"",{className:"loc-single-base"});b=a("div",this.locSingleBase,{className:"loc-single-base-holder"});this.addViewListener(function(a,k,c,b,f,I,h){k=Math.round((h+I)/2);e.locSingleBase.appendChild(document.createTextNode(a+":"+w(k)));e.locSingleBase.removeChild(e.locSingleBase.firstChild)});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=a("div",[b,this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"}),this.svgHolder.appendChild(this.tierHolderHolder));
this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=a("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(a("span",["Powered by ",a("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+S],{className:"powered-by"}));this.browserHolder.appendChild(this.bhtmlRoot);this.resizeListener=function(a){f.resizeViewer()};window.addEventListener("resize",this.resizeListener,!1);this.ruler=a("div",null,{className:"guideline"});this.ruler2=a("div",null,{className:"single-base-guideline"});
this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=this.chains||{};this.chains={};for(var h in this.chainConfigs)b=this.chainConfigs[h],b instanceof G&&console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),this.chains[h]=new G(b);if(0<this.maxWorkers){h=[];for(b=0;b<this.maxWorkers;++b)h.push(x(this));h=B.all(h)}else h=B.resolve([]);this.fetchWorkers=null;this.nextWorker=0;h.then(function(a){console.log("Booted "+
a.length+" workers");f.fetchWorkers=a},function(a){console.log("Failed to boot workers",a)}).then(function(){if(e.offscreenInitWidth||"none"!=window.getComputedStyle(f.browserHolderHolder).display&&0<f.tierHolder.getBoundingClientRect().width)setTimeout(function(){f.realInit2()},1);else var a=setInterval(function(){"none"!=window.getComputedStyle(f.browserHolderHolder).display&&0<f.tierHolder.getBoundingClientRect().width&&(clearInterval(a),f.realInit2())},300)})}};l.prototype.realInit2=function(){var e=
this;c(this.tierHolder);c(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|e.offscreenInitWidth|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.tierHolderHolder.addEventListener("mousewheel",
function(a){a.stopPropagation();a.preventDefault();if(a.wheelDeltaX){var k=a.wheelDeltaX/5;e.reverseScrolling||(k=-k);e.move(k)}a.wheelDeltaY&&(k=a.wheelDeltaY,e.reverseScrolling&&(k=-k),e.tierHolder.scrollTop+=k)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(a){a.stopPropagation();a.preventDefault();1==a.axis?0!=a.detail&&(a=a.detail/4,e.reverseScrolling&&(a=-a),e.move(a)):(a=a.detail,e.reverseScrolling||(a=-a),e.tierHolder.scrollTop+=a)},!1);this.tierHolderHolder.addEventListener("touchstart",
function(a){return e.touchStartHandler(a)},!1);this.tierHolderHolder.addEventListener("touchmove",function(a){return e.touchMoveHandler(a)},!1);this.tierHolderHolder.addEventListener("touchend",function(a){return e.touchEndHandler(a)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(a){return e.touchCancelHandler(a)},!1);var b=function(a){if(13==a.keyCode){var k=!1;for(a=0;a<e.tiers.length;++a){var c=e.tiers[a];c.wantedLayoutHeight&&c.wantedLayoutHeight!=c.layoutHeight&&(c.layoutHeight=
c.wantedLayoutHeight,c.clipTier(),k=!0)}k&&e.arrangeTiers()}else if(32==a.keyCode||32==a.charCode)e.isSnapZooming?(e.isSnapZooming=!1,k=(e.savedZoom||20)+e.zoomMin):(e.isSnapZooming=!0,k=(e.savedZoom||0)+e.zoomMin),e.savedZoom=e.zoomSliderValue-e.zoomMin,e.zoomSliderValue=k,e.zoom(Math.exp(1*k/e.zoomExpt)),a.stopPropagation(),a.preventDefault();else if(85==a.keyCode)"opts"===e.uiMode&&(k=document.getElementById("singleBaseHightlightButton").checked,document.getElementById("singleBaseHightlightButton").checked=
!k),e.singleBaseHighlight=!e.singleBaseHighlight,e.positionRuler(),a.stopPropagation(),a.preventDefault();else if(39==a.keyCode)a.stopPropagation(),a.preventDefault(),e.scrollArrowKey(a,-1);else if(37==a.keyCode)a.stopPropagation(),a.preventDefault(),e.scrollArrowKey(a,1);else if(38==a.keyCode||87==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=e.getSelectedTier(),0>a||(k=e.tiers[a],a=k.forceHeight||k.subtiers[0].height,40<=a&&k.mergeConfig({height:a-10}));else if(a.ctrlKey||a.metaKey){if(a=
e.getSelectedTier(),!(0>a)&&(k=e.tiers[a],k.quantLeapThreshold)){var c=k.subtiers[0].height,b=k.subtiers[0].quant;b&&(a=1*b.min,b=1*b.max,c=(b-a)/c,k.mergeConfig({quantLeapThreshold:a+((Math.round((k.quantLeapThreshold-a)/c)|0)+1)*c}),k.notify("Threshold: "+D(k.quantLeapThreshold)))}}else if(a.altKey){if(b=e.selectedTiers.length,0!=b){a=e.selectedTiers[0];for(var f=!0,k=[],c=0;c<e.selectedTiers.length;++c)k.push(e.tiers[e.selectedTiers[c]]),0<c&&1!=e.selectedTiers[c]-e.selectedTiers[c-1]&&(f=!1);
if(!(f&&0>=a)){for(c=e.selectedTiers.length-1;0<=c;--c)e.tiers.splice(e.selectedTiers[c],1);e.selectedTiers.splice(0,b);b=f?a-1:a;for(c=0;c<k.length;++c)e.tiers.splice(b+c,0,k[c]),e.selectedTiers.push(b+c);e.withPreservedSelection(e._ensureTiersGrouped);e.markSelectedTiers();e.notifyTierSelection();e.reorderTiers();e.notifyTier("selected",a)}}}else if(a=e.getSelectedTier(),0<a){if(e.setSelectedTier(a-1),a=e.tiers[e.getSelectedTier()],k=a.row.offsetTop,a=k+a.row.offsetHeight,k<e.tierHolder.scrollTop||
a>e.tierHolder.scrollTop+e.tierHolder.offsetHeight)e.tierHolder.scrollTop=k}else e.notifyTierSelectionWrap(-1);else if(40==a.keyCode||83==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=e.getSelectedTier(),0>a||(k=e.tiers[a],a=k.forceHeight||k.subtiers[0].height,k.mergeConfig({height:a+10}));else if(a.ctrlKey||a.metaKey){if(a=e.getSelectedTier(),!(0>a)&&(k=e.tiers[a],k.quantLeapThreshold&&(c=k.subtiers[0].height,b=k.subtiers[0].quant)))a=1*b.min,b=1*b.max,c=(b-a)/c,b=Math.round((k.quantLeapThreshold-
a)/c)|0,1<b&&(k.mergeConfig({quantLeapThreshold:a+(b-1)*c}),k.notify("Threshold: "+D(k.quantLeapThreshold)))}else if(a.altKey){if(b=e.selectedTiers.length,0!=b){a=e.selectedTiers[0];for(var h=0,k=[],c=0;c<e.selectedTiers.length;++c)k.push(e.tiers[e.selectedTiers[c]]),0<c&&(h+=e.selectedTiers[c]-e.selectedTiers[c-1]-1);f=0==h;if(!(f&&a+b>=e.tiers.length)){for(c=e.selectedTiers.length-1;0<=c;--c)e.tiers.splice(e.selectedTiers[c],1);e.selectedTiers.splice(0,b);b=f?a+1:a+h;for(c=0;c<k.length;++c)e.tiers.splice(b+
c,0,k[c]),e.selectedTiers.push(b+c);e.withPreservedSelection(function(){e._ensureTiersGrouped(!0)});e.markSelectedTiers();e.notifyTierSelection();e.reorderTiers();e.notifyTier("selected",a)}}}else{if(a=e.getSelectedTier(),a<e.tiers.length-1&&(e.setSelectedTier(a+1),a=e.tiers[e.getSelectedTier()],k=a.row.offsetTop,a=k+a.row.offsetHeight,k<e.tierHolder.scrollTop||a>e.tierHolder.scrollTop+e.tierHolder.offsetHeight))e.tierHolder.scrollTop=Math.min(k,a-e.tierHolder.offsetHeight)}else if(187==a.keyCode||
61==a.keyCode)a.stopPropagation(),a.preventDefault(),e.zoomStep(-10);else if(189==a.keyCode||173==a.keyCode)a.stopPropagation(),a.preventDefault(),e.zoomStep(10);else if(73==a.keyCode||105==a.keyCode)a.stopPropagation(),a.preventDefault(),a=e.getSelectedTier(),0>a||(c=e.tiers[a],c.infoVisible?(c.infoElement.style.display="none",c.updateHeight(),c.infoVisible=!1):(c.infoElement.style.display="block",c.updateHeight(),c.infoVisible=!0));else if(84==a.keyCode||116==a.keyCode)if(a.shiftKey)for(a.stopPropagation(),
a.preventDefault(),a=0;a<e.tiers.length;++a)c=e.tiers[a],c.dasSource.collapseSuperGroups&&(void 0===k&&(k=!c.bumped),c.mergeConfig({bumped:k}));else a.ctrlKey||a.metaKey||(a.stopPropagation(),a.preventDefault(),a=e.getSelectedTier(),0>a||(c=e.tiers[a],c.dasSource.collapseSuperGroups&&(void 0===k&&(k=!c.bumped),c.mergeConfig({bumped:k}))));else if(77==a.keyCode||109==a.keyCode)a.stopPropagation(),a.preventDefault(),(a.ctrlKey||a.metaKey)&&1<e.selectedTiers.length&&e.mergeSelectedTiers();else if(68==
a.keyCode||100==a.keyCode){if(a.stopPropagation(),a.preventDefault(),a.ctrlKey||a.metaKey)a=e.getSelectedTier(),0>a||e.addTier(e.tiers[a].dasSource)}else if(80==a.keyCode||112==a.keyCode)if(a.ctrlKey||a.metaKey){k=[];for(a=0;a<e.selectedTiers.length;++a)k.push(e.tiers[e.selectedTiers[a]]);for(a=0;a<k.length;++a)k[a].mergeConfig({pinned:!k[a].pinned})}};this.browserHolder.addEventListener("focus",function(a){e.browserHolder.addEventListener("keydown",b,!1)},!1);this.browserHolder.addEventListener("blur",
function(a){e.browserHolder.removeEventListener("keydown",b,!1)},!1);this.hPopupHolder=a("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var k=0;k<this.sources.length;++k){var f=this.sources[k];if(f){var h={};this.restoredConfigs&&(h=this.restoredConfigs[k]);f.disabled||this.makeTier(f,h).then(function(a){e.refreshTier(a)})}}e._ensureTiersGrouped();e.arrangeTiers();
e.reorderTiers();(k=this.getSequenceSource())&&k.getSeqInfo(this.chr,function(a){e.currentSeqMax=a?a.length:-1});this.queryRegistry();for(var n in this.chains)this.queryRegistry(n,!0);if(this.hubs)for(n=0;n<this.hubs.length;++n)k=this.hubs[n],"string"==typeof k&&(k={url:k}),function(a){F(a.url,function(k,c){if(c)console.log(c);else{var b;if(b=a.genome?k.genomes[a.genome]:k.genomes[e.coordSystem.ucscName])a.mapping&&(b.mapping=a.mapping),a.label&&(b.hub.altLabel=a.label),e.hubObjects.push(b)}},a)}(k);
this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus();e.setLocation(this.chr,this.viewStart,this.viewEnd,function(){e.setSelectedTier(1);for(var a=0;a<e.initListeners.length;++a)try{e.initListeners[a].call(e)}catch(k){console.log(k)}})};l.prototype.touchStartHandler=function(a){this.touchOriginX=a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=
this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};l.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var e=a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&e!=this.touchOriginX&&this.move(e-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&(this.tierHolder.scrollTop-=a-this.touchOriginY);this.touchOriginX=e;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){e=Math.abs(a.touches[0].pageX-a.touches[1].pageX);
if(e!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var k=this.viewStart+a/this.scale|0;this.scale=e/this.zoomInitialSep*this.zoomInitialScale;this.viewStart=k-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=e}};l.prototype.touchEndHandler=function(a){};l.prototype.touchCancelHandler=function(a){};l.prototype.makeTier=function(a,e){try{return this.realMakeTier(a,e)}catch(k){console.log("Error initializing",a),console.log(k.stack||k)}};l.prototype.realMakeTier=
function(a,e){var k=this,c=null;this.tierBackgroundColors&&(c=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);var b=new h(this,a,e,c);b.oorigin=this.viewStart;var f=!1,n,u,d,A=function(a,e){var c=b.subtiers;if(c){var f=0;for(e-=b.padding;f<c.length&&e>c[f].height&&f<c.length-1;)e=e-c[f].height-b.padding,++f;if(!(f>=c.length))return c=c[f].glyphs,a-=(b.glyphCacheOrigin-k.viewStart)*k.scale,q(c,a,e)}},z=function(a){a.preventDefault();a.stopPropagation();a=a.clientX;a!=
u&&(k.move(a-u,!0),u=a);k.isDragging=!0},s=function(a){window.removeEventListener("mousemove",z,!0);window.removeEventListener("mouseup",s,!0);k.move(a.clientX-u)};b.viewport.addEventListener("mousedown",function(a){k.browserHolder.focus();a.preventDefault();b.row.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",z,!0);window.addEventListener("mouseup",s,!0);n=u=a;k.isDragging=!1},!1);b.viewport.addEventListener("mousemove",function(a){var e=b.row.getBoundingClientRect(),c=a.clientX-
e.left,y=a.clientY-e.top,e=A(c,y);b.row.style.cursor=e&&0<e.length?"pointer":"default";d&&clearTimeout(d);f||(d=setTimeout(function(){var e=A(c,y);e&&0<e.length&&k.notifyFeatureHover(a,e[e.length-1],e,b)},1E3))});var p=null;b.viewport.addEventListener("mouseup",function(a){var e=b.row.getBoundingClientRect(),c=a.clientX-e.left,e=a.clientY-e.top,f=A(c,e);f&&0<f.length&&!k.isDragging&&(p?(clearTimeout(p),p=null,k.featureDoubleClick(f,c,e)):p=setTimeout(function(){p=null;k.notifyFeature(a,f[f.length-
1],f,b)},500));if(k.isDragging&&c!=n&&b.sequenceSource){var e=k.viewStart+c/k.scale,y=k.viewStart+n/k.scale;e<y?(c=e|0,e=y|0):(c=y|0,e|=0);k.notifyRegionSelect(k.chr,c,e)}k.isDragging=!1},!1);b.viewport.addEventListener("mouseout",function(a){f=!1});b.removeButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();for(a=0;a<k.tiers.length;++a)if(k.tiers[a]===b){k.removeTier({index:a});break}},!1);b.nameButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();
if(a.shiftKey){a=-1;for(var e=0;e<k.tiers.length;++e)if(k.tiers[e]===b){a=e;break}0<=a&&(e=k.selectedTiers.indexOf(a),0<=e?k.selectedTiers.splice(e,1):(k.selectedTiers.push(a),k.selectedTiers.sort()),k.markSelectedTiers(),k.notifyTierSelection(),0<k.selectedTiers.length?k.browserHolder.focus():k.notifyTierSelectionWrap(-1))}else{for(e=0;e<k.tiers.length;++e)if(k.tiers[e]===b&&(k.browserHolder.focus(),1!=k.selectedTiers.length||k.selectedTiers[0]!=e)){k.setSelectedTier(e);return}b.infoVisible?(b.infoElement.style.display=
"none",b.updateHeight(),b.infoVisible=!1):(b.infoElement.style.display="block",b.updateHeight(),b.infoVisible=!0)}},!1);b.bumpButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();var e;b.dasSource.collapseSuperGroups&&(void 0===e&&(e=!b.bumped),b.mergeConfig({bumped:e}))},!1);var w,g,F,B,D,r=!1,R=function(a){var e=b.label;a.stopPropagation();a.preventDefault();if(!w){g=b.pinned?k.pinnedTierHolder:k.tierHolder;F=g.scrollHeight-g.offsetHeight;w=e.cloneNode(!0);w.style.cursor=
"pointer";g.appendChild(w);e.style.visibility="hidden";for(var c=0;c<k.tiers.length;++c)if(k.tiers[c]===b){B=c;break}D=a.clientY}var f=g.getBoundingClientRect();w.style.left=e.getBoundingClientRect().left-f.left+"px";w.style.top=a.clientY-f.top+g.scrollTop-10+"px";e=a.clientY-f.top+g.scrollTop;for(c=0;c<k.tiers.length;++c)if(f=k.tiers[c],!(f.pinned^b.pinned)&&(f=f.row.getBoundingClientRect(),e-=f.bottom-f.top,0>e)){if(c<B&&a.clientY<D||c>B&&a.clientY>D){k.withPreservedSelection(function(){k.tiers.splice(B,
1);k.tiers.splice(c,0,b);k._ensureTiersGrouped(c>B)});for(e=0;e<k.tiers.length;++e)k.tiers[e]==b&&(B=e);D=a.clientY;k.reorderTiers();g.appendChild(w);r=!0}break}w.offsetTop<g.scrollTop?g.scrollTop-=g.scrollTop-w.offsetTop:w.offsetTop+w.offsetHeight>g.scrollTop+g.offsetHeight&&(g.scrollTop=Math.min(g.scrollTop+(w.offsetTop+w.offsetHeight)-(g.scrollTop+g.offsetHeight),F))},G=function(a){var e=b.label;a.stopPropagation();a.preventDefault();w&&(w.style.cursor="auto",g.removeChild(w),w=null,e.style.visibility=
"visible");document.removeEventListener("mousemove",R,!1);document.removeEventListener("mouseup",G,!1);if(r){for(a=0;a<k.tiers.length;++a)if(k.tiers[a]==b){k.setSelectedTier(a);break}k.notifyTier("reordered",b)}};b.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();r=!1;document.addEventListener("mousemove",R,!1);document.addEventListener("mouseup",G,!1)},!1);this.tiers.push(b);return b.init().then(function(a){a.currentlyHeight=50;k.updateHeight();a.updateLabel();
k.withPreservedSelection(k._ensureTiersGrouped);a._updateFromConfig();k.reorderTiers();return a})};l.prototype.reorderTiers=function(){c(this.tierHolder);c(this.pinnedTierHolder);this.disablePinning&&(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var a=!1,e=[],k=[],b=0;b<this.tiers.length;++b){var f=this.tiers[b];f.pinned&&!this.disablePinning?(e.push(f),this.pinnedTierHolder.appendChild(this.tiers[b].row),a=!0):(k.push(f),this.tierHolder.appendChild(this.tiers[b].row))}this.withPreservedSelection(function(){this.tiers.splice(0,
this.tiers.length);for(var a=0;a<e.length;++a)this.tiers.push(e[a]);for(a=0;a<k.length;++a)this.tiers.push(k[a])});a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};l.prototype.withPreservedSelection=function(a){for(var e=[],k=0;k<this.selectedTiers.length;++k)e.push(this.tiers[this.selectedTiers[k]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=e.indexOf(this.tiers[a])&&
this.selectedTiers.push(a)};l.prototype.refreshTier=function(a,c){c=c||e;this.knownSpace&&this.knownSpace.invalidate(a,c)};l.prototype._ensureTiersGrouped=function(a){for(var e={},k=0;k<this.tiers.length;++k){var c=this.tiers[k];c.dasSource.tierGroup&&pusho(e,c.dasSource.tierGroup,c)}var b=[];a&&this.tiers.reverse();for(k=0;k<this.tiers.length;++k)if(c=this.tiers[k],c.dasSource.tierGroup){var f=e[c.dasSource.tierGroup];if(f){a&&f.reverse();for(var h=0;h<f.length;++h)b.push(f[h]);e[c.dasSource.tierGroup]=
null}}else b.push(c);a&&b.reverse();this.tiers.splice(0,this.tiers.length);for(h=0;h<b.length;++h)this.tiers.push(b[h])};l.prototype.arrangeTiers=function(){for(var e=[],c={},k=0;k<this.tiers.length;++k){var b=this.tiers[k];b.pinned&&(e.push(b),b.dasSource.tierGroup&&pusho(c,b.dasSource.tierGroup,b))}for(k=0;k<this.tiers.length;++k)b=this.tiers[k],b.pinned||(e.push(b),b.dasSource.tierGroup&&pusho(c,b.dasSource.tierGroup,b));for(var f in c){var b=c[f],h=this.tierGroups[f];h||(h={element:a("div",a("span",
f,{className:"tier-group-label"}),{className:"tier-group"})},this.tierGroups[f]=h);h.element.parentNode&&h.element.parentNode.removeChild(h.element);for(var n=b[0].pinned?this.pinnedTierHolder:this.tierHolder,u=1E7,d=0,k=0;k<b.length;++k)var A=b[k].row,u=Math.min(u,A.offsetTop),d=Math.max(d,A.offsetTop+A.offsetHeight);h.element.style.top=u+"px";h.element.style.left="0px";h.element.style.height=d-u+"px";n.appendChild(h.element)}if(this.tierBackgroundColors)for(k=0;k<e.length;++k)b=e[k],b.setBackground(this.tierBackgroundColors[k%
this.tierBackgroundColors.length]),b.label.style.left=b.dasSource.tierGroup?"18px":"2px",b.background=this.tierBackgroundColors[k%this.tierBackgroundColors.length]};l.prototype.refresh=function(){this.retrieveTierData(this.tiers,e);this.drawOverlays();this.positionRuler()};var e=function(a,e){e.draw();e.updateStatus(a)};l.prototype.retrieveTierData=function(a,e){this.notifyLocation();var k=100/this.scale|0,c=1E3/this.scale|0,b=(this.viewStart+this.viewEnd)/2,f=b-this.origin;this.origin=b;this.scaleAtLastRedraw=
this.scale;for(b=0;b<a.length;++b){var h=f;a[b].originHaxx&&(h+=a[b].originHaxx);a[b].originHaxx=h}f=this.targetQuantRes/this.scale;b=Math.max(1,(this.viewStart|0)-k);k=Math.min((this.viewEnd|0)+k,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);h=Math.max(1,(this.viewStart|0)-c);c=Math.min((this.viewEnd|0)+c,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var n=this.getSequenceSource();this.knownSpace&&this.knownSpace.cancel();this.knownSpace=
new M(this.tiers,this.chr,h,c,f,n)}(n=this.knownSpace.bestCacheOverlapping(this.chr,b,k))&&n.min<=b&&n.max>=k?(this.drawnStart=Math.max(n.min,h),this.drawnEnd=Math.min(n.max,c)):(this.drawnStart=h,this.drawnEnd=c);this.knownSpace.retrieveFeatures(a,this.chr,this.drawnStart,this.drawnEnd,f,e)};l.prototype.queryRegistry=function(a,e){if(this.registry){var k,c;a?(k=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new b),c=this.mappableSources[a]):(k=this.coordSystem,c=this.availableSources);
var h=p(f(k));if(e){var n=localStorage["dalliance.registry."+h+".last_queried"];if(n)try{if(g(c,JSON.parse(localStorage["dalliance.registry."+h+".sources"]),a),432E5>(Date.now()|0)-(n|0))return}catch(u){console.log("Bad registry cache: "+u)}}n=this.registry;if(0==n.indexOf("//")){var d=window.location.protocol;"https:"!=d&&"http:"!=d&&(n="http:"+n)}(new U(n)).sources(function(e){for(var b=[],f=0;f<e.length;++f){var n=e[f];if(n.coords&&0!=n.coords.length){var u=n.coords[0];u.taxon==k.taxon&&u.auth==
k.auth&&u.version==k.version&&b.push(n)}}localStorage["dalliance.registry."+h+".sources"]=JSON.stringify(b);localStorage["dalliance.registry."+h+".last_queried"]=""+Date.now();g(c,b,a)},function(a){},k)}};l.prototype.move=function(a,e){var k=this.viewEnd-this.viewStart,c=this.viewStart-1*a/this.scale,b=c+k;e||(0<this.currentSeqMax&&b>this.currentSeqMax&&(b=this.currentSeqMax,c=this.viewEnd-k),1>c&&(c=1,b=c+k));this.setLocation(null,c,b,null,e)};l.prototype.zoomStep=function(a){var e=1*this.zoomSliderValue;
a=e+a;a<this.zoomMin&&(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=e&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};l.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&
(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.notifyLocation();this.refresh()};l.prototype.spaceCheck=function(a){this.knownSpace&&this.knownSpace.chr===this.chr?(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};l.prototype.resizeViewer=
function(a){var e=this.tierHolder.getBoundingClientRect().width|0;if(0!=e){var k=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=e|0;k!=this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/
k,e=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-e+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+e-1),this.positionRuler(),a||this.spaceCheck(),this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};l.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(300,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-
20)+"px"};l.prototype.addTier=function(a){var e=this;a=n(a);a.disabled=!1;return this.makeTier(a).then(function(a){e.refreshTier(a);e.markSelectedTiers();e.positionRuler();e.notifyTier("added",a);return a})};l.prototype.removeTier=function(a,e){var k=-1;if("undefined"!==typeof a.index&&0<=a.index&&a.index<this.tiers.length)k=a.index;else for(var c=0;c<this.tiers.length;++c)if(H(a,this.tiers[c].dasSource)){k=c;break}if(0>k)throw"Couldn't find requested tier";c=this.tiers[k];this.tiers.splice(k,1);
for(var b=[],f=0;f<this.selectedTiers.length;++f){var h=this.selectedTiers[f];h<k?b.push(h):h>k&&b.push(h-1)}this.selectedTiers=b;this.markSelectedTiers();c.destroy();this.knownSpace&&(this.knownSpace.featureCache[c]=null);this.reorderTiers();this.notifyTier("removed",c)};l.prototype.removeAllTiers=function(){var a=this;this.selectedTiers=[];this.markSelectedTiers();this.tiers.forEach(function(e){e.destroy();a.knownSpace&&(a.knownSpace.featureCache[e]=null)});this.tiers.length=0;this.reorderTiers();
this.notifyTier("removedAll",null)};l.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};l.prototype._getSequenceSource=function(){for(var a=0;a<this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;for(a=0;a<this.defaultSources.length;++a){var e=this.defaultSources[a];if(e.provides_entrypoints||"sequence"==e.tier_type||e.twoBitURI||e.twoBitBlob)return e.twoBitURI||
e.twoBitBlob?new z(e):e.ensemblURI?new A(e):new N(e)}};l.prototype.setLocation=function(a,e,k,c,b){if("number"!==typeof e)throw Error("minimum must be a number (got "+JSON.stringify(e)+")");if("number"!==typeof k)throw Error("maximum must be a number (got "+JSON.stringify(k)+")");if(e>k){var f=e;e=k;k=f}else e===k&&(k+=1);c||(c=function(a){if(a)throw a;});var h=this;if((!a||a==this.chr)&&0<this.currentSeqMax)return this._setLocation(null,e,k,null,c,b);var n=this.getSequenceSource();if(!n)return c("Need a sequence source");
var u=a||this.chr;n.getSeqInfo(u,function(f){if(f)return h._setLocation(a,e,k,f,c,b);var d;d=0==u.indexOf("chr")?u.substr(3):"chr"+u;n.getSeqInfo(d,function(f){return!f&&a?c("Couldn't find sequence '"+a+"'"):f?h._setLocation(d,e,k,f,c,b):h._setLocation(null,e,k,null,c,b)})})};l.prototype._setLocation=function(a,e,k,c,b,f){var h=!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(h=!0),this.chr=a,this.currentSeqMax=c.length);e=parseFloat(e);k=parseFloat(k);a=Math.max(10,k-e+1);f||(f=this.currentSeqMax,
0>=f&&(f=1E12),1>e&&(e=1,k=e+a-1),k>f&&(k=f,e=Math.max(1,k-a+1)));this.viewStart=e;this.viewEnd=k;e=Math.max(this.featurePanelWidth||this.offscreenInitWidth,50)/(this.viewEnd-this.viewStart);f=1E-6<Math.abs(e-this.scale);this.scale=e;k=this.zoomSliderValue;this.zoomSliderValue=e=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);if(f||h){for(h=0;h<this.tiers.length;++h)this.tiers[h].viewportHolder.style.left="5000px",this.tiers[h].overlay.style.left="5000px";this.refresh();this.savedZoom?
(e-=this.zoomMin,k-=this.zoomMin,h=e-this.savedZoom,Math.abs(e-k)>Math.abs(h)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=k)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(h=0;h<this.tiers.length;++h)this.tiers[h].viewportHolder.style.left=""+((-((this.viewStart-this.tiers[h].norigin)*this.scale)|0)-1E3)+"px",this.tiers[h].drawOverlay();this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return b()};l.prototype.setCenterLocation=
function(a,e){var k=(this.viewEnd-this.viewStart)/2;this.setLocation(a,e-k,e+k)};l.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=0,e=0;e<this.tiers.length;++e)"none"!==this.tiers[e].loaderButton.style.display&&++a;0==a&&(a=Date.now()|0,console.log("Loading took "+(a-this.activityStartTime)+"ms"),this.activityStartTime=null)}};l.prototype.addInitListener=function(a){this.initListeners.push(a)};l.prototype.addFeatureListener=function(a,e){this.featureListeners.push(a)};
l.prototype.removeFeatureListener=function(a,e){var k=arrayIndexOf(this.featureListeners,a);0<=k&&this.featureListeners.splice(k,1)};l.prototype.notifyFeature=function(a,e,k,c){for(var b=0;b<this.featureListeners.length;++b)try{if(this.featureListeners[b](a,e,k,c))break}catch(f){console.log(f.stack)}};l.prototype.addFeatureHoverListener=function(a,e){this.featureHoverListeners.push(a)};l.prototype.removeFeatureHoverListener=function(a,e){var k=arrayIndexOf(this.featureHoverListeners,a);0<=k&&this.featureHoverListeners.splice(k,
1)};l.prototype.notifyFeatureHover=function(a,e,k,c){for(var b=0;b<this.featureHoverListeners.length;++b)try{this.featureHoverListeners[b](a,e,k,c)}catch(f){console.log(f.stack)}};l.prototype.addViewListener=function(a,e){this.viewListeners.push(a)};l.prototype.removeViewListener=function(a,e){var k=arrayIndexOf(this.viewListeners,a);0<=k&&this.viewListeners.splice(k,1)};l.prototype.notifyLocation=function(){var a=Math.max(1,this.viewStart|0),e=this.viewEnd|0;0<this.currentSeqMax&&e>this.currentSeqMax&&
(e=this.currentSeqMax);for(var k=0;k<this.viewListeners.length;++k)try{this.viewListeners[k](this.chr,a,e,this.zoomSliderValue,{current:this.zoomSliderValue,alternate:this.savedZoom+this.zoomMin||this.zoomMin,isSnapZooming:this.isSnapZooming,min:this.zoomMin,max:this.zoomMax},this.viewStart,this.viewEnd)}catch(c){console.log(c.stack)}};l.prototype.addTierListener=function(a){this.tierListeners.push(a)};l.prototype.removeTierListener=function(a){a=arrayIndexOf(this.tierListeners,a);0<=a&&this.tierListeners.splice(a,
1)};l.prototype.notifyTier=function(a,e){for(var k=0;k<this.tierListeners.length;++k)try{this.tierListeners[k](a,e)}catch(c){console.log(c.stack)}};l.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};l.prototype.removeRegionSelectListener=function(a){a=arrayIndexOf(this.regionSelectListeners,a);0<=a&&this.regionSelectListeners.splice(a,1)};l.prototype.notifyRegionSelect=function(a,e,k){for(var c=0;c<this.regionSelectListeners.length;++c)try{this.regionSelectListeners[c](a,
e,k)}catch(b){console.log(b.stack)}};l.prototype.highlightRegion=function(a,e,k){var c=this;if(a==this.chr)return this._highlightRegion(a,e,k);var b=this.getSequenceSource();if(!b)throw"Need a sequence source";b.getSeqInfo(a,function(f){if(f)return c._highlightRegion(a,e,k);var h;h=0==a.indexOf("chr")?a.substr(3):"chr"+a;b.getSeqInfo(h,function(a){if(a)return c._highlightRegion(h,e,k)})})};l.prototype._highlightRegion=function(a,e,k){for(var c=0;c<this.highlights.length;++c){var b=this.highlights[c];
if(b.chr==a&&b.min==e&&b.max==k)return}this.highlights.push(new m(a,e,k));c=this.viewStart-1E3/this.scale;b=this.viewEnd+1E3/this.scale;(a==this.chr||a=="chr"+this.chr)&&e<b&&k>c&&this.drawOverlays();this.notifyLocation()};l.prototype.clearHighlights=function(){this.highlights=[];this.drawOverlays();this.notifyLocation()};l.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};l.prototype.featuresInRegion=function(a,e,k){var c=[];if(a!==this.chr)return[];
for(a=0;a<this.tiers.length;++a)for(var b=this.tiers[a].currentFeatures||[],f=0;f<b.length;++f){var h=b[f];h.min<=k&&h.max>=e&&c.push(h)}return c};l.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};l.prototype.setSelectedTier=function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};l.prototype.markSelectedTiers=function(){for(var a=0;a<this.tiers.length;++a){var e=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?
e.classList.add("active"):e.classList.remove("active")}0<this.selectedTiers.length&&(a=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/2,a>document.body.scrollTop&&a+100<document.body.scrollTop+window.innerHeight&&this.browserHolder.focus())};l.prototype.addTierSelectionListener=function(a){this.tierSelectionListeners.push(a)};l.prototype.removeTierSelectionListener=function(a){a=arrayIndexOf(this.tierSelectionListeners,a);0<=a&&this.tierSelectionListeners.splice(a,1)};l.prototype.notifyTierSelection=
function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(e){console.log(e.stack)}};l.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};l.prototype.removeTierSelectionWrapListener=function(a){a=arrayIndexOf(this.tierSelectionWrapListeners,a);0<=a&&this.tierSelectionWrapListeners.splice(a,1)};l.prototype.notifyTierSelectionWrap=function(a){for(var e=0;e<this.tierSelectionWrapListeners.length;++e)try{this.tierSelectionWrapListeners[e](a)}catch(k){console.log(k.stack)}};
l.prototype.positionRuler=function(){var a="none",e="",k="";"center"==this.rulerLocation?(a="block",e=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",e="0px"):"right"==this.rulerLocation?(a="block",k="0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=e;this.ruler.style.right=k;this.singleBaseHighlight?(this.ruler2.style.display="block",this.ruler2.style.borderWidth="1px",1>this.scale?(this.ruler2.style.width="0px",this.ruler2.style.borderRightWidth="0px"):
(this.ruler2.style.width=this.scale+"px",this.ruler2.style.borderRightWidth="1px"),this.locSingleBase.style.visibility="visible",this.locSingleBase.style.left=""+(this.featurePanelWidth/2-this.locSingleBase.offsetWidth/2+this.ruler2.offsetWidth/2|0)+"px"):(this.locSingleBase.style.visibility="hidden",this.ruler2.style.width="1px",this.ruler2.style.borderWidth="0px",this.ruler2.style.display="center"==this.rulerLocation?"none":"block");this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var c=
0;c<this.tiers.length;++c){var b=this.tiers[c],f=b.quantOverlay,h;b.subtiers&&0<b.subtiers.length&&(h=b.subtiers[0].quant);f&&(f.style.display=h?a:"none",f.style.left=e,f.style.right=k)}};l.prototype.featureDoubleClick=function(a,e,k){if(a&&0!=a.length&&(k=a[a.length-1],k.min&&k.max)){var c=((k.min|0)-(this.viewStart|0))*this.scale,b=(k.max-k.min+1)*this.scale;a=((k.min|0)+(k.max|0))/2;10<b&&(e=1*(e-c)/b,0.3>e?a=k.min|0:0.7<e&&(a=(k.max|0)+1));e=this.viewEnd-this.viewStart;this.setLocation(null,a-
e/2,a+e/2)}};l.prototype.zoomForScale=function(a){return 0.2<a?"high":0.01<a?"medium":"low"};l.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};l.prototype.updateHeight=function(){for(var a=0,e=0;e<this.tiers.length;++e)a+=this.tiers[e].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px";this.browserHolder.style.display="block";this.browserHolder.style.display="-webkit-flex";this.browserHolder.style.display="flex"};l.prototype.scrollArrowKey=
function(a,e){this.reverseKeyScrolling&&(e=-e);if(a.ctrlKey||a.metaKey){var k=!1;a.shiftKey&&(k=!0);this.leap(e,k)}else if(1<this.scale){var k=(this.viewStart+this.viewEnd)/2,k=k-Math.round(k),c=1;a.shiftKey&&(c*=10);0<e?(c=-c-k,0<k&&(c+=1)):(c-=k,0>k&&(c-=1));this.setLocation(null,this.viewStart+c,this.viewEnd+c)}else this.move(a.shiftKey?100*e:25*e)};l.prototype.leap=function(a,e){var k=this,c=(k.viewStart+k.viewEnd+1)/2|0;0<a&&1>=k.viewStart?c-=1E8:0>a&&k.viewEnd>=k.currentSeqMax&&(c+=1E8);var b=
k.getSelectedTier();0>b||((b=k.tiers[b])&&(b.featureSource&&this.sourceAdapterIsCapable(b.featureSource,"quantLeap")&&"number"==typeof b.quantLeapThreshold||b.featureSource&&this.sourceAdapterIsCapable(b.featureSource,"leap"))?b.findNextFeature(k.chr,c,-a,e,function(b){if(b){var f=b.min,h=b.max;e&&(0<a?f>c+1?h=f:(h++,f=h):h<c-1?(h++,f=h):h=f);var n=k.viewEnd-k.viewStart+1;parseFloat(n/2)==parseInt(n/2)&&n--;f=(f+h-n)/2+1;k.setLocation(b.segment,f,f+n-1)}else alert("no next feature")}):this.move(100*
a))};l.prototype.nameForCoordSystem=function(a){var e=null,k=null;this.assemblyNamePrimary&&(e=""+a.auth,"undefined"!==typeof a.version&&(e+=a.version));this.assemblyNameUcsc&&(k=a.ucscName);return null!=e&&null!=k?e+"/"+k:e||k||"unknown"};l.prototype.makeLoader=function(e){var c=1<window.devicePixelRatio;return 20>(e||16)?a("img",null,{src:this.resolveURL("$$img/spinner_"+(c?16:32)+".gif"),width:"16",height:"16"}):a("img",null,{src:this.resolveURL("$$img/spinner_"+(c?24:48)+".gif"),width:"24",height:"24"})};
l.prototype.canFetchPlainHTTP=function(){var a=this;if(!this._plainHTTPPromise){var e=this.getWorker();this._plainHTTPPromise=e?new B(function(k,c){e.postCommand({command:"textxhr",uri:a.httpCanaryURL},function(a,e){a?k(!0):k(!1)})}):new B(function(e,c){s(a.httpCanaryURL,function(a,c){a?e(!0):e(!1)},{timeout:2E3})})}return this._plainHTTPPromise};l.prototype.getWorker=function(){if(!this.useFetchWorkers||!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&
(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};l.prototype.registerResolver=function(a){var e="res"+ ++this.resolverSeed;this.resolvers[e]=a;return e};r.prototype.postCommand=function(a,e,k){var c="x"+ ++this.tagSeed;a.tag=c;this.callbacks[c]=e;this.worker.postMessage(a,k)};if("undefined"!==typeof v){v.exports={Browser:l};d("./browser-ui");d("./track-adder");d("./feature-popup");d("./tier-actions");d("./domui");d("./search");v=d("./sourceadapters");var z=v.TwoBitSequenceSource,A=
v.EnsemblSequenceSource,N=v.DASSequenceSource,M=d("./kspace").KnownSpace,U=d("./das").DASRegistry}C.prototype.get=function(a){var e=this.sourcesByURI[K(a)];if(e)for(var k=0;k<e.configs.length;++k)if(u(e.configs[k],a))return e.sources[k]};C.prototype.put=function(a,e){var k=K(a),c=this.sourcesByURI[k];c||(c={configs:[],sources:[]},this.sourcesByURI[k]=c);c.configs.push(a);c.sources.push(e)}},{"./browser-ui":5,"./chainset":7,"./das":10,"./domui":11,"./feature-popup":19,"./kspace":23,"./numformats":26,
"./search":30,"./sha1":33,"./sourceadapters":34,"./sourcecompare":35,"./thub":42,"./tier":45,"./tier-actions":43,"./track-adder":46,"./utils":49,"./version":51,"es6-promise":53}],7:[function(d,v,t){function m(a,c,b,h){"string"==typeof a?(this.uri=a,this.srcTag=c,this.destTag=b,this.coords=h):(this.uri=a.uri,this.srcTag=a.srcTag,this.destTag=a.destTag,this.coords=f(a.coords),this.type=a.type,this.credentials=a.credentials);this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={};this.fetchedTiles=
{};this.granularity=1E6;this.chainFetcher="bigbed"==this.type?new g(this.uri,this.credentials):"alias"==this.type?new C(a):new l(this.uri,this.srcTag,this.destTag)}function l(a,c,f){this.source=new b(a);this.srcTag=c;this.destTag=f}function g(a,c){var b=this;this.uri=a;this.credentials=c;this.bwg=new p(function(a,c){h(new s(b.uri,{credentials:b.credentials,resolver:b.resolver}),function(b,f){b?a(b):c(f)})});this.bwg.then(function(a,c){c&&console.log(c)})}function q(a){return parseInt(a)}function r(a){return 0==
a.indexOf("chr")?a.substr(3):a}function x(a){var c={srcChr:r(a.srcChrom),srcMin:parseInt(a.srcStart),srcMax:parseInt(a.srcEnd),srcOri:a.srcOri,destChr:r(a.segment),destMin:a.min-1,destMax:a.max,destOri:a.ori,blocks:[]},b=a.srcStarts.split(",").map(q),f=a.destStarts.split(",").map(q);a=a.blockLens.split(",").map(q);for(var h=0;h<b.length;++h)c.blocks.push([b[h],f[h],a[h]]);return c}function C(a){this.conf=a;this.forwardAliases={};a=a.sequenceAliases||[];for(var c=0;c<a.length;++c){var b=a[c];if(!(2>
b.length)){for(var f=[],h=0;h<b.length-1;++h)f.push(b[h]);this.forwardAliases[b[b.length-1]]=f}}}if("undefined"!==typeof d){t=d("./das");var b=t.DASSource,a=t.DASSegment;t=d("./utils");var c=t.pusho,f=t.shallowCopy,n=d("./cigar").parseCigar,s=d("./bin").URLFetchable,h=d("./bigwig").makeBwg,p=d("es6-promise").Promise}m.prototype.exportConfig=function(){return{uri:this.uri,srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};m.prototype.mapPoint=function(a,
c){for(var b=this.chainsBySrc[a]||[],f=0;f<b.length;++f){var h=b[f];if(c>=h.srcMin&&c<=h.srcMax){var n;n="-"==h.srcOri?h.srcMax-c:c-h.srcMin;for(var d=h.blocks,u=0;u<d.length;++u){var s=d[u],e=s[0],z=s[1],s=s[2];if(n>=e&&n<=e+s)return b=n-e,{seq:h.destChr,pos:"-"==h.destOri?h.destMax-z-b:b+z+h.destMin,flipped:h.srcOri!=h.destOri}}}}return null};m.prototype.mapSegment=function(a,c,b){a=this.chainsBySrc[a]||[];for(var f=[],h=0;h<a.length;++h){var n=a[h];if(b>=n.srcMin&&c<=n.srcMax){var d,u;"-"==n.srcOri?
(d=n.srcMax-b,u=n.srcMax-c):(d=c-n.srcMin,u=b-n.srcMin);for(var s=n.blocks,e=0;e<s.length;++e){var z=s[e],A=z[0],p=z[1],z=z[2];if(u>=A&&d<=A+z){var g={segment:n.destChr,flipped:"-"==n.srcOri^"-"==n.destOri};"-"==n.destOri?(d>=A?g.max=n.destMax-p-d+A:(g.max=n.destMax-p,g.partialMax=A-d),u<=A+z?g.min=n.destMax-p-u+A:(g.min=n.destMax-p-z,g.partialMin=u-A-z)):(d>=A?g.min=n.destMin+p+d-A:(g.min=n.destMin+p,g.partialMin=A-d),u<=A+z?g.max=n.destMin+p+u-A:(g.max=n.destMin+p+z,g.partialMax=u-A-z));f.push(g)}}}}return f};
m.prototype.unmapPoint=function(a,c){for(var b=this.chainsByDest[a]||[],f=0;f<b.length;++f){var h=b[f];if(c>=h.destMin&&c<=h.destMax){var n;n="-"==h.srcOri?h.destMax-c:c-h.destMin;for(var d=h.blocks,u=0;u<d.length;++u){var s=d[u],e=s[0],z=s[1],s=s[2];if(n>=z&&n<=z+s)return b=n-z,f=b+e+h.srcMin,f="-"==h.destOri?h.srcMax-e-b:b+e+h.srcMin,{seq:h.srcChr,pos:f,flipped:h.srcOri!=h.destOri}}}}return null};m.prototype.sourceBlocksForRange=function(b,f,h,n){for(var d=this,s=f/this.granularity|0,p=h/this.granularity|
0,u=!1,g=s;g<=p;++g){var e=b+"_"+g;2!=this.fetchedTiles[e]&&(u=!0,1!=this.fetchedTiles[e]&&(this.fetchedTiles[e]=1))}if(u)this.postFetchQueues[b]||this.chainFetcher.fetchChains(b,s*this.granularity,(p+1)*this.granularity-1).then(function(a){d.chainsByDest||(d.chainsByDest[b]=[]);for(var e=0;e<a.length;++e){var k=a[e],c=d.chainsBySrc[k.srcChr];if(c){for(var f=!1,h=0;h<c.length;++h){var n=c[h];if(n.srcMin==k.srcMin&&n.srcMax==k.srcMax){f=!0;break}}f||c.push(k)}else d.chainsBySrc[k.srcChr]=[k];if(c=
d.chainsByDest[k.destChr]){f=!1;for(h=0;h<c.length;++h)if(n=c[h],n.destMin==k.destMin&&n.destMax==k.destMax){f=!0;break}f||c.push(k)}else d.chainsByDest[k.destChr]=[k]}for(a=s;a<=p;++a)d.fetchedTiles[b+"_"+a]=2;if(d.postFetchQueues[b]){a=d.postFetchQueues[b];for(e=0;e<a.length;++e)a[e]();d.postFetchQueues[b]=null}}).catch(function(a){console.log(a)}),c(this.postFetchQueues,b,function(){d.sourceBlocksForRange(b,f,h,n)});else{u=[];g=this.chainsByDest[b]||[];for(e=0;e<g.length;++e){var z=g[e];if(f<=
z.destMax&&h>=z.destMin){var A,r;"-"==z.srcOri?(A=z.destMax-h,r=z.destMax-f):(A=f-z.destMin,r=h-z.destMin);for(var q=z.blocks,l=0;l<q.length;++l){var y=q[l],m=y[0],k=y[1],I=y[2];r>=k&&A<=k+I&&(y=Math.max(A,k)-k,k=Math.min(r,k+I)-k,"-"==z.destOri?u.push(new a(z.srcChr,z.srcMax-m-k,z.srcMax-m-y)):u.push(new a(z.srcChr,z.srcMin+y+m,z.srcMin+k+m)))}}}n(u)}};l.prototype.fetchChains=function(a,c,b){var f=this;return new p(function(c,b){f.source.alignments(a,{},function(a){for(var b=[],h=0;h<a.length;++h)for(var e=
a[h],d=0;d<e.blocks.length;++d){for(var A=e.blocks[d],s,g,p=0;p<A.segments.length;++p){var y=A.segments[p],r=e.objects[y.object];r.dbSource===f.srcTag?s=y:r.dbSource===f.destTag&&(g=y)}if(s&&g){for(var A={srcChr:e.objects[s.object].accession,srcMin:s.min|0,srcMax:s.max|0,srcOri:s.strand,destChr:e.objects[g.object].accession,destMin:g.min|0,destMax:g.max|0,destOri:g.strand,blocks:[]},p=n(s.cigar),y=n(g.cigar),k=r=0,I=0,B=0;I<p.length&&B<y.length;)if("M"==p[I].op&&"M"==y[B].op){var l=Math.min(p[I].cnt,
y[B].cnt);A.blocks.push([r,k,l]);p[I].cnt==l?++I:p[I].cnt-=l;y[B].cnt==l?++B:y[B]-=l;r+=l;k+=l}else"I"==p[I].op?k+=p[I++].cnt:"I"==y[B].op&&(r+=y[B++].cnt);b.push(A)}}c(b)})})};g.prototype.fetchChains=function(a,c,b){return this.bwg.then(function(f,h){if(!f)throw Error("No BWG");return new p(function(h,n){f.getUnzoomedView().readWigData(a,c,b,function(a){h(a.map(x))})})})};C.prototype.fetchChains=function(a,c,b){c=[];b=this.forwardAliases[a]||[];for(var f=0;f<b.length;++f)c.push({srcChr:b[f],srcMin:1,
srcMax:1E9,srcOri:"+",destChr:a,destMin:1,destMax:1E9,destOri:"+",blocks:[[1,1,1E9]]});return p.resolve(c)};"undefined"!==typeof v&&(v.exports={Chainset:m})},{"./bigwig":3,"./bin":4,"./cigar":8,"./das":10,"./utils":49,"es6-promise":53}],8:[function(d,v,t){function m(d){for(var q=[],r;null!=(r=l.exec(d));){var m=r[1];0==m.length&&(m=1);q.push({cnt:m|0,op:r[2]})}return q}var l=/([0-9]*)([MIDS])/g;"undefined"!==typeof v&&(v.exports={parseCigar:m})},{}],9:[function(d,v,t){function m(a,c,b,n){this.red=
a|0;this.green=c|0;this.blue=b|0;n&&(this.name=n)}function l(a){a="00"+a.toString(16);return a.substring(a.length-2)}function g(a){var c=x[a];c||((c=C.exec(a))?c=new m("0x"+c[1]|0,"0x"+c[2]|0,"0x"+c[3]|0,a):(c=b.exec(a))?c=new m(c[1]|0,c[2]|0,c[3]|0,a):(console.log("couldn't handle color: "+a),c=x.black),x[a]=c);return c}function q(a,c,b){for(var n=[],d=0;d<b.length;++d)n.push(g(b[d]));b=[];d=0;a:for(;d<a;++d){for(var h=c[0]+1*d/(a-1)*(c[c.length-1]-c[0]),p=0;p<c.length-1;++p)if(h>=c[p]&&h<=c[p+1]){var h=
(h-c[p])/(c[p+1]-c[p]),r=n[p],p=n[p+1],p=(new m(r.red*(1-h)+p.red*h|0,r.green*(1-h)+p.green*h|0,r.blue*(1-h)+p.blue*h|0)).toSvgString();b.push(p);continue a}throw"Bad step";}return b}function r(a,c,b,n){return n?q(a,[0,0.5,1],[c,b,n]):q(a,[0,1],[c,b])}m.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};m.prototype.toHexString=function(){return"#"+l(this.red)+l(this.green)+l(this.blue)};var x={red:new m(255,0,0,"red"),green:new m(0,
255,0,"green"),blue:new m(0,0,255,"blue"),yellow:new m(255,255,0,"yellow"),white:new m(255,255,255,"white"),black:new m(0,0,0,"black"),gray:new m(180,180,180,"gray"),grey:new m(180,180,180,"grey"),lightskyblue:new m(135,206,250,"lightskyblue"),lightsalmon:new m(255,160,122,"lightsalmon"),hotpink:new m(255,105,180,"hotpink")},C=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,b=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;"undefined"!==typeof v&&(v.exports={makeColourSteps:q,makeGradient:r,dasColourForName:g})},
{}],10:[function(d,v,t){function m(a,c,e,b){this.name=a;this.start=c;this.end=e;this.description=b}function l(a,c){var e;"string"==typeof a?(this.uri=a,e=c||{}):e=a||{};for(var b in e)this[b]=e[b];this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function g(){}function q(a,c){return a.taxon==c.taxon&&a.auth==c.auth&&a.version==c.version}function r(a,c,e,b,f){this.name=a;this.start=c;this.end=
e;this.alphabet=b;this.seq=f}function x(){}function C(a){a&&(this.id=a)}function b(a,c){this.desc=a;this.uri=c}function a(a){this.type=a;this.objects={};this.blocks=[]}function c(){this.styles=[]}function f(){}function n(a,c){c=c||{};this.uri=a;this.opts=c}function s(a,c){var e=a.getElementsByTagName(c);if(0<e.length&&e[0].firstChild){e=e[0];if(1==e.childNodes.length)return e.firstChild.nodeValue;for(var b="",f=0;f<e.childNodes.length;++f)b+=e.childNodes[f].nodeValue;return b}return null}function h(a){for(var c=
[],e=a.getElementsByTagName("LINK"),f=0;f<e.length;++f){var h=e[f];h.parentNode==a&&c.push(new b(h.firstChild?h.firstChild.nodeValue:"Unknown",h.getAttribute("href")))}return c}function p(a){var c=[];a=a.getElementsByTagName("NOTE");for(var e=0;e<a.length;++e)a[e].firstChild&&c.push(a[e].firstChild.nodeValue);return c}function F(a,c,e,b){if(window.XDomainRequest){var f=new XDomainRequest;f.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(f.responseText);c(a)};f.open("get",
a);f.send("")}else try{var f=new XMLHttpRequest,h=setTimeout(function(){console.log("timing out "+a);f.abort();c(null,f)},5E3);f.timeout=5E3;f.ontimeout=function(){console.log("timeout on "+a)};f.onreadystatechange=function(){4==f.readyState&&(clearTimeout(h),(200<=f.status||0==f.status)&&c(f.responseXML,f))};f.open("get",a,!0);e&&(f.withCredentials=!0);b&&f.setRequestHeader("X-DAS-Authorisation",b);f.overrideMimeType("text/xml");f.setRequestHeader("Accept","application/xml,*/*");f.send("")}catch(n){c(null,
f,n)}}function S(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function D(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function w(a){var c=G(a);c.styles=[];for(var e=0;e<a.styles.length;++e){var b=c.styles[e]=G(a.styles[e]);b._methodRE=b._labelRE=b._typeRE=void 0;b.style=G(b.style);b.style.id=void 0;b.style._gradient=void 0}return c}if("undefined"!==typeof d){t=d("./utils");var G=t.shallowCopy,B=t.pusho,H=d("./color").makeColourSteps}m.prototype.toString=function(){return this.name+
":"+this.start+".."+this.end};m.prototype.isBounded=function(){return this.start&&this.end};m.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};l.prototype.getURI=function(a){return this.resolver?this.resolver(a).then(function(a){return"string"===typeof a?a:a.url}):Promise.resolve(a)};l.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(c){if(!c)return a([]);var e=[];c=c.getElementsByTagName("SEGMENT");
for(var b=0;b<c.length;++b){var f=c[b],h=f.getAttribute("id"),n=f.getAttribute("size"),d;n?(d=1,n|=0):((d=f.getAttribute("start"))&&(d|=0),(n=f.getAttribute("stop"))&&(n|=0));var s=null;f.firstChild&&(s=f.firstChild.nodeValue);e.push(new m(h,d,n,s))}a(e)})};l.prototype.sequence=function(a,c){var e=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(e,function(a){if(a){var e=[];a=a.getElementsByTagName("SEQUENCE");for(var b=0;b<a.length;++b){var f=a[b],h=f.getAttribute("id"),n=f.getAttribute("start"),
d=f.getAttribute("stop"),k=null;if(f.firstChild)for(var f=f.firstChild.nodeValue,k="",s=0;;){var p=f.indexOf("\n",s);if(0<=p)k+=f.substring(s,p).toUpperCase(),s=p+1;else{k+=f.substring(s).toUpperCase();break}}e.push(new r(h,n,d,"DNA",k))}c(e)}else c([])})};l.prototype.features=function(a,c,e){c=c||{};var b;if(this.features_uri)b=this.features_uri;else{var f=[];if(a)f.push(a.toDASQuery());else if(c.group)if(a=c.group,"string"==typeof a)f.push("group_id="+a);else for(var n=0;n<a.length;++n)f.push("group_id="+
a[n]);if(c.adjacent)for(a=c.adjacent,"string"==typeof a&&(a=[a]),n=0;n<a.length;++n)f.push("adjacent="+a[n]);if(c.type)if("string"==typeof c.type)f.push("type="+c.type);else for(a=0;a<c.type.length;++a)f.push("type="+c.type[a]);c.maxbins&&f.push("maxbins="+c.maxbins);0<f.length?b=this.dasBaseURI+"features?"+f.join(";"):e([],"No filters specified")}this.doCrossDomainRequest(b,function(a,c){if(a){for(var b=[],f={},k=a.getElementsByTagName("SEGMENT"),n=0;n<k.length;++n){var d=k[n],g=d.getAttribute("id");
f[g]={min:d.getAttribute("start"),max:d.getAttribute("stop")};for(var d=d.getElementsByTagName("FEATURE"),A=0;A<d.length;++A){var u=d[A],z=new x;z.segment=g;z.id=u.getAttribute("id");z.label=u.getAttribute("label");var w=s(u,"START"),r=s(u,"END");(w|0)>(r|0)?(z.min=r|0,z.max=w|0):(z.min=w|0,z.max=r|0);w=u.getElementsByTagName("TYPE");0<w.length&&(w=w[0],w.firstChild&&(z.type=w.firstChild.nodeValue),z.typeId=w.getAttribute("id"),z.typeCv=w.getAttribute("cvId"));z.type=s(u,"TYPE");!z.type&&z.typeId&&
(z.type=z.typeId);z.method=s(u,"METHOD");(w=s(u,"ORIENTATION"))||(w="0");z.orientation=w;z.score=s(u,"SCORE");z.links=h(u);z.notes=p(u);w=u.getElementsByTagName("GROUP");for(r=0;r<w.length;++r){var B=w[r],l=new C;l.type=B.getAttribute("type");l.id=B.getAttribute("id");l.links=h(B);l.notes=p(B);z.groups?z.groups.push(l):z.groups=Array(l)}if(z.notes)for(w=0;w<z.notes.length;++w)r=z.notes[w],0==r.indexOf("Genename=")&&(B=new C,B.type="gene",B.id=r.substring(9),z.groups?z.groups.push(B):z.groups=Array(B));
w=u.getElementsByTagName("PART");if(0<w.length){B=[];for(r=0;r<w.length;++r)B.push(w[r].getAttribute("id"));z.parts=B}w=u.getElementsByTagName("PARENT");if(0<w.length){u=[];for(r=0;r<w.length;++r)u.push(w[r].getAttribute("id"));z.parents=u}b.push(z)}}e(b,void 0,f)}else e([],"Failed request: "+(0==c.status?"server may not support CORS":"status="+c.status))},function(a){e([],a)})};l.prototype.alignments=function(c,b,e){var f=this.dasBaseURI+"alignment?query="+c;this.doCrossDomainRequest(f,function(c){if(c){var b=
[];c=c.getElementsByTagName("alignment");for(var h=0;h<c.length;++h){for(var n=c[h],d=new a(n.getAttribute("alignType")),p=n.getElementsByTagName("alignObject"),k=0;k<p.length;++k){var g=p[k],g={id:g.getAttribute("intObjectId"),accession:g.getAttribute("dbAccessionId"),version:g.getAttribute("objectVersion"),dbSource:g.getAttribute("dbSource"),dbVersion:g.getAttribute("dbVersion")};d.objects[g.id]=g}n=n.getElementsByTagName("block");for(p=0;p<n.length;++p){for(var g=n[p],k={order:g.getAttribute("blockOrder"),
segments:[]},g=g.getElementsByTagName("segment"),u=0;u<g.length;++u){var w=g[u],w={object:w.getAttribute("intObjectId"),min:w.getAttribute("start"),max:w.getAttribute("end"),strand:w.getAttribute("strand"),cigar:s(w,"cigar")};k.segments.push(w)}d.blocks.push(k)}b.push(d)}e(b)}else e([],"Failed request "+f)})};c.prototype.pushStyle=function(a,c,e){a||(a={type:"default"});a=G(a);c&&(a.zoom=c);a.style=e;this.styles.push(a)};l.prototype.stylesheet=function(a,b){var e,h=this.credentials;this.stylesheet_uri?
(e=this.stylesheet_uri,h=!1):e=this.dasBaseURI+"stylesheet";this.getURI(e).then(function(e){F(e,function(e){if(e){var h=new c;e=e.getElementsByTagName("TYPE");for(var n=0;n<e.length;++n){var d=e[n],s={};s.type=d.getAttribute("id");s.label=d.getAttribute("label");s.method=d.getAttribute("method");for(var d=d.getElementsByTagName("GLYPH"),k=0;k<d.length;++k){var g=d[k],p=g.getAttribute("zoom"),z;a:{if(g.hasChildNodes()){g=g.firstChild;do{if(g.nodeType==Node.ELEMENT_NODE){z=g;break a}g=g.nextSibling}while(null!=
g)}z=null}g=new f;g.glyph=z.localName;for(z=z.firstChild;z;){if(z.nodeType==Node.ELEMENT_NODE)if("BGGRAD"==z.localName){var A=g,w=z.localName,r,B=z;r=(r=B.getAttribute("steps"))?r|0:50;for(var l=[],q=[],B=B.getElementsByTagName("STOP"),m=0;m<B.length;++m){var D=B[m];l.push(1*D.getAttribute("score"));q.push(D.firstChild.nodeValue)}r=H(r,l,q);A[w]=r}else g[z.localName]=z.firstChild.nodeValue;z=z.nextSibling}h.pushStyle(s,p,g)}}a(h)}else b&&b()},h)}).catch(function(a){console.log(a);b()})};n.prototype.sources=
function(a,c,e){e||(e={});var b=[];e.taxon&&b.push("organism="+e.taxon);e.auth&&b.push("authority="+e.auth);e.version&&b.push("version="+e.version);e=this.uri;0<b.length&&(e=e+"?"+b.join("&"));F(e,function(e){if(!e&&c)c();else{var b=[];e=e.getElementsByTagName("SOURCE");for(var f=0;f<e.length;++f){var h=e[f],n=h.getElementsByTagName("VERSION");if(!(1>n.length)){for(var d=n[0],k=d.getElementsByTagName("COORDINATES"),n=[],s=0;s<k.length;++s){var p=k[s],z=new g;z.auth=p.getAttribute("authority");z.taxon=
p.getAttribute("taxid");z.version=p.getAttribute("version");n.push(z)}for(var k=[],p=d.getElementsByTagName("CAPABILITY"),w,s=0;s<p.length;++s)z=p[s],k.push(z.getAttribute("type")),"das1:features"==z.getAttribute("type")&&(w=z.getAttribute("query_uri"),w=w.substring(0,w.length-8));s={};d=d.getElementsByTagName("PROP");for(p=0;p<d.length;++p)B(s,d[p].getAttribute("name"),d[p].getAttribute("value"));w&&(h=new l(w,{source_uri:h.getAttribute("uri"),name:h.getAttribute("title"),desc:h.getAttribute("description"),
coords:n,props:s,capabilities:k}),b.push(h))}}a(b)}})};l.prototype.doCrossDomainRequest=function(a,c,e){var b;this.xUser&&(b="Basic "+btoa(this.xUser+":"+this.xPass));try{return F(a,c,this.credentials,b)}catch(f){if(e)e(f);else throw f;}};"undefined"!==typeof v&&(v.exports={DASGroup:C,DASFeature:x,DASStylesheet:c,DASStyle:f,DASSource:l,DASSegment:m,DASRegistry:n,DASSequence:r,DASLink:b,isDasBooleanTrue:S,isDasBooleanNotFalse:D,copyStylesheet:w,coordsMatch:q})},{"./color":9,"./utils":49}],11:[function(d,
v,t){function m(d,l,q){function b(){q?(a.className="fa fa-caret-down",l.style.display="table"):(a.className="fa fa-caret-right",l.style.display="none")}var a=g("i");b();a.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();q=!q;b()},!1);d=g("h6",[a," ",d],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return g("div",[d,l],{})}if("undefined"!==typeof d){var l=d("./cbrowser").Browser;d=d("./utils");var g=d.makeElement,q=d.removeChildren}l.prototype.removeAllPopups=
function(){q(this.hPopupHolder);q(this.popupHolder)};l.prototype.makeTooltip=function(d,l){var q=!1,b=this,a=null,c;c=function(b){q=!1;a&&(clearTimeout(a),a=null);d.removeEventListener("mouseout",c,!1)};var f=function(c){var s=c.clientX+window.scrollX,h=c.clientY+window.scrollY;a||(a=setTimeout(function(){var c;c="function"===typeof l?l():l;var n=g("div",[g("div",null,{className:"tooltip-arrow"}),g("div",c,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(h+20)+
"px",left:""+Math.max(s-30,20)+"px"});b.hPopupHolder.appendChild(n);var m;m=function(a){try{b.hPopupHolder.removeChild(n)}catch(c){}window.removeEventListener("mousemove",m,!1);q&&null!=d.offsetParent&&f(a)};window.addEventListener("mousemove",m,!1);a=null},1E3))};d.addEventListener("mouseover",function(a){q=!0;d.addEventListener("mouseout",c,!1);f(a)},!1);d.addEventListener("DOMNodeRemovedFromDocument",function(c){q=!1;a&&(clearTimeout(a),a=null)},!1)};l.prototype.popit=function(d,l,q,b){var a=this;
b||(b={});d||(d={});var c=b.width||200,f;d.clientX?(b=d.clientX,f=d.clientY):(b=500,f=50);b+=document.documentElement.scrollLeft||document.body.scrollLeft;f+=document.documentElement.scrollTop||document.body.scrollTop;var n=window.innerWidth,s=f,h=Math.min(b-c/2-4,n-c-30),p=g("div");p.className="popover fade "+(d.clientX?"bottom ":"")+"in";p.style.display="block";p.style.position="absolute";p.style.top=""+s+"px";p.style.left=""+h+"px";p.style.width=c+"px";276<c&&(p.style.maxWidth=c+"px");p.appendChild(g("div",
null,{className:"arrow"}));if(l){var m=g("button","",{className:"close"});m.innerHTML="&times;";m.addEventListener("mouseover",function(a){m.style.color="red"},!1);m.addEventListener("mouseout",function(a){m.style.color="black"},!1);m.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();a.removeAllPopups()},!1);d=g("h4",[g("span",l,null,{maxWidth:"200px"}),m],{},{paddingLeft:"10px",paddingRight:"10px"});var S,D,w,G;w=function(a){a.stopPropagation();a.preventDefault();h+=a.clientX-
S;8>h&&(h=8);h>n-c-32&&(h=n-c-26);s+=a.clientY-D;s=Math.max(10,s);p.style.top=""+s+"px";p.style.left=""+Math.min(h,n-c-10)+"px";S=a.clientX;D=a.clientY};G=function(a){a.stopPropagation();a.preventDefault();window.removeEventListener("mousemove",w,!1);window.removeEventListener("mouseup",G,!1)};d.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();S=a.clientX;D=a.clientY;window.addEventListener("mousemove",w,!1);window.addEventListener("mouseup",G,!1)},!1);p.appendChild(d)}p.appendChild(g("div",
q,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(p);var B={node:p,displayed:!0};p.addEventListener("DOMNodeRemoved",function(a){a.target==p&&(B.displayed=!1)},!1);return B};"undefined"!==typeof v&&(v.exports={makeTreeTableSection:m})},{"./cbrowser":6,"./utils":49}],12:[function(d,v,t){function m(d,g){0>d.indexOf("?")&&(d+="?soft=true");return new q(function(l,b){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(300<=a.status)b("Error code "+
a.status);else{var c=JSON.parse(a.response);l(g?c:c.location)}};a.open("GET",d,!0);a.setRequestHeader("Accept","application/json");a.responseType="text";a.send("")})}function l(d){this.rawurl=d}function g(d,g,q,b){b||("object"===typeof g?(b=g,g=void 0):b={});this.url="string"===typeof d?new l(d):d;this.start=g||0;q&&(this.end=q);this.opts=b}if("undefined"!==typeof d)var q=d("es6-promise").Promise;l.prototype.getURLPromise=function(){this.urlPromise&&this.urlPromiseValidity>Date.now()||(this.urlPromise=
m(this.rawurl,!0).then(function(d){return d.location}),this.urlPromiseValidity=Date.now()+432E5);return this.urlPromise};g.prototype.slice=function(d,l){if(0>d)throw"Bad slice "+d;var q=this.start,b=this.end,q=q&&d?q+d:d||q;return new g(this.url,q,l&&q?q+l-1:b||l-1,this.opts)};g.prototype.fetchAsText=function(d){var g=this,l=new XMLHttpRequest;g.url.getURLPromise().then(function(b){l.open("GET",b,!0);if(g.end){if(1E8<g.end-g.start)throw"Monster fetch!";l.setRequestHeader("Range","bytes="+g.start+
"-"+g.end)}l.onreadystatechange=function(){if(4==l.readyState)return 200==l.status||206==l.status?d(l.responseText):d(null)};g.opts.credentials&&(l.withCredentials=!0);l.send("")}).catch(function(b){console.log(b);return d(null)})};g.prototype.salted=function(){return this};g.prototype.fetch=function(d,g,l){var b=this;g=g||1;if(3<g)return d(null);b.url.getURLPromise().then(function(a){var c=new XMLHttpRequest,f;c.open("GET",a,!0);c.overrideMimeType("text/plain; charset=x-user-defined");if(b.end){if(1E8<
b.end-b.start)throw"Monster fetch!";c.setRequestHeader("Range","bytes="+b.start+"-"+b.end);f=b.end-b.start+1}c.responseType="arraybuffer";c.onreadystatechange=function(){if(4==c.readyState){if(200==c.status||206==c.status){if(c.response){var a=c.response.byteLength;return!f||f==a||l&&a==l?d(c.response):b.fetch(d,g+1,a)}if(c.mozResponseArrayBuffer)return d(c.mozResponseArrayBuffer);a=c.responseText;if(!f||f==a.length||l&&a.length==l){if(a=c.responseText){for(var s=new Uint8Array(a.length),h=0;h<s.length;++h)s[h]=
a.charCodeAt(h);a=s.buffer}else a=null;return d(a)}return b.fetch(d,g+1,a.length)}return b.fetch(d,g+1)}};b.opts.credentials&&(c.withCredentials=!0);c.send("")}).catch(function(a){console.log(a)})};"undefined"!==typeof v&&(v.exports={lookupEncodeURI:m,EncodeFetchable:g})},{"es6-promise":53}],13:[function(d,v,t){function m(b){g.call(this);this.source=b;this.base=b.uri||"//rest.ensembl.org";if(0===this.base.indexOf("//")){var a=window.location.protocol;"http:"!=a&&"https:"!=a&&(this.base="http:"+this.base)}this.species=
b.species||"human";this.type="string"===typeof b.type?[b.type]:b.type||["regulatory"]}if("undefined"!==typeof d){v=d("./sourceadapters");var l=v.registerSourceAdapterFactory,g=v.FeatureSourceBase;d=d("./das");var q=d.DASStylesheet,r=d.DASStyle,x=d.DASFeature,C=d.DASGroup}m.prototype=Object.create(g.prototype);m.prototype.constructor=m;m.prototype.getStyleSheet=function(b){var a=new q,c=new r;c.glyph="__NONE";0<=this.type.indexOf("exon")&&a.pushStyle({type:"transcript"},null,c);(0<=this.type.indexOf("exon")||
0<=this.type.indexOf("transcript"))&&a.pushStyle({type:"gene"},null,c);c=new r;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="red";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=10;a.pushStyle({type:"cds"},null,c);c=new r;c.glyph="SQUARE";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";a.pushStyle({type:"variation",method:".+_UTR_variant"},null,c);c=new r;c.glyph="TRIANGLE";c.DIRECTION="S";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";a.pushStyle({type:"variation",method:"missense_variant"},null,c);c=new r;c.glyph=
"TRIANGLE";c.DIRECTION="N";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";a.pushStyle({type:"variation",method:"splice_.+_variant"},null,c);c=new r;c.glyph="STAR";c.POINTS=6;c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";a.pushStyle({type:"variation",method:"regulatory_region_variant"},null,c);c=new r;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(50,80,255)";c.STROKECOLOR="black";a.pushStyle({type:"variation"},null,c);c=new r;c.glyph="SQUARE";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR=
"red";a.pushStyle({type:"indel",method:".+_UTR_variant"},null,c);c=new r;c.glyph="TRIANGLE";c.DIRECTION="S";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";a.pushStyle({type:"indel",method:"missense_variant"},null,c);c=new r;c.glyph="TRIANGLE";c.DIRECTION="N";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";a.pushStyle({type:"indel",method:"splice_.+_variant"},null,c);c=new r;c.glyph="STAR";c.POINTS=6;c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";a.pushStyle({type:"indel",
method:"regulatory_region_variant"},null,c);c=new r;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";c.STROKECOLOR="black";a.pushStyle({type:"indel"},null,c);c=new r;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="orange";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;a.pushStyle({type:"default"},null,c);return b(a)};m.prototype.getScales=function(){return[]};m.prototype.fetch=function(b,a,c,f,d,s,h){var g=this;a=this.base+"/overlap/region/"+this.species+"/"+b+":"+a+"-"+c;
c=[];for(f=0;f<this.type.length;++f)c.push("feature="+this.type[f]);c.push("content-type=application/json");a=a+"?"+c.join(";");var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4==l.readyState)if(g.busy--,g.notifyActivity(),300<=l.status){var a="Error code "+l.status;try{var c=JSON.parse(l.response);c.error&&(a=c.error)}catch(f){}h(a,null)}else{for(var a=JSON.parse(l.response),c=[],d=0;d<a.length;++d){var n=a[d],s=[],u=new x;u.segment=b;u.min=n.start|0;u.max=n.end|0;u.type=n.feature_type||
"unknown";u.id=n.ID;if(n.Parent){var q=new C;q.id=n.Parent;u.groups=[q]}n.strand&&(0>n.strand?u.orientation="-":0<n.strand&&(u.orientation="+"));n.consequence_type&&(u.method=n.consequence_type);n.alt_alleles&&(s.push("Alleles="+n.alt_alleles.join("/")),1<n.alt_alleles.length&&(n.alt_alleles[1].length!=n.alt_alleles[0].length||"-"==n.alt_alleles[1])&&(u.type="indel"));0<s.length&&(u.notes=s);c.push(u)}h(null,c)}};g.busy++;g.notifyActivity();l.open("GET",a,!0);l.responseType="text";l.send("")};l("ensembl",
function(b){return{features:new m(b)}})},{"./das":10,"./sourceadapters":34}],14:[function(d,v,t){if("undefined"!==typeof d)var m=d("./cbrowser").Browser,l=d("./utils").shallowCopy,g=d("./sha1").hex_sha1,q=d("./das").copyStylesheet;m.prototype.exportFullConfig=function(d){d={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+g(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),chains:this.exportChains()};this.prefix&&(d.prefix=this.prefix);
return d};m.prototype.exportChains=function(){var d={},g=this.chains||{},l;for(l in g)d[l]=g[l].exportConfig();return d};m.prototype.exportSourceConfig=function(d){d=[];for(var g=0;g<this.tiers.length;++g){var m=this.tiers[g],b=l(m.dasSource);b.noPersist||(b.coords=void 0,b.props=void 0,b.disabled||(b.disabled=void 0),m.config.stylesheet?(b.style=q(m.config.stylesheet).styles,b.stylesheet_uri=void 0):b.style&&(b.style=q({styles:b.style}).styles),"string"===typeof m.config.name&&(b.name=m.config.name),
void 0!==m.config.height&&(b.forceHeight=m.config.height),void 0!==m.config.forceMin&&(b.forceMin=m.config.forceMin),m.config.forceMinDynamic&&(b.forceMinDynamic=m.config.forceMinDynamic),void 0!==m.config.forceMax&&(b.forceMax=m.config.forceMax),void 0!==m.config.bumped&&(b.bumped=m.config.bumped),m.config.forceMaxDynamic&&(b.forceMaxDynamic=m.config.forceMaxDynamic),d.push(b))}return d};m.prototype.exportPageTemplate=function(d){d=d||{};return'<html>\n  <head>\n    <script language="javascript" src="'+
this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+JSON.stringify(this.exportFullConfig(d),null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},{"./cbrowser":6,"./das":10,"./sha1":33,"./utils":49}],15:[function(d,v,t){if("undefined"!==typeof d)var m=d("./cbrowser").Browser,l=d("./glyphs").OverlayLabelCanvas,g=d("./numformats").formatQuantLabel,
q=d("./sequence-draw").drawSeqTierGC;m.prototype.exportImage=function(d){d=d||{};for(var m=this.featurePanelWidth,C=0,b=0;b<this.tiers.length;++b){0<b&&(C+=3);var a=this.tiers[b];void 0!==a.layoutHeight&&(C+=a.layoutHeight)}var c=d.resolutionMultiplier||1,b=(m+200)*c|0,a=C*c|0,C=makeElement("canvas",null,{width:b,height:a}),f=C.getContext("2d");f.fillStyle="white";f.fillRect(0,0,b,a);f.scale(c,c);for(b=c=0;b<this.tiers.length;++b){var a=this.tiers[b],n=(a.glyphCacheOrigin-this.viewStart)*this.scale,
s=new l;f.save();f.translate(0,c);f.save();f.beginPath();f.moveTo(200,0);f.lineTo(200+m,0);f.lineTo(200+m,a.layoutHeight);f.lineTo(200,a.layoutHeight);f.closePath();f.clip();f.translate(200,0);f.save();f.translate(n,0);a.subtiers?a.paintToContext(f,s,n+1E3):q(a,a.currentSequence,f);f.restore();f.save();f.translate(n,0);s.draw(f,-n,m-n);f.restore();f.restore();for(var s=!1,h=0,p=a.subtiers||[],F=0;F<p.length;++F){var S=p[F];if(S.quant){var s=!0,D=S.quant,w=S.height,G=2;40<w&&(G=1+(w/20|0));var w=w/
(G-1),B=(D.max-D.min)/(G-1);f.beginPath();f.moveTo(205,h);f.lineTo(200,h);f.lineTo(200,h+S.height);f.lineTo(205,h+S.height);for(var H=1;H<G-1;++H){var u=H*w;f.moveTo(200,h+u);f.lineTo(203,h+u)}f.strokeStyle="black";f.strokeWidth=2;f.stroke();f.fillStyle="black";var H=g(D.max),K=h+7;f.fillText(H,197-f.measureText(H).width,K);H=g(D.min);K=h+S.height;f.fillText(H,197-f.measureText(H).width,K);for(H=1;H<G-1;++H)u=H*w,K=g(1*D.max-H*B),u=h+u+3,f.fillText(K,197-f.measureText(K).width,u)}h+=S.height+3}h=
"string"===typeof a.config.name?a.config.name:a.dasSource.name;p=f.measureText(h).width;f.fillStyle="black";f.fillText(h,200-(s?22:12)-p,(a.layoutHeight+6)/2);f.restore();c+=a.layoutHeight+3}if(d.highlights){f.save();f.beginPath();f.moveTo(200,0);f.lineTo(200+m,0);f.lineTo(200+m,c);f.lineTo(200,c);f.closePath();f.clip();f.translate(200+n,0);n=m=this.viewStart;b=this.viewEnd;for(a=0;a<this.highlights.length;++a)w=this.highlights[a],(w.chr===this.chr||w.chr==="chr"+this.chr)&&w.min<b&&w.max>n&&(f.globalAlpha=
this.defaultHighlightAlpha,f.fillStyle=this.defaultHighlightFill,f.fillRect((w.min-m)*this.scale,0,(w.max-w.min)*this.scale,c));f.restore()}m=-1;"center"==d.ruler?m=200+(this.viewEnd-this.viewStart+1)*this.scale/2:"left"==d.ruler?m=200:"right"==d.ruler&&(m=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=m&&(f.strokeStyle="blue",f.beginPath(),f.moveTo(m,0),f.lineTo(m,c),f.stroke());return C.toDataURL("image/png")}},{"./cbrowser":6,"./glyphs":21,"./numformats":26,"./sequence-draw":31}],16:[function(d,
v,t){if("undefined"!==typeof d){var m=d("./cbrowser").Browser;d=d("./utils");var l=d.makeElement,g=d.removeChildren}m.prototype.openExportPanel=function(){var d=this;if("export"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var m=l("div",null,{className:"export-form"}),x=l("select");x.appendChild(l("option","SVG",{value:"svg"}));x.appendChild(l("option","Image",{value:"png"}));x.appendChild(l("option","Dalliance config",{value:"config"}));x.appendChild(l("option","Dalliance sources",
{value:"sources"}));x.appendChild(l("option","Dalliance page",{value:"page"}));x.value="svg";x.addEventListener("change",function(a){g(f);F()},!1);m.appendChild(l("p",["Export as: ",x]));var C=l("input",null,{type:"checkbox",checked:this.exportHighlights});C.addEventListener("change",function(a){d.exportHighlights=C.checked;d.storeStatus()},!1);var b=l("input",null,{type:"checkbox",checked:this.exportRuler});b.addEventListener("change",function(a){d.exportRuler=b.checked;d.storeStatus()},!1);var a=
l("input",null,{type:"text",value:"1.0"}),c=l("button","Export",{className:"btn btn-primary"});c.addEventListener("click",function(c){g(f);var h,n,s,p;if("svg"===x.value)h=URL.createObjectURL(d.makeSVG({highlights:C.checked,ruler:b.checked?d.rulerLocation:"none"})),n="SVG",s="image/svg",p="dalliance-view.svg";else if("png"===x.value){s=parseFloat(a.value);if(0.1>s||10<s){alert("bad scale "+s);return}h=d.exportImage({highlights:C.checked,ruler:b.checked?d.rulerLocation:"none",resolutionMultiplier:s});
n="Image";s="image/png";p="dalliance-view.png"}else"config"===x.value?(s=JSON.stringify(d.exportFullConfig(),null,2),n=new Blob([s],{type:"text/plain"}),h=URL.createObjectURL(n),n="Configuration",s="text/plain",p="dalliance-config.json"):"sources"===x.value?(s=JSON.stringify(d.exportSourceConfig(),null,2),n=new Blob([s],{type:"text/plain"}),h=URL.createObjectURL(n),n="Source array",s="text/plain",p="dalliance-sources.json"):"page"===x.value&&(n=d.exportPageTemplate(),s="text/html",n=new Blob([n],
{type:s}),h=URL.createObjectURL(n),n="Page template",p="dalliance-view.html");h&&(c=l("a","[Download]",{href:h,download:p,type:s}),s=l("a","[Preview in browser]",{href:h,type:s,target:"_new"}),f.appendChild(l("p",[""+n+" created: ",c,s])))},!1);d.addViewListener(function(){g(f)});d.addTierListener(function(){g(f)});var f=l("p",""),n=l("tr",[l("th","Include highlights",{},{width:"200px",textAlign:"right"}),l("td",C)]),s=l("tr",[l("th","Include vertical guideline"),l("td",b)]),h=l("tr",[l("th","Scale multiplier"),
l("td",a)]),p=l("table",[n,s,h]),F=function(){var a=x.value;n.style.display="svg"==a||"png"==a?"table-row":"none";s.style.display="svg"==a||"png"==a?"table-row":"none";h.style.display="png"==a?"table-row":"none"};F();m.appendChild(p);m.appendChild(c);m.appendChild(f);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(m,this.svgHolder);this.activeToolPanel=m;this.setUiMode("export")}}},{"./cbrowser":6,"./utils":49}],17:[function(d,v,t){v=d("./cbrowser");t=d("./chainset");var m=
d("./sourceadapters"),l=d("./utils"),g=d("./das");d=d("./sourcecompare");window.Browser=v.Browser;window.sourcesAreEqual=d.sourcesAreEqual;window.Chainset=t.Chainset;window.makeElement=l.makeElement;window.dalliance_registerSourceAdapterFactory=m.registerSourceAdapterFactory;window.dalliance_registerParserFactory=m.registerParserFactory;window.dalliance_makeParser=m.makeParser;window.DASSequence=g.DASSequence;window.DASFeature=g.DASFeature;window.DASGroup=g.DASGroup;window.DASStylesheet=g.DASStylesheet;
window.DASStyle=g.DASStyle;window.DASSource=g.DASSource},{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":34,"./sourcecompare":35,"./utils":49}],18:[function(d,v,t){function m(){this.glyphs=[];this.height=0;this.quant=null}function l(a){Date.now();aa=a.viewport.getContext("2d");a.padding="number"===typeof a.dasSource.padding?a.dasSource.padding:X;a.scaleVertical="boolean"===typeof a.dasSource.scaleVertical?a.dasSource.scaleVertical:!1;var e=[],c={},k={},f;for(f in a.ungroupedFeatures)for(var h=
a.ungroupedFeatures[f],d=0;d<h.length;++d){var n=h[d];if(!n.parts){var s=a.styleForFeature(n);if(s)if("LINEPLOT"==s.glyph)b(c,s.id,n),k[s.id]=s;else{var p=q(n,0,s,a);p&&e.push(p)}}}for(var z in c)f=c[z],s=k[z],"LINEPLOT"==s.glyph&&e.push(r(f,s,a));if(a.dasSource.collapseSuperGroups&&!a.bumped)for(var u in a.superGroups){c=a.superGroups[u];a.groups[u]=C(a.groups[u]);a.groups[u].isSuperGroup=!0;k={};z=1E10;h=-1E10;d=null;for(p=0;p<c.length;++p)if(f=a.groupedFeatures[c[p]]){for(s=0;s<f.length;++s)n=
f[s],b(k,n.type,n),z=Math.min(n.min,z),h=Math.max(n.max,h),n.segment&&!d&&(d=n.segment);if(a.groups[u]&&!a.groups[u].links||0==a.groups[u].links.length)a.groups[u].links=a.groups[c[0]].links;delete a.groupedFeatures[c[p]]}a.groups[u].max=h;a.groups[u].min=z;a.groups[u].segment=d;for(var A in k){f=k[A];z=f[0];h=null;for(s=0;s<f.length;++s)n=f[s],n=new I(n.min,n.max),h=h?J(h,n):n;h=h.ranges();for(d=0;d<h.length;++d){for(var w=h[d],l=((w.max()|0)-(w.min()|0)+1)*c.length,y=0,s=0;s<f.length;++s)if(n=f[s],
(n.min|0)<=w.max()&&(n.max|0)>=w.min())var B=Math.max(n.min|0,w.min()),n=Math.min(n.max|0,w.max()),y=y+(n-B+1);var n=new Q,D;for(D in z)n[D]=z[D];n.min=w.min();n.max=w.max();n.label&&1<c.length&&(n.label+=" ("+c.length+" vars)");n.visualWeight=1*y/l;b(a.groupedFeatures,u,n)}}delete a.superGroups[u]}D=[];for(var F in a.groupedFeatures)D.push(F);D.sort(function(e,c){var k=a.groupedFeatures[e][0].score-a.groupedFeatures[c][0].score;return 0<k?-1:0==k?0:1});A={};for(n=0;n<D.length;++n)if(F=D[n],p=g(a.groupedFeatures[F],
0,a.groups[F],a,a.dasSource.collapseSuperGroups&&!a.bumped?"collapsed_gene":"tent"))p.group=a.groups[F],A[F]=p;for(u in a.superGroups){c=a.superGroups[u];F=[];z=1E10;h=-1E10;for(D=0;D<c.length;++D)n=A[c[D]],A[c[D]]=null,n&&(F.push(n),z=Math.min(z,n.min()),h=Math.max(h,n.max()));for(D=0;D<F.length;++D)n=F[D],e.push(new S(n,z,h))}for(p in A)(n=A[p])&&e.push(n);u=new m;F=[];A=a.subtierMax||a.dasSource.subtierMax||a.browser.defaultSubtierMax;D=!1;n=0;a:for(;n<e.length;++n)if(p=e[n],p.bump&&(a.bumped||
a.dasSource.collapseSuperGroups)){for(c=0;c<F.length;++c)if(k=F[c],k.hasSpaceFor(p)){k.add(p);continue a}F.length>=A?D=!0:(k=new m,k.add(p),F.push(k))}else u.add(p);0<u.glyphs.length&&(F=[u].concat(F));for(c=0;c<F.length;++c)k=F[c],k.quant&&k.glyphs.unshift(new M(k.height));for(c=0;c<F.length;++c)k=F[c],k.glyphs.sort(function(a,e){return(a.zindex||0)-(e.zindex||0)});a.subtiers=F;a.glyphCacheOrigin=a.browser.viewStart;D?a.updateStatus("Bumping limit exceeded, use the track editor to see more features"):
a.updateStatus()}function g(a,e,k,b,f){f=b.styleForFeature(k);var h,d=!1,s=[];e=null;for(var g=0;g<a.length;++g){var p=a[g];p.orientation&&null==e&&(e=p.orientation);!h&&p.label&&(h=p.label);var z=b.styleForFeature(p);z&&!p.parts&&(L(z.LABEL)&&(d=!0),(p=q(p,0,z,b,null,!0))&&s.push(p))}if(0==s.length)return null;a="flat";f&&"LINE"===f.glyph||(b.dasSource.collapseSuperGroups&&!b.bumped?"+"===e?a="collapsed+":"-"===e&&(a="collapsed-"):"+"===e?a="hat+":"-"===e&&(a="hat-"));b=null;if(h&&d||f&&(L(f.LABEL)||
L(f.LABELS)))b=k.label||h;k=new c(s,a);b&&("+"===e?b=">"+b:"-"===e&&(b="<"+b),k=new n(aa,k,b,!1));k.bump=!0;return k}function q(b,f,d,g,l,I){function m(a,e,c){var b=null;if(a.currentSequence){var k=a.currentSequence.start|0,f=a.currentSequence.end|0;if(k<=c&&f>=e){for(var h=Math.max(e,k),f=Math.min(c,f),b=a.currentSequence.seq.substr(h-k,f-h+1);e<h;)b="N"+b,h--;for(;c>f;)b+="N",f++}}return b}var R=g.browser.scale,q=g.browser.viewStart,r=d.glyph||"BOX",C=b.min,E=b.max,J=b.orientation,x=b.score,M=b.label||
b.id,t=(C-q)*R,v=Math.max((E-q+1)*R,t+1),Q=g.forceHeight||d.HEIGHT||l||12,T=Q*=1,q=d.BUMP&&L(d.BUMP),X;if("CROSS"===r||"EX"===r||"TRIANGLE"===r||"DOT"===r||"SQUARE"===r||"STAR"===r||"PLIMSOLL"===r){var W=d.FGCOLOR||"black",P=d.BGCOLOR||"none",C=d.STROKECOLOR;d.BGITEM&&b.itemRgb?W=b.itemRgb:L(d.COLOR_BY_SCORE2)&&(R=d.BGGRAD||d._gradient,R||(R=k(50,d.COLOR1,d.COLOR2,d.COLOR3),d._gradient=R),Q=b.score2,void 0==Q&&W||(T=d.MIN2?1*d.MIN2:0,E=(1*(Q||0)-T)/((d.MAX2?1*d.MAX2:1)-T)*R.length|0,0>E&&(E=0),E>=
R.length&&(E=R.length-1),W=R[E]));Q=g.forceHeight||d.HEIGHT||l||12;T=Q*=1;E=d.SIZE||Q;d.RSIZE&&(E=1*d.RSIZE*Q);d.STROKETHRESHOLD&&E<1*d.STROKETHRESHOLD&&(C=null);E*=1;Q=(t+v)/2;R=E/2;"EX"===r?C=new h(Q,E,W):"TRIANGLE"===r?C=new p(Q,E,d.DIRECTION||"N",d.LINEWIDTH||E,W,C):"DOT"===r?C=new F(Q,E,W,C):"PLIMSOLL"===r?C=new y(Q,E,0.2*E,W,C):"SQUARE"===r?C=new a(Q-R,0,E,E,W,C):"STAR"===r?(r=5,d.POINTS&&(r=d.POINTS|0),C=new U(Q,R,r,W,C)):C=new s(Q,E,W);P&&"none"!=P&&5<v-t&&(t=new a(t,0,v-t,E,P),C=new c([t,
C]));if(L(d.SCATTER)){P=g.quantMin(d);(E=g.quantMax(d))||(E=0>P?0:10);P||(P=0);g=(1*x-P)/(E-P);x=-1*P/(E-P);if(0>g||1<g)return null;g>=x?(Q=Math.max(1,(g-x)*T),f=f+(1-x)*T-Q):(Q=Math.max(1,(g-x)*T),f+=(1-x)*T);X={min:P,max:E};t=0;v="undefined"!==typeof b.forceLabel?b.forceLabel:d.LABEL;Y(v)&&M&&!I&&(C=new n(aa,C,M,!0,null,"above"==v?"above":"below"),"above"==v&&(t=C.textHeight+2),I=!0);C=new A(C,0,f-R-t,T)}}else if("HISTOGRAM"===r||"GRADIENT"===r&&"undefined"!==x)P=g.quantMin(d),(E=g.quantMax(d))||
(E=0>P?0:10),P||(P=0),1*x<1*P&&(x=P),1*x>1*E&&(x=E),g=(1*x-P)/(E-P),x=-1*P/(E-P),"HISTOGRAM"===r&&(g>=x?(Q=(g-Math.max(0,x))*T,f=f+(1-Math.max(0,x))*T-Q):(Q=(Math.max(0,x)-g)*T,f+=(1-Math.max(0,x))*T),X={min:P,max:E}),W=d.FGCOLOR||null,P=d.BGCOLOR||d.COLOR1||"green",d.BGITEM&&b.itemRgb&&(P=b.itemRgb),x=d.ALPHA?1*d.ALPHA:null,d.BGGRAD&&(R=d.BGGRAD,E=g*R.length|0,0>E&&(E=0),E>=R.length&&(E=R.length-1),P=R[E]),d.COLOR2&&(R=d._gradient,R||(R=k(50,d.COLOR1,d.COLOR2,d.COLOR3),d._gradient=R),E=g*R.length|
0,0>E&&(E=0),E>=R.length&&(E=R.length-1),P=R[E]),C=new a(t,f,v-t,Q,P,W,x),C=new A(C,0,0,T);else if("HIDDEN"===r)C=new S(null,t,v),I=!0;else if("ARROW"===r)g=d.FGCOLOR||"purple",f=L(d.PARALLEL),T=L(d.SOUTHWEST),x=L(d.NORTHEAST),C=new H(t,v,Q,g,f,T,x);else if("ANCHORED_ARROW"===r)W=d.FGCOLOR||"none",P=d.BGCOLOR||"green",C=new D(t,v,Q,P,W,J),C.bump=!0;else if("SPAN"===r)W=d.FGCOLOR||"black",C=new w(t,v,Q,W);else if("LINE"===r)W=d.FGCOLOR||"black",C=new G(t,v,Q,d.STYLE||"solid",J,W);else if("PRIMERS"===
r)W=d.FGCOLOR||"black",P=d.BGCOLOR||"red",C=new B(t,v,Q,P,W);else if("TEXT"===r)g=d.STRING||"text",P=d.FGCOLOR||"black",C=new K(aa,t,v,Q,P,g);else if("TOOMANY"===r)W=d.FGCOLOR||"gray",P=d.BGCOLOR||"orange",C=new u(t,v,Q,P,W);else if("POINT"===r)Q=g.forceHeight||d.HEIGHT||30,P=g.quantMin(d),E=g.quantMax(d),g=(1*x-P)/(E-P),f=1*Q/(E-P)*(x-1*P)|0,X={min:P,max:E},P=d.FGCOLOR||d.COLOR1||"black",d.COLOR2&&(R=d._gradient,R||(R=k(50,d.COLOR1,d.COLOR2,d.COLOR3),d._gradient=R),E=g*R.length|0,0>E&&(E=0),E>=R.length&&
(E=R.length-1),P=R[E]),C=new N((t+v)/2,Q-f,Q,P);else if("__SEQUENCE"===r){x=r=b.seq;P=W=b.quals;f=L(d.__INSERTIONS);T=[];if(b.cigar){l=ea(b.cigar);for(var P=x="",na=J=0;na<l.length;++na){var Z=l[na];if("M"==Z.op)x+=r.substr(J,Z.cnt),P+=W.substr(J,Z.cnt),J+=Z.cnt;else if("D"==Z.op)for(var ja=0;ja<Z.cnt;++ja)x+="-",P+="Z";else if("I"==Z.op){var ua=r.substr(J,Z.cnt),ja=new p(t+x.length*R,5,"S",5,g.browser.baseColors.I);f&&(ja=new n(aa,ja,ua,!1,"center","above","7px sans-serif"));ja.feature={label:"Insertion: "+
ua,type:"insertion",method:"insertion"};T.push(ja);J+=Z.cnt}else"S"==Z.op?J+=Z.cnt:console.log("unknown cigop"+Z.op)}}R=m(g,C,E);if(x&&R&&("mismatch"===d.__SEQCOLOR||"mismatch-all"===d.__SEQCOLOR)){C=[];E="-"===b.orientation?",":".";for(r=0;r<x.length;++r)C.push(x[r]==R[r]?E:x[r]);x=C.join("")}C="-"===b.orientation?d._minusColor||"lightskyblue":d._plusColor||"lightsalmon";d.__disableQuals&&(P=!1);C=new e(g.browser.baseColors,C,t,v,Q,x,R,d.__SEQCOLOR,P,!L(d.__CLEARBG),g.scaleVertical);f&&(C=new A(C,
0,7));0<T.length&&(T.splice(0,0,C),C=new c(T))}else if("__INSERTION"===r)ja=new p(t,5,"S",5,g.browser.baseColors.I),C=new n(aa,ja,b.insertion||b.altAlleles[0],!1,"center","above","7px sans-serif"),1<v-t&&(P=d.BGCOLOR||d.COLOR1||"green",t=new a(t,5,v-t,Q,P,W),C=new c([t,C]));else{if("__NONE"===r)return null;W=d.FGCOLOR||null;P=d.BGCOLOR||d.COLOR1||"green";d.BGITEM&&b.itemRgb&&(P=b.itemRgb);R=(v-t)/(E-C);"translation"==b.type&&("protein_coding"==b.method||b.readframeExplicit)&&(!b.tags||0>b.tags.indexOf("cds_start_NF")||
b.readframeExplicit)&&(!g.dasSource.collapseSuperGroups||g.bumped)&&0.5<=R?(R=m(g,C,E),C=new z(t,v,Q,P,R,b.orientation,b.readframe)):C=new a(t,0,v-t,Q,P,W)}(L(d.LABEL)||b.forceLabel)&&M&&!I&&(C=new n(aa,C,M,!1));q&&(C.bump=!0);C.feature=b;X&&(C.quant=X);d.ZINDEX&&(C.zindex=d.ZINDEX|0);return C}function r(a,e,c){var b=c.browser.viewStart,k=c.browser.scale,h=c.forceHeight||e.HEIGHT||30,d=c.quantMin(e);c=c.quantMax(e);for(var n=1*h/(c-d),g=e.FGCOLOR||e.COLOR1||"black",s=[],p=0;p<a.length;++p){var z=
a[p],u=h-((z.score-1*d)*n|0);s.push((((z.min|0)+(z.max|0))/2-b)*k);s.push(u)}a=new f(s,g,h);a.quant={min:d,max:c};e.ZINDEX&&(a.zindex=e.ZINDEX|0);return a}if("undefined"!==typeof d){var x=d("./utils"),C=x.shallowCopy,b=x.pusho,x=d("./tier").DasTier;t=d("./glyphs");var a=t.BoxGlyph,c=t.GroupGlyph,f=t.LineGraphGlyph,n=t.LabelledGlyph,s=t.CrossGlyph,h=t.ExGlyph,p=t.TriangleGlyph,F=t.DotGlyph,S=t.PaddedGlyph,D=t.AArrowGlyph,w=t.SpanGlyph,G=t.LineGlyph,B=t.PrimersGlyph,H=t.ArrowGlyph,u=t.TooManyGlyph,
K=t.TextGlyph,e=t.SequenceGlyph,z=t.AminoAcidGlyph,A=t.TranslatedGlyph,N=t.PointGlyph,M=t.GridGlyph,U=t.StarGlyph,y=t.PlimsollGlyph,E=t.OverlayLabelCanvas,k=d("./color").makeGradient;t=d("./spans");var I=t.Range,J=t.union;t=d("./das");var Q=t.DASFeature,L=t.isDasBooleanTrue,Y=t.isDasBooleanNotFalse,ea=d("./cigar").parseCigar,T=d("./numformats").formatQuantLabel}var X=3;m.prototype.indexFor=function(a){a=a.min();for(var e=0,c=this.glyphs.length;c>e;){var b=(e+c)/2|0;if(b>=this.glyphs.length)return this.glyphs.length;
a<this.glyphs[b].min()?c=b:e=b+1}return c};m.prototype.add=function(a){var e=this.indexFor(a);this.glyphs.splice(e,0,a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};m.prototype.hasSpaceFor=function(a){var e=this.indexFor(a);return 0<e&&this.glyphs[e-1].max()>=a.min()||e<this.glyphs.length&&this.glyphs[e].min()<=a.max()?!1:!0};var aa;x.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,e=this.subtiers;if(e){var c=this.browser.featurePanelWidth+
2E3;a&&(c*=2);var b=this.viewport.width|0;b<c-50&&(this.viewport.width=b=c);for(var c=this.padding,k=0;k<e.length;++k)c=c+e[k].height+this.padding;k=c=Math.max(c+6,this.browser.minTierHeight);a&&(k*=2);k!=this.viewport.height&&(this.viewport.height=k);Math.max(c,this.browser.minTierHeight);this.viewportHolder.style.left="-1000px";this.viewport.style.width=a?""+b/2+"px":""+b+"px";this.viewport.style.height=""+c+"px";this.layoutHeight=Math.max(c,this.browser.minTierHeight);this.updateHeight();this.norigin=
this.browser.viewStart;e=this.viewport.getContext("2d");e.clearRect(0,0,b,k);e.save();a&&e.scale(2,2);b=this.browser.viewStart-1E3/this.browser.scale;k=this.browser.viewEnd+1E3/this.browser.scale;a=[];if(this.knownCoverage)for(var f=this.knownCoverage.ranges(),h=0;h<f.length;++h){var d=f[h];0==h?d.min()>b&&a.push({min:b,max:d.min()-1}):a.push({min:f[h-1].max()+1,max:d.min()-1});h==f.length-1&&d.max()<k&&a.push({min:d.max()+1,max:k})}if(0<a.length)for(e.fillStyle="gray",b=0;b<a.length;++b)k=a[b],f=
(k.min-this.browser.viewStart)*this.browser.scale+1E3,e.fillRect(f,0,(k.max-this.browser.viewStart)*this.browser.scale+1E3-f,c);c=new E;a=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;e.translate(a,this.padding);c.translate(0,this.padding);this.paintToContext(e,c,a);this.overlayLabelCanvas=0<c.glyphs.length?c:null;e.restore();this.drawOverlay();this.paintQuant()}};x.prototype.paintToContext=function(a,e,c){var b=this.subtiers,k=this.viewport.width|0;a.save();for(var f=0;f<
b.length;++f){for(var h=null,d=b[f].glyphs,n=0;n<d.length;++n){var s=d[n];s.min()<k-c&&s.max()>-c&&(s=d[n],s.draw(a,e),s.quant&&(h=s.quant))}this.scaleVertical?(d=this.browser.scale,a.translate(0,d+this.padding),e.translate(0,d+this.padding)):(a.translate(0,b[f].height+this.padding),e.translate(0,b[f].height+this.padding))}a.restore();h&&this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(e=b[0].height*(1-(this.quantLeapThreshold-h.min)/
(h.max-h.min)),a.save(),a.strokeStyle="red",a.lineWidth=0.3,a.beginPath(),a.moveTo(-1E3,e),a.lineTo(k+1E3,e),a.stroke(),a.restore())};x.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,e;this.subtiers&&0<this.subtiers.length&&(e=this.subtiers[0].quant);if(e){var c=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+
"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var b=this.quantOverlay.getContext("2d");a&&b.scale(2,2);a=2;40<c&&(a=1+(c/20|0));var k=(c+2*this.padding)/(a-1),f=(e.max-e.min)/(a-1);b.fillStyle="white";b.globalAlpha=0.6;"right"==this.browser.rulerLocation?b.fillRect(20,0,30,c+2*this.padding):b.fillRect(0,0,30,c+2*this.padding);b.globalAlpha=1;b.strokeStyle="black";b.lineWidth=1;b.beginPath();if("right"==this.browser.rulerLocation){b.moveTo(42,this.padding);b.lineTo(50,
this.padding);b.lineTo(50,c+this.padding);b.lineTo(42,c+this.padding);for(var h=1;h<a-1;++h){var d=h*k;b.moveTo(50,d);b.lineTo(45,d)}}else for(b.moveTo(8,this.padding),b.lineTo(0,this.padding),b.lineTo(0,c+this.padding),b.lineTo(8,c+this.padding),h=1;h<a-1;++h)d=h*k,b.moveTo(0,d),b.lineTo(5,d);b.stroke();b.fillStyle="black";if("right"==this.browser.rulerLocation)for(b.textAlign="right",b.fillText(T(e.max),41,8),b.fillText(T(e.min),41,c+this.padding),h=1;h<a-1;++h)d=h*k,b.fillText(T(1*e.max-h*f),41,
d+3);else for(b.textAlign="left",b.fillText(T(e.max),9,8),b.fillText(T(e.min),9,c+this.padding),h=1;h<a-1;++h)d=h*k,b.fillText(T(1*e.max-h*f),9,d+3)}else this.quantOverlay.style.display="none"}};x.prototype.styleForFeature=function(a){var e=this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;for(var c=null,b=this.stylesheet.styles,k=0;k<b.length;++k){var f=b[k];if(!(f.zoom&&f.zoom!=e||f.orientation&&f.orientation!=a.orientation)){var h=f._labelRE;h&&h.test||(h=new RegExp("^"+f.label+
"$"),f._labelRE=h);if(!f.label||h.test(a.label))if(h=f._methodRE,h&&h.test||(h=new RegExp("^"+f.method+"$"),f._methodRE=h),!f.method||h.test(a.method)){if(f.type)if("default"==f.type){c||(c=f.style);continue}else if(h=f._typeRE,h&&h.test||(h=new RegExp("^"+f.type+"$"),f._typeRE=h),!h.test(a.type))continue;return f.style}}}return c};x.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||
0};x.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==typeof v&&(v.exports={drawFeatureTier:l})},{"./cigar":8,"./color":9,"./das":10,"./glyphs":21,"./numformats":26,"./spans":36,"./tier":45,"./utils":49}],19:[function(d,v,t){function m(b,a,c){var f=q(c.type,a.type),d=q(c.label,a.label,c.id,a.id);d&&0!=d.indexOf("__dazzle")&&(f=f+": "+d);this.hit=b;this.feature=
a;this.group=c;this.title=f;this.sections=[]}function l(b,a){var c=[];if(b)for(var f=0;f<b.length;++f)r(c,b[f]);if(a)for(f=0;f<a.length;++f)r(c,a[f]);return c}if("undefined"!==typeof d){var g=d("./cbrowser").Browser;d=d("./utils");var q=d.pick,r=d.pushnew,x=d.makeElement}var C=/^([A-Za-z_-]+)=(.+)/;g.prototype.addFeatureInfoPlugin=function(b){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(b)};m.prototype.setTitle=function(b){this.title=b};m.prototype.add=function(b,
a){"string"===typeof a&&(a=x("span",a));this.sections.push({label:b,info:a})};g.prototype.featurePopup=function(b,a,c,f){var d=c.length;a=0<=--d?c[d]:{};var s=0<=--d?c[d]:{};c=new m(c,a,s);c.tier=f;for(var d=this.featureInfoPlugins||[],h=0;h<d.length;++h)try{d[h](a,c)}catch(g){console.log(g.stack||g)}d=f.featureInfoPlugins||[];for(h=0;h<d.length;++h)try{d[h](a,c)}catch(r){console.log(r.stack||r)}this.removeAllPopups();f=x("table",null,{className:"table table-striped table-condensed"});f.style.width=
"100%";f.style.margin="0px";d=0;a.method&&(h=x("tr",[x("th","Method"),x("td",a.method)]),f.appendChild(h),++d);h=s.segment?s:a;h=x("tr",[x("th","Location"),x("td",h.segment+":"+h.min+"-"+h.max,{},{minWidth:"200px"})]);f.appendChild(h);++d;void 0===a.score||null===a.score||"-"==a.score||a.suppressScore||(h=x("tr",[x("th","Score"),x("td",""+a.score)]),f.appendChild(h),++d);(h=l(s.links,a.links))&&0<h.length&&(h=x("tr",[x("th","Links"),x("td",h.map(function(a){return x("div",x("a",a.desc,{href:a.uri,
target:"_new"}))}))]),f.appendChild(h),++d);a=l(s.notes,a.notes);for(s=0;s<a.length;++s){var h="Note",q=a[s],D=q.match(C);D&&(h=D[1],q=D[2]);h=x("tr",[x("th",h),x("td",q)]);f.appendChild(h);++d}for(a=0;a<c.sections.length;++a)d=c.sections[a],f.appendChild(x("tr",[x("th",d.label),x("td",d.info)]));this.popit(b,c.title||"Feature",f,{width:450})}},{"./cbrowser":6,"./utils":49}],20:[function(d,v,t){function m(d){for(var m=d.browser.drawnStart,x=d.browser.drawnEnd,C={},b={},a={},c={},f={},n={},s={},h=
{},p=[],F,t,D,w=function(){D={};for(var a=0;a<d.currentFeatures.length;++a){var e=d.currentFeatures[a];e.id&&(D[e.id]=e)}},G=function(a){var e=[];if(a.parents)for(var c=0;c<a.parents.length;++c){var b=a.parents[c],f=D[b];f&&"SO:0000704"==f.typeCv&&pushnew(e,b)}return e},B=0;B<d.currentFeatures.length;++B){var H=d.currentFeatures[B];if(!H.parts){var u=H.min<=x&&H.max>=m;if(H.min&&H.max){if(H.score&&"."!=H.score&&"-"!=H.score){var K=1*H.score;if(!F||K<F)F=K;if(!t||K>t)t=K}var K=[],e=null;if(H.groups)for(var z=
0;z<H.groups.length;++z){var A=H.groups[z],N=A.id;if("gene"==A.type)e=N,n[N]=A;else if("translation"!=A.type){l(b,N,H);n[N]=A;K.push(N);A=c[N];if(!A||H.min<A)c[N]=H.min;A=f[N];if(!A||H.max>A)f[N]=H.max}}if(H.parents)for(D||w(),z=0;z<H.parents.length;++z){var M=H.parents[z],v=D[M];if(v){v.parts||(v.parts=[H]);g(b,M,v);l(b,M,H);n[M]||(n[M]={type:v.type,id:v.id,label:v.label||v.id});K.push(M);A=c[M];if(!A||H.min<A)c[M]=H.min;A=f[M];if(!A||H.max>A)f[M]=H.max;A=G(v);0<A.length&&(e=A[0],M=D[A[0]],n[A[0]]=
{type:M.type,id:M.id,label:M.label||M.id},d.dasSource.collapseSuperGroups||(d.dasSource.collapseSuperGroups=!0))}}if(0==K.length)u&&l(C,H.type,H);else if(e)for(A=0;A<K.length;++A)N=K[A],g(s,e,N),h[N]=e}else p.push(H)}}for(N in b)p=n[N],"number"!==typeof p.min&&(p.min=c[N]),"number"!==typeof p.max&&(p.max=f[N]),f[N]>=m&&c[N]<=x&&(a[N]=b[N]);d.ungroupedFeatures=C;d.groupedFeatures=a;d.groups=n;d.superGroups=s;d.groupsToSupers=h;F&&(0<F?F=0:0>t&&(t=0),d.currentFeaturesMinScore=F,d.currentFeaturesMaxScore=
t)}if("undefined"!==typeof d){d=d("./utils");var l=d.pusho,g=d.pushnewo}"undefined"!==typeof v&&(v.exports={sortFeatures:m})},{"./utils":49}],21:[function(d,v,t){function m(a,e){this._stroke=a;this._fill=e}function l(a,e,c,b,f,h,d,n){this.x=a;this.y=e;this._width=c;this._height=b;this.fill=f;this.stroke=h;this._alpha=d;this._radius=n||0}function g(a,e){this.glyphs=a;this.connector=e;this.h=a[0].height();for(var c=[],b=0;b<a.length;++b){var f=a[b];c.push(new N(f.min(),f.max()));this.h=Math.max(this.h,
f.height())}this.coverage=A(c)}function q(a,e,c){this.points=a;this.color=e;this._height=c||50}function r(a,e,c,b,f,h,d){this.glyph=e;this.text=c;this.anchor=f||"left";this.align=h||"below";d&&(this.font=d);this.font&&(a.save(),a.font=this.font);c=a.measureText(c);this.font&&a.restore();this.textLen=c.width;this.textHeight=5;this.bump=e.bump;this.measured=!b}function x(a,e,c){this._x=a;this._height=e;this._stroke=c}function C(a,e,c){this._x=a;this._height=e;this._stroke=c}function b(a,e,c,b,f,d){m.call(this,
d,f);this._x=a;this._height=e;this._dir=c;this._width=b}function a(a,e,c,b){this._x=a;this._height=e;this._fill=c;this._stroke=b}function c(a,e,c){this.glyph=a;this._min=e;this._max=c;a&&(this.bump=a.bump)}function f(a,e,c,b,f,d){m.call(this,f,b);this._min=a;this._max=e;this._height=c;this._ori=d}function n(a,e,c,b){m.call(this,b,null);this._min=a;this._max=e;this._height=c}function s(a,e,c,b,f,d){this._min=a;this._max=e;this._height=c;this._style=b;this._strand=f;this._stroke=d}function h(a,e,c,
b,f){this._min=a;this._max=e;this._height=c;this._fill=b;this._stroke=f}function p(a,e,c,b,f,d,h){m.call(this,null,b);this._min=a;this._max=e;this._height=c;this._color=b;this._parallel=f;this._sw=d;this._ne=h}function F(a,e,c,b,f){this._min=a;this._max=e;this._height=c;this._fill=b;this._stroke=f}function S(a,e,c,b,f,d){this._min=e;this._max=c;this._height=b;this._fill=f;this._string=d;this._textLen=a.measureText(d).width}function D(a,e,c){var b={red:"darkred",purple:"mediumpurple",blue:"darkblue",
green:"darkgreen"}[c.toLowerCase()];c=b?[c,b]:["rgb(73, 68, 149)","rgb(9, 0, 103)"];return"?"==a?"black":"M"==a?"greenyellow":"*"==a?"crimson":c[e%2]}function w(a){var e={A:"T",T:"A",G:"C",C:"G"};a=a.split("").reverse().join("");for(var c=[],b=0;b<a.length;++b){var f=a.substr(b,1).toUpperCase();c.push(f in e?e[f]:"N")}return c.join("")}function G(a,e,c,b,f,d,h){this._min=a;this._max=e;this._height=c;this._fill=b;this._seq=f;this._orientation=d;this._readframe=h}function B(a,e,c,b){this.glyph=a;this._height=
b;this._x=e;this._y=c}function H(a,e,c,b){this._x=a;this._y=e;this._height=c;this._fill=b}function u(a){this._height=a||50}function K(a,e,c,b,f){m.call(this,f,b);this._x=a;this._r=e;this._points=c}function e(a,e,c,b,f){this._x=a;this._height=e;this._overhang=c;this._fill=b;this._stroke=f;this._hh=e/2}function z(){this.oy=this.ox=0;this.glyphs=[]}if("undefined"!==typeof d){t=d("./spans");var A=t.union,N=t.Range;t=d("./utils");var M=t.makeElementNS,U=t.AMINO_ACID_TRANSLATION;d=d("./svg-utils");var y=
d.NS_SVG,E=d.SVGPath}m.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};m.prototype.toSVG=function(){var a=new E;this.drawPath(a);return M(y,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};m.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};l.prototype.draw=function(a){var e=this._radius;0<e?(a.beginPath(),a.moveTo(this.x+
e,this.y),a.lineTo(this.x+this._width-e,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+e,e),a.lineTo(this.x+this._width,this.y+this._height-e),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-e,this.y+this._height,e),a.lineTo(this.x+e,this.y+this._height),a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-e,e),a.lineTo(this.x,this.y+e),a.arcTo(this.x,this.y,this.x+e,this.y,e),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&
(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.strokeRect(this.x,this.y,this._width,this._height)));null!=this._alpha&&a.restore()};l.prototype.toSVG=function(){var a=M(y,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||
"none",strokeWidth:0.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};l.prototype.min=function(){return this.x};l.prototype.max=function(){return this.x+this._width};l.prototype.height=function(){return this.y+this._height};g.prototype.drawConnectors=function(a){for(var e=this.coverage.ranges(),c=1;c<e.length;++c){var b=e[c],f=e[c-1];if(f&&b.min()>f.max()){var f=f.max(),b=b.min(),d=(f+b)/2;"hat+"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(d,0),a.lineTo(b,
this.h/2)):"hat-"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(d,this.h),a.lineTo(b,this.h/2)):"collapsed+"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(b,this.h/2),4<b-f&&(a.moveTo(d-2,this.h/2-3),a.lineTo(d+2,this.h/2),a.lineTo(d-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(b,this.h/2),4<b-f&&(a.moveTo(d+2,this.h/2-3),a.lineTo(d-2,this.h/2),a.lineTo(d+2,this.h/2+3))):(a.moveTo(f,this.h/2),a.lineTo(b,this.h/2))}}};g.prototype.draw=function(a,e){for(var c=0;c<
this.glyphs.length;++c)this.glyphs[c].draw(a,e);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};g.prototype.toSVG=function(){for(var a=M(y,"g"),e=0;e<this.glyphs.length;++e)a.appendChild(this.glyphs[e].toSVG());e=new E;this.drawConnectors(e);0<e.toPathData().length&&(e=M(y,"path",null,{d:e.toPathData(),fill:"none",stroke:"black",strokeWidth:0.5}),a.appendChild(e));return a};g.prototype.min=function(){return this.coverage.min()};g.prototype.max=function(){return this.coverage.max()};
g.prototype.height=function(){return this.h};q.prototype.min=function(){return this.points[0]};q.prototype.max=function(){return this.points[this.points.length-2]};q.prototype.height=function(){return this._height};q.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var e=0;e<this.points.length;e+=2){var c=this.points[e],b=this.points[e+1];0==e?a.moveTo(c,b):a.lineTo(c,b)}a.stroke();a.restore()};q.prototype.toSVG=function(){for(var a=new E,e=0;e<this.points.length;e+=
2){var c=this.points[e],b=this.points[e+1];0==e?a.moveTo(c,b):a.lineTo(c,b)}return M(y,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};r.prototype.toSVG=function(){var a=this.glyph.toSVG(),e={};"above"==this.align?(a=M(y,"g",a,{transform:"translate(0, "+(this.textHeight|2)+")"}),e.y=this.textHeight):e.y=this.glyph.height()+15;this.font&&(e.fontSize=7);e.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return M(y,"g",[a,M(y,
"text",this.text,e)])};r.prototype.min=function(){return this.glyph.min()};r.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};r.prototype.height=function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+2):a+20);return a};r.prototype.draw=function(a,e){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();e.registerGlyph(this)};
r.prototype.drawOverlay=function(a,e,c){a.fillStyle="black";this.font&&(a.save(),a.font=this.font);"center"==this.anchor?c=(this.glyph.min()+this.glyph.max()-this.textLen)/2:(c=this.glyph.min(),c<e&&(c=Math.min(e,this.glyph.max()-this.textLen)));a.fillText(this.text,c,"above"==this.align?this.textHeight:this.glyph.height()+15);this.font&&a.restore()};x.prototype.draw=function(a){var e=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-e,e);a.lineTo(this._x+
e,e);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};x.prototype.toSVG=function(){var a=this._height/2,e=new E;e.moveTo(this._x,0);e.lineTo(this._x,this._height);e.moveTo(this._x-a,a);e.lineTo(this._x+a,a);return M(y,"path",null,{d:e.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};x.prototype.min=function(){return this._x-this._height/2};x.prototype.max=function(){return this._x+this._height/2};x.prototype.height=function(){return this._height};C.prototype.draw=function(a){var e=
this._height/2;a.beginPath();a.moveTo(this._x-e,0);a.lineTo(this._x+e,this._height);a.moveTo(this._x-e,this._height);a.lineTo(this._x+e,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};C.prototype.toSVG=function(){var a=this._height/2,e=new E;e.moveTo(this._x-a,0);e.lineTo(this._x+a,this._height);e.moveTo(this._x-a,this._height);e.lineTo(this._x+a,0);return M(y,"path",null,{d:e.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};C.prototype.min=function(){return this._x-this._height/
2};C.prototype.max=function(){return this._x+this._height/2};C.prototype.height=function(){return this._height};b.prototype=Object.create(m.prototype);b.prototype.drawPath=function(a){var e=this._height/2,c=this._width/2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-c,0),a.lineTo(this._x+c,0)):"W"===this._dir?(a.moveTo(this._x+c,e),a.lineTo(this._x-c,0),a.lineTo(this._x-c,this._height)):"E"===this._dir?(a.moveTo(this._x-c,e),a.lineTo(this._x+c,0),a.lineTo(this._x+c,this._height)):
(a.moveTo(this._x,0),a.lineTo(this._x+c,this._height),a.lineTo(this._x-c,this._height));a.closePath()};b.prototype.min=function(){return this._x-this._height/2};b.prototype.max=function(){return this._x+this._height/2};b.prototype.height=function(){return this._height};a.prototype.draw=function(a){var e=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,e,e,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};a.prototype.toSVG=
function(){var a=this._height/2;return M(y,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};a.prototype.min=function(){return this._x-this._height/2};a.prototype.max=function(){return this._x+this._height/2};a.prototype.height=function(){return this._height};c.prototype.draw=function(a,e){this.glyph&&this.glyph.draw(a,e)};c.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():M(y,"g")};c.prototype.min=function(){return this._min};
c.prototype.max=function(){return this._max};c.prototype.height=function(){return this.glyph?this.glyph.height():1};f.prototype=Object.create(m.prototype);f.prototype.min=function(){return this._min};f.prototype.max=function(){return this._max};f.prototype.height=function(){return this._height};f.prototype.drawPath=function(a){var e=this._max,c=this._min,b=this._height,f=0,d=0,h=this._height+2,n=0.333333*this._height;this._ori&&("+"===this._ori?d=0.5*this._height:"-"===this._ori&&(f=0.5*this._height));
e-c<h&&(c=(e+c-h)/2,e=c+h);a.moveTo(c+f,0+n);a.lineTo(e-d,0+n);a.lineTo(e-d,0);a.lineTo(e,0+this._height/2);a.lineTo(e-d,0+b);a.lineTo(e-d,0+n+n);a.lineTo(c+f,0+n+n);a.lineTo(c+f,0+b);a.lineTo(c,0+b/2);a.lineTo(c+f,0);a.lineTo(c+f,0+n)};n.prototype=Object.create(m.prototype);n.prototype.min=function(){return this._min};n.prototype.max=function(){return this._max};n.prototype.height=function(){return this._height};n.prototype.drawPath=function(a){var e=this._min,c=this._max,b=this._height,f=b/2;a.moveTo(e,
f);a.lineTo(c,f);a.moveTo(e,0);a.lineTo(e,b);a.moveTo(c,0);a.lineTo(c,b)};s.prototype.min=function(){return this._min};s.prototype.max=function(){return this._max};s.prototype.height=function(){return this._height};s.prototype.drawPath=function(a){var e=this._min,c=this._max,b=this._height,f=b/2;"hat"===this._style?(a.moveTo(e,f),a.lineTo((e+c)/2,"-"===this._strand?b:0)):a.moveTo(e,f);a.lineTo(c,f)};s.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===
this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};s.prototype.toSVG=function(){var a=new E;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return M(y,"path",null,a)};h.prototype.min=function(){return this._min};h.prototype.max=function(){return this._max};h.prototype.height=function(){return this._height};h.prototype.drawStemPath=function(a){var e=this._max,c=this._height/2;a.moveTo(this._min,
c);a.lineTo(e,c)};h.prototype.drawTrigsPath=function(a){var e=this._min,c=this._max,b=this._height,f=b/2;a.moveTo(e,0);a.lineTo(e+b,f);a.lineTo(e,b);a.lineTo(e,0);a.moveTo(c,0);a.lineTo(c-b,f);a.lineTo(c,b);a.lineTo(c,0)};h.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};h.prototype.toSVG=function(){var a=new E;this.drawStemPath(a);var e=new E;this.drawTrigsPath(e);return M(y,"g",
[M(y,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),M(y,"path",null,{d:e.toPathData(),fill:this._fill||"none"})])};p.prototype=Object.create(m.prototype);p.prototype.min=function(){return this._min};p.prototype.max=function(){return this._max};p.prototype.height=function(){return this._height};p.prototype.drawPath=function(a){var e=this._min,c=this._max,b=this._height;if(this._parallel){var f=b/2,d=0.4*b;this._sw?(a.moveTo(e+f,b-d),a.lineTo(e+f,b),a.lineTo(e,f),a.lineTo(e+f,0),a.lineTo(e+
f,d)):(a.moveTo(e,b-d),a.lineTo(e,d));this._ne?(a.lineTo(c-f,d),a.lineTo(c-f,0),a.lineTo(c,f),a.lineTo(c-f,b),a.lineTo(c-f,b-d)):(a.lineTo(c,d),a.lineTo(c,b-d))}else{var f=(e+c)/2,d=0.4*(c-e),h=b/3;this._ne?(a.moveTo(e+d,h),a.lineTo(e,h),a.lineTo(f,0),a.lineTo(c,h),a.lineTo(c-d,h)):(a.moveTo(e+d,0),a.lineTo(c-d,0));this._sw?(a.lineTo(c-d,b-h),a.lineTo(c,b-h),a.lineTo(f,b),a.lineTo(e,b-h),a.lineTo(e+d,b-h)):(a.lineTo(c-d,b),a.lineTo(e+d,b))}a.closePath()};F.prototype.min=function(){return this._min};
F.prototype.max=function(){return this._max};F.prototype.height=function(){return this._height};F.prototype.toSVG=function(){return M(y,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};F.prototype.draw=function(a){this._fill&&(a.fillStyle=this._fill,a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();
for(var e=2;e<this._height;e+=3)a.moveTo(this._min,e),a.lineTo(this._max,e);a.stroke()}};S.prototype.min=function(){return this._min};S.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};S.prototype.height=function(){return this._height};S.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};S.prototype.toSVG=function(){return M(y,"text",this._string,{x:this._min,y:this._height-4})};G.prototype.min=function(){return this._min};
G.prototype.max=function(){return this._max};G.prototype.height=function(){return this._height};G.prototype.draw=function(a){var e=this._seq,c=this._fill;if(e){var b=(this._max-this._min+1)/e.length,f=(3-this._readframe)%3,d=(e.length-f)%3,f="+"==this._orientation?f:d;0<f&&(a.fillStyle=c,a.fillRect(this._min,0,b*f,this._height));for(;f<e.length;f+=3){d=e.substr(f,3).toUpperCase();"-"==this._orientation&&(d=w(d));var h=d in U?U[d]:"?",c=3==d.length?D(h,f,this._fill):this._fill;a.fillStyle=c;a.fillRect(this._min+
f*b,0,b*d.length,this._height);8<=b&&3==d.length&&(a.fillStyle="white",a.fillText(h,this._min+(f+1)*b,this._height))}}};G.prototype.toSVG=function(){var a=M(y,"g"),e=this._seq,c=this._fill;if(!e)return a;var b=(this._max-this._min+1)/e.length,f=(3-this._readframe)%3,d=(e.length-f)%3,f="+"==this._orientation?f:d;for(0<f&&a.appendChild(M(y,"rect",null,{x:this._min,y:0,width:b*f,height:this._height,fill:c}));f<e.length;f+=3){d=e.substr(f,3).toUpperCase();"-"==this._orientation&&(d=w(d));var h=d in U?
U[d]:"?",c=3==d.length?D(h,f,this._fill):this._fill;a.appendChild(M(y,"rect",null,{x:this._min+f*b,y:0,width:b*d.length,height:this._height,fill:c}));8<=b&&3==d.length&&a.appendChild(M(y,"text",h,{x:this._min+(f+1)*b,y:this._height,fill:"white"}))}return a};(function(a){function e(a,c,b,f,d,k,h,n,s,g,p){this.baseColors=a;this._strandColor=c;this._min=b;this._max=f;this._height=d;this._seq=k;this._ref=h;this._scheme=n;this._quals=s;this._fillbg=g;this._scaleVertical=p}var c=1<window.devicePixelRatio,
b={},f=/^[ACGT-]$/;e.prototype.min=function(){return this._min};e.prototype.max=function(){return this._max};e.prototype.height=function(){return this._height};e.prototype.alphaForQual=function(a){return 0.1+0.9*Math.max(0,Math.min(1*a/30,1))};e.prototype.draw=function(a){var e=this._seq,d=this._ref,k="mismatch-all"===this._scheme,h=e?e.length:this._max-this._min+1,n=(this._max-this._min+1)/h;"mismatch"!==this._scheme&&"mismatch-all"!==this._scheme||8<=n||(a.fillStyle=this._strandColor,this._scaleVertical?
a.fillRect(this._min,n,this._max-this._min,n):a.fillRect(this._min,this._height/4,this._max-this._min,this._height/2));for(var s=0;s<h;++s){var g=e?e.substr(s,1).toUpperCase():"N";if(f.test(g)||8<=n){var p=this.baseColors[g];if(this._quals){var z=this._quals.charCodeAt(s)-33,u=a.globalAlpha;a.globalAlpha=this.alphaForQual(z)}p||(z=d?d.substr(s,1).toUpperCase():"N",p="N"==g||"N"==z?"gray":this._strandColor,k&&(g=z));a.fillStyle=p;z=f.test(g);!this._fillbg&&8<=n&&z||(this._scaleVertical?a.fillRect(this._min+
s*n,n,n,n):a.fillRect(this._min+s*n,0,n,this._height));if(8<=n&&z){var A=p+"_"+g,z=b[A];if(!z){z=document.createElement("canvas");c?(z.width=16,z.height=20):(z.width=8,z.height=10);var w=z.getContext("2d");c&&w.scale(2,2);w.fillStyle=this._fillbg?"black":p;p=w.measureText(g).width;w.fillText(g,0.5*(8-p),8);b[A]=z}g=this._scaleVertical?n:0;c?a.drawImage(z,this._min+s*n+0.5*(n-8),g,8,10):a.drawImage(z,this._min+s*n+0.5*(n-8),g)}this._quals&&(a.globalAlpha=u)}}};e.prototype.toSVG=function(){for(var a=
this._seq,e=this._ref,c="mismatch-all"===this._scheme,b=(this._max-this._min+1)/this._seq.length,d=M(y,"g"),k=0;k<a.length;++k){var h=a?a.substr(k,1).toUpperCase():"N",n=this.baseColors[h];if(!n){var s=e?e.substr(k,1).toUpperCase():"N",n="N"==h||"N"==s?"gray":this._strandColor;c&&(h=s)}s=1;this._quals&&(s=this._quals.charCodeAt(k)-33,s=this.alphaForQual(s));var g=f.test(h);!this._fillbg&&8<=b&&g||d.appendChild(M(y,"rect",null,{x:this._min+k*b,y:0,width:b,height:this._height,fill:n,fillOpacity:s}));
8<=b&&g&&d.appendChild(M(y,"text",h,{x:this._min+(0.5+k)*b,y:8,textAnchor:"middle",fill:this._fillbg?"black":n,fillOpacity:s}))}return d};a.SequenceGlyph=e})(this);B.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};B.prototype.min=function(){return this.glyph.min()+this._x};B.prototype.max=function(){return this.glyph.max()+this._x};B.prototype.minY=function(){return this._y};B.prototype.maxY=function(){return this._y+this.glyph.height()};B.prototype.draw=
function(a,e){a.save();a.translate(this._x,this._y);this.glyph.draw(a,e);a.restore()};B.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};H.prototype.min=function(){return this._x-2};H.prototype.max=function(){return this._x+2};H.prototype.height=function(){return this._height};H.prototype.draw=function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};
H.prototype.toSVG=function(){return M(y,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};u.prototype.notSelectable=!0;u.prototype.min=function(){return-1E5};u.prototype.max=function(){return 1E5};u.prototype.height=function(){return this._height};u.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var e=0;e<=this._height;e+=10)a.moveTo(-5E3,e),a.lineTo(5E3,e);a.stroke();a.restore()};u.prototype.toSVG=function(){for(var a=new E,e=0;e<=
this._height;e+=10)a.moveTo(-5E3,e),a.lineTo(5E3,e);return M(y,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};K.prototype=Object.create(m.prototype);K.prototype.min=function(){return this._x-this._r};K.prototype.max=function(){return this._x+this._r};K.prototype.height=function(){return 2*this._r};K.prototype.drawPath=function(a){for(var e=this._x,c=this._r,b=this._r,f=0;f<this._points;++f){var d=6.28*f/this._points,h=e+b*Math.sin(d),d=c-b*Math.cos(d);0==f?a.moveTo(h,
d):a.lineTo(h,d);d=6.28*(f+0.5)/this._points;h=e+0.4*b*Math.sin(d);d=c-0.4*b*Math.cos(d);a.lineTo(h,d)}a.closePath()};e.prototype.draw=function(a){var e=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,e,e-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};e.prototype.toSVG=function(){var a=this._hh;return M(y,"g",[M(y,"circle",null,{cx:this._x,cy:a,r:a-this._overhang}),
M(y,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};e.prototype.min=function(){return this._x-this._hh};e.prototype.max=function(){return this._x+this._hh};e.prototype.height=function(){return this._height};z.prototype.translate=function(a,e){this.ox+=a;this.oy+=e};z.prototype.registerGlyph=function(a){this.glyphs.push({x:this.ox,y:this.oy,glyph:a})};z.prototype.draw=function(a,e,c){for(var b=0;b<this.glyphs.length;++b){var f=
this.glyphs[b];a.save();a.translate(f.x,f.y);f.glyph.drawOverlay(a,e,c);a.restore()}};"undefined"!==typeof v&&(v.exports={BoxGlyph:l,GroupGlyph:g,LineGraphGlyph:q,LabelledGlyph:r,CrossGlyph:x,ExGlyph:C,TriangleGlyph:b,DotGlyph:a,PaddedGlyph:c,AArrowGlyph:f,SpanGlyph:n,LineGlyph:s,PrimersGlyph:h,ArrowGlyph:p,TooManyGlyph:F,TextGlyph:S,SequenceGlyph:this.SequenceGlyph,AminoAcidGlyph:G,TranslatedGlyph:B,GridGlyph:u,StarGlyph:K,PointGlyph:H,PlimsollGlyph:e,OverlayLabelCanvas:z})},{"./spans":36,"./svg-utils":39,
"./utils":49}],22:[function(d,v,t){function m(b,a){this.base=b;this.query=a}function l(b){if(0<b)return"+";if(0>b)return"-"}if("undefined"!==typeof d)var g=d("./das").DASFeature,q=d("./utils").shallowCopy,r=d("./spans"),x=r.Range,C=r.union;m.prototype.features=function(b,a,c){url=this.base+"/features/"+b.name;a=[];this.query&&a.push(this.query);b.isBounded&&(a.push("start="+b.start),a.push("end="+b.end));0<a.length&&(url=url+"?"+a.join("&"));var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4==
f.readyState)if(300<=f.status)c(null,"Error code "+f.status);else{var a=JSON.parse(f.response).features,d=[];for(fi=0;fi<a.length;++fi){var h=a[fi],p=new g;p.segment=b.name;p.min=(h.start|0)+1;p.max=h.end|0;h.name&&(p.label=h.name);h.strand&&(p.orientation=l(h.strand));p.type=h.type||"unknown";if(h.subfeatures&&0<h.subfeatures.length){p.id=h.uniqueID;for(var m=[],t=[],D=[],w=0;w<h.subfeatures.length;++w){var G=h.subfeatures[w],B=q(p);B.min=G.start+1;B.max=G.end;B.groups=[p];D.push(B);m.push(new x(B.min,
B.max));"CDS"===G.type&&t.push(B)}if(0<t.length){r=C(m);var H=q(p);H.type="transcript";r.ranges().forEach(function(a){d.push({segment:b.name,min:a.min(),max:a.max(),orientation:p.orientation,groups:[H],type:"transcript"})});var u=q(p);t.forEach(function(a){a.type="translation";a.groups=[u];d.push(a)})}else D.forEach(function(a){d.push(a)})}else d.push(p)}c(d)}};f.open("GET",url,!0);f.responseType="text";f.send("")};"undefined"!==typeof v&&(v.exports={JBrowseStore:m})},{"./das":10,"./spans":36,"./utils":49}],
23:[function(d,v,t){function m(){var a=this;this.reqs=[];this.awaitedFeatures={};this.requestsIssued=new B(function(c,b){a.notifyRequestsIssued=c})}function l(a,c,b,e,f,d,h){this.chr=a;this.min=c;this.max=b;this.coverage=h;this.scale=e;this.features=f||[];this.status=d}function g(a,c,b,e,f,d){this.tierMap=a;this.chr=c;this.min=b;this.max=e;this.scale=f;this.seqSource=d||new s;this.viewCount=0;this.featureCache={};this.latestViews={}}function q(a,c,b){for(var e=[],f={},d=0;d<a.length;++d){var h=a[d];
h.min&&h.max?h.groups&&0<h.groups.length?x(f,h.groups[0].id,h):h.min<=b&&h.max>=c&&e.push(h):e.push(h)}for(var n in f){a=f[n];for(var s=1E11,g=-1E11,d=0;d<a.length;++d)h=a[d],s=Math.min(s,h.min),g=Math.max(g,h.max);if(s<=b||g>=c)for(d=0;d<a.length;++d)e.push(a[d])}return e}if("undefined"!==typeof d){t=d("./utils");var r=t.Awaited,x=t.pusho;t=d("./sourceadapters");var C=t.MappedFeatureSource,b=t.CachingFeatureSource,a=t.BWGFeatureSource,c=t.RemoteBWGFeatureSource,f=t.BAMFeatureSource,n=t.RemoteBAMFeatureSource,
s=t.DummySequenceSource,h=t.DummyFeatureSource,p=d("./overlay").OverlayFeatureSource;t=d("./spans");var F=t.Range,S=t.intersection;t=d("./sample");var D=t.downsample,w=t.getBaseCoverage,G=d("./das").DASSequence,B=d("es6-promise").Promise}m.prototype.addRequest=function(a){this.reqs.push(a)};m.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};l.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};g.prototype.cancel=function(){this.cancelled=
!0};g.prototype.bestCacheOverlapping=function(a,c,b){return(a=this.featureCache[this.tierMap[0]])?a:null};g.prototype.retrieveFeatures=function(a,c,b,e,f,d){if(f!=f)throw"retrieveFeatures called with silly scale";if(c!=this.chr)throw"Can't extend Known Space to a new chromosome";1>b&&(b=1);this.min=b;this.max=e;this.scale=f;this.pool&&this.pool.abortAll();this.pool=new m;this.awaitedSeq=new r;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(a,d);this.pool.notifyRequestsIssued()};g.prototype.invalidate=
function(a,c){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a],c))};g.prototype.startFetchesForTiers=function(a,c){for(var b=this,e=this.awaitedSeq,f=!1,d,h=0;h<a.length;++h)try{this.startFetchesFor(a[h],e,c)&&(f=!0)}catch(n){var s=a[h];s.currentFeatures=[];s.currentSequence=null;console.log("Error fetching tier source");console.log(n);d=n;c(n,s)}if(f&&!this.seqWasFetched){this.seqWasFetched=!0;var g=this.min,p=this.max;if(this.cs&&this.cs.start<=g&&this.cs.end>=p)return f=this.cs.start==
g&&this.cs.end==p?this.cs:new G(this.cs.name,g,p,this.cs.alphabet,this.cs.seq.substring(g-this.cs.start,p+1-this.cs.start)),e.provide(f);this.seqSource.fetch(this.chr,g,p,this.pool,function(a,c){if(c){if(!b.cs||g<=b.cs.start&&p>=b.cs.end||g>=b.cs.end||p<=b.cs.start||p-g>b.cs.end-b.cs.start)b.cs=c;e.provide(c)}else console.log("Sequence loading failed",a),e.provide(null)})}if(d)throw d;};g.prototype.startFetchesFor=function(a,c,b){var e=this,f=this.viewCount,d=a.getSource()||new h,n=a.needsSequence(this.scale),
g=e.featureCache[a],s=a.getActiveStyleFilters(this.scale),p;s&&(p=s.typeList());var w=this.chr,k=this.min,m=this.max;if(void 0===p)return!1;if(g&&g.chr===this.chr&&g.min<=k&&g.max>=m){var r=g.features;if(g.min<k||g.max>m)r=q(r,k,m);e.provision(a,g.chr,S(g.coverage,new F(k,m)),g.scale,p,r,g.status,n?c:null,b);r=d.getScales();if(g.scale<=this.scale||!r)return n}d.instrument&&console.log("Starting  fetch "+f+" ("+k+", "+m+")");d.fetch(w,k,m,this.scale,p,this.pool,function(h,s,r,q){d.instrument&&console.log("Finishing fetch "+
f);var B=e.latestViews[a]||-1;if(!(e.cancelled||B>f)){q||(q=new F(k,m));if(!g||k<g.min||m>g.max)e.featureCache[a]=new l(w,k,m,r,s,h,q);e.latestViews[a]=f;e.provision(a,w,q,r,p,s,h,n?c:null,b)}},s);return n};g.prototype.provision=function(d,h,g,e,s,A,l,m,r){if(l)d.setFeatures(h,g,e,[],null),r(l,d);else{for(var q=!1,B=!1,k=d.getSource();C.prototype.isPrototypeOf(k)||b.prototype.isPrototypeOf(k)||p.prototype.isPrototypeOf(k);)k=p.prototype.isPrototypeOf(k)?k.sources[0]:k.source;if(a.prototype.isPrototypeOf(k)||
c.prototype.isPrototypeOf(k)||f.prototype.isPrototypeOf(k)||n.prototype.isPrototypeOf(k))q=!0;k.opts&&(k.opts.forceReduction||k.opts.noDownsample)||q&&s&&1==s.length&&0<=s.indexOf("density")&&(A=D(A,this.scale));s&&1==s.length&&0<=s.indexOf("base-coverage")&&(B=!0);m?m.await(function(a){B&&(A=w(A,a,d.browser.baseColors));d.setFeatures(h,g,e,A,a);r(l,d)}):(d.setFeatures(h,g,e,A),r(l,d))}};"undefined"!==typeof v&&(v.exports={KnownSpace:g})},{"./das":10,"./overlay":27,"./sample":29,"./sourceadapters":34,
"./spans":36,"./utils":49,"es6-promise":53}],24:[function(d,v,t){function m(a,c){this.block=a;this.offset=c}function l(a,c){var b=4294967296*(a[c+6]&255)+16777216*(a[c+5]&255)+65536*(a[c+4]&255)+256*(a[c+3]&255)+(a[c+2]&255),d=a[c+1]<<8|a[c];return 0==b&&0==d?null:new m(b,d)}function g(a,c){c=Math.min(c||1,a.byteLength-50);for(var f=[],d=[0],g=0;d[0]<c;){var h=new Uint8Array(a,d[0],12),h=h[11]<<8|h[10],h=C(a,12+h+d[0],Math.min(65536,a.byteLength-12-h-d[0]),d);d[0]+=8;g+=h.byteLength;f.push(h)}if(1==
f.length)return f[0];d=new Uint8Array(g);for(h=g=0;h<f.length;++h){var p=new Uint8Array(f[h]);b(p,0,d,g,p.length);g+=p.length}return d.buffer}function q(a,c){this.minv=a;this.maxv=c}function r(a,c){--c;return a>>14==c>>14?4681+(a>>14):a>>17==c>>17?585+(a>>17):a>>20==c>>20?73+(a>>20):a>>23==c>>23?9+(a>>23):a>>26==c>>26?1+(a>>26):0}function x(a,c){var b,d=[];--c;d.push(0);for(b=1+(a>>26);b<=1+(c>>26);++b)d.push(b);for(b=9+(a>>23);b<=9+(c>>23);++b)d.push(b);for(b=73+(a>>20);b<=73+(c>>20);++b)d.push(b);
for(b=585+(a>>17);b<=585+(c>>17);++b)d.push(b);for(b=4681+(a>>14);b<=4681+(c>>14);++b)d.push(b);return d}if("undefined"!==typeof d){d=d("jszlib");var C=d.inflateBuffer,b=d.arrayCopy}m.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof v&&(v.exports={unbgzf:g,readVob:l,reg2bin:r,reg2bins:x,Chunk:q})},{jszlib:65}],25:[function(d,v,t){function m(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}function l(b){this.source=b;r.call(this);this.storeHolder=new x;
this.parser=q(b.payload);if(!this.parser)throw"Unsupported memstore payload: "+b.payload;var a=this;this._load(function(c,b){if(c){for(var d=new m,g=[],h=c.split("\n"),p=a.parser.createSession(function(a){g.push(a)}),l=0;l<h.length;++l){var r=h[l];0<r.length&&p.parse(r)}p.flush();d.addFeatures(g);a.storeHolder.provide(d)}else a.error=b||"No data",a.storeHolder.provide(null)})}if("undefined"!==typeof d){v=d("./sourceadapters");var g=v.registerSourceAdapterFactory,q=v.makeParser,r=v.FeatureSourceBase;
d("./das");d=d("./utils");var x=d.Awaited,C=d.textXHR}m.prototype.addFeatures=function(b){for(var a={},c=0;c<b.length;++c){var f=b[c],d=f.segment||f.chr,g=this.featuresByChr[d];g||(g=[],this.featuresByChr[d]=g);g.push(f);a[d]=!0;f=f.max-f.min+1;f>this.maxLength&&(this.maxLength=f)}for(d in a)g=this.featuresByChr[d],g.sort(function(a,c){var b=a.min-c.min;return 0!=b?b:a.max-c.max});this.chrRing=null};m.prototype._indexFor=function(b,a){for(var c=0,f=b.length;f>c;){var d=(c+f)/2|0;if(d>=b.length)return b.length;
a<b[d].min?f=d:c=d+1}return f};m.prototype.fetch=function(b,a,c){var f=this.featuresByChr[b];f||(f=0==b.indexOf("chr")?this.featuresByChr[b.substring(3)]:this.featuresByChr["chr"+b]);if(!f)return[];var d=Math.max(0,this._indexFor(f,a-this.maxLength-1));b=Math.min(f.length-1,this._indexFor(f,c));for(var g=[];d<=b;++d){var h=f[d];h.min<=c&&h.max>=a&&g.push(h)}return g};m.prototype.findNextFeature=function(b,a,c){if(null==this.chrRing){this.chrRing=[];for(b in this.featuresByChr)this.chrRing.push(b);
this.chrRing.sort()}var f=this.featuresByChr[b];f||(b=0==b.indexOf("chr")?b.substring(3):"chr"+b,f=this.featuresByChr[b]);if(!f)return null;var d=Math.max(0,Math.min(this._indexFor(f,a),f.length-1));if(0<c){for(;d<f.length;){var g=f[d++];if(g.min>a)return g}b=this.chrRing.indexOf(b)+1;b>=this.chrRing.length&&(b=0);return this.findNextFeature(this.chrRing[b],0,c)}for(;0<=d;)if(g=f[d--],g.max<a)return g;b=this.chrRing.indexOf(b)-1;0>b&&(b=this.chrRing.length-1);return this.findNextFeature(this.chrRing[b],
1E10,c)};l.prototype=Object.create(r.prototype);l.prototype._load=function(b){if(this.source.blob){var a=new FileReader;a.onloadend=function(){return b(a.result,a.error)};a.readAsText(this.source.blob)}else{if(this.source.credentials)var c={credentials:this.source.credentials};C(this.source.uri,b,c)}};l.prototype.fetch=function(b,a,c,f,d,g,h){var p=this;this.storeHolder.await(function(f){return f?(f=f.fetch(b,a,c),h(null,f,1E8)):h(p.error)})};l.prototype.getStyleSheet=function(b){this.parser&&this.parser.getStyleSheet&&
this.parser.getStyleSheet(b)};l.prototype.getDefaultFIPs=function(b){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(b)};l.prototype.getScales=function(){return 1E8};l.prototype.findNextFeature=function(b,a,c,f){var d=this;this.storeHolder.await(function(g){return g?f(g.findNextFeature(b,a,c)):f(null,d.error)})};l.prototype.capabilities=function(){return{leap:!0}};g("memstore",function(b){return{features:new l(b)}})},{"./das":10,"./sourceadapters":34,"./utils":49}],26:[function(d,
v,t){function m(d){return(d|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function l(d){d=""+d;var l=d.indexOf(".");if(0>l)return d;var m=2;"-"==d.substring(0,1)&&++m;return l>=m?d.substring(0,l):d.substring(0,l+2)}"undefined"!==typeof v&&(v.exports={formatLongInt:m,formatQuantLabel:l})},{}],27:[function(d,v,t){function m(d,b){this.sources=d;this.opts=b||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var a=0;a<this.sources.length;++a)this.initN(a);
"function"===typeof b.merge?this.merge=b.merge:"concat"==b.merge?this.merge=q:"alternates"==b.merge?(this.merge=q,this.filterDispatchOnMethod=!0):this.merge=g}function l(d,b,a){this.source=d;this.callback=b;this.sources=a;this.count=a.length;this.statusCount=this.returnCount=0;this.returns=[];this.features=[];this.statuses=[];this.scale=null}function g(d){for(var b=[],a=1;a<d.length;++a){for(var c={},f=d[a],n=0;n<f.length;++n)c[this.keyForFeature(f[n])]=f[n];b.push(c)}a=[];d=d[0];for(n=0;n<d.length;++n){for(var g=
d[n],h=0;h<b.length;++h)if(c=b[h],f=c[this.keyForFeature(g)])for(var p in f)"score"===p?g.score2=f.score:"min"!==p&&"max"!==p&&"segment"!==p&&"_cachedStyle"!==p&&(g[p]=f[p]);a.push(g)}return a}function q(d,b){for(var a=[],c=0;c<d.length;++c)for(var f=d[c],n=b[c].name,g=0;g<f.length;++g){var h=f[g];h.method=n;a.push(h)}return a}if("undefined"!==typeof d){d=d("./utils");var r=d.shallowCopy,x=d.arrayIndexOf}m.prototype.initN=function(d){var b=this.sources[d],a=this;this.business[d]=0;b.addActivityListener&&
b.addActivityListener(function(c){a.business[d]=c;a.notifyActivity()});b.addChangeListener&&b.addChangeListener(function(){a.notifyChange()});b.addReadinessListener&&b.addReadinessListener(function(c){a.readiness[d]=c;a.notifyReadiness()})};m.prototype.addReadinessListener=function(d){this.readinessListeners.push(d);this.notifyReadinessListener(d)};m.prototype.removeReadinessListener=function(d){d=x(this.readinessListeners,d);0<=d&&this.readinessListeners.splice(d,1)};m.prototype.notifyReadiness=
function(){for(var d=0;d<this.readinessListeners.length;++d)this.notifyReadinessListener(this.readinessListeners[d])};m.prototype.notifyReadinessListener=function(d){for(var b=null,a=0;a<this.readiness.length;++a)if(null!=this.readiness[a]){b=this.readiness[a];break}try{d(b)}catch(c){console.log(c)}};m.prototype.addActivityListener=function(d){this.activityListeners.push(d)};m.prototype.removeActivityListener=function(d){d=x(this.activityListeners,d);0<=d&&this.activityListeners.splice(d,1)};m.prototype.notifyActivity=
function(){for(var d=0,b=0;b<this.business.length;++b)d+=this.business[b];for(b=0;b<this.activityListeners.length;++b)try{this.activityListeners[b](d)}catch(a){console.log(a)}};m.prototype.addChangeListener=function(d){this.changeListeners.push(d)};m.prototype.removeChangeListener=function(d){d=x(this.changeListeners,d);0<=d&&this.changeListeners.splice(d,1)};m.prototype.notifyChange=function(){for(var d=0;d<this.changeListeners.length;++d)try{this.changeListeners[d](this.busy)}catch(b){console.log(b)}};
m.prototype.getScales=function(){return this.sources[0].getScales()};m.prototype.getStyleSheet=function(d){return this.sources[0].getStyleSheet(d)};m.prototype.capabilities=function(){var d={},b=this.sources[0];b.capabilities&&(d=r(b.capabilities()));for(b=1;b<this.sources.length;++b){var a=this.sources[b];a.capabilities&&(a=a.capabilities(),a.search&&(d.search=a.search))}return d};m.prototype.search=function(d,b){for(var a=0;a<this.sources.length;++a){var c;c=this.sources[a];c=c.capabilities?c.capabilities().search:
!1;if(c)return this.sources[a].search(d,b)}};m.prototype.fetch=function(d,b,a,c,f,n,g,h){var p;if(this.filterDispatchOnMethod){p=[];for(var m=h.list(),r=0;r<this.sources.length;++r)for(var q=this.sources[r],w=0;w<m.length;++w){var G=m[w];if(!G.method||G.method==q.name){p.push(q);break}}}else p=this.sources;g=new l(this,g,p);for(r=0;r<p.length;++r)this.fetchN(g,r,p[r],d,b,a,c,f,n,h)};m.prototype.fetchN=function(d,b,a,c,f,n,g,h,p,l){a.fetch(c,f,n,g,h,p,function(a,c,f){return d.completed(b,a,c,f)},l)};
m.prototype.quantFindNextFeature=function(d,b,a,c,f){return this.sources[0].quantFindNextFeature(d,b,a,c,f)};m.prototype.findNextFeature=function(d,b,a,c){return this.sources[0].findNextFeature(d,b,a,c)};l.prototype.completed=function(d,b,a,c){if(null==this.scale||0==d)this.scale=c;if(this.returns[d])throw"Multiple returns for source "+d;this.returns[d]=!0;this.returnCount++;this.features[d]=a;b&&(this.statuses[d]=b,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){d="";
for(b=0;b<this.count;++b)if(a=this.statuses[b])0<d.length&&(d+=", "),d+=a;return this.callback(d,null,this.scale)}this.callback(null,this.source.merge(this.features,this.sources),this.scale)}};m.prototype.getDefaultFIPs=function(d){for(var b=0;b<this.sources.length;++b){var a=this.sources[b];a.getDefaultFIPs&&a.getDefaultFIPs(d)}};m.prototype.keyForFeature=function(d){return""+d.min+".."+d.max};"undefined"!==typeof v&&(v.exports={OverlayFeatureSource:m})},{"./utils":49}],28:[function(d,v,t){function m(d,
h,p){var F=/^\w+\s[0-9]+\s[0-9]+.*$/,t=/([^=]+)=\"?([^\"]+)\"?/,D=/^##\s*fileformat=VCFv4\..+/;(d.blob?new q(d.blob):"encode"==d.transport?new n(d.uri):new g(d.uri,{credentials:d.credentials})).slice(0,65536).salted().fetch(function(n,g){if(!n)return p||(d.credentials=!0,m(d,h,!0)),h(d,"Couldn't fetch data");var q=new Uint8Array(n),H=(new Uint32Array(n,0,1))[0];if(H==x||H==C){d.tier_type="bwg";q=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(q=q.exec(d.uri||d.blob.name))d.name=q[1];return h(d,null)}if(H==
c)return d.tier_type="bai",h(d,null);if(31==q[0]||139==q[1]){q=b(n);q=new Uint8Array(q);H=r(q,0);if(H==a){d.tier_type="bam";q=/\/?([^/]+?)(.bam)?$/;if(q=q.exec(d.uri||d.blob.name))d.name=q[1];return h(d,null)}if(H==f)return d.tier_type="tabix-index",h(d,null);if(1768301347==H){d.tier_type="tabix";d.payload="vcf";q=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(q=q.exec(d.uri||d.blob.name))d.name=q[1];return h(d,null)}console.log("magic = "+H.toString(16));return h(d,"Unsupported format")}q=String.fromCharCode.apply(null,
q).split("\n");if(0<q.length&&D.test(q[0]))return d.tier_type="memstore",d.payload="vcf",q=/\/?([^/]+?)(.vcf)?$/,(q=q.exec(d.uri||d.blob.name))&&!d.name&&(d.name=q[1]),h(d,null);for(var u=0;u<q.length;++u)if(H=q[u].replace("\r",""),0!=H.length&&0!=H.indexOf("browser")){if(0==H.indexOf("track")){q="bed";H=H.split(/\s/);for(u=1;u<H.length;++u){var v=t.exec(H[u]);v&&("type"==v[1]&&"wiggle_0"==v[2]?q="wig":"name"==v[0]&&(d.name=v[2]))}l(d,q);return h(d,null)}if(0==H.indexOf("fixedStep")||0==H.indexOf("variableStep"))return l(d,
"wig"),h(d,null);if(F.test(H))return l(d,null),h(d,null);break}return h(d,"Unsupported format")},{timeout:1500})}function l(a,c){a.tier_type="memstore";var b=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);b&&(a.name||(a.name=b[1]),!c&&b[3]&&(c=b[3]));a.payload=c||"bed"}if("undefined"!==typeof d){t=d("./bin");var g=t.URLFetchable,q=t.BlobFetchable,r=t.readInt;t=d("./bigwig");var x=t.BIG_WIG_MAGIC,C=t.BIG_BED_MAGIC,b=d("./lh3utils").unbgzf;t=d("./bam");var a=t.BAM_MAGIC,c=t.BAI_MAGIC,f=d("./tabix").TABIX_MAGIC,
n=d("./encode").EncodeFetchable}"undefined"!==typeof v&&(v.exports={probeResource:m})},{"./bam":1,"./bigwig":3,"./bin":4,"./encode":12,"./lh3utils":24,"./tabix":41}],29:[function(d,v,t){function m(a){return c[a%c.length]*Math.pow(10,a/c.length|0)}function l(a,c,b){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=c;this.max=b;this.features=[]}function g(a,c){return a.min<c.min?-1:a.min>c.min?1:a.max<c.max?-1:c.max>a.max?1:0}function q(a,c){for(var b=0;m(b+1)<c;)++b;for(var b=m(b),d=[],g=
-1E10,r=1E10,q=0;q<a.length;++q){var D=a[q];if(D.groups&&0<D.groups.length)return a;for(var w=D.min/b|0,G=D.max/b|0,g=Math.max(g,G),r=Math.min(r,w);w<=G;++w){var B=d[w];B||(B=new l(b,w*b,(w+1)*b-1),d[w]=B);B.feature(D)}}q=[];for(w=r;w<=g;++w)if(B=d[w])D=new C,D.segment=a[0].segment,D.min=w*b+1,D.max=(w+1)*b,D.score=B.score(),D.type="density",q.push(D);Date.now();return q}function r(a){this._pos=a;this._bases={};this._totalCount=0}function x(c,d,g){for(var h,p,l=null,m=null,q=[],w=0;w<c.length;++w){var G=
c[w];if(G.groups&&0<G.groups.length)return c;h=G.seq;var B=G.quals,x=b(G.cigar),u=[];p=[];for(var t=0,e=0;e<x.length;++e){var z=x[e];if("M"==z.op)u.push(h.substr(t,z.cnt)),p.push(B.substr(t,z.cnt)),t+=z.cnt;else if("D"==z.op)for(var A=0;A<z.cnt;++A)u.push("-"),p.push("Z");else"I"==z.op?t+=z.cnt:"S"==z.op?t+=z.cnt:console.log("unknown cigop"+z.op)}h=u.join("");p=p.join("");u=h;t=p;e=G.orientation;z=G.min||0;G=G.max||0;p=0;for(h=z;h<=G;++h)x=q[h],x||(x=new r(h),q[h]=x),B=u.charAt(p),A=t.charCodeAt(p)-
33,x.recordBase(B,A,e),p++;l=l?Math.min(l,z):z;m=m?Math.max(m,G):G}G=l;w=m;p=[];if(d&&(h=d.start|0,x=d.end|0,h<=w&&x>=G)){B=Math.max(G,h);x=Math.min(w,x);for(u=0;u<B-G;u++)p.push("N");p.push(d.seq.substr(B-h,x-B+1));for(u=0;u<w-x;u++)p.push("N")}d=p.join("");w=[];p=0;for(h=l;h<=m;++h){if(x=q[h])if(G=new C,G.segment=c[0].segment,G.min=x.pos(),G.max=G.min,G.notes=[],G.notes=G.notes.concat(x.infoList()),G.type="base-coverage",G.suppressScore=!0,d)for(l=d.charAt(p),G.notes.unshift("Ref="+l),x=x.baseScoreList(l,
0.2),u=0;u<x.length;u++){B=x[u].base;t=x[u].score;e=a(G);e.score=t;if(1<x.length||B!=l)e.itemRgb=g[B];w.push(e)}else w.push(G);p++}return w}if("undefined"!==typeof d)var C=d("./das").DASFeature,b=d("./cigar").parseCigar,a=d("./utils").shallowCopy;var c=[1,2,5];l.prototype.score=function(){if(0==this.cnt)return 0;if(this.hasScore)return this.tot/this.cnt;var a=this.features;a.sort(g);for(var c=-1E10,b=0,d=0,p=1;p<a.length;++p){var l=a[p],m=Math.max(l.min,this.min),l=Math.min(l.max,this.max),d=d+(l-
m+1);m>c?(b+=l-m+1,c=l):l>c&&(b+=l-c,c=l)}return 0<b?1*d/b:0};l.prototype.feature=function(a){void 0!==a.score&&(this.tot+=a.score,this.hasScore=!0);++this.cnt;this.features.push(a)};r.prototype.recordBase=function(a,c,b){if(this._bases[a])a=this._bases[a],a.cnt++,a.totalQual+=c,a.strandCnt[b]++;else{var d={"+":0,"-":0};d[b]++;this._bases[a]={cnt:1,totalQual:c,strandCnt:d}}this._totalCount++};r.prototype.totalCount=function(){return this._totalCount};r.prototype.pos=function(){return this._pos};r.prototype.infoList=
function(){var a=[],c=this._totalCount;a.push("Depth="+c.toString());for(var b in this._bases){var d=this._bases[b],g=d.cnt,l=d.strandCnt["+"],m=d.strandCnt["-"],d=d.totalQual/g,g=[b,"=",g," (",(100*g/c).toFixed(0),"%, ",l," +, ",m," -, Qual: ",d.toFixed(0),")"];a.push(g.join(""))}return a};r.prototype.baseScoreList=function(a,c){var b=[],d=this._totalCount,g=c*d,l;for(l in this._bases){var m=this._bases[l].cnt;m<g||l==a||(b.push({base:l,score:d}),d-=m)}b.push({base:a,score:d});return b};"undefined"!==
typeof v&&(v.exports={downsample:q,getBaseCoverage:x})},{"./cigar":8,"./das":10,"./utils":49}],30:[function(d,v,t){function m(d,g){var b=parseFloat(d.replace(/,/g,""));return"k"===g||"K"===g?1E3*b|0:"m"==g||"M"===g?1E6*b|0:b|0}if("undefined"!==typeof d)var l=d("./cbrowser").Browser,g=d("./bin").URLFetchable,q=d("./trix").connectTrix;var r=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;l.prototype.search=function(d,l){var b=this,a=r.exec(d);if(a){var c=a[1],f;if(a[6])f=
m(a[2],a[3]),a=m(a[6],a[7]);else{var n=this.viewEnd-this.viewStart+1;f=m(a[2],a[3])-n/2|0;a=f+n-1}this.setLocation(c,f,a,l)}else{if(!d||0==d.length)return!1;var s=0,h=!1,p=function(a,c){--s;if(c)return l(c);a||(a=[]);for(var f=5E8,g=-1E8,n=null,p=0;p<a.length;++p){var u=a[p];null==n&&(n=u.segment);f=Math.min(f,u.min);g=Math.max(g,u.max)}if(n)h=!0,b.highlightRegion(n,f,g),p=Math.max(2500,0.3*(g-f+1)|0),b.setLocation(n,f-p,g+p,l);else if(0==s&&!h)return l("no match for '"+d+"'")},F=function(a,c){c.lookup(d,
function(c,b){if(null==c||2>c.length)return a.featureSource.search(d,p);var f=c[1].split(",")[0];return a.featureSource.search(f,p)})};if(this.searchEndpoint)return s=1,this.doDasSearch(b.searchEndpoint,d,p);for(c=0;c<this.tiers.length;++c)(function(a){if(b.sourceAdapterIsCapable(a.featureSource,"search"))if(a.dasSource.trixURI)if(++s,a.trix)F(a,a.trix);else{var c=new g(a.dasSource.trixURI,{credentials:a.dasSource.credentials,resolver:a.dasSource.resolver}),f=new g(a.dasSource.trixxURI||a.dasSource.trixURI+
"x",{credentials:a.dasSource.credentials,resolver:a.dasSource.resolver});q(c,f,function(c){a.trix=c;F(a,c)})}else++s,a.featureSource.search(d,p);else a.dasSource.provides_search&&(++s,b.doDasSearch(a.dasSource,d,p))})(this.tiers[c])}};l.prototype.doDasSearch=function(d,g,b){d.features(null,{group:g,type:"transcript"},function(a){a||(a=[]);for(var c=[],d=0;d<a.length;++d){var n=a[d];n.label.toLowerCase()==g.toLowerCase()&&c.push(n)}return b(c)},!1)}},{"./bin":4,"./cbrowser":6,"./trix":47}],31:[function(d,
v,t){function m(c,d){d||(d=b);for(var g=a.length;c*a[g%a.length]*Math.pow(10,g/a.length|0)<d;)++g;return a[g%a.length]*Math.pow(10,g/a.length|0)}function l(a,b){var d=a.viewport.getContext("2d"),s=a.browser.retina&&1<window.devicePixelRatio,h=a.browser.featurePanelWidth+2E3;s&&(h*=2);var p=a.viewport.width|0;p<h-50&&(a.viewport.width=p=h);h=50;b&&b.seq&&(h+=25);var l=h;s&&(l*=2);a.viewport.height=l;a.viewport.style.height=""+h+"px";a.viewport.style.width=s?""+p/2+"px":""+p+"px";a.layoutHeight=h;a.updateHeight();
a.background&&(d.fillStyle=a.background,d.fillRect(0,0,p,a.viewport.height));s&&d.scale(2,2);d.translate(1E3,0);g(a,b,d);a.norigin=a.browser.viewStart;a.viewportHolder.style.left="-1000px"}function g(a,b,d){var g=a.browser.scale,h=a.browser.viewStart-1E3/g|0,p=a.browser.viewEnd+2E3/g,l=a.browser.currentSeqMax,q=p;0<l&&l<p&&(q=l);for(var D=m(g),w=Math.max(0,(h/D|0)*D),l=a.browser.viewStart;w<=q;)d.fillStyle=0==w/D%2?"white":"black",d.strokeStyle="black",d.fillRect((w-l)*g,8,D*g,3),d.strokeRect((w-
l)*g,8,D*g,3),d.fillStyle="black",d.fillText(r(w),(w-l)*g,22),w+=D;if(b&&b.seq)for(;h<=p;++h)h>=b.start&&h<=b.end&&(q=b.seq.substr(h-b.start,1).toUpperCase(),(D=a.browser.baseColors[q])||(D="gray"),d.fillStyle=D,8<=g?(D=d.measureText(q).width,d.fillText(q,(h-l)*g+0.5*(g-D),52)):d.fillRect((h-l)*g,42,g,12))}function q(a,b){var d=a.browser.scale,g=a.browser.viewStart-1E3/d|0,h=a.browser.viewEnd+2E3/d,p=a.browser.currentSeqMax,l=h;0<p&&p<h&&(l=p);for(var q=m(d),D=Math.max(0,(g/q|0)*q),p=a.browser.viewStart,
w=x(C,"g",[],{fontSize:"8pt"});D<=l;)w.appendChild(x(C,"rect",null,{x:(D-p)*d,y:8,width:q*d,height:3,fill:0==D/q%2?"white":"black",stroke:"black"})),w.appendChild(x(C,"text",r(D),{x:(D-p)*d,y:28,fill:"black",stroke:"none"})),D+=q;if(b&&b.seq)for(;g<=h;++g)g>=b.start&&g<=b.end&&(l=b.seq.substr(g-b.start,1).toUpperCase(),(q=a.browser.baseColors[l])||(q="gray"),8<=d?w.appendChild(x(C,"text",l,{x:(0.5+g-p)*d,y:52,textAnchor:"middle",fill:q})):w.appendChild(x(C,"rect",null,{x:(g-p)*d,y:42,width:d,height:12,
fill:q})));return w}if("undefined"!==typeof d){t=d("./utils");var r=t.formatLongInt,x=t.makeElementNS,C=d("./svg-utils").NS_SVG,r=d("./numformats").formatLongInt}var b=100,a=[1,2,5],C="http://www.w3.org/2000/svg";"undefined"!==typeof v&&(v.exports={drawSeqTier:l,drawSeqTierGC:g,svgSeqTier:q})},{"./numformats":26,"./svg-utils":39,"./utils":49}],32:[function(d,v,t){if("undefined"!=typeof d){var m=d("./cbrowser").Browser;v=d("./sourcecompare");var l=v.sourceDataURI,g=v.sourcesAreEqual,q=d("./version"),
r=d("./utils").miniJSONify,x=d("./sha1").hex_sha1}m.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+
this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+this.cookieKey+".ruler-location"]};m.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};m.prototype.storeViewStatus=function(){!this.cookieKey||this.noPersist||
this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};m.prototype.storeTierStatus=
function(){if(this.cookieKey&&!this.noPersist){for(var d=[],b=0;b<this.tiers.length;++b){var a=this.tiers[b];a.dasSource.noPersist||d.push({source:a.dasSource,config:a.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(d);d={};b=[];for(a=0;a<this.hubObjects.length;++a){var c=this.hubObjects[a],f={url:c.hub.url,genome:c.genome};c.credentials&&(f.credentials=c.credentials);c.mapping&&(f.mapping=c.mapping);d[f.url]=!0;b.push(f)}for(a=0;a<this.hubs.length;++a)f=this.hubs[a],
"string"===typeof f&&(f={url:f}),d[f.url]||b.push(f);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(b);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+this.cookieKey+".single-base-highlight"]=this.singleBaseHighlight;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+
".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=q.CONFIG}};m.prototype.restoreStatus=function(){if(!this.noPersist){var d=localStorage["dalliance."+this.cookieKey+".version"];if(q.CONFIG==(d?d|0:-100)){var d=localStorage["dalliance."+this.cookieKey+".configHash"]||"",b=x(r({sources:this.sources,hubs:this.hubs}));if(b!=d)localStorage["dalliance."+this.cookieKey+".configHash"]=
b;else{d={};for(b=0;b<this.sources.length;++b){var a=this.sources[b];if(a){var c=l(a),f=d[c];f||(d[c]=f=[]);f.push(a)}}if(!this.noPersistView&&(b=localStorage["dalliance."+this.cookieKey+".view-chr"],a=localStorage["dalliance."+this.cookieKey+".view-start"]|0,f=localStorage["dalliance."+this.cookieKey+".view-end"]|0,b&&a&&f)){this.chr=b;this.viewStart=a;this.viewEnd=f;if(b=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=b|0;this.isSnapZooming="true"==localStorage["dalliance."+
this.cookieKey+".showing-alt-zoom"];b=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof b||isNaN(b)||(this.savedZoom=b)}this.reverseScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==b;this.reverseKeyScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"])&&"true"==b;this.singleBaseHighlight=(b=localStorage["dalliance."+this.cookieKey+".single-base-highlight"])&&"true"==b;if(b=localStorage["dalliance."+
this.cookieKey+".ruler-location"])this.rulerLocation=b;if(b=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".sources"]){var n=JSON.parse(b);this.sources=[];this.restoredConfigs=[];for(b=0;b<n.length;++b)for(a=this.sources[b]=n[b].source,this.restoredConfigs[b]=n[b].config,c=l(a),f=d[c]||[],c=0;c<f.length;++c){var s=
f[c];if(g(a,s))for(var h in s)s.hasOwnProperty(h)&&("function"===typeof s[h]||s[h]instanceof Blob)&&(a[h]=s[h])}}if(h=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(h);return!0}}}};m.prototype.reset=function(){for(var d=this.tiers.length-1;0<=d;--d)this.removeTier({index:d},!0);for(d=0;d<this.defaultSources.length;++d)this.defaultSources[d].disabled||this.addTier(this.defaultSources[d]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,
this.defaultEnd)}},{"./cbrowser":6,"./sha1":33,"./sourcecompare":35,"./utils":49,"./version":51}],33:[function(d,v,t){function m(b){b=g(q(b));for(var a=x?"0123456789ABCDEF":"0123456789abcdef",c="",d,n=0;n<b.length;n++)d=b.charCodeAt(n),c+=a.charAt(d>>>4&15)+a.charAt(d&15);return c}function l(b){b=g(q(b));for(var a="",c=b.length,d=0;d<c;d+=3)for(var n=b.charCodeAt(d)<<16|(d+1<c?b.charCodeAt(d+1)<<8:0)|(d+2<c?b.charCodeAt(d+2):0),l=0;4>l;l++)a=8*d+6*l>8*b.length?a+C:a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>
6*(3-l)&63);return a}function g(b){for(var a=Array(b.length>>2),c=0;c<a.length;c++)a[c]=0;for(c=0;c<8*b.length;c+=8)a[c>>5]|=(b.charCodeAt(c/8)&255)<<24-c%32;b=8*b.length;a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;b=Array(80);for(var c=1732584193,d=-271733879,g=-1732584194,l=271733878,h=-1009589776,p=0;p<a.length;p+=16){for(var m=c,q=d,D=g,w=l,G=h,B=0;80>B;B++){if(16>B)b[B]=a[p+B];else{var x=b[B-3]^b[B-8]^b[B-14]^b[B-16];b[B]=x<<1|x>>>31}var x=c<<5|c>>>27,u;u=20>B?d&g|~d&l:40>B?d^g^l:60>B?d&g|d&l|
g&l:d^g^l;x=r(r(x,u),r(r(h,b[B]),20>B?1518500249:40>B?1859775393:60>B?-1894007588:-899497514));h=l;l=g;g=d<<30|d>>>2;d=c;c=x}c=r(c,m);d=r(d,q);g=r(g,D);l=r(l,w);h=r(h,G)}a=[c,d,g,l,h];b="";for(c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>24-c%32&255);return b}function q(b){for(var a="",c=-1,d,g;++c<b.length;)d=b.charCodeAt(c),g=c+1<b.length?b.charCodeAt(c+1):0,55296<=d&&56319>=d&&56320<=g&&57343>=g&&(d=65536+((d&1023)<<10)+(g&1023),c++),127>=d?a+=String.fromCharCode(d):2047>=d?a+=String.fromCharCode(192|
d>>>6&31,128|d&63):65535>=d?a+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(a+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return a}function r(b,a){var c=(b&65535)+(a&65535);return(b>>16)+(a>>16)+(c>>16)<<16|c&65535}var x=0,C="";"undefined"!==typeof v&&(v.exports={b64_sha1:l,hex_sha1:m})},{}],34:[function(d,v,t){function m(a,e){fa[a]=e}function l(a,e){ga[a]=e}function g(a){if(ga[a])return ga[a](a)}function q(a){var e=this;this.source=a;this.cfsid=
"cfs"+ ++la;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){e.cfsid="cfs"+ ++la})}function r(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}function x(a){this.dasSource=new N(a);this.busy=0;this.activityListeners=[]}function C(a){this.dasSource=new N(a);this.awaitedEntryPoints=new H;var e=this;this.dasSource.entryPoints(function(a){e.awaitedEntryPoints.provide(a)})}function b(a){var e=this;this.source=a;this.twoBit=new H;if(a.twoBitURI)a=
new k(a.twoBitURI,{credentials:a.credentials,resolver:a.resolver});else if(a.twoBitBlob)a=new I(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");J(a,function(a,c){c?console.log(c):e.twoBit.provide(a)})}function a(a){this.source=a}function c(a){r.call(this);var e=this;this.readiness="Connecting";this.bwgSource=this.opts=a;e.bwgHolder=new H;if(this.opts.preflight){var c=$[this.opts.preflight];if(!c){c=new H;$[this.opts.preflight]=c;var b=new XMLHttpRequest;b.onreadystatechange=
function(){4==b.readyState&&(200==b.status?c.provide("success"):c.provide("failure"))};b.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(b.withCredentials=!0);b.send("")}c.await(function(a){"success"===a&&e.init()})}else e.init()}function f(a,e,c){r.call(this);this.worker=e;this.readiness="Connecting";this.bwgSource=this.opts=a;this.keyHolder=new H;a.resolver&&(this.resolverKey=c.registerResolver(a.resolver));this.init()}function n(a,e){if(!(a.flag&Y.SEGMENT_UNMAPPED)){var c;
c=a.seq?a.seq.length:a.seqLength;if(a.cigar){c=0;for(var b=X(a.cigar),d=0;d<b.length;++d){var f=b[d];if("M"==f.op||"D"==f.op)c+=f.cnt}}b=new U;b.min=a.pos+1;b.max=a.pos+c;b.segment=a.segment;b.type="bam";b.id=a.readName;b.notes=["MQ="+a.mq];b.cigar=a.cigar;b.seq=a.seq;b.quals=a.quals;b.orientation=a.flag&Y.REVERSE_COMPLEMENT?"-":"+";b.bamRecord=a;e&&a.flag&Y.MULTIPLE_SEGMENTS&&(b.groups=[{id:a.readName,type:"readpair"}]);return b}}function s(a){r.call(this);var e=this;this.bamSource=a;this.opts={credentials:a.credentials,
preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new H;if(this.opts.preflight){var b=$[this.opts.preflight];if(!b){b=new H;$[this.opts.preflight]=b;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?b.provide("success"):b.provide("failure"))};c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(c.withCredentials="true");c.send("")}b.await(function(a){"success"===a&&e.init()})}else e.init()}function h(a,e){r.call(this);
this.bamSource=a;this.worker=e;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.keyHolder=new H;bwgSource.resolver&&(this.resolverKey=w.registerResolver(bwgSource.resolver));this.init()}function p(a,e){this.source=a;this.mapping=e;this.activityListeners=[];this.busy=0}function F(){}function S(){}function D(a){this.store=new ka(a.jbURI,a.jbQuery)}if("undefined"!==typeof d){var w=d("./cbrowser"),G=w.Browser,B=d("./tier").DasTier;t=d("./utils");var H=t.Awaited,u=t.arrayIndexOf,
K=t.shallowCopy,e=t.resolveUrlToPage;t=d("./das");var z=t.DASStylesheet,A=t.DASStyle,N=t.DASSource,M=t.DASSegment,U=t.DASFeature,y=t.DASSequence,E=t.DASLink;t=d("./bin");var k=t.URLFetchable,I=t.BlobFetchable,J=d("./twoBit").makeTwoBit,Q=d("./bigwig").makeBwg;t=d("./bam");var L=t.makeBam,Y=t.BamFlags;t=d("./spans");var ea=t.Range,T=t.union,X=d("./cigar").parseCigar,aa=d("./overlay").OverlayFeatureSource,ka=d("./jbjson").JBrowseStore,oa=d("./chainset").Chainset;d("./style");var pa=d("./encode").EncodeFetchable}var fa=
{},ga={};B.prototype.initSources=function(){var a=this,e=this.browser.createSources(this.dasSource);this.featureSource=e.features||new F;this.sequenceSource=e.sequence;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};G.prototype.createSources=function(e){var d=this.sourceCache.get(e);if(d)return d;var k,g;if("sequence"==e.tier_type||e.twoBitURI||e.twoBitBlob)g=e.twoBitURI||e.twoBitBlob?new b(e):e.ensemblURI?new a(e):
new C(e);else if(e.tier_type&&fa[e.tier_type])g=(0,fa[e.tier_type])(e),k=g.features,g=g.sequence;else if(e.bwgURI||e.bwgBlob)k=(k=this.getWorker())?new f(e,k,this):new c(e);else if(e.bamURI||e.bamBlob)k=(k=this.getWorker())?new h(e,k,this):new s(e);else if(e.jbURI)k=new D(e);else if(e.uri||e.features_uri)k=new x(e);if(e.overlay){d=[];k&&d.push(new q(k));for(k=0;k<e.overlay.length;++k){var n=this.createSources(e.overlay[k]);n&&n.features&&d.push(n.features)}k=new aa(d,e)}e.sequenceAliases&&(k=new p(k,
new oa({type:"alias",sequenceAliases:e.sequenceAliases})));e.mapping&&(k=new p(k,this.chains[e.mapping]));e.name&&k&&!k.name&&(k.name=e.name);null!=k&&(k=new q(k));if(null!=k||null!=g)d={features:k,sequence:g},this.sourceCache.put(e,d);return d};B.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri||!(this.dasSource.tier_type||this.dasSource.bwgURI||this.dasSource.bwgBlob||this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.twoBitURI||this.dasSource.twoBitBlob||this.dasSource.jbURI||
this.dasSource.overlay)?new x(this.dasSource):this.getSource()).getStyleSheet(a)};var la=0;q.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};q.prototype.removeReadinessListener=function(a){if(this.source.removeReadinessListener)return this.source.removeReadinessListener(a)};q.prototype.search=function(a,e){if(this.source.search)return this.source.search(a,e)};q.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};
q.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};q.prototype.getScales=function(){return this.source.getScales()};q.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};q.prototype.removeActivityListener=function(a){this.source.removeActivityListener&&this.source.removeActivityListener(a)};q.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};q.prototype.removeChangeListener=
function(a){this.source.removeChangeListener&&this.source.removeChangeListener(a)};q.prototype.findNextFeature=function(a,e,b,c){this.source.findNextFeature(a,e,b,c)};q.prototype.quantFindNextFeature=function(a,e,b,c,d){this.source.quantFindNextFeature(a,e,b,c,d)};q.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};q.prototype.fetch=function(a,e,b,c,d,f,h,k){if(!f)throw Error("Fetch pool is null");var g=this,n=this.cfsid,p=f.awaitedFeatures[n];if(p&&
p.started){if(p.styleFilters.doesNotContain(k)){g.source.fetch(a,e,b,c,d,f,h,k);return}}else p?p.styleFilters.addAll(k):(p=new H,p.styleFilters=k,f.awaitedFeatures[n]=p,f.requestsIssued.then(function(){p.started=!0;g.source.fetch(a,e,b,c,p.styleFilters.typeList(),f,function(a,e,b,c){p.res||p.provide({status:a,features:e,scale:b,coverage:c})},p.styleFilters)}).catch(function(a){console.log(a)}));p.await(function(a){h(a.status,a.features,a.scale,a.coverage)})};r.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);
a(this.readiness)};r.prototype.removeReadinessListener=function(a){a=u(this.readinessListeners,a);0<=a&&this.readinessListeners.splice(a,1)};r.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(e){console.log(e)}};r.prototype.addActivityListener=function(a){this.activityListeners.push(a)};r.prototype.removeActivityListener=function(a){a=u(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};r.prototype.notifyActivity=
function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(e){console.log(e)}};r.prototype.getScales=function(){return null};r.prototype.fetch=function(a,e,b,c,d,f,h){return h(null,[],1E9)};r.prototype.getStyleSheet=function(a){var e=new z,b=new A;b.glyph="BOX";b.BGCOLOR="blue";b.FGCOLOR="black";e.pushStyle({type:"default"},null,b);return a(e)};x.prototype.addActivityListener=function(a){this.activityListeners.push(a)};x.prototype.removeActivityListener=
function(a){a=u(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};x.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(e){console.log(e)}};x.prototype.getStyleSheet=function(a){this.dasSource.stylesheet(function(e){a(e)},function(){a(null,"Couldn't fetch DAS stylesheet")})};x.prototype.fetch=function(a,e,b,c,d,f,h){if(d&&0==d.length)h(null,[],c);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&
this.cachedStaticFeatures)return h(null,this.cachedStaticFeatures,this.cachedStaticScale);var k=!1!==this.dasSource.maxbins;d={type:d};k&&(d.maxbins=1+((b-e)/c|0));var g=this;g.busy++;g.notifyActivity();this.dasSource.features(new M(a,e,b),d,function(a,e){g.busy--;g.notifyActivity();var b=c;k||(b=0.1);!e&&g.dasSource.dasStaticFeatures&&(g.cachedStaticFeatures=a,g.cachedStaticScale=b);h(e,a,b)})}};x.prototype.findNextFeature=this.sourceFindNextFeature=function(a,e,b,c){if(this.dasSource.capabilities&&
0<=u(this.dasSource.capabilities,"das1:adjacent-feature")){var d=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(e|0)+":"+(0<b?"F":"B")};if(e=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=e;thisTier.dasSource.features(null,a,function(a){d.dasAdjLock=!1;0<a.length&&null!=a[0]&&c(a[0])})}};C.prototype.fetch=function(a,e,b,c,d){this.dasSource.sequence(new M(a,e,b),function(a){return 1==a.length?d(null,a[0]):
d("Didn't get sequence")})};C.prototype.getSeqInfo=function(a,e){this.awaitedEntryPoints.await(function(b){for(var c=0;c<b.length;++c)if(b[c].name==a)return e({length:b[c].end});return e()})};b.prototype.fetch=function(a,e,b,c,d){this.twoBit.await(function(c){c.fetch(a,e,b,function(c,f){if(f)return d(f,null);var h=new y(a,e,b,"DNA",c);return d(null,h)})})};b.prototype.getSeqInfo=function(a,e){this.twoBit.await(function(b){b.getSeq(a)?b.getSeq(a).length(function(a){e({length:a})}):e()})};a.prototype.fetch=
function(a,e,b,c,d){c=this.source.ensemblURI+"/sequence/region/"+this.source.species+"/"+a+":"+e+".."+b+":1?content-type=application/json";var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4==f.readyState)if(300<=f.status){var c="Error code "+f.status;try{var h=JSON.parse(f.response);h.error&&(c=h.error)}catch(k){}d(c,null)}else return h=JSON.parse(f.response),c=new y(a,e,b,"DNA",h.seq),d(null,c)};f.open("GET",c,!0);f.responseType="text";f.send("")};a.prototype.getSeqInfo=function(a,e){var b=
this.source.ensemblURI+"/info/assembly/"+this.source.species+"/"+a+"?content-type=application/json",c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==c.readyState)if(300<=c.status)e();else{var a=JSON.parse(c.response);e(a)}};c.open("GET",b,!0);c.responseType="text";c.send("")};x.prototype.getScales=function(){return[]};var $={};c.prototype=Object.create(r.prototype);c.prototype.init=function(){var a=this,e;e=(e=this.bwgSource.uri||this.bwgSource.bwgURI)?"encode"===this.bwgSource.transport?
new pa(e,{credentials:this.opts.credentials}):new k(e,{credentials:this.opts.credentials,resolver:this.opts.resolver}):new I(this.bwgSource.bwgBlob);Q(e,function(e,c){c?(a.error=c,a.readiness=null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(e),a.readiness=null,a.notifyReadiness(),"bigbed"==e.type&&e.getExtraIndices(function(e){a.extraIndices=e}))})};c.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&
0<this.extraIndices.length){a.search=[];for(var e=0;e<this.extraIndices.length;++e)a.search.push(this.extraIndices[e].field)}return a};c.prototype.fetch=function(a,e,c,b,d,f,h){var k=this;this.bwgHolder.await(function(f){if(null==f)return h(k.error||"Can't access binary file",null,null);var g;g=!d||0==d.length||0<=u(d,"density");k.opts.clientBin&&(g=!1);if("bigwig"==f.type||g||"undefined"!==typeof k.opts.forceReduction){g=-1;for(var n=0;n<f.zoomLevels.length;++n)if(f.zoomLevels[n].reduction<=b)g=
n;else break;"undefined"!==typeof k.opts.forceReduction&&(g=k.opts.forceReduction);g=0>g?f.getUnzoomedView():f.getZoomedView(g)}else g=f.getUnzoomedView();k.busy++;k.notifyActivity();g.readWigData(a,e,c,function(a){k.busy--;k.notifyActivity();var b=1E9;if("bigwig"===f.type){var d=(c-e)/a.length/2;d<b&&(b=d)}if(k.opts.link)for(d=0;d<a.length;++d){var g=a[d];g.label&&(g.links=[new E("Link",k.opts.link.replace(/\$\$/,g.label))])}h(null,a,b)})})};c.prototype.quantFindNextFeature=function(a,e,c,b,d){var f=
this;f.busy++;f.notifyActivity();this.bwgHolder.res.thresholdSearch(a,e,c,b,function(a,e){f.busy--;f.notifyActivity();return d(a,e)})};c.prototype.findNextFeature=function(a,e,c,b){var d=this;d.busy++;d.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,e,c,function(a){d.busy--;d.notifyActivity();0<a.length&&null!=a[0]&&b(a[0])})};c.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var e=[1],c=0;c<a.zoomLevels.length;++c)e.push(a.zoomLevels[c].reduction);return e}return null};
c.prototype.search=function(a,e){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,e):e(null,"No indices available")};c.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(e){e&&e.schema&&e.definedFieldCount<e.schema.fields.length&&a(function(a,c){for(var b=0;b<c.hit.length;++b)if(c.hit[b].isSuperGroup)return;for(b=e.definedFieldCount;b<e.schema.fields.length;++b){var d=e.schema.fields[b];c.add(d.comment,a[d.name])}})})};
c.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(e){if(!e)return a(null,"bbi error");var c=new z;if("bigbed"==e.type){var b=new A;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="blue";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=20;c.pushStyle({type:"bigbed"},null,b);b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="red";b.HEIGHT=10;b.BUMP=!0;b.ZINDEX=20;c.pushStyle({type:"translation"},null,b);b=new A;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="white";b.HEIGHT=10;b.ZINDEX=10;b.BUMP=!0;b.LABEL=
!0;c.pushStyle({type:"transcript"},null,b);b=new A;b.glyph="HISTOGRAM";b.COLOR1="white";b.COLOR2="black";b.HEIGHT=30;c.pushStyle({type:"density"},null,b)}else b=new A,b.glyph="HISTOGRAM",b.COLOR1="white",b.COLOR2="black",b.HEIGHT=30,c.pushStyle({type:"default"},null,b);12==e.definedFieldCount&&14<=e.fieldCount&&(c.geneHint=!0);return a(c)})};f.prototype=Object.create(r.prototype);f.prototype.init=function(){var a=this,b=this.uri||this.bwgSource.uri||this.bwgSource.bwgURI,c=this.bwgSource.blob||this.bwgSource.bwgBlob,
d=function(e,b){a.readiness=null;a.notifyReadiness();e?a.worker.postCommand({command:"meta",connection:e},function(b,c){c?(a.error=c,a.keyHolder.provide(null)):(a.meta=b,a.keyHolder.provide(e))}):(a.error=b,a.keyHolder.provide(null))};c?this.worker.postCommand({command:"connectBBI",blob:c},d):this.worker.postCommand({command:"connectBBI",uri:e(b),resolver:this.resolverKey,transport:this.bwgSource.transport,credentials:this.bwgSource.credentials},d)};f.prototype.capabilities=function(){var a={leap:!0};
this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=[];for(var e=0;e<this.meta.extraIndices.length;++e)a.search.push(this.meta.extraIndices[e].field)}return a};f.prototype.fetch=function(a,e,b,c,d,f,h){var k=this;k.busy++;k.notifyActivity();this.keyHolder.await(function(f){if(!f)return k.busy--,k.notifyActivity(),h(k.error||"Can't access binary file",null,null);var g=-1,n=!d||0==d.length||0<=u(d,"density");k.opts.clientBin&&
(n=!1);if("bigwig"==k.meta.type||n||"undefined"!==typeof k.opts.forceReduction){for(n=1;n<k.meta.zoomLevels.length;++n)if(k.meta.zoomLevels[n]<=c)g=n-1;else break;"undefined"!==typeof k.opts.forceReduction&&(g=k.opts.forceReduction)}k.worker.postCommand({command:"fetch",connection:f,chr:a,min:e,max:b,zoom:g},function(a,c){k.busy--;k.notifyActivity();var d=1E9;if("bigwig"===k.meta.type){var f=(b-e)/a.length/2;f<d&&(d=f)}if(k.opts.link)for(f=0;f<a.length;++f){var g=a[f];g.label&&(g.links=[new E("Link",
k.opts.link.replace(/\$\$/,g.label))])}h(c,a,d)})})};f.prototype.quantFindNextFeature=function(a,e,b,c,d){var f=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:e,dir:b,threshold:c,under:!1},function(a,e){console.log(a,e);f.busy--;f.notifyActivity();return d(a,e)})};f.prototype.findNextFeature=function(a,e,b,c){var d=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,
chr:a,pos:e,dir:b},function(a,e){d.busy--;d.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};f.prototype.getScales=function(){var a=this.meta;return a?a.zoomLevels:null};f.prototype.search=function(a,e){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return e(null,"No indices available");var b=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,c){b.busy--;b.notifyActivity();
e(a,c)})};f.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var e=this;this.keyHolder.await(function(b){var c=e.meta;c&&c.schema&&c.definedFieldCount<c.schema.fields.length&&a(function(a,e){for(var b=0;b<e.hit.length;++b)if(e.hit[b].isSuperGroup)return;for(b=c.definedFieldCount;b<c.schema.fields.length;++b){var d=c.schema.fields[b];e.add(d.comment,a[d.name])}})})};f.prototype.getStyleSheet=function(a){var e=this;this.keyHolder.await(function(b){b=e.meta;if(!b)return a(null,
"bbi error");var c=new z;if("bigbed"==b.type){var d=new A;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="blue";d.HEIGHT=8;d.BUMP=!0;d.LABEL=!0;d.ZINDEX=20;c.pushStyle({type:"bigbed"},null,d);d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="red";d.HEIGHT=10;d.BUMP=!0;d.ZINDEX=20;c.pushStyle({type:"translation"},null,d);d=new A;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="white";d.HEIGHT=10;d.ZINDEX=10;d.BUMP=!0;d.LABEL=!0;c.pushStyle({type:"transcript"},null,d);d=new A;d.glyph="HISTOGRAM";d.COLOR1="white";d.COLOR2=
"black";d.HEIGHT=30;c.pushStyle({type:"density"},null,d)}else d=new A,d.glyph="HISTOGRAM",d.COLOR1="white",d.COLOR2="black",d.HEIGHT=30,c.pushStyle({type:"default"},null,d);12==b.definedFieldCount&&14<=b.fieldCount&&(c.geneHint=!0);return a(c)})};s.prototype=Object.create(r.prototype);s.prototype.init=function(){var a=this,e,b;this.bamSource.bamBlob?(e=new I(this.bamSource.bamBlob),b=new I(this.bamSource.baiBlob)):(e=new k(this.bamSource.bamURI,{credentials:this.opts.credentials,resolver:this.opts.resolver}),
b=new k(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials,resolver:this.opts.resolver}));L(e,b,null,function(e,b){a.readiness=null;a.notifyReadiness();e?a.bamHolder.provide(e):(a.error=b,a.bamHolder.provide(null))})};s.prototype.fetch=function(a,e,b,c,d,f,k){var h=d&&1==d.length&&"density"==d[0],g=this;g.busy++;g.notifyActivity();this.bamHolder.await(function(c){if(!c)return g.busy--,g.notifyActivity(),k(g.error||"Couldn't fetch BAM");c.fetch(a,e,b,function(a,
e){g.busy--;g.notifyActivity();if(e)k(e,null,null);else{for(var b=[],c=0;c<a.length;++c){var d=n(a[c],g.opts.bamGroup);d&&b.push(d)}k(null,b,1E9)}},{light:h})})};s.prototype.getScales=function(){return 1E9};s.prototype.getStyleSheet=function(a){this.bamHolder.await(function(e){e=new z;var b=new A;b.glyph="HISTOGRAM";b.COLOR1="black";b.COLOR2="red";b.HEIGHT=30;e.pushStyle({type:"density"},"low",b);e.pushStyle({type:"density"},"medium",b);b=new A;b.glyph="__SEQUENCE";b.FGCOLOR="black";b.BGCOLOR="blue";
b.HEIGHT=8;b.BUMP=!0;b.LABEL=!1;b.ZINDEX=20;e.pushStyle({type:"bam"},"high",b);return a(e)})};h.prototype=Object.create(r.prototype);h.prototype.init=function(){var a=this,b=this.bamSource.uri||this.bamSource.bamURI,c=this.bamSource.indexUri||this.bamSource.baiURI||b+".bai",d=this.bamSource.bamBlob||this.bamSource.blob,f=this.bamSource.baiBlob||this.bamSource.indexBlob,k=function(e,b){a.readiness=null;a.notifyReadiness();e?a.keyHolder.provide(e):(a.error=b,a.keyHolder.provide(null))};d?this.worker.postCommand({command:"connectBAM",
blob:d,indexBlob:f},k):this.worker.postCommand({command:"connectBAM",uri:e(b),resolver:this.resolverKey,indexUri:e(c),credentials:this.bamSource.credentials,indexChunks:this.bamSource.indexChunks},k)};h.prototype.fetch=function(a,e,b,c,d,f,k){var h=d&&1==d.length&&"density"==d[0],g=this;g.busy++;g.notifyActivity();this.keyHolder.await(function(c){if(!c)return g.busy--,g.notifyActivity(),k(g.error||"Couldn't fetch BAM");g.worker.postCommand({command:"fetch",connection:c,chr:a,min:e,max:b,opts:{light:h}},
function(a,e){g.busy--;g.notifyActivity();if(e)k(e,null,null);else{for(var b=[],c=0;c<a.length;++c){var d=n(a[c],g.opts.bamGroup);d&&b.push(d)}k(null,b,1E9)}})})};h.prototype.getScales=function(){return 1E9};h.prototype.getStyleSheet=function(a){this.keyHolder.await(function(e){e=new z;var b=new A;b.glyph="HISTOGRAM";b.COLOR1="black";b.COLOR2="red";b.HEIGHT=30;e.pushStyle({type:"density"},"low",b);e.pushStyle({type:"density"},"medium",b);b=new A;b.glyph="__SEQUENCE";b.FGCOLOR="black";b.BGCOLOR="blue";
b.HEIGHT=8;b.BUMP=!0;b.LABEL=!1;b.ZINDEX=20;e.pushStyle({type:"bam"},"high",b);return a(e)})};p.prototype.addActivityListener=function(a){this.activityListeners.push(a)};p.prototype.removeActivityListener=function(a){a=u(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,0)};p.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(e){console.log(e)}};p.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};
p.prototype.getScales=function(){return this.source.getScales()};p.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};p.prototype.simplifySegments=function(a,e){if(0==a.length)return a;a.sort(function(a,e){var b=a.name-e.name;return b?b:(b=a.start-e.start)?b:a.end-e.end});for(var b=[],c=a[0],d=0;d<a.length;++d){var f=a[d];f.name!=c.name||f.start>c.end+e?(b.push(c),c=f):c=new M(c.name,Math.min(c.start,f.start),Math.max(c.end,f.end))}b.push(c);return b};
p.prototype.fetch=function(a,e,b,c,d,f,k,h){var g=this,n=b-e+1;g.busy++;g.notifyActivity();this.mapping.sourceBlocksForRange(a,e,b,function(a){if(0==a.length)g.busy--,g.notifyActivity(),k("No mapping available for this regions",[],c);else{a=g.simplifySegments(a,Math.max(100,0.05*n));var e=[],b=null,p=a.length,l;a.map(function(a){g.source.fetch(a.name,a.start,a.end,c,d,f,function(c,d,f){c&&!l&&(l=c);if(d)for(c=0;c<d.length;++c){var h=d[c],n=h.segment;0==n.indexOf("chr")&&(n=n.substr(3));n=g.mapping.mapSegment(n,
h.min,h.max);if(0==n.length)h.parts&&0<h.parts.length&&e.push(h);else for(var z=0;z<n.length;++z){var u=n[z],s=K(h);s.segment=u.segment;s.min=u.min;s.max=u.max;u.partialMin&&(s.partialMin=u.partialMin);u.partialMax&&(s.partialMax=u.partialMax);u.flipped&&("-"==h.orientation?s.orientation="+":"+"==h.orientation&&(s.orientation="-"));e.push(s)}}d=g.mapping.mapPoint(a.name,a.start);c=g.mapping.mapPoint(a.name,a.end);d&&c&&(d=new ea(d.pos,c.pos),b=b?T(b,d):d);--p;0==p&&(g.busy--,g.notifyActivity(),k(l,
e,f,b))},h)})}})};F.prototype.getScales=function(){return null};F.prototype.fetch=function(a,e,b,c,d,f,k){return k(null,[],1E9)};F.prototype.getStyleSheet=function(a){var e=new z,b=new A;b.glyph="BOX";b.BGCOLOR="blue";b.FGCOLOR="black";e.pushStyle({type:"default"},null,b);return a(e)};S.prototype.fetch=function(a,e,b,c,d){return d(null,null)};D.prototype.getScales=function(){return null};D.prototype.getStyleSheet=function(a){var e=new z,b=new A;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="red";b.HEIGHT=
10;b.BUMP=!0;b.ZINDEX=20;e.pushStyle({type:"translation"},null,b);b=new A;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="white";b.HEIGHT=10;b.ZINDEX=10;b.BUMP=!0;b.LABEL=!0;e.pushStyle({type:"transcript"},null,b);b=new A;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="green";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=20;e.pushStyle({type:"default"},null,b);return a(e)};D.prototype.fetch=function(a,e,b,c,d,f,k){d&&0==d.length?k(null,[],c):this.store.features(new M(a,e,b),{},function(a,e){k(e,a,1E5)})};G.prototype.sourceAdapterIsCapable=
function(a,e){return a.capabilities?a.capabilities()[e]:!1};"undefined"!==typeof v&&(v.exports={FeatureSourceBase:r,TwoBitSequenceSource:b,EnsemblSequenceSource:a,DASSequenceSource:C,MappedFeatureSource:p,CachingFeatureSource:q,BWGFeatureSource:c,RemoteBWGFeatureSource:f,BAMFeatureSource:s,RemoteBAMFeatureSource:h,DummyFeatureSource:F,DummySequenceSource:S,registerSourceAdapterFactory:m,registerParserFactory:l,makeParser:g},d("./ensembljson"),d("./tabix-source"),d("./memstore"),d("./bedwig"),d("./vcf"))},
{"./bam":1,"./bedwig":2,"./bigwig":3,"./bin":4,"./cbrowser":6,"./chainset":7,"./cigar":8,"./das":10,"./encode":12,"./ensembljson":13,"./jbjson":22,"./memstore":25,"./overlay":27,"./spans":36,"./style":37,"./tabix-source":40,"./tier":45,"./twoBit":48,"./utils":49,"./vcf":50}],35:[function(d,v,t){function m(d){return d.uri?d.uri:d.blob?"file:"+d.blob.name:d.bwgBlob?"file:"+d.bwgBlob.name:d.bamBlob?"file:"+d.bamBlob.name:d.twoBitBlob?"file:"+d.twoBitBlob.name:d.bwgURI||d.bamURI||d.jbURI||d.twoBitURI||
"https://www.biodalliance.org/magic/no_uri"}function l(d){return d.stylesheet_uri?d.stylesheet_uri:"sequence"==d.tier_type||d.twoBitURI||d.twoBitBlob?"https://www.biodalliance.org/magic/sequence":m(d)}function g(d,l){if(m(d)!=m(l)||d.mapping!=l.mapping||d.tier_type!=l.tier_type)return!1;if(d.overlay){if(!l.overlay||l.overlay.length!=d.overlay.length)return!1;for(var q=0;q<d.overlay.length;++q)if(!g(d.overlay[q],l.overlay[q]))return!1}else if(l.overlay)return!1;return!0}function q(d,g){if(m(d)!=m(g)||
l(d)!=l(g)||d.mapping!=g.mapping||d.tier_type!=g.tier_type)return!1;if(d.overlay){if(!g.overlay||g.overlay.length!=d.overlay.length)return!1;for(var t=0;t<d.overlay.length;++t)if(!q(d.overlay[t],g.overlay[t]))return!1}else if(g.overlay)return!1;return!0}"undefined"!==typeof v&&(v.exports={sourcesAreEqual:q,sourcesAreEqualModuloStyle:g,sourceDataURI:m,sourceStyleURI:l})},{}],36:[function(d,v,t){function m(b,a){if("number"!=typeof b||"number"!=typeof a)throw"Bad range "+b+","+a;this._min=b;this._max=
a}function l(b){b=b.sort(C);var a=[],c=b.shift();b.forEach(function(b){b._min<=c._max?b._max>c._max&&(c._max=b._max):(a.push(c),c=b)});a.push(c);this._ranges=a}function g(b,a){b instanceof l||(b instanceof Array||(b=[b]),b=new l(b));a&&b.insertRange(a);return b}function q(b,a){for(var c=b.ranges(),d=a.ranges(),g=c.length,s=d.length,h=0,p=0,q=[];h<g&&p<s;){b=c[h];a=d[p];var r=Math.max(b.min(),a.min()),D=Math.min(b.max(),a.max());D>=r&&q.push(new m(r,D));b.max()>a.max()?++p:++h}return 0==q.length?null:
1==q.length?q[0]:new l(q)}function r(b){var a=0;b=b.ranges();for(var c=0;c<b.length;++c)var d=b[c],a=a+(d.max()-d.min()+1);return a}function x(b,a){return b.min()<a.min()?-1:b.min()>a.min()?1:b.max()<a.max()?-1:a.max()>b.max()?1:0}function C(b,a){return b._min<a._min?-1:b._min>a._min?1:b._max<a._max?-1:a._max>b._max?1:0}m.prototype.min=function(){return this._min};m.prototype.max=function(){return this._max};m.prototype.contains=function(b){return b>=this._min&&b<=this._max};m.prototype.isContiguous=
function(){return!0};m.prototype.ranges=function(){return[this]};m.prototype._pushRanges=function(b){b.push(this)};m.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};l.prototype.min=function(){return this._ranges[0].min()};l.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};l.prototype.lower_bound=function(b){var a=this.ranges();if(b>this.max())return a.length;if(b<this.min())return 0;for(var c=0,d=a.length-1;c<=d;){var g=Math.floor((c+d)/2);if(b>a[g]._max)c=
g+1;else if(b<a[g]._min)d=g-1;else return g}return c};l.prototype.contains=function(b){var a=this.lower_bound(b);return a<this._ranges.length&&this._ranges[a].contains(b)?!0:!1};l.prototype.insertRange=function(b){var a=this.lower_bound(b._min);if(a===this._ranges.length)this._ranges.push(b);else{var c=this.ranges();if(b._max<c[a]._min)this._ranges.splice(a,0,b);else{c[a]._min<b._min&&(b._min=c[a]._min);for(var d=a+1;d<c.length&&c[d]._min<=b._max;)d++;d--;c[d]._max>b._max&&(b._max=c[d]._max);this._ranges.splice(a,
d-a+1,b)}}};l.prototype.isContiguous=function(){return 1<this._ranges.length};l.prototype.ranges=function(){return this._ranges};l.prototype._pushRanges=function(b){for(var a=0;a<this._ranges.length;++a)b.push(this._ranges[a])};l.prototype.toString=function(){for(var b="",a=0;a<this._ranges.length;++a)0<a&&(b+=","),b+=this._ranges[a].toString();return b};"undefined"!==typeof v&&(v.exports={Range:m,union:g,intersection:q,coverage:r,rangeOver:x,_rangeOrder:C})},{}],37:[function(d,v,t){function m(d,
l,m){this.type=d;this.method=l;this.label=m}function l(d){this._filters={};if(d)for(var l=0;l<d.length;++l)this.add(d[l])}m.prototype.equals=function(d){return this.type==d.type&&this.method==d.method&&this.label==d.label};m.prototype.toString=function(){var d=[];this.type&&d.push("type="+this.type);this.method&&d.push("method="+this.method);this.label&&d.push("label="+this.label);return"StyleFilter<"+d.join(";")+">"};l.prototype.add=function(d){var l=d.toString();this._filters[l]||(this._filters[l]=
d,this._list=null)};l.prototype.addAll=function(d){d=d.list();for(var l=0;l<d.length;++l)this.add(d[l])};l.prototype.doesNotContain=function(d){d=d.list();for(var l=0;l<d.length;++l)if(!this._filters[l.toString()])return!0;return!1};l.prototype.list=function(){if(!this._list){this._list=[];for(var d in this._filters)this._filters.hasOwnProperty(d)&&this._list.push(this._filters[d])}return this._list};l.prototype.typeList=function(){for(var d=[],l=this.list(),m=0;m<l.length;++m){var t=l[m].type;if(!t||
"default"==t)return null;0>d.indexOf(t)&&d.push(t)}return d};"undefined"!==typeof v&&(v.exports={StyleFilter:m,StyleFilterSet:l})},{}],38:[function(d,v,t){if("undefined"!==typeof d){var m=d("./cbrowser").Browser,l=d("./utils").makeElementNS,g=d("./version"),q=d("./sequence-draw").svgSeqTier;v=d("./svg-utils");var r=v.NS_SVG,x=v.NS_XLINK,C=v.SVGPath,b=d("./numformats").formatQuantLabel}m.prototype.makeSVG=function(a){a=a||{};var c=a.minTierHeight||20,d=document.implementation.createDocument(r,"svg",
null),n=l(r,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});d.documentElement.appendChild(n);var s=l(r,"a",l(r,"text","Graphics from Dalliance "+g,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",textAnchor:"middle",fill:"blue"}));s.setAttribute("xmlns:xlink",x);s.setAttribute("xlink:href","http://www.biodalliance.org/");n.appendChild(s);s=l(r,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});s=l(r,"clipPath",s,{id:"featureClip"});n.appendChild(s);for(var s=
70,h=l(r,"g",null,{}),p=0;p<this.tiers.length;++p){var m=this.tiers[p],t=l(r,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),D=l(r,"g"),w=s,G=l(r,"rect",null,{x:0,y:w,width:"10000",height:50,fill:m.background});t.appendChild(G);if(m.sequenceSource){var B=q(m,m.currentSequence);t.appendChild(l(r,"g",B,{transform:"translate(200, "+s+")"}));s+=80}else{if(!m.subtiers)continue;for(var B=(m.glyphCacheOrigin-this.viewStart)*this.scale,v=!1,u=0;u<m.subtiers.length;++u){for(var s=s+3,K=m.subtiers[u],
e=[],z=0;z<K.glyphs.length;++z)e.push(K.glyphs[z].toSVG());t.appendChild(l(r,"g",e,{transform:"translate("+(200+B)+", "+s+")"}));if(K.quant){var v=!0,e=K.quant,A=K.height,z=2;40<A&&(z=1+(A/20|0));var A=A/(z-1),N=(e.max-e.min)/(z-1),M=new C;M.moveTo(205,s);M.lineTo(200,s);M.lineTo(200,s+K.height);M.lineTo(205,s+K.height);for(var U=1;U<z-1;++U){var y=U*A;M.moveTo(200,s+y);M.lineTo(203,s+y)}D.appendChild(l(r,"path",null,{d:M.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));D.appendChild(l(r,
"text",b(e.max),{x:197,y:s+7,textAnchor:"end"}));D.appendChild(l(r,"text",b(e.min),{x:197,y:s+K.height,textAnchor:"end"}));for(U=1;U<z-1;++U)y=U*A,D.appendChild(l(r,"text",b(1*e.max-U*N),{x:197,y:s+y+3,textAnchor:"end"}))}s+=K.height+3}s-w<c&&(s=w+c)}D.appendChild(l(r,"text","string"===typeof m.config.name?m.config.name:m.dasSource.name,{x:200-(v?20:12),y:(s+w+8)/2,fontSize:"10pt",textAnchor:"end"}));G.setAttribute("height",s-w);h.appendChild(l(r,"g",[t,D]))}if(a.highlights)for(c=this.highlights||
[],v=0;v<c.length;++v)A=c[v],(A.chr==this.chr||A.chr=="chr"+this.chr)&&A.min<this.viewEnd&&A.max>this.viewStart&&(p=(Math.max(A.min,this.viewStart)-this.viewStart)*this.scale,m=(Math.min(A.max,this.viewEnd)-this.viewStart)*this.scale,h.appendChild(l(r,"rect",null,{x:200+p,y:70,width:m-p,height:s-70,stroke:"none",fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));c=-1;"center"==a.ruler?c=200+(this.viewEnd-this.viewStart)*this.scale/2:"left"==a.ruler?c=200:"right"==a.ruler&&(c=
200+(this.viewEnd-this.viewStart)*this.scale);0<=c&&h.appendChild(l(r,"line",null,{x1:c,y1:70,x2:c,y2:s,stroke:"blue"}));n.appendChild(h);d.documentElement.setAttribute("width",this.featurePanelWidth+20+200);d.documentElement.setAttribute("height",s+50);return new Blob([(new XMLSerializer).serializeToString(d)],{type:"image/svg+xml"})}},{"./cbrowser":6,"./numformats":26,"./sequence-draw":31,"./svg-utils":39,"./utils":49,"./version":51}],39:[function(d,v,t){function m(){this.ops=[]}m.prototype.moveTo=
function(d,g){this.ops.push("M "+d+" "+g)};m.prototype.lineTo=function(d,g){this.ops.push("L "+d+" "+g)};m.prototype.closePath=function(){this.ops.push("Z")};m.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof v&&(v.exports={NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",SVGPath:m})},{}],40:[function(d,v,t){function m(a){q.call(this);this.readiness="Connecting";this.source=a;this.tabixHolder=new C;var c=this,d=g(a.payload);if(d)this.parser=
d;else throw"Unsuported tabix payload "+a.payload;var n;this.source.blob?(a=new x(this.source.blob),n=new x(this.source.indexBlob)):(a=new r(this.source.uri,{credentials:this.source.credentials,resolver:this.source.resolver}),n=new r(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials,resolver:this.source.resolver}));b(a,n,function(a,b){c.tabixHolder.provide(a);a.fetchHeader(function(a,b){if(a){for(var c=d.createSession(function(){}),h=0;h<a.length;++h)c.parse(a[h]);
c.flush()}});c.readiness=null;c.notifyReadiness()})}if("undefined"!==typeof d){v=d("./sourceadapters");var l=v.registerSourceAdapterFactory,g=v.makeParser,q=v.FeatureSourceBase;v=d("./bin");var r=v.URLFetchable,x=v.BlobFetchable,C=d("./utils").Awaited,b=d("./tabix").connectTabix}m.prototype=Object.create(q.prototype);m.prototype.fetch=function(a,b,d,g,l,h,p){var m=this;m.busy++;m.notifyActivity();this.tabixHolder.await(function(h){h.fetch(a,b,d,function(a,b){m.busy--;m.notifyActivity();for(var c=
[],d=m.parser.createSession(function(a){c.push(a)}),f=0;f<a.length;++f)d.parse(a[f]);d.flush();p(null,c,1E9)})})};m.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};m.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};l("tabix",function(a){return{features:new m(a)}})},{"./bin":4,"./sourceadapters":34,"./tabix":41,"./utils":49}],41:[function(d,v,t){function m(){}function l(a,b,d){var n=
new m;n.data=a;n.tbi=b;n.tbi.fetch(function(a){if(!a)return d(null,"Couldn't access Tabix");a=x(a,a.byteLength);var b=new Uint8Array(a);if(q(b,0)!=g)return d(null,"Not a tabix index");var c=q(b,4);n.format=q(b,8);n.colSeq=q(b,12);n.colStart=q(b,16);n.colEnd=q(b,20);n.meta=q(b,24);n.skip=q(b,28);q(b,32);n.indices=[];var l=36;n.chrToIndex={};n.indexToChr=[];for(var m=0;m<c;++m){for(var D="";;){var w=b[l++];if(0==w)break;D+=String.fromCharCode(w)}n.chrToIndex[D]=m;0==D.indexOf("chr")?n.chrToIndex[D.substring(3)]=
m:n.chrToIndex["chr"+D]=m;n.indexToChr.push(D)}D=1E9;for(w=0;w<c;++w){for(var t=l,B=q(b,l),l=l+4,m=0;m<B;++m){q(b,l);var v=q(b,l+4),l=l+(8+16*v)}for(var v=q(b,l),u=l+=4,m=0;m<v;++m){var C=r(b,u),u=u+8;if(C){m=C.block;0<C.offset&&(m+=65536);m<D&&(D=m);break}}l+=8*v;0<B&&(n.indices[w]=new Uint8Array(a,t,l-t))}n.headerMax=D;d(n)},{timeout:5E3})}var g=21578324;if("undefined"!==typeof d){d("./spans");var q=d("./bin").readInt;d=d("./lh3utils");var r=d.readVob,x=d.unbgzf,C=d.reg2bins,b=d.Chunk}m.prototype.blocksForRange=
function(a,c,d){var g=this.indices[a];if(!g)return[];a=C(c,d);for(var l=[],h=0;h<a.length;++h)l[a[h]]=!0;a=[];for(var p=[],h=q(g,0),m=4,t=0;t<h;++t){var D=q(g,m),w=q(g,m+4),m=m+8;if(l[D])for(var G=0;G<w;++G){var B=r(g,m),x=r(g,m+8);(4681>D?p:a).push(new b(B,x));m+=16}else m+=16*w}h=q(g,m);l=null;c=Math.min(c>>14,h-1);d=Math.min(d>>14,h-1);for(h=c;h<=d;++h)(c=r(g,m+4+8*h))&&(!l||c.block<l.block||c.offset<l.offset)&&(l=c);g=[];if(null!=l)for(h=0;h<p.length;++h)d=p[h],d.maxv.block>=l.block&&d.maxv.offset>=
l.offset&&g.push(d);p=g;g=[];for(h=0;h<p.length;++h)g.push(p[h]);for(h=0;h<a.length;++h)g.push(a[h]);g.sort(function(a,b){var e=a.minv.block-b.minv.block;return 0!=e?e:a.minv.offset-b.minv.offset});a=[];if(0<g.length){p=g[0];for(h=1;h<g.length;++h)d=g[h],d.minv.block==p.maxv.block?p=new b(p.minv,d.maxv):(a.push(p),p=d);a.push(p)}return a};m.prototype.fetch=function(a,b,d,g){function l(){if(r>=m.length)return g(q);if(w){var a=new Uint8Array(w);h.readRecords(a,m[r].minv.offset,q,b,d,p);w=null;++r;return l()}var B=
m[r],a=B.minv.block;h.data.slice(a,B.maxv.block+65536-a).fetch(function(a){w=x(a,B.maxv.block-B.minv.block+1);return l()})}var h=this;a=this.chrToIndex[a];if(void 0==a)return g([]);var p=this.indexToChr[a],m;void 0===a?m=[]:(m=this.blocksForRange(a,b,d))||g(null,"Error in index fetch");var q=[],r=0,w;l()};m.prototype.readRecords=function(a,b,d,g,l,h){a:for(;;){for(var p="";b<a.length;){var m=a[b++];if(10==m){m=p.split("\t");if(m[this.colSeq-1]==h){var q=parseInt(m[this.colStart-1]),r=q;0<this.colEnd&&
(r=parseInt(m[this.colEnd-1]));this.format&65536&&++q;q<=l&&r>=g&&d.push(p)}continue a}else p+=String.fromCharCode(m)}break}};m.prototype.fetchHeader=function(a){var b=this;b.data.slice(0,b.headerMax).fetch(function(d){if(!d)return a(null,"Fetch failed");d=new Uint8Array(x(d,d.byteLength));for(var g=0,l="",h=[];g<d.length;){var p=d[g++];if(10==p)if(l.charCodeAt(0)==b.meta)h.push(l),l="";else return a(h);else l+=String.fromCharCode(p)}a(h)})};"undefined"!==typeof v&&(v.exports={connectTabix:l,TABIX_MAGIC:g})},
{"./bin":4,"./lh3utils":24,"./spans":36}],42:[function(d,v,t){function m(a){this.genomes={};this.url=a}function l(){}function g(a){this.hub=a}function q(a,b,c){c=c||{};c.salt=!0;x(a,function(d,l){if(l)return b(null,l);var w=d.split(n),q=new m(a);c.credentials&&(q.credentials=c.credentials);for(var s=0;s<w.length-2;s+=3)q[w[s+1]]=w[s+2];if(q.genomesFile){var r=C(a,q.genomesFile);x(r,function(a,d){if(d)return b(null,d);for(var e=a.split(f),h=0;h<e.length;++h){var l=e[h].split(n),m=new g(q);c.credentials&&
(m.credentials=c.credentials);for(var w=0;w<l.length-2;w+=3)m[l[w+1]]=l[w+2];m.twoBitPath&&(m.twoBitPath=C(r,m.twoBitPath));m.genome&&m.trackDb&&(m.absURL=C(r,m.trackDb),q.genomes[m.genome]=m)}b(q)},c)}else b(null,"No genomesFile")},c)}function r(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}if("undefined"!==typeof d){t=d("./utils");var x=t.textXHR,C=t.relativeURL,b=t.shallowCopy;d=d("./das");var a=d.DASStylesheet,
c=d.DASStyle}var f=/\n\s*\n/,n=/(\w+) +(.+)\n?/,s=/subGroup[1-9]/;l.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};g.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);x(this.absURL,function(c,d){if(d)return a(null,d);c=c.replace("\\\n"," ");for(var g=[],m={},q=c.split(f),r=0;r<q.length;++r){var t=q[r].replace(/\#.*/g,"").split(n),u=new l;u._db=b;for(var x=0;x<t.length-2;x+=3){var e=t[x+1],z=t[x+2];if(e.match(s)){u.subgroups||
(u.subgroups={});for(var e=z.split(/\s/),z=e[0],A={name:e[1],tags:[],titles:[]},N=2;N<e.length;++N){var v=e[N].split(/=/);A.tags.push(v[0]);A.titles.push(v[1])}u.subgroups[z]=A}else if("subGroups"===e)for(e=z.split(/(\w+)=(\w+)/),u.sgm={},N=0;N<e.length-2;N+=3)u.sgm[e[N+1]]=e[N+2];else u[t[x+1]]=t[x+2]}u.track&&(u.type||u.container||u.view||u.bigDataUrl)&&(g.push(u),m[u.track]=u)}q=[];r=[];for(e=0;e<g.length;++e)u=g[e],t=!0,u.parent&&(x=u.parent.split(/\s+/),(z=m[x[0]])?(u._parent=z,z.children||(z.children=
[]),z.children.push(u),z&&(t=!1)):console.log("Couldn't find parent "+x[0]+"("+u.parent+")")),u.compositeTrack?r.push(u):t&&q.push(u);for(g=0;g<r.length;++g)if(m=r[g],m.children){u=!1;for(t=0;t<m.children.length;++t)e=m.children[t],e.view&&(e.shortLabel=m.shortLabel+": "+e.shortLabel,q.push(e),u=!0);u||q.push(m)}b._tracks=q;return a(b._tracks,null)},{credentials:this.credentials,salt:!0})};l.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&
(a.mapping=this._db.mapping);var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant="http://genome.ucsc.edu/images/"+b[0]);if(b=this.get("searchTrix"))a.trixURI=C(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var c=0;c<b.length;++c){var d=b[c],f=d.toDallianceSource();a.overlay.push(f);if(f.style)for(var g=0;g<f.style.length;++g){var n=f.style[g];n.method=d.shortLabel;"transparentOverlay"==this.aggregate&&
(n.style.ALPHA=0.5);a.style.push(n)}}return a}b=this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){c=b.split(/\s+/);if("bigBed"==c[0]&&this.bigDataUrl)return b=c[1]|0,c="+"==c[2],a.bwgURI=C(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&c&&(a.collapseSuperGroups=!0),a;if("bigWig"==c[0]&&this.bigDataUrl)return a.bwgURI=C(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&
"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==c[0]&&this.bigDataUrl)return a.bamURI=C(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;if("vcfTabix"==c[0]&&this.bigDataUrl)return a.uri=C(this._db.absURL,this.bigDataUrl),a.tier_type="tabix",a.payload="vcf",this._db.credentials&&(a.credentials=!0),a;console.log("Unsupported "+this.type)}};l.prototype.bigwigStyles=function(){var b=
this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){var b=b.split(/\s+/),d,f;3<=b.length&&(d=1*b[1],f=1*b[2]);var g;this.maxHeightPixels&&(b=this.maxHeightPixels.split(/:/),3==b.length?g=b[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));b="bars";this.graphTypeDefault&&(b=this.graphTypeDefault);var n="black",l=null;this.color&&(n="rgb("+this.color+")");this.altColor&&(l="rgb("+this.altColor+")");var m=new a,q=new c;q.glyph="points"==b?"POINT":"HISTOGRAM";
l?(q.COLOR1=n,q.COLOR2=l):q.BGCOLOR=n;q.HEIGHT=g||30;if(d||f)q.MIN=d,q.MAX=f;m.pushStyle({type:"default"},null,q);return m.styles}};l.prototype.bigbedStyles=function(){var d="on"==(""+this.get("itemRgb")).toLowerCase(),f=this.get("visibility")||"full",g=this.get("color"),g=g?"rgb("+g+")":"blue",n=new a,l=new c;l.glyph="BOX";l.FGCOLOR="black";l.BGCOLOR=g;l.HEIGHT="full"==f||"pack"==f?12:8;l.BUMP="full"==f||"pack"==f;l.LABEL="full"==f||"pack"==f;l.ZINDEX=20;d&&(l.BGITEM=!0);(f=this.get("colorByStrand"))?
(f=f.split(/\s+/),g=b(l),g.BGCOLOR="rgb("+f[0]+")",n.pushStyle({type:"bigwig",orientation:"+"},null,g),l=b(l),l.BGCOLOR="rgb("+f[1]+")",n.pushStyle({type:"bigwig",orientation:"-"},null,l)):n.pushStyle({type:"bigwig"},null,l);l=new c;l.glyph="BOX";l.FGCOLOR="black";d&&(l.BGITEM=!0);l.BGCOLOR="red";l.HEIGHT=10;l.BUMP=!0;l.ZINDEX=20;n.pushStyle({type:"translation"},null,l);d=new c;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="white";d.HEIGHT=10;d.ZINDEX=10;d.BUMP=!0;d.LABEL=!0;n.pushStyle({type:"transcript"},
null,d);return n.styles};"undefined"!==typeof v&&(v.exports={connectTrackHub:q,THUB_COMPARE:r})},{"./das":10,"./utils":49}],43:[function(d,v,t){if("undefined"!==typeof d)var m=d("./cbrowser").Browser,l=d("./utils").shallowCopy;m.prototype.mergeSelectedTiers=function(){for(var d=[],m=[],r=0;r<this.selectedTiers.length;++r){var t=this.tiers[this.selectedTiers[r]];d.push(l(t.dasSource));for(var v=t.stylesheet.styles,b=0;b<v.length;++b){var a=v[b],c=l(a);c.method=t.dasSource.name.replace(/[()+*?]/g,"\\$&");
c._methodRE=null;c.style=l(a.style);void 0===c.style.ZINDEX&&(c.style.ZINDEX=r);t.forceMin&&(c.style.MIN=t.forceMin);t.forceMax&&(c.style.MAX=t.forceMax);m.push(c)}}this.addTier({name:"Merged",merge:"concat",overlay:d,noDownsample:!0,style:m});this.setSelectedTier(this.tiers.length-1)}},{"./cbrowser":6,"./utils":49}],44:[function(d,v,t){function m(a){for(var b=0;b<a.styles.length;++b){var d=a.styles[b].style;if("__SEQUENCE"===d.glyph)return d}}if("undefined"!==typeof d){var l=d("./cbrowser").Browser,
g=d("./utils").makeElement;v=d("./das");var q=v.isDasBooleanTrue,r=v.copyStylesheet,x=d("./color").dasColourForName,C=d("./sourcecompare").sourceDataURI}var b={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};l.prototype.openTierPanel=function(a){if("tier"===this.uiMode&&this.manipulatingTier===a)this.hideToolPanel(),this.setUiMode("none");else if(a){var c=function(a){a.BGGRAD||(1==N?("LINEPLOT"==a.glyph||b[a.glyph]?a.FGCOLOR=B.value:a.BGCOLOR=B.value,a.COLOR1=a.COLOR2=a.COLOR3=null):
(a.COLOR1=B.value,a.COLOR2=H.value,a.COLOR3=2<N?u.value:null),a._gradient=null,a._plusColor=K.value,a._minusColor=e.value)},d=function(e){for(var b=r(a.stylesheet),c=a.browser.zoomForCurrentScale(),d=0;d<b.styles.length;++d){var f=b.styles[d];f.zoom&&f.zoom!=c||e(f.style)}return b},n=function(e){a.mergeStylesheet(d(c))};this.manipulatingTier=a;var l=g("div",null,{className:"tier-edit"}),h=g("div","About '"+(a.config.Name||a.dasSource.name)+"'",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",
textAlign:"center"});l.appendChild(h);var h=g("div",[g("p",a.dasSource.desc)]),p=[],t=C(a.dasSource);!t||0!=t.indexOf("http://")&&0!=t.indexOf("https://")&&0!=t.indexOf("//")||"https://www.biodalliance.org/magic/no_uri"===t||p.push(g("li",g("a","(Download data)",{href:t})));a.dasSource.mapping&&(t=this.chains[a.dasSource.mapping].coords,p.push(g("li","Mapped from "+t.auth+t.version)));0<p.length&&h.appendChild(g("ul",p));l.appendChild(h);var v=g("span"," (styles for current zoom level)",null,{display:"none"}),
h=g("div",["Edit",v],null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"});l.appendChild(h);var D=g("input",null,{type:"text"}),w=g("input",null,{type:"checkbox",disabled:this.disablePinning}),G=g("select");G.appendChild(g("option","Histogram",{value:"HISTOGRAM"}));G.appendChild(g("option","Line Plot",{value:"LINEPLOT"}));G.appendChild(g("option","Ribbon",{value:"GRADIENT"}));G.appendChild(g("option","Scatter",{value:"SCATTER"}));var B=g("input",null,{type:"text",value:"#dd00dd"}),
H=g("input",null,{type:"text",value:"#dd00dd"}),u=g("input",null,{type:"text",value:"#dd00dd"}),K=g("input",null,{type:"text",value:"#ffa07a"}),e=g("input",null,{type:"text",value:"#87cefa"});try{B.type=H.type=u.type="color",K.type=e.type="color"}catch(z){}var A=[B,H,u],h=g("i",null,{className:"fa fa-plus-circle"}),p=g("i",null,{className:"fa fa-minus-circle"}),N=1,t=g("td",A),M=function(a){N=a;for(var e=0;e<a;++e)A[e].style.display="block";for(e=a;e<A.length;++e)A[e].style.display="none"};h.addEventListener("click",
function(a){3>N&&(M(N+1),n(null))},!1);p.addEventListener("click",function(a){1<N&&(M(N-1),n(null))},!1);var U=g("input",null,{type:"text",value:"0.0"}),y=g("input",null,{type:"text",value:"10.0"}),E=g("input",null,{type:"checkbox"}),k=g("input",null,{type:"checkbox"}),I=g("input",null,{type:"checkbox",checked:void 0!==a.quantLeapThreshold}),J=g("input",null,{type:"text",value:a.quantLeapThreshold,disabled:!I.checked}),Q=g("input",null,{type:"text",value:"50"}),L=g("input",null,{type:"checkbox"}),
Y=g("input",null,{type:"text"}),ea=g("input",null,{type:"checkbox"}),T=null;0<a.stylesheet.styles.length&&(T=a.stylesheet.styles[0].style);var X=function(){D.value="string"===typeof a.config.name?a.config.name:a.dasSource.name;w.checked=a.pinned;a.forceHeight?Q.value=""+a.forceHeight:T&&T.HEIGHT&&(Q.value=""+T.HEIGHT);"number"==typeof a.quantLeapThreshold?(I.checked=!0,J.disabled=!1,parseFloat(J.value)!=a.quantLeapThreshold&&(J.value=a.quantLeapThreshold)):(I.checked=!1,J.disabled=!0);Y.value="number"==
typeof a.subtierMax?""+a.subtierMax:""+(a.dasSource.subtierMax||a.browser.defaultSubtierMax);if(0<a.stylesheet.styles.length){for(var b=null,c=!1,d=!1,d=a.browser.zoomForCurrentScale(),f=0,h=0;h<a.stylesheet.styles.length;++h){var g=a.stylesheet.styles[h];if(!g.zoom||g.zoom==d)if(++f,g=a.stylesheet.styles[h].style,b||(b=T=g),"LINEPLOT"==g.glyph||"HISTOGRAM"==g.glyph||"GRADIENT"==g.glyph||q(g.SCATTER))c||(b=T=g),c=!0}if(!b)return;v.style.display=f==a.stylesheet.styles.length?"none":"inline";d=c&&1==
f;c?(qa.style.display="table-row",da.style.display="table-row",ta.style.display="none",V.style.display="none"):(qa.style.display="none",da.style.display="none",ta.style.display="table-row",L.checked=q(T.BUMP),Y.disabled=!q(T.BUMP),V.style.display="table-row",ea.checked=q(T.LABEL));d?(la.style.display="table-row",$.style.display="table-row"):(la.style.display="none",$.style.display="none");f=1;b.COLOR1?(B.value=x(b.COLOR1).toHexString(),b.COLOR2&&(H.value=x(b.COLOR2).toHexString(),b.COLOR3?(u.value=
x(b.COLOR3).toHexString(),f=3):f=2)):"LINEPLOT"==b.glyph||"DOT"==b.glyph&&b.FGCOLOR?B.value=x(b.FGCOLOR).toHexString():b.BGCOLOR&&(B.value=x(b.BGCOLOR).toHexString());M(f);b._plusColor&&(K.value=x(b._plusColor).toHexString()||b._plusColor);b._minusColor&&(e.value=x(b._minusColor).toHexString()||b._minusColor);q(b.SCATTER)?G.value="SCATTER":G.value=b.glyph;var n,l;void 0!==b.MIN&&(f=parseFloat(b.MIN),isNaN(f)||(n=f));a.forceMinDynamic||void 0===b.MIN&&void 0===a.forceMin?(E.checked=!1,U.disabled=!0):
(E.checked=!0,U.disabled=!1);void 0!==b.MAX&&(f=parseFloat(b.MAX),isNaN(f)||(l=f));a.forceMaxDynamic||void 0===b.MAX&&void 0===a.forceMax?(k.checked=!1,y.disabled=!0):(k.checked=!0,y.disabled=!1);void 0!=a.forceMin&&(n=a.forceMin);void 0!=a.forceMax&&(l=a.forceMax);"number"==typeof n&&n!=parseFloat(U.value)&&(U.value=n);"number"==typeof l&&l!=parseFloat(y.value)&&(y.value=l);(b=m(a.stylesheet))?(ka.style.display="table-row",aa.checked="mismatch"===b.__SEQCOLOR,pa.style.display="table-row",oa.checked=
q(b.__INSERTIONS),ga.style.display="table-row",fa.checked=void 0===b.__disableQuals||!1===b.__disableQuals,console.log(b.__disableQuals)):(ka.style.display="none",pa.style.display="none",ga.style.display="none");b&&aa.checked&&!d?(R.style.display="table-row",ma.style.display="table-row"):(R.style.display="none",ma.style.display="none")}c&&a.browser.sourceAdapterIsCapable(a.featureSource,"quantLeap")?sa.style.display="table-row":sa.style.display="none"},aa=g("input",null,{type:"checkbox"}),ka=g("tr",
[g("th","Highlight mismatches & strands"),g("td",aa)]);aa.addEventListener("change",function(e){e=r(a.stylesheet);m(e).__SEQCOLOR=aa.checked?"mismatch":"base";a.mergeStylesheet(e)});var oa=g("input",null,{type:"checkbox"}),pa=g("tr",[g("th","Show insertions"),g("td",oa)]);oa.addEventListener("change",function(e){e=r(a.stylesheet);m(e).__INSERTIONS=oa.checked?"yes":"no";a.mergeStylesheet(e)});var fa=g("input",null,{type:"checkbox"}),ga=g("tr",[g("th","Reflect base quality as base color transparency"),
g("td",fa)]);fa.addEventListener("change",function(e){e=r(a.stylesheet);var b=m(e);b.__disableQuals=!fa.checked;console.log(b.__disableQuals);a.mergeStylesheet(e)});var la=g("tr",[g("th","Style"),g("td",G)]),$=g("tr",[g("th",["Colour(s)",h,p]),t]),R=g("tr",[g("th","Plus Strand Color"),g("td",K)]),ma=g("tr",[g("th","Minus Strand Color"),g("td",e)]),qa=g("tr",[g("th","Min value"),g("td",[E," ",U])]),da=g("tr",[g("th","Max value"),g("td",[k," ",y])]),sa=g("tr",[g("th","Threshold leap:"),g("td",[I," ",
J])]),ta=g("tr",[g("th","Bump overlaps"),g("td",[L," limit: ",Y])]),V=g("tr",[g("th","Label features"),g("td",ea)]),h=g("table",[g("tr",[g("th","Name",{},{width:"150px",textAlign:"right"}),D]),g("tr",[g("th","Pin to top"),w]),g("tr",[g("th","Height"),g("td",Q)]),la,$,R,ma,qa,da,sa,ta,V,ka,pa,ga]);X();l.appendChild(h);h=g("button","Reset track",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});h.addEventListener("click",function(e){a.setConfig({})},!1);l.appendChild(h);D.addEventListener("input",
function(e){a.mergeConfig({name:D.value})},!1);w.addEventListener("change",function(e){a.mergeConfig({pinned:w.checked})},!1);for(h=0;h<A.length;++h)A[h].addEventListener("change",n,!1);K.addEventListener("change",n,!1);e.addEventListener("change",n,!1);G.addEventListener("change",function(e){e=d(function(a){"SCATTER"===G.value?(a.SCATTER=!0,a.glyph="DOT",a.SIZE="3"):(a.glyph=G.value,a.SCATTER=void 0);c(a)});a.mergeStylesheet(e)},!1);E.addEventListener("change",function(e){e={forceMinDynamic:!E.checked};
U.disabled=!E.checked;var b=parseFloat(U.value);E.checked&&"number"==typeof b&&!isNaN(b)&&(e.forceMin=parseFloat(b));a.mergeConfig(e)});U.addEventListener("input",function(e){e=parseFloat(U.value);"number"!=typeof e||isNaN(e)||a.mergeConfig({forceMin:e})},!1);k.addEventListener("change",function(e){e={forceMaxDynamic:!k.checked};y.disabled=!k.checked;var b=parseFloat(y.value);k.checked&&"number"==typeof b&&!isNaN(b)&&(e.forceMax=parseFloat(b));a.mergeConfig(e)});y.addEventListener("input",function(e){e=
parseFloat(y.value);"number"!=typeof e||isNaN(e)||a.mergeConfig({forceMax:e})},!1);Q.addEventListener("input",function(e){e=parseFloat(Q.value);"number"!=typeof e||isNaN(e)||a.mergeConfig({height:Math.min(500,e|0)})},!1);var ba=function(){J.disabled=!I.checked;if(I.checked){var e=parseFloat(J.value);"number"!=typeof e||isNaN(e)||a.mergeConfig({quantLeapThreshold:parseFloat(J.value)})}else a.mergeConfig({quantLeapThreshold:null})};I.addEventListener("change",function(a){ba()},!1);J.addEventListener("input",
function(a){ba()},!1);ea.addEventListener("change",function(e){e=d(function(a){a.LABEL=ea.checked?"yes":"no"});a.mergeStylesheet(e)},!1);L.addEventListener("change",function(e){e=d(function(a){a.BUMP=L.checked?"yes":"no"});a.mergeStylesheet(e)},!1);Y.addEventListener("input",function(e){e=parseInt(Y.value);"number"==typeof e&&0<e&&a.mergeConfig({subtierMax:e})},!1);this.showToolPanel(l);this.setUiMode("tier");a.addTierListener(X);var O=a.browser.scale;a.browser.addViewListener(function(){a.browser.scale!=
O&&(O=a.browser.scale,X())})}}},{"./cbrowser":6,"./color":9,"./das":10,"./sourcecompare":35,"./utils":49}],45:[function(d,v,t){function m(a,b,c,d){this.config=c||{};this.id="tier"+ ++p;this.browser=a;this.dasSource=q(b);this.background=d;this.viewport=l("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport_12_5"},{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=l("div",this.viewport,{className:"viewport-holder_12_5"},{background:d,
position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=l("canvas",null,{width:+(this.browser.featurePanelWidth|0),height:"30",className:"viewport-overlay"});this.notifier=l("div","",{className:"notifier"});this.notifierHolder=l("div",this.notifier,{className:"notifier-holder"});this.quantOverlay=l("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=l("i",null,{className:"fa fa-times"});this.bumpButton=l("i",null,
{className:"fa fa-plus-circle"});this.loaderButton=a.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=l("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=l("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);b.pennant?this.nameButton.appendChild(l("img",null,{src:b.pennant,width:"16",height:"16"})):b.mapping&&(c=null,this.browser.chains[b.mapping]&&(c=this.browser.chains[b.mapping].coords.version),c&&this.nameButton.appendChild(l("span",
""+c,null,{fontSize:"8pt",background:"black",color:"white",paddingLeft:"3px",paddingRight:"3px",paddingTop:"1px",paddingBottom:"1px",marginLeft:"2px",borderRadius:"10px"})));this.nameElement=l("span",b.name);this.nameButton.appendChild(l("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=l("span",[this.nameButton],{className:"btn-group track-label"});this.row=l("div",[this.viewportHolder,
this.overlay,this.quantOverlay],{className:"tier"+(b.className?" "+b.className:"")});d||(this.row.style.background="none");a.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);this.initSources();
var f=this;this.featureSource&&this.featureSource.getDefaultFIPs&&!b.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&f.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&(this.readinessListener=function(a){f.notify(a,-1)},this.featureSource.addReadinessListener(this.readinessListener));this.featureSource&&this.featureSource.addActivityListener&&(this.activityListener=function(a){f.loaderButton.style.display=0<a?"inline-block":"none";f.browser.pingActivity()},
this.featureSource.addActivityListener(this.activityListener));this.listeners=[];this.featuresLoadedListeners=[]}if("undefined"!==typeof d){t=d("./utils");var l=t.makeElement,g=t.removeChildren,q=t.shallowCopy,r=t.miniJSONify,x=t.arrayIndexOf;t=d("./das");var C=t.DASStylesheet,b=t.DASStyle,a=d("./sha1").b64_sha1;t=d("./style");var c=t.StyleFilter,f=t.StyleFilterSet,n=d("./sourcecompare").sourceDataURI,s=d("es6-promise").Promise,h=d("./features").sortFeatures}var p=0;m.prototype.destroy=function(){this.featureSource.removeReadinessListener&&
this.featureSource.removeReadinessListener(this.readinessListener);this.featureSource.removeActivityListener&&this.featureSource.removeActivityListener(this.activityListener)};m.prototype.setBackground=function(a){this.background=a;this.viewportHolder.style.background=a};m.prototype.toString=function(){return this.id};m.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};m.prototype.init=function(){var a=this;return new s(function(c,
d){a.dasSource.style?(a.setStylesheet({styles:a.dasSource.style}),c(a)):(a.status="Fetching stylesheet",a.fetchStylesheet(function(d,f){if(f||!d){a.error="No stylesheet";d=new C;var h=new b;h.glyph="BOX";h.BGCOLOR="blue";h.FGCOLOR="black";d.pushStyle({type:"default"},null,h);a.setStylesheet(d)}else a.setStylesheet(d),d.geneHint&&(a.dasSource.collapseSuperGroups=!0,a.bumped=!1,a.updateLabel()),a._updateFromConfig();c(a)}))})};m.prototype.setStylesheet=function(b){this.baseStylesheet=q(b);for(b=0;b<
this.baseStylesheet.styles.length;++b){var c=this.baseStylesheet.styles[b]=q(this.baseStylesheet.styles[b]);c._methodRE=c._labelRE=c._typeRE=null;c.style=q(c.style);c.style.id="style"+ ++this.styleIdSeed}this.baseStylesheetValidity=a(r(this.baseStylesheet));this._updateFromConfig()};m.prototype.getSource=function(){return this.featureSource};m.prototype.getDesiredTypes=function(a){if(a=this.getActiveStyleFilters(a))return a.typeList()};m.prototype.getActiveStyleFilters=function(a){a=this.browser.zoomForCurrentScale();
if(this.stylesheet){for(var b=new f,d=this.stylesheet.styles,h=0;h<d.length;++h){var g=d[h];g.zoom&&g.zoom!=a||b.add(new c(g.type,g.method,g.label))}return b}};m.prototype.needsSequence=function(a){return this.sequenceSource&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.bwgURI||this.dasSource.bwgBlob)&&20>a?!0:!1};m.prototype.setFeatures=function(a,b,c,d,f){this.currentFeatures=d;this.currentSequence=f;this.knownChr=a;this.knownCoverage=b;d&&(h(this),this.notifyFeaturesLoaded())};
m.prototype.draw=function(){var a=this.currentSequence;this.sequenceSource?S(this,a):F(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};m.prototype.findNextFeature=function(a,b,c,d,f){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*c/2|0,this.featureSource.quantFindNextFeature(a,b,c,this.quantLeapThreshold,f);else{if(this.knownCoverage&&b>=this.knownCoverage.min()&&b<=this.knownCoverage.max()&&this.currentFeatures){for(var h=null,g=0;g<this.currentFeatures.length;++g){var e=
this.currentFeatures[g];if(e.min&&e.max&&!(e.parents&&0<e.parents.length))if(0>c)if(1==d&&e.max>=b&&e.min<b){if(!h||e.min>h.min||e.min==h.min&&e.max<h.max)h=e}else e.max<b&&(!h||e.max>h.max||e.max==h.max&&e.min<h.min||e.min==h.mmin&&h.max>=b)&&(h=e);else if(1==d&&e.min<=b&&e.max>b){if(!h||e.max<h.max||e.max==h.max&&e.min>h.min)h=e}else e.min>b&&(!h||e.min<h.min||e.min==h.min&&e.max>h.max||e.max==h.max&&h.min<=b)&&(h=e)}if(h)return f(h);b=0>c?this.browser.knownSpace.min:this.browser.knownSpace.max}this.trySourceFNF(a,
b,c,f)}};m.prototype.trySourceFNF=function(a,b,c,d){var f=this;this.featureSource.findNextFeature(a,b,c,function(a){a||d(a);var b=f.browser.getSequenceSource();b||d(a);b.getSeqInfo(a.segment,function(e){e?d(a):f.trySourceFNF(a.segment,0<c?1E10:0,c,d)})})};m.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};m.prototype.updateHeight=function(){this.currentHeight=
Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};m.prototype.drawOverlay=function(){var a=this.browser,b=a.retina&&1<window.devicePixelRatio;this.overlay.height=this.viewport.height;this.overlay.width=b?2*a.featurePanelWidth:a.featurePanelWidth;var c=this.overlay.getContext("2d");b&&c.scale(2,2);var d=b=a.viewStart,f=a.viewEnd;if(this.overlayLabelCanvas){var h=(this.glyphCacheOrigin-
this.browser.viewStart)*this.browser.scale;c.save();c.translate(h,0);var g=-h+2;this.dasSource.tierGroup&&(g+=15);this.overlayLabelCanvas.draw(c,g,a.featurePanelWidth-h);c.restore()}for(h=0;h<a.highlights.length;++h)g=a.highlights[h],(g.chr===a.chr||g.chr==="chr"+a.chr)&&g.min<f&&g.max>d&&(c.globalAlpha=a.defaultHighlightAlpha,c.fillStyle=a.defaultHighlightFill,c.fillRect((g.min-b)*a.scale,0,(g.max-g.min)*a.scale,this.overlay.height));this.overlay.style.width=a.featurePanelWidth;this.overlay.style.height=
this.viewport.style.height;this.overlay.style.left="0px"};m.prototype.updateStatus=function(a){var b=this;a?(this.status=a,this._notifierToStatus(),n(this.dasSource),"https:"!==window.location.protocol||0!=n(this.dasSource).indexOf("http:")||this.checkedHTTP||(this.checkedHTTP=!0,this.browser.canFetchPlainHTTP().then(function(a){a||(b.warnHTTP=!0,b._notifierToStatus())}))):this.status&&(this.status=null,this._notifierToStatus())};m.prototype.notify=function(a,b){"number"!==typeof b&&(b=2E3);this.notifierFadeTimeout&&
(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(a){if(this._notifierOn(a),0<b){var c=this;this.notifierFadeTimeout=setTimeout(function(){c._notifierToStatus()},b)}}else this._notifierToStatus()};m.prototype._notifierOn=function(a,b){g(this.notifier);b?this.notifier.appendChild(l("span",[l("a","[HTTP Warning] ",{href:this.browser.httpWarningURL,target:"_blank"}),a])):this.notifier.textContent=a;this.notifier.style.opacity=0.8};m.prototype._notifierOff=function(){this.notifier.style.opacity=
0};m.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status,this.warnHTTP):this._notifierOff()};m.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();this.notifyTierListeners()};m.prototype.mergeStylesheet=function(a){this.mergeConfig({stylesheet:a,stylesheetValidity:this.baseStylesheetValidity})};m.prototype.mergeConfig=function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();this.notifyTierListeners()};m.prototype._updateFromConfig=
function(){var a=!1,b=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var c=this.config.height||this.dasSource.forceHeight;c!=this.forceHeight&&(this.forceHeight=c,a=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);c=void 0!=this.config.forceMin?this.config.forceMin:this.dasSource.forceMin;this.forceMin!=c&&(this.forceMin=c,a=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&
(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);c=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=c&&(this.forceMax=c,a=!0);c=null;void 0!==this.config.quantLeapThreshold?c=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(c=this.dasSource.quantLeapThreshold);c!=this.quantLeapThreshold&&(this.quantLeapThreshold=c,a=!0);c=null;this.config.stylesheetValidity==this.baseStylesheetValidity&&(c=this.config.stylesheet);c=c||this.baseStylesheet;
this.stylesheet!==c&&(this.stylesheet=c,a=!0);c=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;c!==this.pinned&&(this.pinned=c,b=!0);c=typeof("number"===this.config.subtierMax)?this.config.subtierMax:this.dasSource.subtierMax||this.browser.defaultSubtierMax;c!=this.subtierMax&&(this.subtierMax=c,a=!0);c=void 0!==this.config.bumped?this.config.bumped:void 0!==this.dasSource.bumped?this.dasSource.bumped:this.dasSource.collapseSuperGroups?!1:!0;c!==this.bumped&&(this.bumped=c,a=
!0,this.updateLabel());a&&this.scheduleRedraw();b&&this.browser.reorderTiers()};m.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();a.redrawTimeout=null},10))}};m.prototype.clearTierListeners=function(){this.listeners=[]};m.prototype.addTierListener=function(a){this.listeners.push(a)};m.prototype.removeTierListener=function(a){a=x(this.listeners,a);0<=a&&this.listeners.splice(a,1)};m.prototype.notifyTierListeners=
function(a){for(var b=0;b<this.listeners.length;++b)try{this.listeners[b](a)}catch(c){console.log(c)}this.browser.notifyTier()};m.prototype.clearFeaturesLoadedListeners=function(){this.featuresLoadedListeners=[]};m.prototype.addFeaturesLoadedListener=function(a){this.featuresLoadedListeners.push(a)};m.prototype.removeFeaturesLoadedListener=function(a){a=x(this.featuresLoadedListeners,a);0<=a&&this.featuresLoadedListeners.splice(a,1)};m.prototype.notifyFeaturesLoaded=function(){for(var a=0;a<this.featuresLoadedListeners.length;++a)try{this.featuresLoadedListeners[a].call(this)}catch(b){console.log(b)}};
if("undefined"!==typeof v){v.exports={DasTier:m};var F=d("./feature-draw").drawFeatureTier,S=d("./sequence-draw").drawSeqTier}},{"./das":10,"./feature-draw":18,"./features":20,"./sequence-draw":31,"./sha1":33,"./sourcecompare":35,"./style":37,"./utils":49,"es6-promise":53}],46:[function(d,v,t){function m(a,b){for(var c=0;c<a.length;++c){var e=a[c];e===b?e.classList.add("active"):e.classList.remove("active")}}if("undefined"!==typeof d){var l=d("./cbrowser").Browser,g=d("./sourcecompare").sourcesAreEqual;
v=d("./utils");var q=v.makeElement,r=v.removeChildren,x=v.Observed;v=d("./thub");var C=v.THUB_COMPARE,b=v.connectTrackHub,a=d("./domui").makeTreeTableSection,c=d("./probe").probeResource;v=d("./bin");var f=v.URLFetchable,n=v.BlobFetchable,s=v.readInt,h=d("./lh3utils").unbgzf,p=d("./bam").BAI_MAGIC,F=d("./tabix").TABIX_MAGIC;v=d("./das");var S=v.DASSource,D=v.DASSegment,w=v.DASRegistry,G=v.coordsMatch,B=d("./encode").EncodeFetchable}l.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(g(this.tiers[b].dasSource,
a))return this.tiers[b];return!1};l.prototype.makeButton=function(a,b){var c=q("a",a,{href:"#"});b&&this.makeTooltip(c,b);return q("li",c)};l.prototype.showTrackAdder=function(d){function g(e){ca.style.display="none";ha.style.display="none";ia.style.display="none";V=!1;r(O);for(var b=q("div",null,{},{width:"100%"}),c=[],d=0;d<e.length;++d)c.push(e[d]);c.sort(function(a,e){return a.shortLabel.toLowerCase().trim().localeCompare(e.shortLabel.toLowerCase().trim())});e=[];for(var f=[],d=0;d<c.length;++d){var h=
c[d];h.children&&0<h.children.length&&"multiWig"!=h.container?e.push(h):f.push(h)}0<f.length&&e.push({shortLabel:"Others",priority:-1E8,children:f});e.sort(C);for(var n=[],c=0;c<e.length;++c){h=f=e[c];!h.dimensions&&h._parent&&h._parent.dimensions&&(h=h._parent);d={};if(h.dimensions)for(var l=h.dimensions.split(/(\w+)=(\w+)/),m=0;m<l.length-2;m+=3)d[l[m+1]]=l[m+2];if(d.dimX&&d.dimY){for(var p=d.dimX,z=d.dimY,d=h.subgroups[p],l=h.subgroups[z],m={},A=0;A<f.children.length;++A){var s=f.children[A],h=
s.sgm[p],u=s.sgm[z];m[h]||(m[h]={});m[h][u]=s}z=q("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});h=q("tr");h.appendChild(q("th",null,{},{width:"150px",height:"100px"}));for(u=0;u<d.titles.length;++u)p=q("th",q("div",d.titles[u],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),h.appendChild(p);
z.appendChild(h);for(var y=q("tbody",null,{className:"table table-striped table-condensed"}),w=0;w<l.titles.length;++w){var u=l.tags[w],t=q("tr");t.appendChild(q("th",l.titles[w]),{});for(var E=0;E<d.titles.length;++E){var h=d.tags[E],B=q("td");if(m[h]&&m[h][u]){h=m[h][u];A=h.toDallianceSource();if(!A)continue;p=q("tr");s=q("td");s.style.textAlign="center";var x=q("input");x.type="checkbox";x.dalliance_source=A;ra&&(x.dalliance_mapping=ra);n.push(x);B.appendChild(x);x.addEventListener("change",function(a){a.target.checked?
k.addTier(a.target.dalliance_source):k.removeTier(a.target.dalliance_source)})}t.appendChild(B)}y.appendChild(t)}z.appendChild(y);b.appendChild(a(f.shortLabel,z,0==c))}else{l=q("tbody",null,{className:"table table-striped table-condensed"});m=q("table",l,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});u=0;f.children.sort(C);for(d=0;d<f.children.length;++d)if(h=f.children[d],A=h.toDallianceSource())p=q("tr"),s=q("td",null,{},{width:"30px"}),s.style.textAlign="center",
x=q("input"),x.type="checkbox",x.dalliance_source=A,ra&&(x.dalliance_mapping=ra),n.push(x),s.appendChild(x),x.addEventListener("change",function(a){a.target.checked?k.addTier(a.target.dalliance_source):k.removeTier(a.target.dalliance_source)}),p.appendChild(s),z=q("td"),z.appendChild(document.createTextNode(h.shortLabel)),h.longLabel&&0<h.longLabel.length&&k.makeTooltip(z,h.longLabel),p.appendChild(z),l.appendChild(p),++u;1<e.length||"Others"!==f.shortLabel?b.appendChild(a(f.shortLabel,m,0==c)):b.appendChild(m)}}var v=
function(){for(var a=0;a<n.length;++a){var e=n[a],b=k.currentlyActive(e.dalliance_source);b?(e.checked=!0,e.disabled=null!=b.sequenceSource):e.checked=!1}};v();k.addTierListener(function(a){v()});O.appendChild(b)}function l(){m(I,fa);V="bin";ca.style.display="none";ha.style.display="inline";ia.style.display="none";r(O);var a=q("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(q("h3","Add custom URL-based data"));a.appendChild(q("p",["You can add indexed binary data hosted on an web server that supports CORS (",
q("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(q("br"));a.appendChild(document.createTextNode("URL: "));$=q("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});a.appendChild($);a.appendChild(q("br"));a.appendChild(q("b","- or -"));a.appendChild(q("br"));a.appendChild(document.createTextNode("File: "));da=q("input",null,{type:"file",multiple:"multiple"});
a.appendChild(da);a.appendChild(q("p",'Clicking the "Add" button below will initiate a series of test queries.'));O.appendChild(a);$.focus()}function e(){m(I,ga);ca.style.display="none";ha.style.display="inline";ia.style.display="none";V="hub-connect";ca.style.visibility="hidden";r(O);var a=q("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(q("h3","Connect to a track hub."));a.appendChild(q("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));
$=q("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild($);O.appendChild(a);$.focus()}function z(){m(I,pa);ca.style.display="none";ha.style.display="inline";ia.style.display="none";V="das";r(O);var a=q("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(q("h3","Add custom DAS data"));a.appendChild(q("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));
a.appendChild(document.createTextNode("URL: "));a.appendChild(q("br"));$=q("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild($);a.appendChild(q("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));O.appendChild(a);$.focus()}function A(){if(V)if("das"===V){var a=$.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);a=new S({name:"temporary",
uri:a});wa(a)}else if("bin"===V){var b=da.files;if(b&&0<b.length){a=Z=[];V="multiple";for(var c=0;c<b.length;++c){var d=b[c];d&&a.push({blob:d})}for(c=0;c<a.length;++c)ja(a[c]);ua()}else a=$.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),b={uri:a},a=a.toLowerCase(),0==a.indexOf("https://www.encodeproject.org/")&&0<=a.indexOf("@@download")&&(b.transport="encode"),P(b)}else if("reset"===V)z();else if("reset-bin"===V)l();else if("reset-hub"===V)e();else if("prompt-bai"===V)(b=da.files)&&0<b.length&&
b[0]?(ba.baiBlob=b[0],U(ba)):(b=ba,ca.style.display="none",ha.style.display="inline",ia.style.display="inline",r(O),V="prompt-bai",O.appendChild(q("h2","Select an index file")),O.appendChild(q("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),O.appendChild(document.createTextNode("Index file: ")),
da=q("input",null,{type:"file"}),O.appendChild(da),ba=b);else if("prompt-tbi"===V)(b=da.files)&&0<b.length&&b[0]?(ba.indexBlob=b[0],y(ba)):(b=ba,ca.style.display="none",ha.style.display="inline",ia.style.display="inline",r(O),V="prompt-tbi",O.appendChild(q("h2","Select an index file")),O.appendChild(q("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
O.appendChild(document.createTextNode("Index file: ")),da=q("input",null,{type:"file"}),O.appendChild(da),ba=b);else if("finalize"===V||"finalize-bin"===V)ba.name=R.value,b=ma.value,ba.mapping="__default__"!=b?b:void 0,qa&&(ba.maxbins=qa.checked),1<sa.value.length&&1<ta.value.length&&(ba.xUser=sa.value,ba.xPass=ta.value),k.addTier(ba),"finalize-bin"==V?l():z();else if("hub-connect"===V)a=$.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),t(a);else{if("multiple"===V){for(b=0;b<Z.length;++b)if(a=Z[b],
!a.hidden&&("bam"!=a.tier_type||a.indexBlob||a.indexUri)&&("tabix"!=a.tier_type||a.indexBlob||a.indexUri)&&(a=W(a)))a.noPersist=!0,k.addTier(a);l()}}else k.removeAllPopups()}function t(a,e,c){e=e||{};for(var d=0;d<k.hubObjects.length;++d){var f=k.hubObjects[d];if(f.hub.url==a){for(d=0;d<I.length;++d)I[d].hub==f&&m(I,I[d]);f.getTracks(function(a,b){b&&console.log(b);g(a)});return}}b(a,function(b,d){if(d){if(!c)return t(a,{credentials:!0},!0);r(O);O.appendChild(q("h2","Error connecting to track hub"));
O.appendChild(q("p",d));V="reset-hub"}else{var f=null,h=null,n;for(n in b.genomes){var l=null,z=!1;if(n==k.coordSystem.ucscName)z=!0;else for(var p in k.chains)n==k.chains[p].coords.ucscName&&(l=p,z=!0);z&&(z={url:a,genome:n},e.credentials&&(z.credentials=!0),l&&(z.mapping=l,b.genomes[n].mapping=l),k.hubs.push(z),k.hubObjects.push(b.genomes[n]),z=aa(b.genomes[n]),la.appendChild(z),l&&f||(f=b.genomes[n],h=z))}f?(k.notifyTier(),m(I,h),f.getTracks(function(a,b){g(a)})):(r(O),O.appendChild(q("h2","No data for this genome")),
O.appendChild(q("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),O.appendChild(q("p","coordSystem.ucscName = "+k.coordSystem.ucscName)),V="reset-hub")}},e)}function v(a,b){var e=a.uri;if(b){var c=/(.+)\/[^\/]+\/?/.exec(e);c&&(e=c[1]+"/sources")}(new w(e,{credentials:a.credentials})).sources(function(e){if(!e||0==e.length)return b?na(a):v(a,!0);var c=null;if(1==e.length)c=e[0];else for(var d=0;d<e.length;++d)if(e[d].uri===a.uri){c=
e[d];break}d=e=!1;if(c&&(a.name=c.name,a.desc=c.desc,a.maxbins=c.maxbins?!0:!1,c.capabilities&&(a.capabilities=c.capabilities),d=!0,c.coords&&1==c.coords.length))if(c=c.coords[0],G(c,k.coordSystem))e=!0;else if(k.chains)for(var f in k.chains)G(c,k.chains[f].coords)&&(a.mapping=f,e=!0);return na(a,e,d)},function(){return b?na(a):v(a,!0)})}function U(a){(a.baiBlob?new n(a.baiBlob):"encode"==a.transport?new B(a.bamURI+".bai"):new f(a.bamURI+".bai",{credentials:a.credentials})).slice(0,256).fetch(function(e){var b=
!1;e&&(e=new Uint8Array(e),b=s(e,0)==p);return b?na(a,!1,!1,!0):E("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function y(a){(a.indexBlob?new n(a.indexBlob):new f(a.uri+".tbi")).slice(0,65536).fetch(function(e){var b=!1;if(e){var c=new Uint8Array(e);if(31==c[0]||139==c[1])e=h(e),c=new Uint8Array(e),b=s(c,0)==F}return b?na(a,!1,!1,!0):E('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
function E(a){ca.style.display="none";ha.style.display="inline";ia.style.display="inline";r(O);a=a||"Custom data format not recognized";O.appendChild(q("h2","Error adding custom data"));O.appendChild(q("p",a));O.appendChild(q("p","Currently supported formats are bigBed, bigWig, and BAM."));V="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var k=this;d=q("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top",paddingRight:"15px"});var I=[],J,Q;if(!this.noRegistryTabs){var L=this.makeButton("Registry","Browse compatible datasources from the DAS registry");I.push(L);for(var Y in this.mappableSources)(function(a){var e=k.makeButton(k.chains[a].srcTag,"Browse datasources mapped from "+k.chains[a].srcTag);I.push(e);e.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();m(I,e);J(k.mappableSources[a],a)},!1)})(Y)}Y={};for(var ea=0;ea<this.defaultSources.length;++ea){var T=
this.defaultSources[ea],X=T.group||"Defaults";Y[X]?Y[X].push(T):Y[X]=[T]}var aa=function(a){var b=a.hub,c=q("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),d=b.altLabel||b.shortLabel||"Unknown";a.mapping&&(d=d+" ("+a.genome+")");var d=q("span",[d," ",c]),f=k.makeButton(d,b.longLabel);f.hub=a;I.push(f);f.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();m(I,f);r(O);e=k.makeLoader(24);e.style.marginLeft="auto";e.style.marginRight="auto";e.style.marginTop="100px";
O.appendChild(q("div",e,null,{textAlign:"center"}));ca.style.display="none";ha.style.display="none";ia.style.display="none";a.getTracks(function(a,e){e&&console.log(e);g(a)})},!1);c.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();var c=q("li",q("a","Remove hub")),d=q("li",q("a","Enable all")),h=q("li",q("a","Disable all")),g=q("ul",[c,d,h],{className:"dropdown-menu"},{display:"block"}),n=b.clientX;b=b.clientY;n+=document.documentElement.scrollLeft||document.body.scrollLeft;
b+=document.documentElement.scrollTop||document.body.scrollTop;g.style.position="absolute";g.style.top=""+(b+10)+"px";g.style.left=""+(n-30)+"px";k.hPopupHolder.appendChild(g);var l=function(a){console.log("cc");document.body.removeEventListener("click",l,!0);k.hPopupHolder.removeChild(g)};document.body.addEventListener("click",l,!0);c.addEventListener("click",function(b){for(b=0;b<k.hubObjects.length;++b)if(k.hubObjects[b].absURL==a.absURL){k.hubObjects.splice(b,1);break}for(b=0;b<k.hubs.length;++b){var c=
k.hubs[b];"string"===typeof c&&(c={url:c});if(c.url==a.hub.url&&!c.genome||c.genome==a.genome){k.hubs.splice(b,1);break}}k.notifyTier();la.removeChild(f);m(I,ga);e()},!1);d.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var e=0;e<a.length;++e){var c=a[e].toDallianceSource();k.currentlyActive(c)||k.addTier(c)}})},!1);h.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var e=0;e<a.length;++e){var c=a[e].toDallianceSource();k.currentlyActive(c)&&
k.removeTier(c)}})},!1)},!1);return f},ka=null,oa=null;for(X in Y)(function(a,b){var e=k.makeButton(a,"Browse the default set of data for this browser");e.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();m(I,e);J(new x(b))},!1);I.push(e);ka||(ka=e,oa=b)})(X,Y[X]);var pa=this.makeButton("DAS","Add arbitrary DAS data");I.push(pa);var fa=this.makeButton("Binary","Add data in bigwig or bigbed format");I.push(fa);for(X=0;X<this.hubObjects.length;++X)aa(this.hubObjects[X]);var ga=
this.makeButton("+","Connect to a new track-hub");I.push(ga);var la=q("ul",I,{className:"nav nav-tabs"},{marginBottom:"0px"});d.appendChild(la);var $,R,ma,qa,da,sa,ta,V=!1,ba=null,X=q("form",null,{},{display:"inline-block",width:"100%"});X.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();A();return!1},!0);var O=q("div");O.style.position="relative";O.style.overflow="scroll";X.appendChild(O);var ra,va;J=function(a,b){ca.style.display="none";ha.style.display="none";ia.style.display=
"none";va&&va.removeListener(Q);ra=b;va=a;va.addListenerAndFire(Q)};Q=function(a){V=!1;var b=[];r(O);if(a){for(var e=q("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),c=q("table",e,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),d=0,f=[],h=0;h<a.length;++h)f.push(a[h]);f.sort(function(a,b){return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim())});for(h=0;h<f.length;++h){a=f[h];var g=q("tr"),n=q("td",null,{},
{width:"30px"});n.style.textAlign="center";if(!a.props||a.props.cors){var l=q("input");l.type="checkbox";l.dalliance_source=a;ra&&(l.dalliance_mapping=ra);n.appendChild(l);b.push(l);l.addEventListener("change",function(a){a.target.checked?k.addTier(a.target.dalliance_source):k.removeTier(a.target.dalliance_source)})}else n.appendChild(document.createTextNode("!")),k.makeTooltip(n,q("span",["This data source isn't accessible because it doesn't support ",q("a","CORS",{href:"http://www.w3.org/TR/cors/"}),
"."]));g.appendChild(n);n=q("td");n.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&k.makeTooltip(n,a.desc);g.appendChild(n);e.appendChild(g);++d}var m=function(){for(var a=0;a<b.length;++a){var e=b[a];k.currentlyActive(e.dalliance_source)?e.checked=!0:e.checked=!1}};m();k.addTierListener(function(a){m()});O.appendChild(c)}else O.appendChild(q("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};L&&L.addEventListener("click",
function(a){a.preventDefault();a.stopPropagation();m(I,L);J(k.availableSources)},!1);fa.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();l()},!1);ga.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();e()},!1);pa.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();z()},!1);var ha=q("button","Add",{className:"btn btn-primary"});ha.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();A()},!1);var wa=function(a,
b){var e=k.knownSpace;if(e){var c=Math.max(e.min,(e.min+e.max-100)/2)|0,e=new D(e.chr,c,Math.min(c+99,e.max));a.features(e,{},function(e,c){if(c)b?(r(O),O.appendChild(q("h2","Custom data not found")),O.appendChild(q("p","DAS uri: "+a.uri+" is not answering features requests")),V="reset"):(a.credentials=!0,wa(a,!0));else{var d=/\/([^/]+)\/?$/.exec(a.uri);d&&(a.name=d[1]);v(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},W=function(a){var e={name:a.name};a.credentials&&(e.credentials=
a.credentials);a.mapping&&"__default__"!=a.mapping&&(e.mapping=a.mapping);a.transport&&(e.transport=a.transport);if("bwg"==a.tier_type)return a.blob?e.bwgBlob=a.blob:a.uri&&(e.bwgURI=a.uri),e;if("bam"==a.tier_type)return a.blob?(e.bamBlob=a.blob,e.baiBlob=a.indexBlob):(e.bamURI=a.uri,e.baiURI=a.indexUri),e;if("tabix"==a.tier_type)return e.tier_type="tabix",e.payload=a.payload,a.blob?(e.blob=a.blob,e.indexBlob=a.indexBlob):(e.uri=a.uri,e.indexUri=a.indexUri),e;if("memstore"==a.tier_type)return e.tier_type=
"memstore",e.payload=a.payload,a.blob?e.blob=a.blob:e.uri=a.uri,e},P=function(a){c(a,function(a,e){if(e){r(O);var b=q("div");b.appendChild(q("h2","Couldn't access custom data"));b.appendChild(q("p",""+e));O.appendChild(b);console.log(a);"https:"===window.location.protocol&&0==a.uri.indexOf("http:")&&k.canFetchPlainHTTP().then(function(a){a||b.appendChild(q("p",[q("strong","HTTP warning: "),"you may not be able to access HTTP resources from an instance of Biodalliance which you are accessing via HTTPS.",
q("a","[More info]",{href:k.httpWarningURL,target:"_blank"})]))});V="reset-bin"}else{var c=W(a);return"bam"==a.tier_type?U(c):"tabix"==a.tier_type?y(c):na(c,!1,!1,!0)}})},na=function(a,e,b,c){ca.style.display="none";ha.style.display="inline";ia.style.display="inline";r(O);O.appendChild(q("h2","Add custom data: step 2"));O.appendChild(document.createTextNode("Label: "));R=q("input","",{value:a.name});O.appendChild(R);sa=q("input","");ta=q("input","");O.appendChild(q("br"));O.appendChild(q("br"));O.appendChild(q("h4",
"Coordinate system: "));ma=q("select",null);ma.appendChild(q("option",k.nameForCoordSystem(k.coordSystem),{value:"__default__"}));if(k.chains)for(var d in k.chains)ma.appendChild(q("option",k.nameForCoordSystem(k.chains[d].coords),{value:d}));ma.value=a.mapping||"__default__";O.appendChild(ma);e?O.appendChild(q("p","(Based on server response, probably doesn't need changing.)")):(O.appendChild(q("p",[q("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),
O.appendChild(q("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));c||(O.appendChild(document.createTextNode("Quantitative: ")),qa=q("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(qa.checked=a.maxbins),O.appendChild(qa),b?O.appendChild(q("p","(Based on server response, probably doesn't need changing.)")):O.appendChild(q("p",[q("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&
O.appendChild(q("p",[q("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));R.focus();V="bin"===V||"prompt-bai"===V||"prompt-tbi"===V?"finalize-bin":"finalize";ba=a},Z=null,ja=function(a){c(a,function(a,e){e&&(a.error=e);for(var b=[],c={},d={},f=0;f<Z.length;++f){var h=Z[f];"bam"!=h.tier_type||h.indexBlob||(c[h.blob.name]=h);"tabix"!=h.tier_type||h.indexBlob||(d[h.blob.name]=h)}for(f=0;f<Z.length;++f)if(h=Z[f],"bai"===
h.tier_type){var k=/(.+)\.bai$/.exec(h.blob.name);k&&c[k[1]]&&(c[k[1]].indexBlob=h.blob,b.push(f))}else"tabix-index"===h.tier_type&&(k=/(.+)\.tbi$/.exec(h.blob.name))&&d[k[1]]&&(d[k[1]].indexBlob=h.blob,b.push(f));for(c=b.length-1;0<=c;--c)Z.splice(b[c],1);ua()})},ua=function(){r(O);var a=!1,e=q("table",Z.filter(function(a){return!a.hidden}).map(function(e){q("tr").appendChild(q("td",e.name||e.blob.name));var b;b=e.error?q("span","Error",null,{color:"red"}):e.tier_type?e.payload||e.tier_type:k.makeLoader(16);
var c,d="unknown";"bwg"==e.tier_type||"memstore"==e.tier_type?d="okay":"bam"==e.tier_type?d=e.indexBlob?"okay":"needs-index":"tabix"==e.tier_type&&(d=e.indexBlob?"okay":"needs-index");if("okay"==d){c=q("select",null,null,{width:"150px"});c.appendChild(q("option",k.nameForCoordSystem(k.coordSystem),{value:"__default__"}));if(k.chains)for(var f in k.chains)c.appendChild(q("option",k.nameForCoordSystem(k.chains[f].coords),{value:f}));c.value=e.mapping||"__default__";c.addEventListener("change",function(a){e.mapping=
c.value;console.log(e)},!1)}else"needs-index"==d&&(c=q("span","Needs index",{},{color:"red"}),a=!0);return q("tr",[q("td",e.name||e.blob.name),q("td",b),q("td",c)])}),{className:"table table-striped table-condensed"});O.appendChild(e);if(a){O.appendChild(q("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
O.appendChild(document.createTextNode("Index file(s): "));var b=q("input",null,{type:"file",multiple:"multiple"});O.appendChild(b);b.addEventListener("change",function(a){console.log("fileset changed");a=b.files||[];for(var e=0;e<a.length;++e){var c=a[e];c&&(c={blob:c,hidden:!0},Z.push(c),ja(c))}},!1)}},ia=q("button","Cancel",{className:"btn"});ia.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===V?l():z()},!1);var ca=q("button","Refresh",{className:"btn"});
ca.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();k.queryRegistry(ra)},!1);this.makeTooltip(ca,"Click to re-fetch data from the DAS registry");Y=q("div",[ha," ",ia," ",ca]);Y.style.margin="10px";X.appendChild(Y);d.appendChild(X);J(k.availableSources);this.showToolPanel(d);this.setUiMode("add");ka&&(m(I,ka),J(new x(oa)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./encode":12,"./lh3utils":24,"./probe":28,"./sourcecompare":35,"./tabix":41,"./thub":42,
"./utils":49}],47:[function(d,v,t){function m(d,m,r){m.fetchAsText(function(m){if(!m)return r(null,"Couldn't fetch index-index");m=m.split(/(.+)([0-9A-F]{10})\n/);for(var q=[],b=[],a=1;a<m.length;a+=3)q.push(m[a]),b.push(parseInt(m[a+1],16));return r(new l(q,b,d))})}function l(d,l,m){this.keys=d;this.offsets=l;this.ix=m}l.prototype.lookup=function(d,l){for(var m,t=(d+"     ").substring(0,5).toLowerCase(),v=0;v<this.keys.length;++v)if(0>t.localeCompare(this.keys[v])){m=this.ix.slice(this.offsets[v-
1],this.offsets[v]-this.offsets[v-1]);break}m||(m=this.ix.slice(this.offsets[this.offsets.length-1]));m.fetchAsText(function(b){b=b.split("\n");for(var a=0;a<b.length;++a)if(0==b[a].indexOf(d.toLowerCase()+" "))return l(b[a].split(" "));return l(null)})};"undefined"!==typeof v&&(v.exports={connectTrix:m})},{}],48:[function(d,v,t){function m(){}function l(b,d){var n=new m;n.data=b;var l=f,t=0;n.data.slice(0,l).fetch(function(b){if(!b)return d(null,"Couldn't access data");var m=new Uint8Array(b);b=
q(m,0);if(b==a)n.readInt=q;else if(b==c)n.readInt=r;else return d(null,"Not a .2bit file, magic=0x"+b.toString(16));b=n.readInt(m,4);if(0!=b)return d(null,"Unsupported version "+b);n.seqCount=n.readInt(m,8);n.seqDict={};var s=16,B=0,x=0,u=function(){for(;B<n.seqCount;){var a=m[s];if(s+a+6>=m.length)return t+=l,l=Math.max(f,Math.floor(t*n.seqCount/B)),n.data.slice(x+s,l).fetch(function(a){x+=s;s=0;m=new Uint8Array(a);u()});++s;for(var e="",b=1;b<=a;++b)e+=String.fromCharCode(m[s++]);a=n.readInt(m,
s);s+=4;n.seqDict[e]=new g(n,a);++B}return d(n)};u()})}function g(a,b){this.tbf=a;this.offset=b}if("undefined"!==typeof d){t=d("./bin");var q=t.readInt,r=t.readIntBE;d=d("./spans");var x=d.Range,C=d.union,b=d.intersection}var a=440477507,c=1126646042,f=12500;m.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};m.prototype.fetch=function(a,b,c,d){var f=this.getSeq(a);if(f){if(c<=b)return d("");f.fetch(b,c,d)}else return d(null,"Couldn't find "+a)};g.prototype.init=
function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);b._length=b.tbf.readInt(c,0);b.nBlockCnt=b.tbf.readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);for(var d=null,f=0;f<b.nBlockCnt;++f)var g=b.tbf.readInt(c,4*f),n=b.tbf.readInt(c,4*(f+b.nBlockCnt)),g=new x(g,g+n-1),d=d?C(d,g):g;b.nBlocks=d;b.mBlockCnt=b.tbf.readInt(c,8*b.nBlockCnt);
b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var n=["T","C","A","G"];g.prototype.fetch=function(a,c,d){--a;--c;var f=this;this.init(function(g){if(g)return d(null,g);var l=a>>2;g=c+3>>2;if(0>l||g>f.seqLength)return d("Coordinates out of bounds: "+a+":"+c);f.tbf.data.slice(f.seqOffset+l,g-l).salted().fetch(function(g){function m(a){for(;t<=a;){var b=t&3,e=q[(t>>2)-l];u+=n[0==b?e>>6&3:1==b?e>>4&3:2==b?e>>2&3:e&3];++t}}if(null==g)return d("SeqFetch failed");
var q=new Uint8Array(g);g=[];if(f.nBlocks){var r=b(new x(a,c),f.nBlocks);r&&(g=r.ranges())}for(var u="",t=a,r=0;r<g.length;++r){var e=g[r];if(t>e.min())throw"N mismatch...";for(t<e.min()&&m(e.min()-1);t<=e.max();)u+="N",++t}t<=c&&m(c);return d(u)})})};g.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b._length)})};"undefined"!==typeof v&&(v.exports={makeTwoBit:l})},{"./bin":4,"./spans":36}],49:[function(d,v,t){function m(a,b){for(var c=0;c<a.length;++c)if(a[c]==
b)return;a.push(b)}function l(a,b,c){a[b]?a[b].push(c):a[b]=[c]}function g(a,b,c){var d=a[b];if(d){for(a=0;a<d.length;++a)if(d[a]==c)return;d.push(c)}else a[b]=[c]}function q(a,b,c,d){if(a)return a;if(b)return b;if(c)return c;if(d)return d}function m(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function r(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function x(a,b,c,d){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var f=0;f<b.length;++f){var h=
b[f];h&&("string"==typeof h?h=document.createTextNode(h):"number"==typeof h&&(h=document.createTextNode(""+h)),a.appendChild(h))}}if(c)for(var e in c)try{a[e]=c[e]}catch(g){throw console.log("error setting "+e),g;}if(d)for(e in d)a.style[e]=d[e];return a}function C(a,b,c,d){a=document.createElementNS(a,b);if(c)for(c instanceof Array||(c=[c]),b=0;b<c.length;++b){var f=c[b];"string"==typeof f&&(f=document.createTextNode(f));a.appendChild(f)}if(d)for(var h in d){c=a;b=h;var f=d[h],e=S[b];if(!e){for(var e=
"",g=0;g<b.length;++g)var n=b.substring(g,g+1),l=n.toLowerCase(),e=l!=n?e+"-"+l:e+n;S[b]=e}c.setAttribute(e,f)}return a}function b(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}function a(b,c){if("undefined"===typeof b)return"undefined";if(null==b)return"null";if("string"==typeof b)return"'"+b+"'";if("number"==typeof b||"boolean"==typeof b)return""+b;if("object"==typeof b){if(b instanceof Array){for(var d=null,f=0;f<b.length;++f)d=(null==d?"":d+", ")+a(b[f],c);return"["+
(d?d:"")+"]"}c=c||{};d=null;for(f in b)c[f]||void 0!=f&&"function"!=typeof b[f]&&(d=(null==d?"":d+", ")+f+": "+a(b[f],c));return"{"+(d?d:"")+"}"}return typeof b}function c(a){var b={},c;for(c in a)b[c]=a[c];return b}function f(a){this.value=a;this.listeners=[]}function n(){this.queue=[]}function s(a,b,c){c&&c.salt&&(a=a+"?salt="+F(""+Date.now()+","+ ++D));try{var d;c.timeout&&(d=setTimeout(function(){console.log("timing out "+a);f.abort();return b(null,"Timeout")},c.timeout));var f=new XMLHttpRequest;
f.onreadystatechange=function(){4==f.readyState&&(d&&clearTimeout(d),200>f.status||300<=f.status?b(null,"Error code "+f.status):b(f.responseText))};f.open("GET",a,!0);f.responseType="text";c&&c.credentials&&(f.withCredentials=!0);f.send("")}catch(h){b(null,"Exception "+h)}}function h(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;var c=a.lastIndexOf("/");return 0<=c?a.substr(0,c+1)+b:b}function p(a){return x("a",null,{href:a}).href}if("undefined"!==typeof d)var F=d("./sha1").b64_sha1;
var S={};f.prototype.addListener=function(a){this.listeners.push(a)};f.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};f.prototype.removeListener=function(a){var b=this.listeners;a=r(b,a);0<=a&&b.splice(a,1)};f.prototype.get=function(){return this.value};f.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};n.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=
0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};n.prototype.await=function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var D=0;d={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"*",TAG:"*",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",
AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"*",TGG:"W",CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"undefined"!==typeof v&&(v.exports={textXHR:s,relativeURL:h,resolveUrlToPage:p,shallowCopy:c,pusho:l,pushnew:m,pushnewo:g,arrayIndexOf:r,pick:q,makeElement:x,makeElementNS:C,removeChildren:b,miniJSONify:a,Observed:f,
Awaited:n,AMINO_ACID_TRANSLATION:d})},{"./sha1":33}],50:[function(d,v,t){function m(){this.info=[]}function l(a,b){this.parser=a;this.sink=b}if("undefined"!==typeof d){var g=d("./sourceadapters").registerParserFactory;d=d("./das");var q=d.DASStylesheet,r=d.DASStyle,x=d.DASFeature}var C=/([^;=]+)(=([^;]+))?;?/,b=/##INFO=<([^>]+)>/,a=/([^,=]+)=([^,]+|"[^"]+"),?/;m.prototype.createSession=function(a){return new l(this,a)};l.prototype.parse=function(c){if(0!=c.length)if("#"==c[0]){if(1<c.length&&"#"==
c[1]&&(c=b.exec(c))){var d=c[1].split(a),g=null,l=null;for(c=0;c<d.length-1;c+=3){var h=d[c+1],m=d[c+2].replace(/"/g,"");"ID"==h?g=m:"Description"==h&&(l=m)}g&&l&&this.parser.info.push({id:g,desc:l})}}else{d=c.split("\t");g=new x;g.segment=d[0];g.id=d[2];g.refAllele=d[3];g.altAlleles=d[4].split(",");g.min=parseInt(d[1]);g.max=g.min+g.refAllele.length-1;d=d[7].split(C);g.info={};for(c=0;c<d.length;c+=4)g.info[d[c+1]]=d[c+3];c=g.altAlleles[0];d=g.refAllele;c.length>d.length?(g.type="insertion",0==c.indexOf(d)?
(g.insertion=c.substr(d.length),g.min+=d.length,g.max=g.min-1):g.insertion=c):g.type=c.length<d.length?"deletion":"substitution";this.sink(g)}};l.prototype.flush=function(){};m.prototype.getStyleSheet=function(a){var b=new q,d=new r;d.glyph="__INSERTION";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";b.pushStyle({type:"insertion"},null,d);d=new r;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(255, 60, 60)";d.BGCOLOR="#888888";d.STROKECOLOR=
"black";b.pushStyle({type:"deletion"},null,d);d=new r;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";b.pushStyle({type:"default"},null,d);return a(b)};m.prototype.getDefaultFIPs=function(a){var b=this;a(function(a,c){c.add("Ref. allele",a.refAllele);c.add("Alt. alleles",a.altAlleles.join(","));if(a.info)for(var d=0;d<b.info.length;++d){var g=b.info[d],l=a.info[g.id];void 0!==l&&c.add(g.desc,l)}})};g("vcf",function(){return new m})},
{"./das":10,"./sourceadapters":34}],51:[function(d,v,t){d={CONFIG:5,MAJOR:0,MINOR:13,MICRO:6,PATCH:"a",BRANCH:"dev",toString:function(){var d=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(d+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(d=d+"-"+this.BRANCH);return d}};"undefined"!==typeof v&&(v.exports=d)},{}],52:[function(d,v,t){function m(d){function m(a){a=Math.min(a,v);c=a=Math.max(a,t);s.style.left=""+c+"px"}function r(a){a=Math.min(a,v);f=a=Math.max(a,t);h.style.left=""+f+"px"}d=d||
{};var t=0,v=d.width||200,b=0,a=200,c=50,f=100,n=[];d=l("hr",null,{className:"slider-track"},{width:""+(v|0)+"px"});var s=l("hr",null,{className:"slider-thumb active"}),h=l("hr",null,{className:"slider-thumb"}),p=l("div",[d,s,h],{className:"slider"},{width:""+((v|0)+10)+"px"});p.removeLabels=function(){for(var a=0;a<n.length;++a)p.removeChild(n[a]);n=[]};p.addLabel=function(c,d){var f=l("div",d,{className:"slider-label"},{left:""+(t+(c-b)*(v-t)/(a-b)|0)+"px"});p.appendChild(f);n.push(f)};var F=document.createEvent("HTMLEvents");
F.initEvent("change",!0,!1);Object.defineProperty(p,"value",{get:function(){return b+(c-t)*(a-b)/(v-t)},set:function(c){m(t+(c-b)*(v-t)/(a-b))}});Object.defineProperty(p,"value2",{get:function(){return b+(f-t)*(a-b)/(v-t)},set:function(c){r(t+(c-b)*(v-t)/(a-b))}});Object.defineProperty(p,"active",{get:function(){return s.classList.contains("active")?1:2},set:function(a){1==a?(s.classList.add("active"),h.classList.remove("active")):(h.classList.add("active"),s.classList.remove("active"))}});Object.defineProperty(p,
"min",{get:function(){return b},set:function(a){b=a}});Object.defineProperty(p,"max",{get:function(){return a},set:function(b){a=b}});var S,D;d=function(a){D=this==s?1:2;D!=p.active&&(p.active=D,p.dispatchEvent(F));a.stopPropagation();a.preventDefault();window.addEventListener("mousemove",w,!1);window.addEventListener("mouseup",G,!1);S=a.clientX-(1==D?c:f)};s.addEventListener("mousedown",d,!1);h.addEventListener("mousedown",d,!1);var w=function(a){1==D?m(a.clientX-S):r(a.clientX-S);p.dispatchEvent(F)},
G=function(a){window.removeEventListener("mousemove",w,!1);window.removeEventListener("mouseup",G,!1)};return p}if("undefined"!==typeof d)var l=d("./utils").makeElement;"undefined"!==typeof v&&(v.exports=m)},{"./utils":49}],53:[function(d,v,t){v=d("./promise/promise").Promise;d=d("./promise/polyfill").polyfill;t.Promise=v;t.polyfill=d},{"./promise/polyfill":58,"./promise/promise":59}],54:[function(d,v,t){var m=d("./utils").isArray,l=d("./utils").isFunction;t.all=function(d){if(!m(d))throw new TypeError("You must pass an array to all.");
return new this(function(m,r){function t(a){return function(c){v[a]=c;0===--b&&m(v)}}var v=[],b=d.length,a;0===b&&m([]);for(var c=0;c<d.length;c++)(a=d[c])&&l(a.then)?a.then(t(c),r):(v[c]=a,0===--b&&m(v))})}},{"./utils":63}],55:[function(d,v,t){(function(d,l){function g(){return function(){d.nextTick(v)}}function q(){var a=0,c=new b(v),d=document.createTextNode("");c.observe(d,{characterData:!0});return function(){d.data=a=++a%2}}function r(){return function(){a.setTimeout(v,1)}}function v(){for(var a=
0;a<c.length;a++){var b=c[a];(0,b[0])(b[1])}c=[]}var C="undefined"!==typeof window?window:{},b=C.MutationObserver||C.WebKitMutationObserver,a="undefined"!==typeof l?l:void 0===this?window:this,c=[],f;f="undefined"!==typeof d&&"[object process]"==={}.toString.call(d)?g():b?q():r();t.asap=function(a,b){1===c.push([a,b])&&f()}}).call(this,d("/Users/thomas/Projects/dalliance/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!==
typeof self?self:"undefined"!==typeof window?window:{})},{"/Users/thomas/Projects/dalliance/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":64}],56:[function(d,v,t){t.cast=function(d){return d&&"object"===typeof d&&d.constructor===this?d:new this(function(l){l(d)})}},{}],57:[function(d,v,t){var m={instrument:!1};t.config=m;t.configure=function(d,g){if(2===arguments.length)m[d]=g;else return m[d]}},{}],58:[function(d,v,t){(function(m){var l=
d("./promise").Promise,g=d("./utils").isFunction;t.polyfill=function(){var d;d="undefined"!==typeof m?m:"undefined"!==typeof window&&window.document?window:self;"Promise"in d&&"cast"in d.Promise&&"resolve"in d.Promise&&"reject"in d.Promise&&"all"in d.Promise&&"race"in d.Promise&&function(){var l;new d.Promise(function(d){l=d});return g(l)}()||(d.Promise=l)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./promise":59,"./utils":63}],59:[function(d,v,t){function m(a){if(!h(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");
if(!(this instanceof m))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[];l(a,this)}function l(b,c){function e(a){C(c,a)}function d(b){a(c,b)}try{b(e,d)}catch(f){d(f)}}function g(b,c,e,d){var f=h(e),g,l,n,m;if(f)try{g=e(d),n=!0}catch(p){m=!0,l=p}else g=d,n=!0;x(c,g)||(f&&n?C(c,g):m?a(c,l):b===B?C(c,g):b===H&&a(c,g))}function q(a,b,e,c){a=a._subscribers;var d=a.length;a[d]=b;a[d+B]=e;a[d+
H]=c}function r(a,b){for(var e,c,d=a._subscribers,f=a._detail,h=0;h<d.length;h+=3)e=d[h],c=d[h+b],g(b,e,c,f);a._subscribers=null}function x(c,d){var e=null,f;try{if(c===d)throw new TypeError("A promises callback cannot return that same promise.");if(s(d)&&(e=d.then,h(e)))return e.call(d,function(a){if(f)return!0;f=!0;d!==a?C(c,a):b(c,a)},function(b){if(f)return!0;f=!0;a(c,b)}),!0}catch(g){if(f)return!0;a(c,g);return!0}return!1}function C(a,c){a===c?b(a,c):x(a,c)||b(a,c)}function b(a,b){a._state===
w&&(a._state=G,a._detail=b,n.async(c,a))}function a(a,b){a._state===w&&(a._state=G,a._detail=b,n.async(f,a))}function c(a){r(a,a._state=B)}function f(a){r(a,a._state=H)}var n=d("./config").config;d("./config");var s=d("./utils").objectOrFunction,h=d("./utils").isFunction;d("./utils");v=d("./cast").cast;var p=d("./all").all,F=d("./race").race,S=d("./resolve").resolve,D=d("./reject").reject;d=d("./asap").asap;n.async=d;var w=void 0,G=0,B=1,H=2;m.prototype={constructor:m,_state:void 0,_detail:void 0,
_subscribers:void 0,then:function(a,b){var e=this,c=new this.constructor(function(){});if(this._state){var d=arguments;n.async(function(){g(e._state,c,d[e._state-1],e._detail)})}else q(this,c,a,b);return c},"catch":function(a){return this.then(null,a)}};m.all=p;m.cast=v;m.race=F;m.resolve=S;m.reject=D;t.Promise=m},{"./all":54,"./asap":55,"./cast":56,"./config":57,"./race":60,"./reject":61,"./resolve":62,"./utils":63}],60:[function(d,v,t){var m=d("./utils").isArray;t.race=function(d){if(!m(d))throw new TypeError("You must pass an array to race.");
return new this(function(g,m){for(var r,t=0;t<d.length;t++)(r=d[t])&&"function"===typeof r.then?r.then(g,m):g(r)})}},{"./utils":63}],61:[function(d,v,t){t.reject=function(d){return new this(function(l,g){g(d)})}},{}],62:[function(d,v,t){t.resolve=function(d){return new this(function(l,g){l(d)})}},{}],63:[function(d,v,t){function m(d){return"function"===typeof d}d=Date.now||function(){return(new Date).getTime()};t.objectOrFunction=function(d){return m(d)||"object"===typeof d&&null!==d};t.isFunction=
m;t.isArray=function(d){return"[object Array]"===Object.prototype.toString.call(d)};t.now=d},{}],64:[function(d,v,t){function m(){}d=v.exports={};d.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(d){return window.setImmediate(d)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var d=[];window.addEventListener("message",function(g){var m=g.source;m!==window&&null!==m||"process-tick"!==g.data||(g.stopPropagation(),0<d.length&&d.shift()())},
!0);return function(g){d.push(g);window.postMessage("process-tick","*")}}return function(d){setTimeout(d,0)}}();d.title="browser";d.browser=!0;d.env={};d.argv=[];d.on=m;d.once=m;d.off=m;d.emit=m;d.binding=function(d){throw Error("process.binding is not supported");};d.cwd=function(){return"/"};d.chdir=function(d){throw Error("process.chdir is not supported");}},{}],65:[function(d,v,t){function m(){}function l(){this.was=[0]}function g(b,c,d){this.hufts=new Int32Array(3*a);this.window=new Uint8Array(d);
this.end=d;this.checkfn=c;this.mode=p;this.reset(b,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new q;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new r}function q(){}function r(){}function x(a,b,c,d,f){if(0!=f){if(!a)throw"Undef src";if(!c)throw"Undef dest";if(0==b&&f==a.length)c.set(a,d);else if(K)a=a.subarray(b,b+f),c.set(a,d);else if(1==a.BYTES_PER_ELEMENT&&100<f)a=new Uint8Array(a.buffer,
a.byteOffset+b,f),c.set(a,d);else for(var h=0;h<f;++h)c[d+h]=a[b+h]}}function C(a,d,h,g){a=d?h?new Uint8Array(a,d,h):new Uint8Array(a,d,a.byteLength-d):new Uint8Array(a);h=new m;h.inflateInit(b,!0);h.next_in=a;h.next_in_index=0;h.avail_in=a.length;a=[];for(var l=0;;){var p=new Uint8Array(32E3);h.next_out=p;h.next_out_index=0;h.avail_out=p.length;var q=h.inflate(c);if(q!=f&&q!=n&&q!=s)throw h.msg;if(0!=h.avail_out){var r=new Uint8Array(p.length-h.avail_out);x(p,0,r,0,p.length-h.avail_out);p=r}a.push(p);
l+=p.length;if(q==n||q==s)break}g&&(g[0]=(d||0)+h.next_in_index);if(1==a.length)return a[0].buffer;d=new Uint8Array(l);for(h=g=0;h<a.length;++h)l=a[h],x(l,0,d,g,l.length),g+=l.length;return d.buffer}var b=15,a=1440,c=0,f=0,n=1,s=-5,h=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],p=0,F=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,
8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,
0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,
73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,
0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,
227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,
0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,
7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,
0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],S=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,
59,67,83,99,115,131,163,195,227,258,0,0],w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],G=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];m.prototype.inflateInit=function(a,c){a||(a=b);c&&(c=!1);this.istate=new l;return this.istate.inflateInit(this,c?-a:a)};m.prototype.inflate=function(a){return null==this.istate?-2:this.istate.inflate(this,
a)};m.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);this.istate=null;return a};m.prototype.inflateSync=function(){return istate.inflateSync(this)};m.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};l.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,null);return f};l.prototype.inflateEnd=function(a){null!=
this.blocks&&this.blocks.free(a);this.blocks=null;return f};l.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),-2;this.wbits=b;a.istate.blocks=new g(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return f};l.prototype.inflate=function(a,b){var c,d;if(null==a||null==a.istate||null==a.next_in)return-2;b=4==b?s:f;for(c=s;;)switch(a.istate.mode){case 0:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;if(8!=
((a.istate.method=a.next_in[a.next_in_index++])&15)){a.istate.mode=13;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=13;a.msg="invalid window size";a.istate.marker=5;break}a.istate.mode=1;case 1:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;d=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+d)%31){a.istate.mode=13;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(d&32)){a.istate.mode=7;break}a.istate.mode=
2;case 2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=3;case 3:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=4;case 4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=5;case 5:if(0==a.avail_in)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&
255;a.adler=a.istate.need;a.istate.mode=6;return 2;case 6:return a.istate.mode=13,a.msg="need dictionary",a.istate.marker=0,-2;case 7:c=a.istate.blocks.proc(a,c);if(-3==c){a.istate.mode=13;a.istate.marker=0;break}c==f&&(c=b);if(c!=n)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=12;break}a.istate.mode=8;case 8:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=9;case 9:if(0==
a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=10;case 10:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=11;case 11:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=13;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=
12;case 12:return n;case 13:return-3;default:return-2}};l.prototype.inflateSetDictionary=function(a,b,c){var d=0,h=c;if(null==a||null==a.istate||6!=a.istate.mode)return-2;if(a._adler.adler32(1,b,0,c)!=a.adler)return-3;a.adler=a._adler.adler32(0,null,0,0);h>=1<<a.istate.wbits&&(h=(1<<a.istate.wbits)-1,d=c-h);a.istate.blocks.set_dictionary(b,d,h);a.istate.mode=7;return f};var H=[0,0,255,255];l.prototype.inflateSync=function(a){var b,c,d;if(null==a||null==a.istate)return-2;13!=a.istate.mode&&(a.istate.mode=
13,a.istate.marker=0);if(0==(b=a.avail_in))return s;c=a.next_in_index;for(d=a.istate.marker;0!=b&&4>d;)a.next_in[c]==H[d]?d++:d=0!=a.next_in[c]?0:4-d,c++,b--;a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=d;if(4!=d)return-3;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=7;return f};l.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};var u=[16,17,18,0,
8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];g.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&this.codes.free(a);this.mode=p;this.read=this.write=this.bitb=this.bitk=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};g.prototype.proc=function(a,b){var c,d,g,l,m,q,k;l=a.next_in_index;m=a.avail_in;d=this.bitb;g=this.bitk;q=this.write;for(k=q<this.read?this.read-q-1:this.end-q;;)switch(this.mode){case p:for(;3>g;){if(0!=m)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=m,
a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b);m--;d|=(a.next_in[l++]&255)<<g;g+=8}c=d&7;this.last=c&1;switch(c>>>1){case 0:d>>>=3;g-=3;c=g&7;d>>>=c;g-=c;this.mode=1;break;case 1:var s=new Int32Array(1),r=new Int32Array(1),t=[],v=[];c=r;var w=t,B=v;s[0]=9;c[0]=5;w[0]=F;B[0]=S;this.codes.init(s[0],r[0],t[0],0,v[0],0,a);d>>>=3;g-=3;this.mode=6;break;case 2:d>>>=3;g-=3;this.mode=3;break;case 3:return d>>>=3,g-=3,this.mode=13,a.msg="invalid block type",b=-3,this.bitb=
d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b)}break;case 1:for(;32>g;){if(0!=m)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b);m--;d|=(a.next_in[l++]&255)<<g;g+=8}if((~d>>>16&65535)!=(d&65535))return this.mode=13,a.msg="invalid stored block lengths",b=-3,this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=
q,this.inflate_flush(a,b);this.left=d&65535;d=g=0;this.mode=0!=this.left?2:0!=this.last?7:p;break;case 2:if(0==m)return this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,write=q,this.inflate_flush(a,b);if(0==k&&(q==end&&0!=read&&(q=0,k=q<this.read?this.read-q-1:this.end-q),0==k&&(this.write=q,b=this.inflate_flush(a,b),q=this.write,k=q<this.read?this.read-q-1:this.end-q,q==this.end&&0!=this.read&&(q=0,k=q<this.read?this.read-q-1:this.end-q),0==k)))return this.bitb=
d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b);b=f;c=this.left;c>m&&(c=m);c>k&&(c=k);x(a.next_in,l,this.window,q,c);l+=c;m-=c;q+=c;k-=c;if(0!=(this.left-=c))break;this.mode=0!=this.last?7:p;break;case 3:for(;14>g;){if(0!=m)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b);m--;d|=(a.next_in[l++]&255)<<g;g+=8}this.table=c=d&16383;if(29<(c&31)||29<(c>>
5&31))return this.mode=9,a.msg="too many length or distance symbols",b=-3,this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b);c=258+(c&31)+(c>>5&31);if(null==this.blens||this.blens.length<c)this.blens=new Int32Array(c);else for(k=0;k<c;k++)this.blens[k]=0;d>>>=14;g-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>g;){if(0!=m)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,
a.next_in_index=l,this.write=q,this.inflate_flush(a,b);m--;d|=(a.next_in[l++]&255)<<g;g+=8}this.blens[u[this.index++]]=d&7;d>>>=3;g-=3}for(;19>this.index;)this.blens[u[this.index++]]=0;this.bb[0]=7;c=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(c!=f)return b=c,-3==b&&(this.blens=null,this.mode=9),this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,write=q,this.inflate_flush(a,b);this.index=0;this.mode=5;case 5:for(;;){c=this.table;if(!(this.index<
258+(c&31)+(c>>5&31)))break;for(c=this.bb[0];g<c;){if(0!=m)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b);m--;d|=(a.next_in[l++]&255)<<g;g+=8}c=this.hufts[3*(this.tb[0]+(d&h[c]))+1];r=this.hufts[3*(this.tb[0]+(d&h[c]))+2];if(16>r)d>>>=c,g-=c,this.blens[this.index++]=r;else{k=18==r?7:r-14;for(s=18==r?11:3;g<c+k;){if(0!=m)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=
l,this.write=q,this.inflate_flush(a,b);m--;d|=(a.next_in[l++]&255)<<g;g+=8}d>>>=c;g-=c;s+=d&h[k];d>>>=k;g-=k;k=this.index;c=this.table;if(k+s>258+(c&31)+(c>>5&31)||16==r&&1>k)return this.blens=null,this.mode=9,a.msg="invalid bit length repeat",b=-3,this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b);r=16==r?this.blens[k-1]:0;do this.blens[k++]=r;while(0!=--s);this.index=k}}this.tb[0]=-1;s=new Int32Array(1);r=new Int32Array(1);t=
new Int32Array(1);v=new Int32Array(1);s[0]=9;r[0]=6;c=this.table;c=this.inftree.inflate_trees_dynamic(257+(c&31),1+(c>>5&31),this.blens,s,r,t,v,this.hufts,a);if(c!=f)return-3==c&&(this.blens=null,this.mode=13),b=c,this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b);this.codes.init(s[0],r[0],this.hufts,t[0],this.hufts,v[0],a);this.mode=6;case 6:this.bitb=d;this.bitk=g;a.avail_in=m;a.total_in+=l-a.next_in_index;a.next_in_index=l;
this.write=q;if((b=this.codes.proc(this,a,b))!=n)return this.inflate_flush(a,b);b=f;this.codes.free(a);l=a.next_in_index;m=a.avail_in;d=this.bitb;g=this.bitk;q=this.write;k=q<this.read?this.read-q-1:this.end-q;if(0==this.last){this.mode=p;break}this.mode=7;case 7:this.write=q;b=this.inflate_flush(a,b);q=this.write;if(this.read!=this.write)return this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b);mode=12;case 8:return b=n,this.bitb=
d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b);case 9:return b=-3,this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b);default:return b=-2,this.bitb=d,this.bitk=g,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=q,this.inflate_flush(a,b)}};g.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};g.prototype.set_dictionary=
function(a,b,c){x(a,b,window,0,c);this.read=this.write=c};g.prototype.sync_point=function(){return 1==this.mode};g.prototype.inflate_flush=function(a,b){var c,d,g;d=a.next_out_index;g=this.read;c=(g<=this.write?this.write:this.end)-g;c>a.avail_out&&(c=a.avail_out);0!=c&&b==s&&(b=f);a.avail_out-=c;a.total_out+=c;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,g,c));x(this.window,g,a.next_out,d,c);d+=c;g+=c;g==this.end&&(g=0,this.write==this.end&&(this.write=0),c=this.write-
g,c>a.avail_out&&(c=a.avail_out),0!=c&&b==s&&(b=f),a.avail_out-=c,a.total_out+=c,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,g,c)),x(this.window,g,a.next_out,d,c),d+=c,g+=c);a.next_out_index=d;this.read=g;return b};q.prototype.init=function(a,b,c,d,f,g,h){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=d;this.dtree=f;this.dtree_index=g;this.tree=null};q.prototype.proc=function(a,b,c){var d,g,l=0,m=0,q=0,k,p,s,q=b.next_in_index;k=b.avail_in;l=
a.bitb;m=a.bitk;p=a.write;for(s=p<a.read?a.read-p-1:a.end-p;;)switch(this.mode){case 0:if(258<=s&&10<=k&&(a.bitb=l,a.bitk=m,b.avail_in=k,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=p,c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b),q=b.next_in_index,k=b.avail_in,l=a.bitb,m=a.bitk,p=a.write,s=p<a.read?a.read-p-1:a.end-p,c!=f)){this.mode=c==n?7:9;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=
1;case 1:for(d=this.need;m<d;){if(0!=k)c=f;else return a.bitb=l,a.bitk=m,b.avail_in=k,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=p,a.inflate_flush(b,c);k--;l|=(b.next_in[q++]&255)<<m;m+=8}d=3*(this.tree_index+(l&h[d]));l>>>=this.tree[d+1];m-=this.tree[d+1];g=this.tree[d];if(0==g){this.lit=this.tree[d+2];this.mode=6;break}if(0!=(g&16)){this.get=g&15;this.len=this.tree[d+2];this.mode=2;break}if(0==(g&64)){this.need=g;this.tree_index=d/3+this.tree[d+2];break}if(0!=(g&32)){this.mode=7;break}this.mode=
9;b.msg="invalid literal/length code";c=-3;a.bitb=l;a.bitk=m;b.avail_in=k;b.total_in+=q-b.next_in_index;b.next_in_index=q;a.write=p;return a.inflate_flush(b,c);case 2:for(d=this.get;m<d;){if(0!=k)c=f;else return a.bitb=l,a.bitk=m,b.avail_in=k,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=p,a.inflate_flush(b,c);k--;l|=(b.next_in[q++]&255)<<m;m+=8}this.len+=l&h[d];l>>=d;m-=d;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=3;case 3:for(d=this.need;m<d;){if(0!=
k)c=f;else return a.bitb=l,a.bitk=m,b.avail_in=k,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=p,a.inflate_flush(b,c);k--;l|=(b.next_in[q++]&255)<<m;m+=8}d=3*(this.tree_index+(l&h[d]));l>>=this.tree[d+1];m-=this.tree[d+1];g=this.tree[d];if(0!=(g&16)){this.get=g&15;this.dist=this.tree[d+2];this.mode=4;break}if(0==(g&64)){this.need=g;this.tree_index=d/3+this.tree[d+2];break}this.mode=9;b.msg="invalid distance code";c=-3;a.bitb=l;a.bitk=m;b.avail_in=k;b.total_in+=q-b.next_in_index;b.next_in_index=
q;a.write=p;return a.inflate_flush(b,c);case 4:for(d=this.get;m<d;){if(0!=k)c=f;else return a.bitb=l,a.bitk=m,b.avail_in=k,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=p,a.inflate_flush(b,c);k--;l|=(b.next_in[q++]&255)<<m;m+=8}this.dist+=l&h[d];l>>=d;m-=d;this.mode=5;case 5:for(d=p-this.dist;0>d;)d+=a.end;for(;0!=this.len;){if(0==s&&(p==a.end&&0!=a.read&&(p=0,s=p<a.read?a.read-p-1:a.end-p),0==s&&(a.write=p,c=a.inflate_flush(b,c),p=a.write,s=p<a.read?a.read-p-1:a.end-p,p==a.end&&0!=a.read&&
(p=0,s=p<a.read?a.read-p-1:a.end-p),0==s)))return a.bitb=l,a.bitk=m,b.avail_in=k,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=p,a.inflate_flush(b,c);a.window[p++]=a.window[d++];s--;d==a.end&&(d=0);this.len--}this.mode=0;break;case 6:if(0==s&&(p==a.end&&0!=a.read&&(p=0,s=p<a.read?a.read-p-1:a.end-p),0==s&&(a.write=p,c=a.inflate_flush(b,c),p=a.write,s=p<a.read?a.read-p-1:a.end-p,p==a.end&&0!=a.read&&(p=0,s=p<a.read?a.read-p-1:a.end-p),0==s)))return a.bitb=l,a.bitk=m,b.avail_in=k,b.total_in+=
q-b.next_in_index,b.next_in_index=q,a.write=p,a.inflate_flush(b,c);c=f;a.window[p++]=this.lit;s--;this.mode=0;break;case 7:7<m&&(m-=8,k++,q--);a.write=p;c=a.inflate_flush(b,c);p=a.write;if(a.read!=a.write)return a.bitb=l,a.bitk=m,b.avail_in=k,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=p,a.inflate_flush(b,c);this.mode=8;case 8:return c=n,a.bitb=l,a.bitk=m,b.avail_in=k,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=p,a.inflate_flush(b,c);case 9:return c=-3,a.bitb=l,a.bitk=m,b.avail_in=
k,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=p,a.inflate_flush(b,c);default:return c=-2,a.bitb=l,a.bitk=m,b.avail_in=k,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=p,a.inflate_flush(b,c)}};q.prototype.free=function(a){};q.prototype.inflate_fast=function(a,b,c,d,g,l,m,p){var k,q,s,r,t,u,v,w,B,C,D,F;u=p.next_in_index;v=p.avail_in;r=m.bitb;t=m.bitk;w=m.write;B=w<m.read?m.read-w-1:m.end-w;a=h[a];C=h[b];do{for(;20>t;)v--,r|=(p.next_in[u++]&255)<<t,t+=8;k=r&a;q=c;s=d;F=3*(s+k);if(0==
(b=q[F]))r>>=q[F+1],t-=q[F+1],m.window[w++]=q[F+2],B--;else{do{r>>=q[F+1];t-=q[F+1];if(0!=(b&16)){b&=15;D=q[F+2]+(r&h[b]);r>>=b;for(t-=b;15>t;)v--,r|=(p.next_in[u++]&255)<<t,t+=8;k=r&C;q=g;s=l;F=3*(s+k);b=q[F];do if(r>>=q[F+1],t-=q[F+1],0!=(b&16)){for(b&=15;t<b;)v--,r|=(p.next_in[u++]&255)<<t,t+=8;k=q[F+2]+(r&h[b]);r>>=b;t-=b;B-=D;if(w>=k)k=w-k,m.window[w++]=m.window[k++],m.window[w++]=m.window[k++],D-=2;else{k=w-k;do k+=m.end;while(0>k);b=m.end-k;if(D>b){D-=b;if(0<w-k&&b>w-k){do m.window[w++]=m.window[k++];
while(0!=--b)}else x(m.window,k,m.window,w,b),w+=b;k=0}}do m.window[w++]=m.window[k++];while(0!=--D);break}else if(0==(b&64))k+=q[F+2],k+=r&h[b],F=3*(s+k),b=q[F];else return p.msg="invalid distance code",D=p.avail_in-v,D=t>>3<D?t>>3:D,v+=D,u-=D,t-=D<<3,m.bitb=r,m.bitk=t,p.avail_in=v,p.total_in+=u-p.next_in_index,p.next_in_index=u,m.write=w,-3;while(1);break}if(0==(b&64)){if(k+=q[F+2],k+=r&h[b],F=3*(s+k),0==(b=q[F])){r>>=q[F+1];t-=q[F+1];m.window[w++]=q[F+2];B--;break}}else{if(0!=(b&32))return D=p.avail_in-
v,D=t>>3<D?t>>3:D,v+=D,u-=D,t-=D<<3,m.bitb=r,m.bitk=t,p.avail_in=v,p.total_in+=u-p.next_in_index,p.next_in_index=u,m.write=w,n;p.msg="invalid literal/length code";D=p.avail_in-v;D=t>>3<D?t>>3:D;v+=D;u-=D;t-=D<<3;m.bitb=r;m.bitk=t;p.avail_in=v;p.total_in+=u-p.next_in_index;p.next_in_index=u;m.write=w;return-3}}while(1)}}while(258<=B&&10<=v);D=p.avail_in-v;D=t>>3<D?t>>3:D;u-=D;m.bitb=r;m.bitk=t-(D<<3);p.avail_in=v+D;p.total_in+=u-p.next_in_index;p.next_in_index=u;m.write=w;return f};r.prototype.huft_build=
function(b,c,d,g,h,l,m,n,k,p,q){var r,t,u,v,w,B,D,C,F;B=0;t=d;do this.c[b[c+B]]++,B++,t--;while(0!=t);if(this.c[0]==d)return m[0]=-1,n[0]=0,f;w=n[0];for(u=1;15>=u&&0==this.c[u];u++);v=u;w<u&&(w=u);for(t=15;0!=t&&0==this.c[t];t--);p=t;w>t&&(w=t);n[0]=w;for(n=1<<u;u<t;u++,n<<=1)if(0>(n-=this.c[u]))return-3;if(0>(n-=this.c[t]))return-3;this.c[t]+=n;this.x[1]=u=0;B=1;for(D=2;0!=--t;)this.x[D]=u+=this.c[B],D++,B++;B=t=0;do 0!=(u=b[c+B])&&(this.v[this.x[u]++]=t),B++;while(++t<d);d=this.x[p];B=this.x[0]=
t=0;c=-1;C=-w;for(F=D=this.u[0]=0;v<=p;v++)for(b=this.c[v];0!=b--;){for(;v>C+w;){c++;C+=w;F=p-C;F=F>w?w:F;if((r=1<<(u=v-C))>b+1&&(r-=b+1,D=v,u<F))for(;++u<F&&!((r<<=1)<=this.c[++D]);)r-=this.c[D];F=1<<u;if(this.hn[0]+F>a)return-3;this.u[c]=D=this.hn[0];this.hn[0]+=F;0!=c?(this.x[c]=t,this.r[0]=u,this.r[1]=w,u=t>>>C-w,this.r[2]=D-this.u[c-1]-u,x(this.r,0,k,3*(this.u[c-1]+u),3)):m[0]=D}this.r[1]=v-C;B>=d?this.r[0]=192:q[B]<g?(this.r[0]=256>this.v[B]?0:96,this.r[2]=this.v[B++]):(this.r[0]=l[this.v[B]-
g]+16+64,this.r[2]=h[this.v[B++]-g]);r=1<<v-C;for(u=t>>>C;u<F;u+=r)x(this.r,0,k,3*(D+u),3);for(u=1<<v-1;0!=(t&u);u>>>=1)t^=u;t^=u;for(u=(1<<C)-1;(t&u)!=this.x[c];)c--,C-=w,u=(1<<C)-1}return 0!=n&&1!=p?s:f};r.prototype.inflate_trees_bits=function(a,b,c,d,f){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(-3==a)f.msg="oversubscribed dynamic bit lengths tree";else if(a==s||0==b[0])f.msg="incomplete dynamic bit lengths tree",a=-3;return a};r.prototype.inflate_trees_dynamic=
function(a,b,c,d,g,h,l,m,k){this.initWorkArea(288);this.hn[0]=0;h=this.huft_build(c,0,a,257,D,w,h,d,m,this.hn,this.v);if(h!=f||0==d[0])return-3==h?k.msg="oversubscribed literal/length tree":-4!=h&&(k.msg="incomplete literal/length tree",h=-3),h;this.initWorkArea(288);h=this.huft_build(c,a,b,0,G,B,l,g,m,this.hn,this.v);return h!=f||0==g[0]&&257<a?(-3==h?k.msg="oversubscribed distance tree":h==s?(k.msg="incomplete distance tree",h=-3):-4!=h&&(k.msg="empty distance tree with lengths",h=-3),h):f};r.prototype.initWorkArea=
function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;x(this.c,0,this.u,0,15);x(this.c,0,this.x,0,16)};var K="function"===typeof(new Uint8Array(1)).subarray;"undefined"!==typeof v&&(v.exports={inflateBuffer:C,arrayCopy:x})},{}]},{},[17]);
