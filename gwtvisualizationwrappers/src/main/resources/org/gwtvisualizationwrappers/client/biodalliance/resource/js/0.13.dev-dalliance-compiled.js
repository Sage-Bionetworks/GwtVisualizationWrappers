(function e$$0(v,s,n){function m(t,l){if(!s[t]){if(!v[t]){var E="function"==typeof require&&require;if(!l&&E)return E(t,!0);if(g)return g(t,!0);throw Error("Cannot find module '"+t+"'");}E=s[t]={exports:{}};v[t][0].call(E.exports,function(c){var a=v[t][1][c];return m(a?a:c)},E,E.exports,e$$0,v,s,n)}return s[t].exports}for(var g="function"==typeof require&&require,l=0;l<n.length;l++)m(n[l]);return m})({1:[function(d,v,s){function n(){}function m(a,c,b,k,f){a.slice(0,10).fetch(function(r){return r?
g(a,c,b,k,f):k(null,"Couldn't access BAM.")},{timeout:5E3})}function g(c,f,r,H,p){function F(e){if(!e)return H(null,"Couldn't access BAM");e=b(e,e.byteLength);e=new Uint8Array(e);var a=t(e,0);if(a!=q)return H(null,"Not a BAM file, magic=0x"+a.toString(16));for(var c=t(e,4),k="",a=0;a<c;++a)k+=String.fromCharCode(e[a+8]);k=t(e,c+8);c+=12;u.chrToIndex={};u.indexToChr=[];for(a=0;a<k;++a){for(var f=t(e,c),z="",D=0;D<f-1;++D)z+=String.fromCharCode(e[c+4+D]);t(e,c+f+4);u.chrToIndex[z]=a;0==z.indexOf("chr")?
u.chrToIndex[z.substring(3)]=a:u.chrToIndex["chr"+z]=a;u.indexToChr.push(z);c=c+8+f}if(u.indices)return H(u)}var u=new n;u.data=c;u.bai=f;u.indexChunks=r;var L=u.indexChunks?u.indexChunks.minBlockIndex:1E9;if(u.indexChunks){f=u.indexChunks.chunks;u.indices=[];for(var e=0;e<f.length;e++)u.indices[e]=null;u.data.slice(0,L).fetch(F)}else u.bai.fetch(function(e){var b,f,B;if(e){var q=new Uint8Array(e),z=t(q,0);if(z!=k)e=H(null,"Not a BAI file, magic=0x"+z.toString(16));else{z=t(q,4);u.indices=[];for(var D=
8,h=0;h<z;++h){var K=D;b=q;var G=B=K;f=t(b,G);for(var G=G+4,T=0;T<f;++T){t(b,G);var M=t(b,G+4),G=G+(8+16*M)}for(var T=t(b,G),G=G+4,M=1E9,Y=G,d=0;d<T;++d){var E=a(b,Y),Y=Y+8;if(E){b=E.block;0<E.offset&&(b+=65536);b<M&&(M=b);break}}G+=8*T;b=M;B=G-B;D+=B;L=Math.min(b,L);0<f&&(u.indices[h]=new Uint8Array(e,K,D-K))}e=!0}}else e="Couldn't access BAI";!0!==e?u.bai.url&&"undefined"===typeof p?(u.bai.url=u.data.url.replace(/.bam$/,".bai"),g(c,u.bai,r,H,!0)):H(null,e):u.data.slice(0,L).fetch(F)})}function l(){}
if("undefined"!==typeof d){d("./spans");s=d("./bin");var t=s.readInt,C=s.readShort,E=s.readByte,c=s.readFloat;d=d("./lh3utils");var a=d.readVob,b=d.unbgzf,f=d.reg2bins,p=d.Chunk}var q=21840194,k=21578050;d={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};n.prototype.blocksForRange=function(c,b,k){var r=this.indices[c];
if(!r)return[];c=f(b,k);for(var H=[],q=0;q<c.length;++q)H[c[q]]=!0;c=[];for(var u=[],q=t(r,0),L=4,e=0;e<q;++e){var x=t(r,L),A=t(r,L+4),L=L+8;if(H[x])for(var P=0;P<A;++P){var g=a(r,L),d=a(r,L+8);(4681>x?u:c).push(new p(g,d));L+=16}else L+=16*A}q=t(r,L);H=null;b=Math.min(b>>14,q-1);k=Math.min(k>>14,q-1);for(q=b;q<=k;++q)(b=a(r,L+4+8*q))&&(!H||b.block<H.block||b.offset<H.offset)&&(H=b);r=[];if(null!=H)for(q=0;q<u.length;++q)k=u[q],k.maxv.block>=H.block&&k.maxv.offset>=H.offset&&r.push(k);u=r;r=[];for(q=
0;q<u.length;++q)r.push(u[q]);for(q=0;q<c.length;++q)r.push(c[q]);r.sort(function(e,a){var h=e.minv.block-a.minv.block;return 0!=h?h:e.minv.offset-a.minv.offset});c=[];if(0<r.length){u=r[0];for(q=1;q<r.length;++q)k=r[q],k.minv.block==u.maxv.block?u=new p(u.minv,k.maxv):(c.push(u),u=k);c.push(u)}return c};n.prototype.fetch=function(a,c,k,f,r){function H(){if(q>=e.length)return f(A);if(p){var a=new Uint8Array(p),a=u.readBamRecords(a,e[q].minv.offset,A,c,k,L,r);p=null;++q;return a?f(A):H()}var z=e[q],
a=z.minv.block;u.data.slice(a,z.maxv.block+65536-a).fetch(function(e){p=b(e,z.maxv.block-z.minv.block+1);return H()})}var u=this;r=r||{};var L=this.chrToIndex[a],e;if(void 0===L)e=[];else{if(null===this.indices[L]&&this.indexChunks.chunks[L]){var x=this.indexChunks.chunks[L];return this.bai.slice(x[0],x[1]).fetch(function(e){e=new Uint8Array(e);this.indices[L]=e;return this.fetch(a,c,k,f,r)}.bind(this))}(e=this.blocksForRange(L,c,k))||f(null,"Error in index fetch")}var A=[],q=0,p;H()};var r="=ACxGxxxTxxxxxxN".split(""),
H="MIDNSHP=X???????".split("");n.prototype.readBamRecords=function(a,b,k,f,q,p,u){for(;;){var L=t(a,b),L=b+L+4;if(L>=a.length)return!1;var e=new l,x=t(a,b+4),A=t(a,b+8),P=t(a,b+12),g=(P&65280)>>8,d=P&255,P=t(a,b+16),z=(P&4294901760)>>16,D=P&65535,P=t(a,b+20),h=t(a,b+24),K=t(a,b+28);t(a,b+32);e.segment=this.indexToChr[x];e.flag=z;e.pos=A;e.mq=g;u.light&&(e.seqLength=P);if(!u.light){0<=h&&(e.nextSegment=this.indexToChr[h],e.nextPos=K);g="";for(A=0;A<d-1;++A)g+=String.fromCharCode(a[b+36+A]);e.readName=
g;b=b+36+d;d="";for(A=0;A<D;++A)g=t(a,b),d=d+(g>>4)+H[g&15],b+=4;e.cigar=d;D="";d=P+1>>1;for(A=0;A<d;++A)g=a[b+A],D+=r[(g&240)>>4],D.length<P&&(D+=r[g&15]);b+=d;e.seq=D;D="";for(A=0;A<P;++A)D+=String.fromCharCode(a[b+A]+33);b+=P;for(e.quals=D;b<L;){D=String.fromCharCode(a[b],a[b+1]);d=String.fromCharCode(a[b+2]);if("A"==d)d=String.fromCharCode(a[b+3]),b+=4;else if("i"==d||"I"==d)d=t(a,b+3),b+=7;else if("c"==d||"C"==d)d=a[b+3],b+=4;else if("s"==d||"S"==d)d=C(a,b+3),b+=5;else if("f"==d)d=c(a,b+3),b+=
7;else if("Z"==d||"H"==d)for(b+=3,d="";A=a[b++],0!=A;)d+=String.fromCharCode(A);else if("B"==d){d=String.fromCharCode(a[b+3]);A=t(a,b+4);if("i"==d||"I"==d||"f"==d)g=4,z="f"==d?c:t;else if("s"==d||"S"==d)g=2,z=C;else if("c"==d||"C"==d)g=1,z=E;else throw"Unknown array type "+d;b+=8;d=[];for(h=0;h<A;++h)d.push(z(a,b)),b+=g}else throw"Unknown type "+d;e[D]=d}}if(!f||e.pos<=q&&e.pos+P>=f)void 0!==p&&x!=p||k.push(e);if(e.pos>q)return!0;b=L}};"undefined"!==typeof v&&(v.exports={makeBam:m,BAM_MAGIC:q,BAI_MAGIC:k,
BamFlags:d})},{"./bin":4,"./lh3utils":24,"./spans":36}],2:[function(d,v,s){function n(a){this.type=a}function m(a,b){this.parser=a;this.sink=b}function g(a,b){this.parser=a;this.sink=b;this.wigState=null}if("undefined"!==typeof d){var l=d("./spans"),t=l.Range,C=l.union,E=l.intersection,l=d("./sourceadapters").registerParserFactory;v=d("./das");var c=v.DASStylesheet,a=v.DASStyle,b=v.DASGroup,f=d("./utils").shallowCopy}n.prototype.createSession=function(a){return"wig"==this.type?new g(this,a):new m(this,
a)};var p=/([^=]+)=(.+)/,q=/\s/,k=/^[0-9]+,[0-9]+,[0-9]+/;m.prototype.parse=function(a){var c=a.split(q);if(!(3>c.length)){var p=parseInt(c[1])+1;a=parseInt(c[2]);a={segment:c[0],min:p,max:a};3<c.length&&"."!==c[3]&&(a.label=c[3]);4<c.length&&(a.score=parseFloat(c[4]));5<c.length&&(a.orientation=c[5]);if(8<c.length){var d=c[8];k.test(d)&&(a.itemRgb="rgb("+d+")")}if(12<=c.length){var d=parseInt(c[6]),w=parseInt(c[7]),g=parseInt(c[9]),y=c[10].split(",").map(function(e){return parseInt(e)}),l=c[11].split(",").map(function(e){return parseInt(e)});
a.type="transcript";var u=new b;u.id=c[3];u.type="transcript";u.notes=[];a.groups=[u];if(12<c.length){var L=u=c[12];13<c.length&&(L=c[13]);c=new b;c.id=u;c.label=L;c.type="gene";a.groups.push(c)}c=null;for(u=0;u<g;++u)L=l[u]+p,L=new t(L,L+y[u]),c=c?C(c,L):L;l=c.ranges();for(p=0;p<l.length;++p)y=l[p],g=f(a),g.min=y.min(),g.max=y.max(),this.sink(g);if(w>d&&(d="+"==a.orientation?new t(d,w+3):new t(d-3,w),d=E(c,d)))for(a.type="translation",d=d.ranges(),p=w=0;p<d.length;++p)g=p,"-"==a.orientation&&(g=
d.length-p-1),y=d[g],g=f(a),g.min=y.min(),g.max=y.max(),a.readframe=w,y=y.max()-y.min(),w=(w+y)%3,this.sink(g)}else this.sink(a)}};m.prototype.flush=function(){};g.prototype.parse=function(a){a=a.split(q);if("fixedStep"==a[0]){this.wigState="fixedStep";this.chr=this.pos=this.step=null;for(var b=this.span=1;b<a.length;++b){var c=p.exec(a[b]);c&&("chrom"==c[1]?this.chr=c[2]:"start"==c[1]?this.pos=parseInt(c[2]):"step"==c[1]?this.step=parseInt(c[2]):"span"==c[1]&&(this.span=parseInt(c[2])))}}else if("variableStep"==
a[0])for(this.wigState="variableStep",this.chr=null,b=this.span=1;b<a.length;++b)c=p.exec(a[b]),"chrom"==c[1]?this.chr=c[2]:"span"==c[1]&&(this.span=parseInt(c[2]));else this.wigState?"fixedStep"==this.wigState?1==a.length&&(a=parseFloat(a[0]),a={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:a},this.pos+=this.step,this.sink(a)):"variableStep"==this.wigState&&2==a.length&&(b=parseInt(a[0]),a=parseFloat(a[1]),a={segment:this.chr,min:b,max:b+this.span-1,score:a},this.sink(a)):4>a.length||
(a={segment:a[0],min:parseInt(a[1])+1,max:parseInt(a[2]),score:parseFloat(a[3])},this.sink(a))};g.prototype.flush=function(){};n.prototype.getStyleSheet=function(b){var k=new c;if("wig"==this.type){var f=new a;f.glyph="HISTOGRAM";f.BGCOLOR="blue";f.HEIGHT=30;k.pushStyle({type:"default"},null,f)}else f=new a,f.glyph="BOX",f.FGCOLOR="black",f.BGCOLOR="blue",f.HEIGHT=8,f.BUMP=!0,f.LABEL=!0,f.ZINDEX=20,k.pushStyle({type:"default"},null,f),f=new a,f.glyph="BOX",f.FGCOLOR="black",f.BGCOLOR="red",f.HEIGHT=
10,f.BUMP=!0,f.ZINDEX=20,k.pushStyle({type:"translation"},null,f),f=new a,f.glyph="BOX",f.FGCOLOR="black",f.BGCOLOR="white",f.HEIGHT=10,f.ZINDEX=10,f.BUMP=!0,f.LABEL=!0,k.pushStyle({type:"transcript"},null,f),f=new a,f.glyph="HISTOGRAM",f.COLOR1="white",f.COLOR2="black",f.HEIGHT=30,k.pushStyle({type:"density"},null,f);return b(k)};l("bed",function(a){return new n(a)});l("wig",function(a){return new n(a)})},{"./das":10,"./sourceadapters":34,"./spans":36,"./utils":49}],3:[function(d,v,s){function n(a,
e){return a[e]+a[e+1]*w+a[e+2]*I+a[e+3]*y+a[e+4]*F}function m(){}function g(a,e,b,c){this.bwg=a;this.cirTreeOffset=e;this.cirTreeLength=b;this.isSummary=c}function l(a,e,b){var c=new m;c.data=a;c.name=b;c.data.slice(0,512).salted().fetch(function(a){if(!a)return e(null,"Couldn't fetch file");var b=new Uint8Array(a),f=new Int16Array(a);a=new Int32Array(a);var z=b[0]+w*b[1]+I*b[2]+y*b[3];if(z==r)c.type="bigwig";else if(z==Q)c.type="bigbed";else return z==H||z==B?e(null,"Currently don't support big-endian BBI files"):
e(null,"Not a supported format, magic=0x"+z.toString(16));c.version=f[2];c.numZoomLevels=f[3];c.chromTreeOffset=n(b,8);c.unzoomedDataOffset=n(b,16);c.unzoomedIndexOffset=n(b,24);c.fieldCount=f[16];c.definedFieldCount=f[17];c.asOffset=n(b,36);c.totalSummaryOffset=n(b,44);c.uncompressBufSize=a[13];c.extHeaderOffset=n(b,56);c.zoomLevels=[];for(f=0;f<c.numZoomLevels;++f){var z=a[6*f+16],D=n(b,24*f+72),h=n(b,24*f+80);c.zoomLevels.push({reduction:z,dataOffset:D,indexOffset:h})}c.readChromTree(function(){c.getAutoSQL(function(h){c.schema=
h;return e(c)})})},{timeout:5E3})}function t(a,e,c,b,f){this.bbi=a;this.type=e;this.fieldCount=c;this.offset=b;this.field=f}if("undefined"!==typeof d){s=d("./spans");var C=s.Range,E=s.union,c=s.intersection;s=d("./das");var a=s.DASFeature,b=s.DASGroup,f=d("./utils").shallowCopy,p=d("./bin").readInt;d=d("jszlib");var q=d.inflateBuffer,k=d.arrayCopy}var r=2291137574,H=654086024,Q=2273964779,B=3958540679,w=256,I=65536,y=16777216,F=4294967296,u=/^[0-9]+,[0-9]+,[0-9]+/;m.prototype.readChromTree=function(a){var e=
this;this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var c=this.unzoomedDataOffset,c=c+4-(c-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,c-this.chromTreeOffset).fetch(function(c){var b=new Uint8Array(c),f=new Int16Array(c),k=(new Int32Array(c))[2];n(b,16);var z=function(a){var h=b[a],c=f[a/2+1];a+=4;for(var G=0;G<c;++G)if(0==h){a+=k;var x=n(b,a);a+=8;x-=e.chromTreeOffset;z(x)}else{for(var x="",M=0;M<k;++M){var A=b[a++];0!=A&&(x+=String.fromCharCode(A))}M=b[a+3]<<24|b[a+2]<<16|
b[a+1]<<8|b[a+0];a+=8;e.chromsToIDs[x]=M;0==x.indexOf("chr")&&(e.chromsToIDs[x.substr(3)]=M);e.idsToChroms[M]=x;e.maxID=Math.max(e.maxID,M)}};z(32);a(e)})};g.prototype.readWigData=function(a,e,c,b){a=this.bwg.chromsToIDs[a];if(void 0===a)return b([]);this.readWigDataById(a,e,c,b)};g.prototype.readWigDataById=function(a,e,c,b){var f=this;if(this.cirHeader){var k=[],u=0;Date.now();var z=function(h,z,b,f){return(0>a||h==a)&&z<=c&&b>=e},D=function(e,a){f.bwg.instrument&&console.log("level="+a+"; offset="+
e+"; time="+(Date.now()|0));u+=e.length;if(1==e.length&&48==e[0]-f.cirTreeOffset&&f.cachedCirRoot)K(f.cachedCirRoot,0,a),--u,0==u&&f.fetchFeatures(z,k,b);else{for(var c=4+32*f.cirBlockSize,D,x=0;x<e.length;++x){var p=new C(e[x],e[x]+c);D=D?E(D,p):p}c=D.ranges();for(D=0;D<c.length;++D)h(e,c[D],a)}},h=function(h,e,a,c){e.max();e.min();f.bwg.data.slice(e.min(),e.max()-e.min()).fetch(function(c){for(var D=0;D<h.length;++D)e.contains(h[D])&&(K(c,h[D]-e.min(),a),48==h[D]-f.cirTreeOffset&&0==h[D]-e.min()&&
(f.cachedCirRoot=c),--u,0==u&&f.fetchFeatures(z,k,b))})},K=function(h,z,b){var f=new Uint8Array(h),K=new Int16Array(h);h=new Int32Array(h);var A=f[z],K=K[z/2+1];z+=4;if(0!=A)for(A=0;A<K;++A){var u=z/4,p=h[u],r=h[u+1],q=h[u+2],u=h[u+3],d=n(f,z+16);b=n(f,z+24);(0>a||p<a||p==a&&r<=c)&&(0>a||q>a||q==a&&u>=e)&&k.push({offset:d,size:b});z+=32}else{for(var H=[],A=0;A<K;++A)u=z/4,p=h[u],r=h[u+1],q=h[u+2],u=h[u+3],d=n(f,z+16),(0>a||p<a||p==a&&r<=c)&&(0>a||q>a||q==a&&u>=e)&&H.push(d),z+=24;0<H.length&&D(H,
b+1)}};D([f.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(h){f.cirHeader=h;h=new Int32Array(f.cirHeader);f.cirBlockSize=h[1];f.readWigDataById(a,e,c,b)})};g.prototype.fetchFeatures=function(c,e,b){var f=this;e.sort(function(e,a){return(e.offset|0)-(a.offset|0)});if(0==e.length)b([]);else{var u=[],p=function(e,c,h,b){b||(b={});var k=new a;k._chromId=e;k.segment=f.bwg.idsToChroms[e];k.min=c;k.max=h;k.type=f.bwg.type;for(var x in b)k[x]=b[x];u.push(k)},r=function(){if(0==
e.length)Date.now(),b(u);else{var z=e[0];if(z.data)f.parseFeatures(z.data,p,c),e.splice(0,1),r();else{for(var a=z.offset,h=z.size,z=1;z<e.length&&e[z].offset==a+h;)h+=e[z].size,++z;f.bwg.data.slice(a,h).fetch(function(a){for(var z=0,c=0;z<h;){var b=e[c],D;0<f.bwg.uncompressBufSize?D=q(a,z+2,b.size-2):(D=new Uint8Array(b.size),k(new Uint8Array(a,z,b.size),0,D,0,b.size),D=D.buffer);b.data=D;z+=b.size;++c}r()})}}};r()}};g.prototype.parseFeatures=function(a,e,k){var A=new Uint8Array(a);if(this.isSummary)for(var p=
new Int16Array(a),r=new Int32Array(a),q=new Float32Array(a),A=a.byteLength/32,p=0;p<A;++p){a=r[8*p];var z=r[8*p+1],D=r[8*p+2],h=r[8*p+3],K=q[8*p+5],G=q[8*p+6];k(a,z+1,D)&&(h={type:"bigwig",score:G/h,maxScore:K},"bigbed"==this.bwg.type&&(h.type="density"),e(a,z+1,D,h))}else if("bigwig"==this.bwg.type)if(p=new Int16Array(a),r=new Int32Array(a),q=new Float32Array(a),a=r[0],K=r[1],G=r[3],h=r[4],z=A[20],A=p[11],3==z)for(p=0;p<A;++p){var d=q[p+6],r=K+p*G+1,z=K+p*G+h;k(a,r,z)&&e(a,r,z,{score:d})}else if(2==
z)for(p=0;p<A;++p)z=r[2*p+6]+1,D=z+h-1,d=q[2*p+7],k(a,z,D)&&e(a,z,D,{score:d});else if(1==z)for(p=0;p<A;++p)z=r[3*p+6]+1,D=r[3*p+7],d=q[3*p+8],z>D&&(z=D),k(a,z,D)&&e(a,z,D,{score:d});else console.log("Currently not handling bwgType="+z);else if("bigbed"==this.bwg.type)for(p=0,h=this.bwg.definedFieldCount,K=this.bwg.schema;p<A.length;){a=A[p+3]<<24|A[p+2]<<16|A[p+1]<<8|A[p+0];z=A[p+7]<<24|A[p+6]<<16|A[p+5]<<8|A[p+4];D=A[p+11]<<24|A[p+10]<<16|A[p+9]<<8|A[p+8];p+=12;for(d="";;)if(G=A[p++],0!=G)d+=String.fromCharCode(G);
else break;var G={},M;M=0<d.length?d.split("\t"):[];0<M.length&&3<h&&(G.label=M[0]);1<M.length&&4<h&&(d=parseInt(M[1]),isNaN(d)||(G.score=d));2<M.length&&5<h&&(G.orientation=M[2]);5<M.length&&8<h&&(d=M[5],u.test(d)&&(G.itemRgb="rgb("+d+")"));if(M.length>h-3&&K)for(d=h-3;d<M.length;++d)G[K.fields[d+3].name]=M[d];if(k(a,z+1,D,M))if(12>h)e(a,z+1,D,G);else{var d=M[3]|0,H=M[4]|0,w=M[6]|0,g=M[7].split(","),B=M[8].split(",");G.exonFrames&&(q=G.exonFrames.split(","),G.exonFrames=void 0);G.type="transcript";
var y=new b;for(r in G)y[r]=G[r];y.id=M[0];y.segment=this.bwg.idsToChroms[a];y.min=z+1;y.max=D;y.notes=[];G.groups=[y];if(9<M.length){var I=D=G.geneName||M[9];10<M.length&&(I=M[10]);G.geneName2&&(I=G.geneName2);M=f(y);M.id=D;M.label=I;M.type="gene";G.groups.push(M)}D=[];for(M=0;M<w;++M)y=(B[M]|0)+z,y=new C(y,y+(g[M]|0)),D.push(y);g=E(D);w=g.ranges();for(z=0;z<w.length;++z)D=w[z],e(a,D.min()+1,D.max(),G);if(H>d&&(z="+"==G.orientation?new C(d,H+3):new C(d-3,H),z=c(g,z))){G.type="translation";d=z.ranges();
for(g=H=0;d[0].min()>w[g].max();)g++;for(z=0;z<d.length;++z)w=z,"-"==G.orientation&&(w=d.length-z-1),D=d[w],G.readframe=H,q&&(w=parseInt(q[w+g]),"number"===typeof w&&0<=w&&2>=w&&(G.readframe=w,G.readframeExplicit=!0)),w=D.max()-D.min(),H=(H+w)%3,e(a,D.min()+1,D.max(),G)}}}else throw Error("Don't know what to do with "+this.bwg.type);};g.prototype.getFirstAdjacent=function(a,e,c,b){a=this.bwg.chromsToIDs[a];if(void 0===a)return b([]);this.getFirstAdjacentById(a,e,c,b)};g.prototype.getFirstAdjacentById=
function(a,e,c,b){var f=this;if(this.cirHeader){var k=null,p=-1,z=-1,D=0;Date.now();var h=function(h,e){D+=h.length;for(var a=4+32*f.cirBlockSize,z,c=0;c<h.length;++c){var b=new C(h[c],h[c]+a);z=z?E(z,b):b}a=z.ranges();for(z=0;z<a.length;++z)K(h,a[z],e)},K=function(h,z,K,p){z.max();z.min();f.bwg.data.slice(z.min(),z.max()-z.min()).fetch(function(p){for(var u=0;u<h.length;++u)if(z.contains(h[u])&&(G(p,h[u]-z.min(),K),--D,0==D)){if(!k)return 0<c&&(0!=a||0<e)?f.getFirstAdjacentById(0,0,c,b):0>c&&(a!=
f.bwg.maxID||1E9>e)?f.getFirstAdjacentById(f.bwg.maxID,1E9,c,b):b([]);f.fetchFeatures(function(h,z,b,f){return 0>c&&(h<a||b<e)||0<c&&(h>a||z>e)},[k],function(h){for(var e=null,a=-1,z=-1,f=0;f<h.length;++f){var K=h[f],D=K._chromId,k=K.min,M=K.max;if(null==e||0>c&&(D>a||M>z)||0<c&&(D<a||k<z))e=K,z=0>c?M:k,a=D}return null!=e?b([e]):b([])})}})},G=function(b,K,D){var A=new Uint8Array(b),G=new Int16Array(b);b=new Int32Array(b);var u=A[K],G=G[K/2+1];K+=4;if(0!=u)for(u=0;u<G;++u){var r=K/4,q=b[r],d=b[r+1],
H=b[r+2],w=b[r+3],r=n(A,K+16);D=n(A,K+24);(0>c&&(q<a||q==a&&d<=e)||0<c&&(H>a||H==a&&w>=e))&&!/_random/.exec(f.bwg.idsToChroms[q])&&(null==k||0>c&&(H>p||H==p&&w>z)||0<c&&(q<p||q==p&&d<z))&&(k={offset:r,size:D},z=0>c?w:d,p=0>c?H:q);K+=32}else{for(var g=A=-1,u=0;u<G;++u){r=K/4;q=b[r];d=b[r+1];H=b[r+2];w=b[r+3];r=b[r+4]<<32|b[r+5];if(0>c&&(q<a||q==a&&d<=e)&&H>=a||0<c&&(H>a||H==a&&w>=e)&&q<=a)if(0>A||w>g)A=r,g=0>c?w:d;K+=24}0<=A&&h([A],D+1)}};h([f.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,
48).fetch(function(h){f.cirHeader=h;h=new Int32Array(f.cirHeader);f.cirBlockSize=h[1];f.getFirstAdjacentById(a,e,c,b)})};m.prototype.readWigData=function(a,e,c,b){this.getUnzoomedView().readWigData(a,e,c,b)};m.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new g(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};m.prototype.getZoomedView=function(a){a=this.zoomLevels[a];
a.view||(a.view=new g(this,a.indexOffset,4E3,!0));return a.view};m.prototype._tsFetch=function(a,e,c,b,f){var k=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var p=[],z=this.topLevelReductionCache,D=0;D<z.length;++D)z[D]._chromId==e&&p.push(z[D]);return f(p)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(h){k.topLevelReductionCache=h;return k._tsFetch(a,e,c,b,f)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(e,
c,b,f)};m.prototype.thresholdSearch=function(a,e,c,b,f){function k(){if(0==z.length)return f(null);z.sort(function(h,e){var a=h.zoom-e.zoom;if(0!=a)return a;a=h.chrOrd-e.chrOrd;return 0!=a?a:h.min-e.min*c});var h=z.splice(0,1)[0];p._tsFetch(h.zoom,h.chr,h.min,h.max,function(a){var D=0<c?0:3E8;h.fromRef&&(D=e);for(var M=0;M<a.length;++M){var p=a[M],u;u=void 0!=p.maxScore?p.maxScore:p.score;if(0<c){if(u>b)if(0>h.zoom){if(p.min>D)return f(p)}else p.max>D&&z.push({chr:h.chr,chrOrd:h.chrOrd,zoom:h.zoom-
2,min:p.min,max:p.max,fromRef:h.fromRef})}else if(u>b)if(0>h.zoom){if(p.max<D)return f(p)}else p.min<D&&z.push({chr:h.chr,chrOrd:h.chrOrd,zoom:h.zoom-2,min:p.min,max:p.max,fromRef:h.fromRef})}k()})}c=0>c?-1:1;var p=this;a=this.chromsToIDs[a];for(var z=[{chrOrd:0,chr:a,zoom:p.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],D=1;D<=this.maxID+1;++D){var h=(a+c*D)%(this.maxID+1);0>h&&(h+=this.maxID+1);z.push({chrOrd:D,chr:h,zoom:p.zoomLevels.length-1,min:0,max:3E8})}k()};m.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);
this.data.slice(this.asOffset,2048).fetch(function(e){var c=new Uint8Array(e);e="";for(var b=0;b<c.length&&0!=c[b];++b)e+=String.fromCharCode(c[b]);var c=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,f=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(e);if(f){b={declType:f[1],name:f[2],comment:f[4],fields:[]};e=e.substring(f[0]);for(f=c.exec(e);null!=f;f=c.exec(e))b.fields.push({type:f[1],name:f[2],comment:f[4]});return a(b)}})};m.prototype.getExtraIndices=function(a){var e=this;if(4>this.version||0==this.extHeaderOffset||
"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(c){if(!c)return a(null,"Couldn't fetch extension header");var b=new Uint8Array(c),f=new Int16Array(c);new Int32Array(c);var k=f[1];c=n(b,4);if(0==k)return a(null);e.data.slice(c,20*k).fetch(function(c){if(!c)return a(null,"Couldn't fetch index info");var z=new Uint8Array(c),b=new Int16Array(c);new Int32Array(c);c=[];for(var h=0;h<k;++h){var f=b[10*h],p=b[10*h+1],u=n(z,20*h+4),f=new t(e,f,p,u,b[10*h+8]);c.push(f)}a(c)})})};
t.prototype.lookup=function(a,e){var c=this;this.bbi.data.slice(this.offset,32).fetch(function(b){function f(h){c.bbi.data.slice(h,4+u*(z+D)).fetch(function(h){var b=new Uint8Array(h),k=new Uint16Array(h);new Uint32Array(h);k=k[1];h=4;if(0==b[0]){for(var M=null,u=0;u<k;++u){for(var r="",A=0;A<z;++A){var q=b[h++];0!=q&&(r+=String.fromCharCode(q))}A=n(b,h);h+=8;if(0>a.localeCompare(r)&&M){f(M);return}M=A}f(M)}else{for(u=0;u<k;++u){r="";for(A=0;A<z;++A)q=b[h++],0!=q&&(r+=String.fromCharCode(q));if(r==
a)return k=n(b,h),b=p(b,h+8),c.bbi.getUnzoomedView().fetchFeatures(function(h,e,z,b){if(b&&b.length>c.field-3)return b[c.field-3]==a},[{offset:k,size:b}],e);h+=D}return e([])}})}var k=new Uint8Array(b);new Int16Array(b);b=new Int32Array(b);var u=b[1],z=b[2],D=b[3];n(k,16);f(c.offset+32)})};"undefined"!==typeof v&&(v.exports={makeBwg:l,BIG_BED_MAGIC:Q,BIG_WIG_MAGIC:r})},{"./bin":4,"./das":10,"./spans":36,"./utils":49,jszlib:65}],4:[function(d,v,s){function n(a){this.blob=a}function m(a,b,c,f){f||("object"===
typeof b?(f=b,b=void 0):f={});this.url=a;this.start=b||0;c&&(this.end=c);this.opts=f}function g(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer}function l(a,b){return a[b+7]<<24|a[b+6]<<16|a[b+5]<<8|a[b+4]}function t(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function C(a,b){return a[b+1]<<8|a[b]}function E(a,b){return a[b]}function c(a,b){return a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3]}if("undefined"!==typeof d)var a=d("./utils").shallowCopy,
b=d("./sha1").b64_sha1,f=d("es6-promise").Promise;n.prototype.slice=function(a,b){var c;c=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,a+b):this.blob.webkitSlice(a);return new n(c)};n.prototype.salted=function(){return this};n.prototype.fetch="undefined"!==typeof FileReader?function(a){var b=new FileReader;b.onloadend=function(c){a(g(b.result))};b.readAsBinaryString(this.blob)}:function(a){var b=new FileReaderSync;try{var c=b.readAsArrayBuffer(this.blob);a(c)}catch(f){a(null,
f)}};m.prototype.slice=function(a,b){if(0>a)throw"Bad slice "+a;var c=this.start,f=this.end,c=c&&a?c+a:a||c;return new m(this.url,c,b&&c?c+b-1:f||b-1,this.opts)};var p=0,q=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");m.prototype.fetchAsText=function(a){try{var c=new XMLHttpRequest,f=this.url;(q||this.opts.salt)&&0>f.indexOf("?")&&(f=f+"?salt="+b(""+Date.now()+","+ ++p));c.open("GET",f,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";c.setRequestHeader("Range",
"bytes="+this.start+"-"+this.end)}c.onreadystatechange=function(){if(4==c.readyState)return 200==c.status||206==c.status?a(c.responseText):a(null)};this.opts.credentials&&(c.withCredentials=!0);c.send("")}catch(d){return a(null)}};m.prototype.salted=function(){var b=a(this.opts);b.salt=!0;return new m(this.url,this.start,this.end,b)};m.prototype.getURL=function(){return this.opts.resolver?this.opts.resolver(this.url).then(function(a){return"string"===typeof a?a:a.url}):f.resolve(this.url)};m.prototype.fetch=
function(a,c){var f=this;c=c||{};var d=c.attempt||1,B=c.truncatedLength;if(3<d)return a(null);this.getURL().then(function(w){try{var I;c.timeout&&!f.opts.credentials&&(I=setTimeout(function(){console.log("timing out "+w);y.abort();return a(null,"Timeout")},c.timeout));var y=new XMLHttpRequest,t;(q||f.opts.salt)&&0>w.indexOf("?")&&(w=w+"?salt="+b(""+Date.now()+","+ ++p));y.open("GET",w,!0);y.overrideMimeType("text/plain; charset=x-user-defined");if(f.end){if(1E8<f.end-f.start)throw"Monster fetch!";
y.setRequestHeader("Range","bytes="+f.start+"-"+f.end);t=f.end-f.start+1}y.responseType="arraybuffer";y.onreadystatechange=function(){if(4==y.readyState){I&&clearTimeout(I);if(200==y.status||206==y.status){if(y.response){var b=y.response.byteLength;return!t||t==b||B&&b==B?a(y.response):f.fetch(a,{attempt:d+1,truncatedLength:b})}if(y.mozResponseArrayBuffer)return a(y.mozResponseArrayBuffer);b=y.responseText;return!t||t==b.length||B&&b.length==B?a(g(y.responseText)):f.fetch(a,{attempt:d+1,truncatedLength:b.length})}return f.fetch(a,
{attempt:d+1})}};f.opts.credentials&&(y.withCredentials=!0);y.send("")}catch(u){return a(null)}}).catch(function(b){console.log(b);return a(null,b)})};(function(a){var b=new ArrayBuffer(8),c=new Uint8Array(b),f=new Float32Array(b);a.readFloat=function(a,b){c[0]=a[b];c[1]=a[b+1];c[2]=a[b+2];c[3]=a[b+3];return f[0]}})(this);"undefined"!==typeof v&&(v.exports={BlobFetchable:n,URLFetchable:m,readInt:t,readIntBE:c,readInt64:l,readShort:C,readByte:E,readFloat:this.readFloat})},{"./sha1":33,"./utils":49,
"es6-promise":53}],5:[function(d,v,s){function n(d){var g="bp";1E9<d?(d/=1E9,g="Gb"):1E6<d?(d/=1E6,g="Mb"):1E3<d&&(d/=1E3,g="kb");return""+Math.round(d)+g}if("undefined"!==typeof d){var m=d("./cbrowser").Browser,g=d("./utils").makeElement,l=d("./numformats").formatLongInt,t=d("./zoomslider");d("./tier-edit");d("./export-config");d("./export-ui");d("./export-image");d("./svg-export");d("./session")}m.prototype.initUI=function(d,E){this.noSourceCSS||["bootstrap-scoped.css","dalliance-scoped.css","font-awesome.min.css"].forEach(function(a){document.head.appendChild(g("link",
"",{rel:"stylesheet",href:this.resolveURL("$$css/"+a)}))}.bind(this));var c=this;c.disableDefaultFeaturePopup||this.addFeatureListener(function(a,h,e,b){c.featurePopup(a,h,e,b)});d.classList.add("dalliance");var a=c.toolbar=g("div",null,{className:"btn-toolbar toolbar"}),b=c.coordSystem.speciesName+" "+c.nameForCoordSystem(c.coordSystem);this.setDocumentTitle&&(document.title=b+" :: dalliance");var f=g("input","",{className:"loc-field"});c.makeTooltip(f,"Enter a genomic location or gene name");var p=
g("p","",{className:"loc-status"}),q=g("a",[g("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),k=new t({width:c.zoomSliderWidth});c.makeTooltip(k,"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).");var r=g("a",[g("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),H=g("a",[g("i",null,{className:"fa fa-eraser"})],{className:"btn"}),m=g("a",[g("i",null,{className:"fa fa-plus"})],{className:"btn"}),B=g("a",[g("i",
null,{className:"fa fa-bookmark"})],{className:"btn"}),w=g("a",[g("i",null,{className:"fa fa-print"})],{className:"btn"});g("a",[g("i",null,{className:"fa fa-refresh"})],{className:"btn"});var I=g("a",[g("i",null,{className:"fa fa-cogs"})],{className:"btn"}),y=g("a",[g("i",null,{className:"fa fa-question"})],{className:"btn"}),F=g("a",[g("i",null,{className:"fa fa-road"})],{className:"btn"});c.makeTooltip(F,"Configure currently selected track(s) (E)");var u=g("a",[g("i",null,{className:"fa fa-angle-left"})],
{className:"btn"},{width:"5px"}),L=g("a",[g("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),e=g("div",null,{className:"btn-group pull-right"});this.noTrackAdder||e.appendChild(m);this.noTrackEditor||e.appendChild(F);this.noExport||e.appendChild(w);this.noOptions||e.appendChild(I);this.noHelp||e.appendChild(y);this.setUiMode=function(a){this.uiMode=a;var h={help:y,add:m,opts:I,"export":w,tier:F},e;for(e in h)e==a?h[e].classList.add("active"):h[e].classList.remove("active")};
this.noLeapButtons||a.appendChild(L);e.firstChild&&a.appendChild(e);this.noLeapButtons||a.appendChild(u);this.noTitle||a.appendChild(g("div",g("h4",b,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||a.appendChild(g("div",[f,p],{className:"btn-group loc-group"}));this.noClearHighlightsButton||a.appendChild(H);this.noZoomSlider||a.appendChild(g("div",[q,g("span",k,{className:"btn"}),r],{className:"btn-group"}));this.toolbarBelow?(d.appendChild(E),d.appendChild(a)):(d.appendChild(a),
d.appendChild(E));var x=Math.log(2)/Math.log(10),A=Math.log(5)/Math.log(10),P=function(a){var h=(a/c.zoomExpt+Math.log(c.zoomBase))/Math.log(10);a=h|0;h-=a;return((0.01>h?a:h<=x+0.01?a+x:h<=A+0.01?a+A:a+1)*Math.log(10)-Math.log(c.zoomBase))*c.zoomExpt},J=function(a){k.addLabel(a,n(Math.exp(a/c.zoomExpt)*c.zoomBase))};this.addViewListener(function(a,h,e,b,z){f.value=a+":"+l(h)+".."+l(e);k.min=z.min|0;k.max=z.max|0;z.isSnapZooming?(k.value=z.alternate,k.value2=z.current,k.active=2):(k.value=z.current,
k.value2=z.alternate,k.active=1);z.current==z.min?q.classList.add("disabled"):q.classList.remove("disabled");z.current==z.max?r.classList.add("disabled"):r.classList.remove("disabled");k.removeLabels();a=z.min;z=z.max;h=z-a;e=4;c.zoomSliderWidth&&150>c.zoomSliderWidth&&(e=3);J(P(a));for(b=1;b<e-1;++b)J(P(a+1*b*h/(e-1)));J(P(z));c.storeStatus&&c.storeViewStatus();H.style.display=0<c.highlights.length?"inline-block":"none"});this.addTierListener(function(){c.storeStatus&&c.storeTierStatus()});f.addEventListener("keydown",
function(a){40==a.keyCode&&(a.preventDefault(),a.stopPropagation(),c.setSelectedTier(0));if(10==a.keyCode||13==a.keyCode)a.preventDefault(),c.search(f.value,function(h){p.textContent=h?""+h:""})},!1);var U;m.addEventListener("click",function(a){U&&U.displayed?c.removeAllPopups():U=c.showTrackAdder(a)},!1);c.makeTooltip(m,"Add a new track from the registry or an indexed file. (A)");q.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.zoomStep(-10)},!1);c.makeTooltip(q,"Zoom in (+)");
r.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.zoomStep(10)},!1);c.makeTooltip(r,"Zoom out (-)");k.addEventListener("change",function(a){a=2==k.active;a!=c.isSnapZooming&&(c.savedZoom=c.zoomSliderValue-c.zoomMin,c.isSnapZooming=a);a=1==k.active?k.value:k.value2;c.zoomSliderValue=1*a;c.zoom(Math.exp(1*a/c.zoomExpt))},!1);B.addEventListener("click",function(a){a.stopPropagation();a.preventDefault()},!1);c.makeTooltip(B,"Favourite regions");w.addEventListener("click",
function(a){a.stopPropagation();a.preventDefault();c.openExportPanel()},!1);c.makeTooltip(w,"Export publication-quality SVG. (X)");I.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.toggleOptsPopup(a)},!1);c.makeTooltip(I,"Configure options.");y.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.toggleHelpPopup(a)});c.makeTooltip(y,"Help; Keyboard shortcuts. (H)");F.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();
1==c.selectedTiers.length&&c.openTierPanel(c.tiers[c.selectedTiers[0]])},!1);u.addEventListener("click",function(a){c.leap(c.reverseKeyScrolling?-1:1,!1)},!1);c.makeTooltip(u,function(a){a=c.getSelectedTier();var h;0<=a&&(h=c.tiers[a]);return h&&h.featureSource&&c.sourceAdapterIsCapable(h.featureSource,"quantLeap")&&"number"==typeof h.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(h.config.name||h.dasSource.name)+'"" (ctrl+LEFT)':h&&h.featureSource&&
c.sourceAdapterIsCapable(h.featureSource,"leap")?'Jump to the next feature in the selected track "'+(h.config.name||h.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});L.addEventListener("click",function(a){c.leap(c.reverseKeyScrolling?1:-1,!1)},!1);c.makeTooltip(L,function(a){a=c.getSelectedTier();var h;0<=a&&(h=c.tiers[a]);return h&&h.featureSource&&c.sourceAdapterIsCapable(h.featureSource,"quantLeap")&&"number"==typeof h.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+
(h.config.name||h.dasSource.name)+'"" (ctrl+RIGHT)':h&&h.featureSource&&c.sourceAdapterIsCapable(h.featureSource,"leap")?'Jump to the next feature in the selected track "'+(h.config.name||h.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});c.addTierSelectionListener(function(){var a=c.getSelectedTier(),h;0<=a&&(h=c.tiers[a]);a=!1;h&&h.featureSource&&(c.sourceAdapterIsCapable(h.featureSource,"quantLeap")&&"number"==typeof h.quantLeapThreshold?a=!0:c.sourceAdapterIsCapable(h.featureSource,
"leap")&&(a=!0));u.firstChild.className=a?"fa fa-angle-double-left":"fa fa-angle-left";L.firstChild.className=a?"fa fa-angle-double-right":"fa fa-angle-right"});H.addEventListener("click",function(a){c.clearHighlights()},!1);c.makeTooltip(H,"Clear highlights (C)");c.addTierSelectionWrapListener(function(a){0>a&&(c.setSelectedTier(null),f.focus())});c.addTierSelectionListener(function(a){"tier"===c.uiMode&&(0==a.length?(c.hideToolPanel(),c.manipulatingTier=null,c.uiMode="none"):(a=c.tiers[a[0]],a!=
c.manipulatingTier&&c.openTierPanel(a)))});var z=function(a){if(65==a.keyCode||97==a.keyCode)a.preventDefault(),a.stopPropagation(),c.showTrackAdder();else if(72==a.keyCode||104==a.keyCode)a.stopPropagation(),a.preventDefault(),c.toggleHelpPopup(a);else if(69==a.keyCode||101==a.keyCode)a.stopPropagation(),a.preventDefault(),1==c.selectedTiers.length&&c.openTierPanel(c.tiers[c.selectedTiers[0]]);else if(88==a.keyCode||120==a.keyCode)a.stopPropagation(),a.preventDefault(),c.openExportPanel();else if(67==
a.keyCode||99==a.keyCode)a.stopPropagation(),a.preventDefault(),c.clearHighlights()};d.addEventListener("focus",function(a){d.addEventListener("keydown",z,!1)},!1);d.addEventListener("blur",function(a){d.removeEventListener("keydown",z,!1)},!1);d.addEventListener("keydown",function(a){27===a.keyCode&&"none"!==c.uiMode&&(a.preventDefault(),a.stopPropagation(),c.setUiMode("none"),c.hideToolPanel(),c.selectedTiers&&0<c.selectedTiers.length&&c.browserHolder.focus())},!1)};m.prototype.showToolPanel=function(d,
t){var c=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);var a;a=t?d:g("div",d,{},{overflowY:"auto",width:"100%"});var b=g("div",g("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});b.addEventListener("click",function(a){c.hideToolPanel();c.setUiMode("none")},!1);this.makeTooltip(b,"Close tool panel (ESC)");this.activeToolPanel=g("div",[b,a],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();
c=this};m.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};m.prototype.toggleHelpPopup=function(d){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(d=g("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.resolveURL("$$help/index.html"),className:"help-panel"}),this.showToolPanel(d,!1),this.setUiMode("help"))};m.prototype.toggleOptsPopup=
function(d){var t=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{d=g("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var c=g("table");c.cellPadding=5;var a=g("input","",{type:"checkbox",checked:t.reverseScrolling});a.addEventListener("change",function(b){t.reverseScrolling=a.checked;t.storeStatus()},!1);c.appendChild(g("tr",[g("td","Reverse trackpad scrolling",{align:"right"}),g("td",
a)]));var b=g("input","",{type:"checkbox",checked:t.reverseKeyScrolling});b.addEventListener("change",function(a){t.reverseKeyScrolling=b.checked;t.storeStatus()},!1);c.appendChild(g("tr",[g("td","Reverse scrolling buttons and keys",{align:"right"}),g("td",b)]));var f=g("select");f.appendChild(g("option","Left",{value:"left"}));f.appendChild(g("option","Center",{value:"center"}));f.appendChild(g("option","Right",{value:"right"}));f.appendChild(g("option","None",{value:"none"}));f.value=t.rulerLocation;
f.addEventListener("change",function(a){t.rulerLocation=f.value;t.positionRuler();for(a=0;a<t.tiers.length;++a)t.tiers[a].paintQuant();t.storeStatus()},!1);c.appendChild(g("tr",[g("td","Vertical guideline",{align:"right"}),g("td",f)]));var p=g("input","",{type:"checkbox",checked:t.singleBaseHighlight});p.addEventListener("change",function(a){t.singleBaseHighlight=p.checked;t.positionRuler();t.storeStatus()},!1);p.setAttribute("id","singleBaseHightlightButton");c.appendChild(g("tr",[g("td","Display and highlight current genome location",
{align:"right"}),g("td",p)]));d.appendChild(c);c=g("button","Reset browser",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});c.addEventListener("click",function(a){t.reset()},!1);d.appendChild(c);this.showToolPanel(d);this.setUiMode("opts")}}},{"./cbrowser":6,"./export-config":14,"./export-image":15,"./export-ui":16,"./numformats":26,"./session":32,"./svg-export":38,"./tier-edit":44,"./utils":49,"./zoomslider":52}],6:[function(d,v,s){function n(a,e,h){this.min=e;this.max=
h;this.chr=a}function m(a){a||(a={});this.prefix="//www.biodalliance.org/release-0.14/";this.sources=[];this.tiers=[];this.tierGroups={};this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=1;this.maxPixelsPerBase=10;this.origin=0;this.targetQuantRes=
1;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=0.3;this.singleBaseHighlight=this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)","white"];this.minTierHeight=20;this.noDefaultLabels=
!1;this.availableSources=new c;this.defaultSources=[];this.mappableSources={};this.registry=null;this.noRegistryTabs=!0;this.hubs=[];this.hubObjects=[];this.sourceCache=new E;this.useFetchWorkers=this.retina=!0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.resolvers={};this.resolverSeed=1;this.assemblyNameUcsc=this.assemblyNamePrimary=!0;this.httpCanaryURL="http://www.biodalliance.org/http-canary.txt";this.httpWarningURL="//www.biodalliance.org/https.html";this.initListeners=[];this.baseColors=
a.baseColors?a.baseColors:{A:"green",C:"blue",G:"orange",T:"red","-":"hotpink",I:"red"};if(void 0!==a.viewStart&&"number"!==typeof a.viewStart)throw Error("viewStart must be an integer");if(void 0!==a.viewEnd&&"number"!==typeof a.viewEnd)throw Error("viewEnd must be an integer");if(void 0!==a.offscreenInitWidth&&"number"!==typeof a.offscreenInitWidth)throw Error("offscreenInitWidth must be an integer");for(var e in a)this[e]=a[e];"string"===typeof a.uiPrefix&&"string"!==typeof a.prefix&&(this.prefix=
a.uiPrefix);0>this.prefix.indexOf("//")&&0===this.prefix.indexOf("/")&&(a=window.location.hostname,window.location.port&&(a+=":"+window.location.port),this.prefix="//"+a+this.prefix);0===this.prefix.indexOf("//")&&(a=window.location.protocol,"http:"!=a&&"https:"!=a&&(console.log(window.location.protocol),console.log("WARNING: prefix is set to a protocol-relative URL ("+this.prefix+" when loading from a non-HTTP source"),this.prefix="http:"+this.prefix));if(!this.coordSystem)throw Error("Coordinate system must be configured");
if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var h=this;if("complete"===document.readyState)h.realInit();else{var b=function(a){window.removeEventListener("load",b,!1);h.realInit()};window.addEventListener("load",b,!1)}}function g(a,e,h){if(h)for(var b=0;b<e.length;++b)e[b].mapping=h;a.set(e)}function l(a,e,h,b){b=b||[];for(var c=a.length-1;0<=c;--c){var f=a[c];if(!f.notSelectable&&f.min()<=e&&f.max()>=e&&(!f.minY||
!(h<f.minY()||h>f.maxY()))){f.feature?b.push(f.feature):f.group&&b.push(f.group);if(f.glyphs)return l(f.glyphs,e,h,b);if(f.glyph)return l([f.glyph],e,h,b);break}}return b}function t(a,e){var h=this;this.tagSeed=0;this.callbacks={};this.browser=a;this.worker=e;this.worker.onmessage=function(a){var e=a.data;if(e.cmd)"resolve"==e.cmd?(a=h.browser.resolvers[e.resolver])?a(e.url).then(function(a){h.worker.postMessage({tag:e.tag,url:a})}).catch(function(a){console.log(a);h.worker.postMessage({tag:e.tag,
err:a.toString()})}):console.log("No resolver "+e.resolver):console.log("Bad worker callback "+e.cmd);else if(a=h.callbacks[e.tag])a(e.result,e.error),delete h.callbacks[e.tag]}}function C(a){var e=a.resolveURL(a.workerPath);0==e.indexOf("//")&&(e="https:"==window.location.protocol?"https:"+e:"http:"+e);var h=new Blob(['importScripts("'+e+"?version="+Q+'");'],{type:"application/javascript"});return new y(function(e,b){var c=new Worker(URL.createObjectURL(h));c.onmessage=function(h){"init"===h.data.tag&&
(console.log("Worker initialized"),e(new t(a,c)))};c.onerror=function(a){b(a.message)}})}function E(){this.sourcesByURI={}}if("undefined"!==typeof d){s=d("./utils");var c=s.Observed,a=s.makeElement,b=s.removeChildren,f=s.miniJSONify,p=s.shallowCopy,q=s.textXHR,k=d("./tier").DasTier,r=d("./sha1").hex_sha1,H=d("./thub").connectTrackHub,Q=d("./version");s=d("./numformats");var B=s.formatQuantLabel,w=s.formatLongInt,I=d("./chainset").Chainset,y=d("es6-promise").Promise;s=d("./sourcecompare");var F=s.sourcesAreEqual,
u=s.sourcesAreEqualModuloStyle,L=s.sourceDataURI}m.prototype.resolveURL=function(a){return a.replace("$$",this.prefix)};m.prototype.destroy=function(){window.removeEventListener("resize",this.resizeListener,!1)};m.prototype.realInit=function(){var e=this;if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");else{this.wasInitialized=!0;var c=navigator.userAgent||"dummy";0<=c.indexOf("Trident")&&0<=c.indexOf("rv:11")&&(this.disablePinning=!0);
this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(c=0;c<this.sources.length;++c){var h=this.sources[c];h&&this.defaultSources.push(h)}this.restoreStatus&&(this.statusRestored=this.restoreStatus());var f=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");this.browserHolder=a("div",null,{className:"dalliance dalliance-root",tabIndex:-1});this.maxHeight?
this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=this.maxHeight&&(this.browserHolder.style.maxHeight=null);b(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=a("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=a("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=a("div",this.makeLoader(24),{className:"tier-holder tier-holder-rest"});this.locSingleBase=a("span",
"",{className:"loc-single-base"});c=a("div",this.locSingleBase,{className:"loc-single-base-holder"});this.addViewListener(function(a,h,b,c,f,k,K){h=Math.round((K+k)/2);e.locSingleBase.appendChild(document.createTextNode(a+":"+w(h)));e.locSingleBase.removeChild(e.locSingleBase.firstChild)});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=a("div",[c,this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"}),this.svgHolder.appendChild(this.tierHolderHolder));
this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=a("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(a("span",["Powered by ",a("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+Q],{className:"powered-by"}));this.browserHolder.appendChild(this.bhtmlRoot);this.resizeListener=function(a){f.resizeViewer()};window.addEventListener("resize",this.resizeListener,!1);this.ruler=a("div",null,{className:"guideline"});this.ruler2=a("div",null,{className:"single-base-guideline"});
this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=this.chains||{};this.chains={};for(var k in this.chainConfigs)c=this.chainConfigs[k],c instanceof I&&console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),this.chains[k]=new I(c);if(0<this.maxWorkers){k=[];for(c=0;c<this.maxWorkers;++c)k.push(C(this));k=y.all(k)}else k=y.resolve([]);this.fetchWorkers=null;this.nextWorker=0;k.then(function(a){console.log("Booted "+
a.length+" workers");f.fetchWorkers=a},function(a){console.log("Failed to boot workers",a)}).then(function(){if(e.offscreenInitWidth||"none"!=window.getComputedStyle(f.browserHolderHolder).display&&0<f.tierHolder.getBoundingClientRect().width)setTimeout(function(){f.realInit2()},1);else var a=setInterval(function(){"none"!=window.getComputedStyle(f.browserHolderHolder).display&&0<f.tierHolder.getBoundingClientRect().width&&(clearInterval(a),f.realInit2())},300)})}};m.prototype.realInit2=function(){var e=
this;b(this.tierHolder);b(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|e.offscreenInitWidth|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.tierHolderHolder.addEventListener("mousewheel",
function(a){a.stopPropagation();a.preventDefault();if(a.wheelDeltaX){var h=a.wheelDeltaX/5;e.reverseScrolling||(h=-h);e.move(h)}a.wheelDeltaY&&(h=a.wheelDeltaY,e.reverseScrolling&&(h=-h),e.tierHolder.scrollTop+=h)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(a){a.stopPropagation();a.preventDefault();1==a.axis?0!=a.detail&&(a=a.detail/4,e.reverseScrolling&&(a=-a),e.move(a)):(a=a.detail,e.reverseScrolling||(a=-a),e.tierHolder.scrollTop+=a)},!1);this.tierHolderHolder.addEventListener("touchstart",
function(a){return e.touchStartHandler(a)},!1);this.tierHolderHolder.addEventListener("touchmove",function(a){return e.touchMoveHandler(a)},!1);this.tierHolderHolder.addEventListener("touchend",function(a){return e.touchEndHandler(a)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(a){return e.touchCancelHandler(a)},!1);var c=function(a){if(13==a.keyCode){var h=!1;for(a=0;a<e.tiers.length;++a){var b=e.tiers[a];b.wantedLayoutHeight&&b.wantedLayoutHeight!=b.layoutHeight&&(b.layoutHeight=
b.wantedLayoutHeight,b.clipTier(),h=!0)}h&&e.arrangeTiers()}else if(32==a.keyCode||32==a.charCode)e.isSnapZooming?(e.isSnapZooming=!1,h=(e.savedZoom||20)+e.zoomMin):(e.isSnapZooming=!0,h=(e.savedZoom||0)+e.zoomMin),e.savedZoom=e.zoomSliderValue-e.zoomMin,e.zoomSliderValue=h,e.zoom(Math.exp(1*h/e.zoomExpt)),a.stopPropagation(),a.preventDefault();else if(85==a.keyCode)"opts"===e.uiMode&&(h=document.getElementById("singleBaseHightlightButton").checked,document.getElementById("singleBaseHightlightButton").checked=
!h),e.singleBaseHighlight=!e.singleBaseHighlight,e.positionRuler(),a.stopPropagation(),a.preventDefault();else if(39==a.keyCode)a.stopPropagation(),a.preventDefault(),e.scrollArrowKey(a,-1);else if(37==a.keyCode)a.stopPropagation(),a.preventDefault(),e.scrollArrowKey(a,1);else if(38==a.keyCode||87==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=e.getSelectedTier(),0>a||(h=e.tiers[a],a=h.forceHeight||h.subtiers[0].height,40<=a&&h.mergeConfig({height:a-10}));else if(a.ctrlKey||a.metaKey){if(a=
e.getSelectedTier(),!(0>a)&&(h=e.tiers[a],h.quantLeapThreshold)){var b=h.subtiers[0].height,c=h.subtiers[0].quant;c&&(a=1*c.min,c=1*c.max,b=(c-a)/b,h.mergeConfig({quantLeapThreshold:a+((Math.round((h.quantLeapThreshold-a)/b)|0)+1)*b}),h.notify("Threshold: "+B(h.quantLeapThreshold)))}}else if(a.altKey){if(c=e.selectedTiers.length,0!=c){a=e.selectedTiers[0];for(var f=!0,h=[],b=0;b<e.selectedTiers.length;++b)h.push(e.tiers[e.selectedTiers[b]]),0<b&&1!=e.selectedTiers[b]-e.selectedTiers[b-1]&&(f=!1);
if(!(f&&0>=a)){for(b=e.selectedTiers.length-1;0<=b;--b)e.tiers.splice(e.selectedTiers[b],1);e.selectedTiers.splice(0,c);c=f?a-1:a;for(b=0;b<h.length;++b)e.tiers.splice(c+b,0,h[b]),e.selectedTiers.push(c+b);e.withPreservedSelection(e._ensureTiersGrouped);e.markSelectedTiers();e.notifyTierSelection();e.reorderTiers();e.notifyTier("selected",a)}}}else if(a=e.getSelectedTier(),0<a){if(e.setSelectedTier(a-1),a=e.tiers[e.getSelectedTier()],h=a.row.offsetTop,a=h+a.row.offsetHeight,h<e.tierHolder.scrollTop||
a>e.tierHolder.scrollTop+e.tierHolder.offsetHeight)e.tierHolder.scrollTop=h}else e.notifyTierSelectionWrap(-1);else if(40==a.keyCode||83==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=e.getSelectedTier(),0>a||(h=e.tiers[a],a=h.forceHeight||h.subtiers[0].height,h.mergeConfig({height:a+10}));else if(a.ctrlKey||a.metaKey){if(a=e.getSelectedTier(),!(0>a)&&(h=e.tiers[a],h.quantLeapThreshold&&(b=h.subtiers[0].height,c=h.subtiers[0].quant)))a=1*c.min,c=1*c.max,b=(c-a)/b,c=Math.round((h.quantLeapThreshold-
a)/b)|0,1<c&&(h.mergeConfig({quantLeapThreshold:a+(c-1)*b}),h.notify("Threshold: "+B(h.quantLeapThreshold)))}else if(a.altKey){if(c=e.selectedTiers.length,0!=c){a=e.selectedTiers[0];for(var k=0,h=[],b=0;b<e.selectedTiers.length;++b)h.push(e.tiers[e.selectedTiers[b]]),0<b&&(k+=e.selectedTiers[b]-e.selectedTiers[b-1]-1);f=0==k;if(!(f&&a+c>=e.tiers.length)){for(b=e.selectedTiers.length-1;0<=b;--b)e.tiers.splice(e.selectedTiers[b],1);e.selectedTiers.splice(0,c);c=f?a+1:a+k;for(b=0;b<h.length;++b)e.tiers.splice(c+
b,0,h[b]),e.selectedTiers.push(c+b);e.withPreservedSelection(function(){e._ensureTiersGrouped(!0)});e.markSelectedTiers();e.notifyTierSelection();e.reorderTiers();e.notifyTier("selected",a)}}}else{if(a=e.getSelectedTier(),a<e.tiers.length-1&&(e.setSelectedTier(a+1),a=e.tiers[e.getSelectedTier()],h=a.row.offsetTop,a=h+a.row.offsetHeight,h<e.tierHolder.scrollTop||a>e.tierHolder.scrollTop+e.tierHolder.offsetHeight))e.tierHolder.scrollTop=Math.min(h,a-e.tierHolder.offsetHeight)}else if(187==a.keyCode||
61==a.keyCode)a.stopPropagation(),a.preventDefault(),e.zoomStep(-10);else if(189==a.keyCode||173==a.keyCode)a.stopPropagation(),a.preventDefault(),e.zoomStep(10);else if(73==a.keyCode||105==a.keyCode)a.stopPropagation(),a.preventDefault(),a=e.getSelectedTier(),0>a||(b=e.tiers[a],b.infoVisible?(b.infoElement.style.display="none",b.updateHeight(),b.infoVisible=!1):(b.infoElement.style.display="block",b.updateHeight(),b.infoVisible=!0));else if(84==a.keyCode||116==a.keyCode)if(a.shiftKey)for(a.stopPropagation(),
a.preventDefault(),a=0;a<e.tiers.length;++a)b=e.tiers[a],b.dasSource.collapseSuperGroups&&(void 0===h&&(h=!b.bumped),b.mergeConfig({bumped:h}));else a.ctrlKey||a.metaKey||(a.stopPropagation(),a.preventDefault(),a=e.getSelectedTier(),0>a||(b=e.tiers[a],b.dasSource.collapseSuperGroups&&(void 0===h&&(h=!b.bumped),b.mergeConfig({bumped:h}))));else if(77==a.keyCode||109==a.keyCode)a.stopPropagation(),a.preventDefault(),(a.ctrlKey||a.metaKey)&&1<e.selectedTiers.length&&e.mergeSelectedTiers();else if(68==
a.keyCode||100==a.keyCode){if(a.stopPropagation(),a.preventDefault(),a.ctrlKey||a.metaKey)a=e.getSelectedTier(),0>a||e.addTier(e.tiers[a].dasSource)}else if(80==a.keyCode||112==a.keyCode)if(a.ctrlKey||a.metaKey){h=[];for(a=0;a<e.selectedTiers.length;++a)h.push(e.tiers[e.selectedTiers[a]]);for(a=0;a<h.length;++a)h[a].mergeConfig({pinned:!h[a].pinned})}};this.browserHolder.addEventListener("focus",function(a){e.browserHolder.addEventListener("keydown",c,!1)},!1);this.browserHolder.addEventListener("blur",
function(a){e.browserHolder.removeEventListener("keydown",c,!1)},!1);this.hPopupHolder=a("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var h=0;h<this.sources.length;++h){var f=this.sources[h];if(f){var k={};this.restoredConfigs&&(k=this.restoredConfigs[h]);f.disabled||this.makeTier(f,k).then(function(a){e.refreshTier(a)})}}e._ensureTiersGrouped();e.arrangeTiers();
e.reorderTiers();(h=this.getSequenceSource())&&h.getSeqInfo(this.chr,function(a){e.currentSeqMax=a?a.length:-1});this.queryRegistry();for(var p in this.chains)this.queryRegistry(p,!0);if(this.hubs)for(p=0;p<this.hubs.length;++p)h=this.hubs[p],"string"==typeof h&&(h={url:h}),function(a){H(a.url,function(h,b){if(b)console.log(b);else{var c;if(c=a.genome?h.genomes[a.genome]:h.genomes[e.coordSystem.ucscName])a.mapping&&(c.mapping=a.mapping),a.label&&(c.hub.altLabel=a.label),e.hubObjects.push(c)}},a)}(h);
this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus();e.setLocation(this.chr,this.viewStart,this.viewEnd,function(){e.setSelectedTier(1);for(var a=0;a<e.initListeners.length;++a)try{e.initListeners[a].call(e)}catch(h){console.log(h)}})};m.prototype.touchStartHandler=function(a){this.touchOriginX=a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=
this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};m.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var e=a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&e!=this.touchOriginX&&this.move(e-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&(this.tierHolder.scrollTop-=a-this.touchOriginY);this.touchOriginX=e;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){e=Math.abs(a.touches[0].pageX-a.touches[1].pageX);
if(e!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var h=this.viewStart+a/this.scale|0;this.scale=e/this.zoomInitialSep*this.zoomInitialScale;this.viewStart=h-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=e}};m.prototype.touchEndHandler=function(a){};m.prototype.touchCancelHandler=function(a){};m.prototype.makeTier=function(a,e){try{return this.realMakeTier(a,e)}catch(h){console.log("Error initializing",a),console.log(h.stack||h)}};m.prototype.realMakeTier=
function(a,e){var h=this,b=null;this.tierBackgroundColors&&(b=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);var c=new k(this,a,e,b);c.oorigin=this.viewStart;var f=!1,p,u,d,A=function(a,e){var b=c.subtiers;if(b){var f=0;for(e-=c.padding;f<b.length&&e>b[f].height&&f<b.length-1;)e=e-b[f].height-c.padding,++f;if(!(f>=b.length))return b=b[f].glyphs,a-=(c.glyphCacheOrigin-h.viewStart)*h.scale,l(b,a,e)}},x=function(a){a.preventDefault();a.stopPropagation();a=a.clientX;a!=
u&&(h.move(a-u,!0),u=a);h.isDragging=!0},q=function(a){window.removeEventListener("mousemove",x,!0);window.removeEventListener("mouseup",q,!0);h.move(a.clientX-u)};c.viewport.addEventListener("mousedown",function(a){h.browserHolder.focus();a.preventDefault();c.row.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",x,!0);window.addEventListener("mouseup",q,!0);p=u=a;h.isDragging=!1},!1);c.viewport.addEventListener("mousemove",function(a){var e=c.row.getBoundingClientRect(),b=a.clientX-
e.left,z=a.clientY-e.top,e=A(b,z);c.row.style.cursor=e&&0<e.length?"pointer":"default";d&&clearTimeout(d);f||(d=setTimeout(function(){var e=A(b,z);e&&0<e.length&&h.notifyFeatureHover(a,e[e.length-1],e,c)},1E3))});var r=null;c.viewport.addEventListener("mouseup",function(a){var e=c.row.getBoundingClientRect(),b=a.clientX-e.left,e=a.clientY-e.top,f=A(b,e);f&&0<f.length&&!h.isDragging&&(r?(clearTimeout(r),r=null,h.featureDoubleClick(f,b,e)):r=setTimeout(function(){r=null;h.notifyFeature(a,f[f.length-
1],f,c)},500));if(h.isDragging&&b!=p&&c.sequenceSource){var e=h.viewStart+b/h.scale,z=h.viewStart+p/h.scale;e<z?(b=e|0,e=z|0):(b=z|0,e|=0);h.notifyRegionSelect(h.chr,b,e)}h.isDragging=!1},!1);c.viewport.addEventListener("mouseout",function(a){f=!1});c.removeButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();for(a=0;a<h.tiers.length;++a)if(h.tiers[a]===c){h.removeTier({index:a});break}},!1);c.nameButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();
if(a.shiftKey){a=-1;for(var e=0;e<h.tiers.length;++e)if(h.tiers[e]===c){a=e;break}0<=a&&(e=h.selectedTiers.indexOf(a),0<=e?h.selectedTiers.splice(e,1):(h.selectedTiers.push(a),h.selectedTiers.sort()),h.markSelectedTiers(),h.notifyTierSelection(),0<h.selectedTiers.length?h.browserHolder.focus():h.notifyTierSelectionWrap(-1))}else{for(e=0;e<h.tiers.length;++e)if(h.tiers[e]===c&&(h.browserHolder.focus(),1!=h.selectedTiers.length||h.selectedTiers[0]!=e)){h.setSelectedTier(e);return}c.infoVisible?(c.infoElement.style.display=
"none",c.updateHeight(),c.infoVisible=!1):(c.infoElement.style.display="block",c.updateHeight(),c.infoVisible=!0)}},!1);c.bumpButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();var e;c.dasSource.collapseSuperGroups&&(void 0===e&&(e=!c.bumped),c.mergeConfig({bumped:e}))},!1);var w,g,H,y,B,t=!1,ka=function(a){var e=c.label;a.stopPropagation();a.preventDefault();if(!w){g=c.pinned?h.pinnedTierHolder:h.tierHolder;H=g.scrollHeight-g.offsetHeight;w=e.cloneNode(!0);w.style.cursor=
"pointer";g.appendChild(w);e.style.visibility="hidden";for(var b=0;b<h.tiers.length;++b)if(h.tiers[b]===c){y=b;break}B=a.clientY}var f=g.getBoundingClientRect();w.style.left=e.getBoundingClientRect().left-f.left+"px";w.style.top=a.clientY-f.top+g.scrollTop-10+"px";e=a.clientY-f.top+g.scrollTop;for(b=0;b<h.tiers.length;++b)if(f=h.tiers[b],!(f.pinned^c.pinned)&&(f=f.row.getBoundingClientRect(),e-=f.bottom-f.top,0>e)){if(b<y&&a.clientY<B||b>y&&a.clientY>B){h.withPreservedSelection(function(){h.tiers.splice(y,
1);h.tiers.splice(b,0,c);h._ensureTiersGrouped(b>y)});for(e=0;e<h.tiers.length;++e)h.tiers[e]==c&&(y=e);B=a.clientY;h.reorderTiers();g.appendChild(w);t=!0}break}w.offsetTop<g.scrollTop?g.scrollTop-=g.scrollTop-w.offsetTop:w.offsetTop+w.offsetHeight>g.scrollTop+g.offsetHeight&&(g.scrollTop=Math.min(g.scrollTop+(w.offsetTop+w.offsetHeight)-(g.scrollTop+g.offsetHeight),H))},I=function(a){var e=c.label;a.stopPropagation();a.preventDefault();w&&(w.style.cursor="auto",g.removeChild(w),w=null,e.style.visibility=
"visible");document.removeEventListener("mousemove",ka,!1);document.removeEventListener("mouseup",I,!1);if(t){for(a=0;a<h.tiers.length;++a)if(h.tiers[a]==c){h.setSelectedTier(a);break}h.notifyTier("reordered",c)}};c.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();t=!1;document.addEventListener("mousemove",ka,!1);document.addEventListener("mouseup",I,!1)},!1);this.tiers.push(c);return c.init().then(function(a){a.currentlyHeight=50;h.updateHeight();a.updateLabel();
h.withPreservedSelection(h._ensureTiersGrouped);a._updateFromConfig();h.reorderTiers();return a})};m.prototype.reorderTiers=function(){b(this.tierHolder);b(this.pinnedTierHolder);this.disablePinning&&(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var a=!1,e=[],h=[],c=0;c<this.tiers.length;++c){var f=this.tiers[c];f.pinned&&!this.disablePinning?(e.push(f),this.pinnedTierHolder.appendChild(this.tiers[c].row),a=!0):(h.push(f),this.tierHolder.appendChild(this.tiers[c].row))}this.withPreservedSelection(function(){this.tiers.splice(0,
this.tiers.length);for(var a=0;a<e.length;++a)this.tiers.push(e[a]);for(a=0;a<h.length;++a)this.tiers.push(h[a])});a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};m.prototype.withPreservedSelection=function(a){for(var e=[],h=0;h<this.selectedTiers.length;++h)e.push(this.tiers[this.selectedTiers[h]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=e.indexOf(this.tiers[a])&&
this.selectedTiers.push(a)};m.prototype.refreshTier=function(a,b){b=b||e;this.knownSpace&&this.knownSpace.invalidate(a,b)};m.prototype._ensureTiersGrouped=function(a){for(var e={},h=0;h<this.tiers.length;++h){var b=this.tiers[h];b.dasSource.tierGroup&&pusho(e,b.dasSource.tierGroup,b)}var c=[];a&&this.tiers.reverse();for(h=0;h<this.tiers.length;++h)if(b=this.tiers[h],b.dasSource.tierGroup){var f=e[b.dasSource.tierGroup];if(f){a&&f.reverse();for(var k=0;k<f.length;++k)c.push(f[k]);e[b.dasSource.tierGroup]=
null}}else c.push(b);a&&c.reverse();this.tiers.splice(0,this.tiers.length);for(k=0;k<c.length;++k)this.tiers.push(c[k])};m.prototype.arrangeTiers=function(){for(var e=[],b={},h=0;h<this.tiers.length;++h){var c=this.tiers[h];c.pinned&&(e.push(c),c.dasSource.tierGroup&&pusho(b,c.dasSource.tierGroup,c))}for(h=0;h<this.tiers.length;++h)c=this.tiers[h],c.pinned||(e.push(c),c.dasSource.tierGroup&&pusho(b,c.dasSource.tierGroup,c));for(var f in b){var c=b[f],k=this.tierGroups[f];k||(k={element:a("div",a("span",
f,{className:"tier-group-label"}),{className:"tier-group"})},this.tierGroups[f]=k);k.element.parentNode&&k.element.parentNode.removeChild(k.element);for(var p=c[0].pinned?this.pinnedTierHolder:this.tierHolder,u=1E7,d=0,h=0;h<c.length;++h)var A=c[h].row,u=Math.min(u,A.offsetTop),d=Math.max(d,A.offsetTop+A.offsetHeight);k.element.style.top=u+"px";k.element.style.left="0px";k.element.style.height=d-u+"px";p.appendChild(k.element)}if(this.tierBackgroundColors)for(h=0;h<e.length;++h)c=e[h],c.setBackground(this.tierBackgroundColors[h%
this.tierBackgroundColors.length]),c.label.style.left=c.dasSource.tierGroup?"18px":"2px",c.background=this.tierBackgroundColors[h%this.tierBackgroundColors.length]};m.prototype.refresh=function(){this.retrieveTierData(this.tiers,e);this.drawOverlays();this.positionRuler()};var e=function(a,e){e.draw();e.updateStatus(a)};m.prototype.retrieveTierData=function(a,e){this.notifyLocation();var h=100/this.scale|0,b=1E3/this.scale|0,c=(this.viewStart+this.viewEnd)/2,f=c-this.origin;this.origin=c;this.scaleAtLastRedraw=
this.scale;for(c=0;c<a.length;++c){var k=f;a[c].originHaxx&&(k+=a[c].originHaxx);a[c].originHaxx=k}f=this.targetQuantRes/this.scale;c=Math.max(1,(this.viewStart|0)-h);h=Math.min((this.viewEnd|0)+h,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);k=Math.max(1,(this.viewStart|0)-b);b=Math.min((this.viewEnd|0)+b,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var p=this.getSequenceSource();this.knownSpace&&this.knownSpace.cancel();this.knownSpace=
new J(this.tiers,this.chr,k,b,f,p)}(p=this.knownSpace.bestCacheOverlapping(this.chr,c,h))&&p.min<=c&&p.max>=h?(this.drawnStart=Math.max(p.min,k),this.drawnEnd=Math.min(p.max,b)):(this.drawnStart=k,this.drawnEnd=b);this.knownSpace.retrieveFeatures(a,this.chr,this.drawnStart,this.drawnEnd,f,e)};m.prototype.queryRegistry=function(a,e){if(this.registry){var h,b;a?(h=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new c),b=this.mappableSources[a]):(h=this.coordSystem,b=this.availableSources);
var k=r(f(h));if(e){var p=localStorage["dalliance.registry."+k+".last_queried"];if(p)try{if(g(b,JSON.parse(localStorage["dalliance.registry."+k+".sources"]),a),432E5>(Date.now()|0)-(p|0))return}catch(u){console.log("Bad registry cache: "+u)}}p=this.registry;if(0==p.indexOf("//")){var d=window.location.protocol;"https:"!=d&&"http:"!=d&&(p="http:"+p)}(new U(p)).sources(function(e){for(var c=[],f=0;f<e.length;++f){var p=e[f];if(p.coords&&0!=p.coords.length){var u=p.coords[0];u.taxon==h.taxon&&u.auth==
h.auth&&u.version==h.version&&c.push(p)}}localStorage["dalliance.registry."+k+".sources"]=JSON.stringify(c);localStorage["dalliance.registry."+k+".last_queried"]=""+Date.now();g(b,c,a)},function(a){},h)}};m.prototype.move=function(a,e){var h=this.viewEnd-this.viewStart,b=this.viewStart-1*a/this.scale,c=b+h;e||(0<this.currentSeqMax&&c>this.currentSeqMax&&(c=this.currentSeqMax,b=this.viewEnd-h),1>b&&(b=1,c=b+h));this.setLocation(null,b,c,null,e)};m.prototype.zoomStep=function(a){var e=1*this.zoomSliderValue;
a=e+a;a<this.zoomMin&&(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=e&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};m.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&
(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.notifyLocation();this.refresh()};m.prototype.spaceCheck=function(a){this.knownSpace&&this.knownSpace.chr===this.chr?(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};m.prototype.resizeViewer=
function(a){var e=this.tierHolder.getBoundingClientRect().width|0;if(0!=e){var h=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=e|0;h!=this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/
h,e=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-e+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+e-1),this.positionRuler(),a||this.spaceCheck(),this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};m.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(300,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-
20)+"px"};m.prototype.addTier=function(a){var e=this;a=p(a);a.disabled=!1;return this.makeTier(a).then(function(a){e.refreshTier(a);e.markSelectedTiers();e.positionRuler();e.notifyTier("added",a);return a})};m.prototype.removeTier=function(a,e){var h=-1;if("undefined"!==typeof a.index&&0<=a.index&&a.index<this.tiers.length)h=a.index;else for(var b=0;b<this.tiers.length;++b)if(F(a,this.tiers[b].dasSource)){h=b;break}if(0>h)throw"Couldn't find requested tier";b=this.tiers[h];this.tiers.splice(h,1);
for(var c=[],f=0;f<this.selectedTiers.length;++f){var k=this.selectedTiers[f];k<h?c.push(k):k>h&&c.push(k-1)}this.selectedTiers=c;this.markSelectedTiers();b.destroy();this.knownSpace&&(this.knownSpace.featureCache[b]=null);this.reorderTiers();this.notifyTier("removed",b)};m.prototype.removeAllTiers=function(){var a=this;this.selectedTiers=[];this.markSelectedTiers();this.tiers.forEach(function(e){e.destroy();a.knownSpace&&(a.knownSpace.featureCache[e]=null)});this.tiers.length=0;this.reorderTiers();
this.notifyTier("removedAll",null)};m.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};m.prototype._getSequenceSource=function(){for(var a=0;a<this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;for(a=0;a<this.defaultSources.length;++a){var e=this.defaultSources[a];if(e.provides_entrypoints||"sequence"==e.tier_type||e.twoBitURI||e.twoBitBlob)return e.twoBitURI||
e.twoBitBlob?new x(e):e.ensemblURI?new A(e):new P(e)}};m.prototype.setLocation=function(a,e,h,b,c){if("number"!==typeof e)throw Error("minimum must be a number (got "+JSON.stringify(e)+")");if("number"!==typeof h)throw Error("maximum must be a number (got "+JSON.stringify(h)+")");if(e>h){var f=e;e=h;h=f}else e===h&&(h+=1);b||(b=function(a){if(a)throw a;});var k=this;if((!a||a==this.chr)&&0<this.currentSeqMax)return this._setLocation(null,e,h,null,b,c);var p=this.getSequenceSource();if(!p)return b("Need a sequence source");
var u=a||this.chr;p.getSeqInfo(u,function(f){if(f)return k._setLocation(a,e,h,f,b,c);var d;d=0==u.indexOf("chr")?u.substr(3):"chr"+u;p.getSeqInfo(d,function(f){return!f&&a?b("Couldn't find sequence '"+a+"'"):f?k._setLocation(d,e,h,f,b,c):k._setLocation(null,e,h,null,b,c)})})};m.prototype._setLocation=function(a,e,h,b,c,f){var k=!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(k=!0),this.chr=a,this.currentSeqMax=b.length);e=parseFloat(e);h=parseFloat(h);a=Math.max(10,h-e+1);f||(f=this.currentSeqMax,
0>=f&&(f=1E12),1>e&&(e=1,h=e+a-1),h>f&&(h=f,e=Math.max(1,h-a+1)));this.viewStart=e;this.viewEnd=h;e=Math.max(this.featurePanelWidth||this.offscreenInitWidth,50)/(this.viewEnd-this.viewStart);f=1E-6<Math.abs(e-this.scale);this.scale=e;h=this.zoomSliderValue;this.zoomSliderValue=e=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);if(f||k){for(k=0;k<this.tiers.length;++k)this.tiers[k].viewportHolder.style.left="5000px",this.tiers[k].overlay.style.left="5000px";this.refresh();this.savedZoom?
(e-=this.zoomMin,h-=this.zoomMin,k=e-this.savedZoom,Math.abs(e-h)>Math.abs(k)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=h)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(k=0;k<this.tiers.length;++k)this.tiers[k].viewportHolder.style.left=""+((-((this.viewStart-this.tiers[k].norigin)*this.scale)|0)-1E3)+"px",this.tiers[k].drawOverlay();this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return c()};m.prototype.setCenterLocation=
function(a,e){var h=(this.viewEnd-this.viewStart)/2;this.setLocation(a,e-h,e+h)};m.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=0,e=0;e<this.tiers.length;++e)"none"!==this.tiers[e].loaderButton.style.display&&++a;0==a&&(a=Date.now()|0,console.log("Loading took "+(a-this.activityStartTime)+"ms"),this.activityStartTime=null)}};m.prototype.addInitListener=function(a){this.initListeners.push(a)};m.prototype.addFeatureListener=function(a,e){this.featureListeners.push(a)};
m.prototype.removeFeatureListener=function(a,e){var h=arrayIndexOf(this.featureListeners,a);0<=h&&this.featureListeners.splice(h,1)};m.prototype.notifyFeature=function(a,e,h,b){for(var c=0;c<this.featureListeners.length;++c)try{if(this.featureListeners[c](a,e,h,b))break}catch(f){console.log(f.stack)}};m.prototype.addFeatureHoverListener=function(a,e){this.featureHoverListeners.push(a)};m.prototype.removeFeatureHoverListener=function(a,e){var h=arrayIndexOf(this.featureHoverListeners,a);0<=h&&this.featureHoverListeners.splice(h,
1)};m.prototype.notifyFeatureHover=function(a,e,h,b){for(var c=0;c<this.featureHoverListeners.length;++c)try{this.featureHoverListeners[c](a,e,h,b)}catch(f){console.log(f.stack)}};m.prototype.addViewListener=function(a,e){this.viewListeners.push(a)};m.prototype.removeViewListener=function(a,e){var h=arrayIndexOf(this.viewListeners,a);0<=h&&this.viewListeners.splice(h,1)};m.prototype.notifyLocation=function(){var a=Math.max(1,this.viewStart|0),e=this.viewEnd|0;0<this.currentSeqMax&&e>this.currentSeqMax&&
(e=this.currentSeqMax);for(var h=0;h<this.viewListeners.length;++h)try{this.viewListeners[h](this.chr,a,e,this.zoomSliderValue,{current:this.zoomSliderValue,alternate:this.savedZoom+this.zoomMin||this.zoomMin,isSnapZooming:this.isSnapZooming,min:this.zoomMin,max:this.zoomMax},this.viewStart,this.viewEnd)}catch(b){console.log(b.stack)}};m.prototype.addTierListener=function(a){this.tierListeners.push(a)};m.prototype.removeTierListener=function(a){a=arrayIndexOf(this.tierListeners,a);0<=a&&this.tierListeners.splice(a,
1)};m.prototype.notifyTier=function(a,e){for(var h=0;h<this.tierListeners.length;++h)try{this.tierListeners[h](a,e)}catch(b){console.log(b.stack)}};m.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};m.prototype.removeRegionSelectListener=function(a){a=arrayIndexOf(this.regionSelectListeners,a);0<=a&&this.regionSelectListeners.splice(a,1)};m.prototype.notifyRegionSelect=function(a,e,h){for(var b=0;b<this.regionSelectListeners.length;++b)try{this.regionSelectListeners[b](a,
e,h)}catch(c){console.log(c.stack)}};m.prototype.highlightRegion=function(a,e,h){var b=this;if(a==this.chr)return this._highlightRegion(a,e,h);var c=this.getSequenceSource();if(!c)throw"Need a sequence source";c.getSeqInfo(a,function(f){if(f)return b._highlightRegion(a,e,h);var k;k=0==a.indexOf("chr")?a.substr(3):"chr"+a;c.getSeqInfo(k,function(a){if(a)return b._highlightRegion(k,e,h)})})};m.prototype._highlightRegion=function(a,e,h){for(var b=0;b<this.highlights.length;++b){var c=this.highlights[b];
if(c.chr==a&&c.min==e&&c.max==h)return}this.highlights.push(new n(a,e,h));b=this.viewStart-1E3/this.scale;c=this.viewEnd+1E3/this.scale;(a==this.chr||a=="chr"+this.chr)&&e<c&&h>b&&this.drawOverlays();this.notifyLocation()};m.prototype.clearHighlights=function(){this.highlights=[];this.drawOverlays();this.notifyLocation()};m.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};m.prototype.featuresInRegion=function(a,e,h){var b=[];if(a!==this.chr)return[];
for(a=0;a<this.tiers.length;++a)for(var c=this.tiers[a].currentFeatures||[],f=0;f<c.length;++f){var k=c[f];k.min<=h&&k.max>=e&&b.push(k)}return b};m.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};m.prototype.setSelectedTier=function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};m.prototype.markSelectedTiers=function(){for(var a=0;a<this.tiers.length;++a){var e=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?
e.classList.add("active"):e.classList.remove("active")}0<this.selectedTiers.length&&(a=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/2,a>document.body.scrollTop&&a+100<document.body.scrollTop+window.innerHeight&&this.browserHolder.focus())};m.prototype.addTierSelectionListener=function(a){this.tierSelectionListeners.push(a)};m.prototype.removeTierSelectionListener=function(a){a=arrayIndexOf(this.tierSelectionListeners,a);0<=a&&this.tierSelectionListeners.splice(a,1)};m.prototype.notifyTierSelection=
function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(e){console.log(e.stack)}};m.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};m.prototype.removeTierSelectionWrapListener=function(a){a=arrayIndexOf(this.tierSelectionWrapListeners,a);0<=a&&this.tierSelectionWrapListeners.splice(a,1)};m.prototype.notifyTierSelectionWrap=function(a){for(var e=0;e<this.tierSelectionWrapListeners.length;++e)try{this.tierSelectionWrapListeners[e](a)}catch(h){console.log(h.stack)}};
m.prototype.positionRuler=function(){var a="none",e="",h="";"center"==this.rulerLocation?(a="block",e=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",e="0px"):"right"==this.rulerLocation?(a="block",h="0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=e;this.ruler.style.right=h;this.singleBaseHighlight?(this.ruler2.style.display="block",this.ruler2.style.borderWidth="1px",1>this.scale?(this.ruler2.style.width="0px",this.ruler2.style.borderRightWidth="0px"):
(this.ruler2.style.width=this.scale+"px",this.ruler2.style.borderRightWidth="1px"),this.locSingleBase.style.visibility="visible",this.locSingleBase.style.left=""+(this.featurePanelWidth/2-this.locSingleBase.offsetWidth/2+this.ruler2.offsetWidth/2|0)+"px"):(this.locSingleBase.style.visibility="hidden",this.ruler2.style.width="1px",this.ruler2.style.borderWidth="0px",this.ruler2.style.display="center"==this.rulerLocation?"none":"block");this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var b=
0;b<this.tiers.length;++b){var c=this.tiers[b],f=c.quantOverlay,k;c.subtiers&&0<c.subtiers.length&&(k=c.subtiers[0].quant);f&&(f.style.display=k?a:"none",f.style.left=e,f.style.right=h)}};m.prototype.featureDoubleClick=function(a,e,h){if(a&&0!=a.length&&(h=a[a.length-1],h.min&&h.max)){var b=((h.min|0)-(this.viewStart|0))*this.scale,c=(h.max-h.min+1)*this.scale;a=((h.min|0)+(h.max|0))/2;10<c&&(e=1*(e-b)/c,0.3>e?a=h.min|0:0.7<e&&(a=(h.max|0)+1));e=this.viewEnd-this.viewStart;this.setLocation(null,a-
e/2,a+e/2)}};m.prototype.zoomForScale=function(a){return 0.2<a?"high":0.01<a?"medium":"low"};m.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};m.prototype.updateHeight=function(){for(var a=0,e=0;e<this.tiers.length;++e)a+=this.tiers[e].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px";this.browserHolder.style.display="block";this.browserHolder.style.display="-webkit-flex";this.browserHolder.style.display="flex"};m.prototype.scrollArrowKey=
function(a,e){this.reverseKeyScrolling&&(e=-e);if(a.ctrlKey||a.metaKey){var h=!1;a.shiftKey&&(h=!0);this.leap(e,h)}else if(1<this.scale){var h=(this.viewStart+this.viewEnd)/2,h=h-Math.round(h),b=1;a.shiftKey&&(b*=10);0<e?(b=-b-h,0<h&&(b+=1)):(b-=h,0>h&&(b-=1));this.setLocation(null,this.viewStart+b,this.viewEnd+b)}else this.move(a.shiftKey?100*e:25*e)};m.prototype.leap=function(a,e){var h=this,b=(h.viewStart+h.viewEnd+1)/2|0;0<a&&1>=h.viewStart?b-=1E8:0>a&&h.viewEnd>=h.currentSeqMax&&(b+=1E8);var c=
h.getSelectedTier();0>c||((c=h.tiers[c])&&(c.featureSource&&this.sourceAdapterIsCapable(c.featureSource,"quantLeap")&&"number"==typeof c.quantLeapThreshold||c.featureSource&&this.sourceAdapterIsCapable(c.featureSource,"leap"))?c.findNextFeature(h.chr,b,-a,e,function(c){if(c){var f=c.min,k=c.max;e&&(0<a?f>b+1?k=f:(k++,f=k):k<b-1?(k++,f=k):k=f);var p=h.viewEnd-h.viewStart+1;parseFloat(p/2)==parseInt(p/2)&&p--;f=(f+k-p)/2+1;h.setLocation(c.segment,f,f+p-1)}else alert("no next feature")}):this.move(100*
a))};m.prototype.nameForCoordSystem=function(a){var e=null,h=null;this.assemblyNamePrimary&&(e=""+a.auth,"undefined"!==typeof a.version&&(e+=a.version));this.assemblyNameUcsc&&(h=a.ucscName);return null!=e&&null!=h?e+"/"+h:e||h||"unknown"};m.prototype.makeLoader=function(e){var b=1<window.devicePixelRatio;return 20>(e||16)?a("img",null,{src:this.resolveURL("$$img/spinner_"+(b?16:32)+".gif"),width:"16",height:"16"}):a("img",null,{src:this.resolveURL("$$img/spinner_"+(b?24:48)+".gif"),width:"24",height:"24"})};
m.prototype.canFetchPlainHTTP=function(){var a=this;if(!this._plainHTTPPromise){var e=this.getWorker();this._plainHTTPPromise=e?new y(function(h,b){e.postCommand({command:"textxhr",uri:a.httpCanaryURL},function(a,e){a?h(!0):h(!1)})}):new y(function(e,b){q(a.httpCanaryURL,function(a,b){a?e(!0):e(!1)},{timeout:2E3})})}return this._plainHTTPPromise};m.prototype.getWorker=function(){if(!this.useFetchWorkers||!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&
(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};m.prototype.registerResolver=function(a){var e="res"+ ++this.resolverSeed;this.resolvers[e]=a;return e};t.prototype.postCommand=function(a,e,h){var b="x"+ ++this.tagSeed;a.tag=b;this.callbacks[b]=e;this.worker.postMessage(a,h)};if("undefined"!==typeof v){v.exports={Browser:m};d("./browser-ui");d("./track-adder");d("./feature-popup");d("./tier-actions");d("./domui");d("./search");v=d("./sourceadapters");var x=v.TwoBitSequenceSource,A=
v.EnsemblSequenceSource,P=v.DASSequenceSource,J=d("./kspace").KnownSpace,U=d("./das").DASRegistry}E.prototype.get=function(a){var e=this.sourcesByURI[L(a)];if(e)for(var h=0;h<e.configs.length;++h)if(u(e.configs[h],a))return e.sources[h]};E.prototype.put=function(a,e){var h=L(a),b=this.sourcesByURI[h];b||(b={configs:[],sources:[]},this.sourcesByURI[h]=b);b.configs.push(a);b.sources.push(e)}},{"./browser-ui":5,"./chainset":7,"./das":10,"./domui":11,"./feature-popup":19,"./kspace":23,"./numformats":26,
"./search":30,"./sha1":33,"./sourceadapters":34,"./sourcecompare":35,"./thub":42,"./tier":45,"./tier-actions":43,"./track-adder":46,"./utils":49,"./version":51,"es6-promise":53}],7:[function(d,v,s){function n(a,b,c,k){"string"==typeof a?(this.uri=a,this.srcTag=b,this.destTag=c,this.coords=k):(this.uri=a.uri,this.srcTag=a.srcTag,this.destTag=a.destTag,this.coords=f(a.coords),this.type=a.type,this.credentials=a.credentials);this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={};this.fetchedTiles=
{};this.granularity=1E6;this.chainFetcher="bigbed"==this.type?new g(this.uri,this.credentials):"alias"==this.type?new E(a):new m(this.uri,this.srcTag,this.destTag)}function m(a,b,f){this.source=new c(a);this.srcTag=b;this.destTag=f}function g(a,b){var c=this;this.uri=a;this.credentials=b;this.bwg=new r(function(a,b){k(new q(c.uri,{credentials:c.credentials,resolver:c.resolver}),function(c,f){c?a(c):b(f)})});this.bwg.then(function(a,b){b&&console.log(b)})}function l(a){return parseInt(a)}function t(a){return 0==
a.indexOf("chr")?a.substr(3):a}function C(a){var b={srcChr:t(a.srcChrom),srcMin:parseInt(a.srcStart),srcMax:parseInt(a.srcEnd),srcOri:a.srcOri,destChr:t(a.segment),destMin:a.min-1,destMax:a.max,destOri:a.ori,blocks:[]},c=a.srcStarts.split(",").map(l),f=a.destStarts.split(",").map(l);a=a.blockLens.split(",").map(l);for(var k=0;k<c.length;++k)b.blocks.push([c[k],f[k],a[k]]);return b}function E(a){this.conf=a;this.forwardAliases={};a=a.sequenceAliases||[];for(var b=0;b<a.length;++b){var c=a[b];if(!(2>
c.length)){for(var f=[],k=0;k<c.length-1;++k)f.push(c[k]);this.forwardAliases[c[c.length-1]]=f}}}if("undefined"!==typeof d){s=d("./das");var c=s.DASSource,a=s.DASSegment;s=d("./utils");var b=s.pusho,f=s.shallowCopy,p=d("./cigar").parseCigar,q=d("./bin").URLFetchable,k=d("./bigwig").makeBwg,r=d("es6-promise").Promise}n.prototype.exportConfig=function(){return{uri:this.uri,srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};n.prototype.mapPoint=function(a,
b){for(var c=this.chainsBySrc[a]||[],f=0;f<c.length;++f){var k=c[f];if(b>=k.srcMin&&b<=k.srcMax){var p;p="-"==k.srcOri?k.srcMax-b:b-k.srcMin;for(var d=k.blocks,u=0;u<d.length;++u){var q=d[u],e=q[0],x=q[1],q=q[2];if(p>=e&&p<=e+q)return c=p-e,{seq:k.destChr,pos:"-"==k.destOri?k.destMax-x-c:c+x+k.destMin,flipped:k.srcOri!=k.destOri}}}}return null};n.prototype.mapSegment=function(a,b,c){a=this.chainsBySrc[a]||[];for(var f=[],k=0;k<a.length;++k){var p=a[k];if(c>=p.srcMin&&b<=p.srcMax){var d,u;"-"==p.srcOri?
(d=p.srcMax-c,u=p.srcMax-b):(d=b-p.srcMin,u=c-p.srcMin);for(var q=p.blocks,e=0;e<q.length;++e){var x=q[e],A=x[0],r=x[1],x=x[2];if(u>=A&&d<=A+x){var g={segment:p.destChr,flipped:"-"==p.srcOri^"-"==p.destOri};"-"==p.destOri?(d>=A?g.max=p.destMax-r-d+A:(g.max=p.destMax-r,g.partialMax=A-d),u<=A+x?g.min=p.destMax-r-u+A:(g.min=p.destMax-r-x,g.partialMin=u-A-x)):(d>=A?g.min=p.destMin+r+d-A:(g.min=p.destMin+r,g.partialMin=A-d),u<=A+x?g.max=p.destMin+r+u-A:(g.max=p.destMin+r+x,g.partialMax=u-A-x));f.push(g)}}}}return f};
n.prototype.unmapPoint=function(a,b){for(var c=this.chainsByDest[a]||[],f=0;f<c.length;++f){var k=c[f];if(b>=k.destMin&&b<=k.destMax){var p;p="-"==k.srcOri?k.destMax-b:b-k.destMin;for(var d=k.blocks,u=0;u<d.length;++u){var q=d[u],e=q[0],x=q[1],q=q[2];if(p>=x&&p<=x+q)return c=p-x,f=c+e+k.srcMin,f="-"==k.destOri?k.srcMax-e-c:c+e+k.srcMin,{seq:k.srcChr,pos:f,flipped:k.srcOri!=k.destOri}}}}return null};n.prototype.sourceBlocksForRange=function(c,f,k,p){for(var d=this,q=f/this.granularity|0,r=k/this.granularity|
0,u=!1,g=q;g<=r;++g){var e=c+"_"+g;2!=this.fetchedTiles[e]&&(u=!0,1!=this.fetchedTiles[e]&&(this.fetchedTiles[e]=1))}if(u)this.postFetchQueues[c]||this.chainFetcher.fetchChains(c,q*this.granularity,(r+1)*this.granularity-1).then(function(a){d.chainsByDest||(d.chainsByDest[c]=[]);for(var e=0;e<a.length;++e){var h=a[e],b=d.chainsBySrc[h.srcChr];if(b){for(var f=!1,k=0;k<b.length;++k){var p=b[k];if(p.srcMin==h.srcMin&&p.srcMax==h.srcMax){f=!0;break}}f||b.push(h)}else d.chainsBySrc[h.srcChr]=[h];if(b=
d.chainsByDest[h.destChr]){f=!1;for(k=0;k<b.length;++k)if(p=b[k],p.destMin==h.destMin&&p.destMax==h.destMax){f=!0;break}f||b.push(h)}else d.chainsByDest[h.destChr]=[h]}for(a=q;a<=r;++a)d.fetchedTiles[c+"_"+a]=2;if(d.postFetchQueues[c]){a=d.postFetchQueues[c];for(e=0;e<a.length;++e)a[e]();d.postFetchQueues[c]=null}}).catch(function(a){console.log(a)}),b(this.postFetchQueues,c,function(){d.sourceBlocksForRange(c,f,k,p)});else{u=[];g=this.chainsByDest[c]||[];for(e=0;e<g.length;++e){var x=g[e];if(f<=
x.destMax&&k>=x.destMin){var A,t;"-"==x.srcOri?(A=x.destMax-k,t=x.destMax-f):(A=f-x.destMin,t=k-x.destMin);for(var l=x.blocks,m=0;m<l.length;++m){var z=l[m],n=z[0],h=z[1],K=z[2];t>=h&&A<=h+K&&(z=Math.max(A,h)-h,h=Math.min(t,h+K)-h,"-"==x.destOri?u.push(new a(x.srcChr,x.srcMax-n-h,x.srcMax-n-z)):u.push(new a(x.srcChr,x.srcMin+z+n,x.srcMin+h+n)))}}}p(u)}};m.prototype.fetchChains=function(a,b,c){var f=this;return new r(function(b,c){f.source.alignments(a,{},function(a){for(var c=[],k=0;k<a.length;++k)for(var e=
a[k],d=0;d<e.blocks.length;++d){for(var A=e.blocks[d],q,r,g=0;g<A.segments.length;++g){var z=A.segments[g],t=e.objects[z.object];t.dbSource===f.srcTag?q=z:t.dbSource===f.destTag&&(r=z)}if(q&&r){for(var A={srcChr:e.objects[q.object].accession,srcMin:q.min|0,srcMax:q.max|0,srcOri:q.strand,destChr:e.objects[r.object].accession,destMin:r.min|0,destMax:r.max|0,destOri:r.strand,blocks:[]},g=p(q.cigar),z=p(r.cigar),h=t=0,K=0,y=0;K<g.length&&y<z.length;)if("M"==g[K].op&&"M"==z[y].op){var l=Math.min(g[K].cnt,
z[y].cnt);A.blocks.push([t,h,l]);g[K].cnt==l?++K:g[K].cnt-=l;z[y].cnt==l?++y:z[y]-=l;t+=l;h+=l}else"I"==g[K].op?h+=g[K++].cnt:"I"==z[y].op&&(t+=z[y++].cnt);c.push(A)}}b(c)})})};g.prototype.fetchChains=function(a,b,c){return this.bwg.then(function(f,k){if(!f)throw Error("No BWG");return new r(function(k,p){f.getUnzoomedView().readWigData(a,b,c,function(a){k(a.map(C))})})})};E.prototype.fetchChains=function(a,b,c){b=[];c=this.forwardAliases[a]||[];for(var f=0;f<c.length;++f)b.push({srcChr:c[f],srcMin:1,
srcMax:1E9,srcOri:"+",destChr:a,destMin:1,destMax:1E9,destOri:"+",blocks:[[1,1,1E9]]});return r.resolve(b)};"undefined"!==typeof v&&(v.exports={Chainset:n})},{"./bigwig":3,"./bin":4,"./cigar":8,"./das":10,"./utils":49,"es6-promise":53}],8:[function(d,v,s){function n(d){for(var l=[],t;null!=(t=m.exec(d));){var n=t[1];0==n.length&&(n=1);l.push({cnt:n|0,op:t[2]})}return l}var m=/([0-9]*)([MIDS])/g;"undefined"!==typeof v&&(v.exports={parseCigar:n})},{}],9:[function(d,v,s){function n(a,b,c,p){this.red=
a|0;this.green=b|0;this.blue=c|0;p&&(this.name=p)}function m(a){a="00"+a.toString(16);return a.substring(a.length-2)}function g(a){var b=C[a];b||((b=E.exec(a))?b=new n("0x"+b[1]|0,"0x"+b[2]|0,"0x"+b[3]|0,a):(b=c.exec(a))?b=new n(b[1]|0,b[2]|0,b[3]|0,a):(console.log("couldn't handle color: "+a),b=C.black),C[a]=b);return b}function l(a,b,c){for(var p=[],d=0;d<c.length;++d)p.push(g(c[d]));c=[];d=0;a:for(;d<a;++d){for(var k=b[0]+1*d/(a-1)*(b[b.length-1]-b[0]),r=0;r<b.length-1;++r)if(k>=b[r]&&k<=b[r+1]){var k=
(k-b[r])/(b[r+1]-b[r]),t=p[r],r=p[r+1],r=(new n(t.red*(1-k)+r.red*k|0,t.green*(1-k)+r.green*k|0,t.blue*(1-k)+r.blue*k|0)).toSvgString();c.push(r);continue a}throw"Bad step";}return c}function t(a,b,c,p){return p?l(a,[0,0.5,1],[b,c,p]):l(a,[0,1],[b,c])}n.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};n.prototype.toHexString=function(){return"#"+m(this.red)+m(this.green)+m(this.blue)};var C={red:new n(255,0,0,"red"),green:new n(0,
255,0,"green"),blue:new n(0,0,255,"blue"),yellow:new n(255,255,0,"yellow"),white:new n(255,255,255,"white"),black:new n(0,0,0,"black"),gray:new n(180,180,180,"gray"),grey:new n(180,180,180,"grey"),lightskyblue:new n(135,206,250,"lightskyblue"),lightsalmon:new n(255,160,122,"lightsalmon"),hotpink:new n(255,105,180,"hotpink")},E=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,c=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;"undefined"!==typeof v&&(v.exports={makeColourSteps:l,makeGradient:t,dasColourForName:g})},
{}],10:[function(d,v,s){function n(a,b,e,c){this.name=a;this.start=b;this.end=e;this.description=c}function m(a,b){var e;"string"==typeof a?(this.uri=a,e=b||{}):e=a||{};for(var c in e)"function"!=typeof e[c]&&(this[c]=e[c]);this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function g(){}function l(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}function t(a,b,e,c,f){this.name=
a;this.start=b;this.end=e;this.alphabet=c;this.seq=f}function C(){}function E(a){a&&(this.id=a)}function c(a,b){this.desc=a;this.uri=b}function a(a){this.type=a;this.objects={};this.blocks=[]}function b(){this.styles=[]}function f(){}function p(a,b){b=b||{};this.uri=a;this.opts=b}function q(a,b){var e=a.getElementsByTagName(b);if(0<e.length&&e[0].firstChild){e=e[0];if(1==e.childNodes.length)return e.firstChild.nodeValue;for(var c="",f=0;f<e.childNodes.length;++f)c+=e.childNodes[f].nodeValue;return c}return null}
function k(a){for(var b=[],e=a.getElementsByTagName("LINK"),f=0;f<e.length;++f){var k=e[f];k.parentNode==a&&b.push(new c(k.firstChild?k.firstChild.nodeValue:"Unknown",k.getAttribute("href")))}return b}function r(a){var b=[];a=a.getElementsByTagName("NOTE");for(var e=0;e<a.length;++e)a[e].firstChild&&b.push(a[e].firstChild.nodeValue);return b}function H(a,b,e,c){if(window.XDomainRequest){var f=new XDomainRequest;f.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(f.responseText);
b(a)};f.open("get",a);f.send("")}else try{var f=new XMLHttpRequest,k=setTimeout(function(){console.log("timing out "+a);f.abort();b(null,f)},5E3);f.timeout=5E3;f.ontimeout=function(){console.log("timeout on "+a)};f.onreadystatechange=function(){4==f.readyState&&(clearTimeout(k),(200<=f.status||0==f.status)&&b(f.responseXML,f))};f.open("get",a,!0);e&&(f.withCredentials=!0);c&&f.setRequestHeader("X-DAS-Authorisation",c);f.overrideMimeType("text/xml");f.setRequestHeader("Accept","application/xml,*/*");
f.send("")}catch(p){b(null,f,p)}}function Q(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function B(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function w(a){var b=I(a);b.styles=[];for(var e=0;e<a.styles.length;++e){var c=b.styles[e]=I(a.styles[e]);c._methodRE=c._labelRE=c._typeRE=void 0;c.style=I(c.style);c.style.id=void 0;c.style._gradient=void 0}return b}if("undefined"!==typeof d){s=d("./utils");var I=s.shallowCopy,y=s.pusho,F=d("./color").makeColourSteps}n.prototype.toString=
function(){return this.name+":"+this.start+".."+this.end};n.prototype.isBounded=function(){return this.start&&this.end};n.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};m.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(b){if(!b)return a([]);var e=[];b=b.getElementsByTagName("SEGMENT");for(var c=0;c<b.length;++c){var f=b[c],k=f.getAttribute("id"),p=f.getAttribute("size"),
d;p?(d=1,p|=0):((d=f.getAttribute("start"))&&(d|=0),(p=f.getAttribute("stop"))&&(p|=0));var q=null;f.firstChild&&(q=f.firstChild.nodeValue);e.push(new n(k,d,p,q))}a(e)})};m.prototype.sequence=function(a,b){var e=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(e,function(a){if(a){var e=[];a=a.getElementsByTagName("SEQUENCE");for(var c=0;c<a.length;++c){var f=a[c],k=f.getAttribute("id"),p=f.getAttribute("start"),d=f.getAttribute("stop"),h=null;if(f.firstChild)for(var f=f.firstChild.nodeValue,
h="",q=0;;){var g=f.indexOf("\n",q);if(0<=g)h+=f.substring(q,g).toUpperCase(),q=g+1;else{h+=f.substring(q).toUpperCase();break}}e.push(new t(k,p,d,"DNA",h))}b(e)}else b([])})};m.prototype.features=function(a,b,e){b=b||{};var c;if(this.features_uri)c=this.features_uri;else{var f=[];if(a)f.push(a.toDASQuery());else if(b.group)if(a=b.group,"string"==typeof a)f.push("group_id="+a);else for(var p=0;p<a.length;++p)f.push("group_id="+a[p]);if(b.adjacent)for(a=b.adjacent,"string"==typeof a&&(a=[a]),p=0;p<
a.length;++p)f.push("adjacent="+a[p]);if(b.type)if("string"==typeof b.type)f.push("type="+b.type);else for(a=0;a<b.type.length;++a)f.push("type="+b.type[a]);b.maxbins&&f.push("maxbins="+b.maxbins);0<f.length?c=this.dasBaseURI+"features?"+f.join(";"):e([],"No filters specified")}this.doCrossDomainRequest(c,function(a,b){if(a){for(var c=[],f={},h=a.getElementsByTagName("SEGMENT"),p=0;p<h.length;++p){var d=h[p],g=d.getAttribute("id");f[g]={min:d.getAttribute("start"),max:d.getAttribute("stop")};for(var d=
d.getElementsByTagName("FEATURE"),A=0;A<d.length;++A){var u=d[A],x=new C;x.segment=g;x.id=u.getAttribute("id");x.label=u.getAttribute("label");var w=q(u,"START"),t=q(u,"END");(w|0)>(t|0)?(x.min=t|0,x.max=w|0):(x.min=w|0,x.max=t|0);w=u.getElementsByTagName("TYPE");0<w.length&&(w=w[0],w.firstChild&&(x.type=w.firstChild.nodeValue),x.typeId=w.getAttribute("id"),x.typeCv=w.getAttribute("cvId"));x.type=q(u,"TYPE");!x.type&&x.typeId&&(x.type=x.typeId);x.method=q(u,"METHOD");(w=q(u,"ORIENTATION"))||(w="0");
x.orientation=w;x.score=q(u,"SCORE");x.links=k(u);x.notes=r(u);w=u.getElementsByTagName("GROUP");for(t=0;t<w.length;++t){var y=w[t],l=new E;l.type=y.getAttribute("type");l.id=y.getAttribute("id");l.links=k(y);l.notes=r(y);x.groups?x.groups.push(l):x.groups=Array(l)}if(x.notes)for(w=0;w<x.notes.length;++w)t=x.notes[w],0==t.indexOf("Genename=")&&(y=new E,y.type="gene",y.id=t.substring(9),x.groups?x.groups.push(y):x.groups=Array(y));w=u.getElementsByTagName("PART");if(0<w.length){y=[];for(t=0;t<w.length;++t)y.push(w[t].getAttribute("id"));
x.parts=y}w=u.getElementsByTagName("PARENT");if(0<w.length){u=[];for(t=0;t<w.length;++t)u.push(w[t].getAttribute("id"));x.parents=u}c.push(x)}}e(c,void 0,f)}else e([],"Failed request: "+(0==b.status?"server may not support CORS":"status="+b.status))},function(a){e([],a)})};m.prototype.alignments=function(b,c,e){var f=this.dasBaseURI+"alignment?query="+b;this.doCrossDomainRequest(f,function(b){if(b){var c=[];b=b.getElementsByTagName("alignment");for(var k=0;k<b.length;++k){for(var p=b[k],d=new a(p.getAttribute("alignType")),
g=p.getElementsByTagName("alignObject"),h=0;h<g.length;++h){var r=g[h],r={id:r.getAttribute("intObjectId"),accession:r.getAttribute("dbAccessionId"),version:r.getAttribute("objectVersion"),dbSource:r.getAttribute("dbSource"),dbVersion:r.getAttribute("dbVersion")};d.objects[r.id]=r}p=p.getElementsByTagName("block");for(g=0;g<p.length;++g){for(var r=p[g],h={order:r.getAttribute("blockOrder"),segments:[]},r=r.getElementsByTagName("segment"),u=0;u<r.length;++u){var w=r[u],w={object:w.getAttribute("intObjectId"),
min:w.getAttribute("start"),max:w.getAttribute("end"),strand:w.getAttribute("strand"),cigar:q(w,"cigar")};h.segments.push(w)}d.blocks.push(h)}c.push(d)}e(c)}else e([],"Failed request "+f)})};b.prototype.pushStyle=function(a,b,e){a||(a={type:"default"});a=I(a);b&&(a.zoom=b);a.style=e;this.styles.push(a)};m.prototype.stylesheet=function(a,c){var e,k=this.credentials;this.stylesheet_uri?(e=this.stylesheet_uri,k=!1):e=this.dasBaseURI+"stylesheet";H(e,function(e){if(e){var k=new b;e=e.getElementsByTagName("TYPE");
for(var p=0;p<e.length;++p){var d=e[p],q={};q.type=d.getAttribute("id");q.label=d.getAttribute("label");q.method=d.getAttribute("method");for(var d=d.getElementsByTagName("GLYPH"),g=0;g<d.length;++g){var h=d[g],r=h.getAttribute("zoom"),x;a:{if(h.hasChildNodes()){h=h.firstChild;do{if(h.nodeType==Node.ELEMENT_NODE){x=h;break a}h=h.nextSibling}while(null!=h)}x=null}h=new f;h.glyph=x.localName;for(x=x.firstChild;x;){if(x.nodeType==Node.ELEMENT_NODE)if("BGGRAD"==x.localName){var w=h,t=x.localName,y,l=
x;y=(y=l.getAttribute("steps"))?y|0:50;for(var m=[],B=[],l=l.getElementsByTagName("STOP"),n=0;n<l.length;++n){var E=l[n];m.push(1*E.getAttribute("score"));B.push(E.firstChild.nodeValue)}y=F(y,m,B);w[t]=y}else h[x.localName]=x.firstChild.nodeValue;x=x.nextSibling}k.pushStyle(q,r,h)}}a(k)}else c&&c()},k)};p.prototype.sources=function(a,b,e){e||(e={});var c=[];e.taxon&&c.push("organism="+e.taxon);e.auth&&c.push("authority="+e.auth);e.version&&c.push("version="+e.version);e=this.uri;0<c.length&&(e=e+
"?"+c.join("&"));H(e,function(e){if(!e&&b)b();else{var c=[];e=e.getElementsByTagName("SOURCE");for(var f=0;f<e.length;++f){var k=e[f],p=k.getElementsByTagName("VERSION");if(!(1>p.length)){for(var d=p[0],h=d.getElementsByTagName("COORDINATES"),p=[],q=0;q<h.length;++q){var r=h[q],x=new g;x.auth=r.getAttribute("authority");x.taxon=r.getAttribute("taxid");x.version=r.getAttribute("version");p.push(x)}for(var h=[],r=d.getElementsByTagName("CAPABILITY"),w,q=0;q<r.length;++q)x=r[q],h.push(x.getAttribute("type")),
"das1:features"==x.getAttribute("type")&&(w=x.getAttribute("query_uri"),w=w.substring(0,w.length-8));q={};d=d.getElementsByTagName("PROP");for(r=0;r<d.length;++r)y(q,d[r].getAttribute("name"),d[r].getAttribute("value"));w&&(k=new m(w,{source_uri:k.getAttribute("uri"),name:k.getAttribute("title"),desc:k.getAttribute("description"),coords:p,props:q,capabilities:h}),c.push(k))}}a(c)}})};m.prototype.doCrossDomainRequest=function(a,b,e){var c;this.xUser&&(c="Basic "+btoa(this.xUser+":"+this.xPass));try{return H(a,
b,this.credentials,c)}catch(f){if(e)e(f);else throw f;}};"undefined"!==typeof v&&(v.exports={DASGroup:E,DASFeature:C,DASStylesheet:b,DASStyle:f,DASSource:m,DASSegment:n,DASRegistry:p,DASSequence:t,DASLink:c,isDasBooleanTrue:Q,isDasBooleanNotFalse:B,copyStylesheet:w,coordsMatch:l})},{"./color":9,"./utils":49}],11:[function(d,v,s){function n(d,l,m){function c(){m?(a.className="fa fa-caret-down",l.style.display="table"):(a.className="fa fa-caret-right",l.style.display="none")}var a=g("i");c();a.addEventListener("click",
function(a){a.preventDefault();a.stopPropagation();m=!m;c()},!1);d=g("h6",[a," ",d],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return g("div",[d,l],{})}if("undefined"!==typeof d){var m=d("./cbrowser").Browser;d=d("./utils");var g=d.makeElement,l=d.removeChildren}m.prototype.removeAllPopups=function(){l(this.hPopupHolder);l(this.popupHolder)};m.prototype.makeTooltip=function(d,l){var m=!1,c=this,a=null,b;b=function(c){m=!1;a&&(clearTimeout(a),
a=null);d.removeEventListener("mouseout",b,!1)};var f=function(b){var q=b.clientX+window.scrollX,k=b.clientY+window.scrollY;a||(a=setTimeout(function(){var b;b="function"===typeof l?l():l;var p=g("div",[g("div",null,{className:"tooltip-arrow"}),g("div",b,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(k+20)+"px",left:""+Math.max(q-30,20)+"px"});c.hPopupHolder.appendChild(p);var n;n=function(a){try{c.hPopupHolder.removeChild(p)}catch(b){}window.removeEventListener("mousemove",
n,!1);m&&null!=d.offsetParent&&f(a)};window.addEventListener("mousemove",n,!1);a=null},1E3))};d.addEventListener("mouseover",function(a){m=!0;d.addEventListener("mouseout",b,!1);f(a)},!1);d.addEventListener("DOMNodeRemovedFromDocument",function(b){m=!1;a&&(clearTimeout(a),a=null)},!1)};m.prototype.popit=function(d,l,m,c){var a=this;c||(c={});d||(d={});var b=c.width||200,f;d.clientX?(c=d.clientX,f=d.clientY):(c=500,f=50);c+=document.documentElement.scrollLeft||document.body.scrollLeft;f+=document.documentElement.scrollTop||
document.body.scrollTop;var p=window.innerWidth,q=f,k=Math.min(c-b/2-4,p-b-30),r=g("div");r.className="popover fade "+(d.clientX?"bottom ":"")+"in";r.style.display="block";r.style.position="absolute";r.style.top=""+q+"px";r.style.left=""+k+"px";r.style.width=b+"px";276<b&&(r.style.maxWidth=b+"px");r.appendChild(g("div",null,{className:"arrow"}));if(l){var n=g("button","",{className:"close"});n.innerHTML="&times;";n.addEventListener("mouseover",function(a){n.style.color="red"},!1);n.addEventListener("mouseout",
function(a){n.style.color="black"},!1);n.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();a.removeAllPopups()},!1);d=g("h4",[g("span",l,null,{maxWidth:"200px"}),n],{},{paddingLeft:"10px",paddingRight:"10px"});var Q,B,w,I;w=function(a){a.stopPropagation();a.preventDefault();k+=a.clientX-Q;8>k&&(k=8);k>p-b-32&&(k=p-b-26);q+=a.clientY-B;q=Math.max(10,q);r.style.top=""+q+"px";r.style.left=""+Math.min(k,p-b-10)+"px";Q=a.clientX;B=a.clientY};I=function(a){a.stopPropagation();
a.preventDefault();window.removeEventListener("mousemove",w,!1);window.removeEventListener("mouseup",I,!1)};d.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();Q=a.clientX;B=a.clientY;window.addEventListener("mousemove",w,!1);window.addEventListener("mouseup",I,!1)},!1);r.appendChild(d)}r.appendChild(g("div",m,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(r);var y={node:r,displayed:!0};r.addEventListener("DOMNodeRemoved",function(a){a.target==
r&&(y.displayed=!1)},!1);return y};"undefined"!==typeof v&&(v.exports={makeTreeTableSection:n})},{"./cbrowser":6,"./utils":49}],12:[function(d,v,s){function n(d,g){0>d.indexOf("?")&&(d+="?soft=true");return new l(function(l,c){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(300<=a.status)c("Error code "+a.status);else{var b=JSON.parse(a.response);l(g?b:b.location)}};a.open("GET",d,!0);a.setRequestHeader("Accept","application/json");a.responseType="text";a.send("")})}
function m(d){this.rawurl=d}function g(d,g,l,c){c||("object"===typeof g?(c=g,g=void 0):c={});this.url="string"===typeof d?new m(d):d;this.start=g||0;l&&(this.end=l);this.opts=c}if("undefined"!==typeof d)var l=d("es6-promise").Promise;m.prototype.getURLPromise=function(){this.urlPromise&&this.urlPromiseValidity>Date.now()||(this.urlPromise=n(this.rawurl,!0).then(function(d){return d.location}),this.urlPromiseValidity=Date.now()+432E5);return this.urlPromise};g.prototype.slice=function(d,l){if(0>d)throw"Bad slice "+
d;var m=this.start,c=this.end,m=m&&d?m+d:d||m;return new g(this.url,m,l&&m?m+l-1:c||l-1,this.opts)};g.prototype.fetchAsText=function(d){var g=this,l=new XMLHttpRequest;g.url.getURLPromise().then(function(c){l.open("GET",c,!0);if(g.end){if(1E8<g.end-g.start)throw"Monster fetch!";l.setRequestHeader("Range","bytes="+g.start+"-"+g.end)}l.onreadystatechange=function(){if(4==l.readyState)return 200==l.status||206==l.status?d(l.responseText):d(null)};g.opts.credentials&&(l.withCredentials=!0);l.send("")}).catch(function(c){console.log(c);
return d(null)})};g.prototype.salted=function(){return this};g.prototype.fetch=function(d,g,l){var c=this;g=g||1;if(3<g)return d(null);c.url.getURLPromise().then(function(a){var b=new XMLHttpRequest,f;b.open("GET",a,!0);b.overrideMimeType("text/plain; charset=x-user-defined");if(c.end){if(1E8<c.end-c.start)throw"Monster fetch!";b.setRequestHeader("Range","bytes="+c.start+"-"+c.end);f=c.end-c.start+1}b.responseType="arraybuffer";b.onreadystatechange=function(){if(4==b.readyState){if(200==b.status||
206==b.status){if(b.response){var a=b.response.byteLength;return!f||f==a||l&&a==l?d(b.response):c.fetch(d,g+1,a)}if(b.mozResponseArrayBuffer)return d(b.mozResponseArrayBuffer);a=b.responseText;if(!f||f==a.length||l&&a.length==l){if(a=b.responseText){for(var q=new Uint8Array(a.length),k=0;k<q.length;++k)q[k]=a.charCodeAt(k);a=q.buffer}else a=null;return d(a)}return c.fetch(d,g+1,a.length)}return c.fetch(d,g+1)}};c.opts.credentials&&(b.withCredentials=!0);b.send("")}).catch(function(a){console.log(a)})};
"undefined"!==typeof v&&(v.exports={lookupEncodeURI:n,EncodeFetchable:g})},{"es6-promise":53}],13:[function(d,v,s){function n(c){g.call(this);this.source=c;this.base=c.uri||"//rest.ensembl.org";if(0===this.base.indexOf("//")){var a=window.location.protocol;"http:"!=a&&"https:"!=a&&(this.base="http:"+this.base)}this.species=c.species||"human";this.type="string"===typeof c.type?[c.type]:c.type||["regulatory"]}if("undefined"!==typeof d){v=d("./sourceadapters");var m=v.registerSourceAdapterFactory,g=
v.FeatureSourceBase;d=d("./das");var l=d.DASStylesheet,t=d.DASStyle,C=d.DASFeature,E=d.DASGroup}n.prototype=Object.create(g.prototype);n.prototype.constructor=n;n.prototype.getStyleSheet=function(c){var a=new l,b=new t;b.glyph="__NONE";0<=this.type.indexOf("exon")&&a.pushStyle({type:"transcript"},null,b);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&a.pushStyle({type:"gene"},null,b);b=new t;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="red";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=
10;a.pushStyle({type:"cds"},null,b);b=new t;b.glyph="SQUARE";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:".+_UTR_variant"},null,b);b=new t;b.glyph="TRIANGLE";b.DIRECTION="S";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"missense_variant"},null,b);b=new t;b.glyph="TRIANGLE";b.DIRECTION="N";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"splice_.+_variant"},null,b);b=new t;b.glyph="STAR";b.POINTS=
6;b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"regulatory_region_variant"},null,b);b=new t;b.glyph="PLIMSOLL";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="rgb(50,80,255)";b.STROKECOLOR="black";a.pushStyle({type:"variation"},null,b);b=new t;b.glyph="SQUARE";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",method:".+_UTR_variant"},null,b);b=new t;b.glyph="TRIANGLE";b.DIRECTION="S";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR=
"red";a.pushStyle({type:"indel",method:"missense_variant"},null,b);b=new t;b.glyph="TRIANGLE";b.DIRECTION="N";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",method:"splice_.+_variant"},null,b);b=new t;b.glyph="STAR";b.POINTS=6;b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",method:"regulatory_region_variant"},null,b);b=new t;b.glyph="PLIMSOLL";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";b.STROKECOLOR=
"black";a.pushStyle({type:"indel"},null,b);b=new t;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="orange";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=20;a.pushStyle({type:"default"},null,b);return c(a)};n.prototype.getScales=function(){return[]};n.prototype.fetch=function(c,a,b,f,d,q,k){var g=this;a=this.base+"/overlap/region/"+this.species+"/"+c+":"+a+"-"+b;b=[];for(f=0;f<this.type.length;++f)b.push("feature="+this.type[f]);b.push("content-type=application/json");a=a+"?"+b.join(";");var l=new XMLHttpRequest;
l.onreadystatechange=function(){if(4==l.readyState)if(g.busy--,g.notifyActivity(),300<=l.status){var a="Error code "+l.status;try{var b=JSON.parse(l.response);b.error&&(a=b.error)}catch(f){}k(a,null)}else{for(var a=JSON.parse(l.response),b=[],d=0;d<a.length;++d){var p=a[d],q=[],u=new C;u.segment=c;u.min=p.start|0;u.max=p.end|0;u.type=p.feature_type||"unknown";u.id=p.ID;if(p.Parent){var m=new E;m.id=p.Parent;u.groups=[m]}p.strand&&(0>p.strand?u.orientation="-":0<p.strand&&(u.orientation="+"));p.consequence_type&&
(u.method=p.consequence_type);p.alt_alleles&&(q.push("Alleles="+p.alt_alleles.join("/")),1<p.alt_alleles.length&&(p.alt_alleles[1].length!=p.alt_alleles[0].length||"-"==p.alt_alleles[1])&&(u.type="indel"));0<q.length&&(u.notes=q);b.push(u)}k(null,b)}};g.busy++;g.notifyActivity();l.open("GET",a,!0);l.responseType="text";l.send("")};m("ensembl",function(c){return{features:new n(c)}})},{"./das":10,"./sourceadapters":34}],14:[function(d,v,s){if("undefined"!==typeof d)var n=d("./cbrowser").Browser,m=d("./utils").shallowCopy,
g=d("./sha1").hex_sha1,l=d("./das").copyStylesheet;n.prototype.exportFullConfig=function(d){d={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+g(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),chains:this.exportChains()};this.prefix&&(d.prefix=this.prefix);return d};n.prototype.exportChains=function(){var d={},g=this.chains||{},l;for(l in g)d[l]=g[l].exportConfig();return d};n.prototype.exportSourceConfig=function(d){d=[];for(var g=
0;g<this.tiers.length;++g){var n=this.tiers[g],c=m(n.dasSource);c.noPersist||(c.coords=void 0,c.props=void 0,c.disabled||(c.disabled=void 0),n.config.stylesheet?(c.style=l(n.config.stylesheet).styles,c.stylesheet_uri=void 0):c.style&&(c.style=l({styles:c.style}).styles),"string"===typeof n.config.name&&(c.name=n.config.name),void 0!==n.config.height&&(c.forceHeight=n.config.height),void 0!==n.config.forceMin&&(c.forceMin=n.config.forceMin),n.config.forceMinDynamic&&(c.forceMinDynamic=n.config.forceMinDynamic),
void 0!==n.config.forceMax&&(c.forceMax=n.config.forceMax),void 0!==n.config.bumped&&(c.bumped=n.config.bumped),n.config.forceMaxDynamic&&(c.forceMaxDynamic=n.config.forceMaxDynamic),d.push(c))}return d};n.prototype.exportPageTemplate=function(d){d=d||{};return'<html>\n  <head>\n    <script language="javascript" src="'+this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+JSON.stringify(this.exportFullConfig(d),
null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},{"./cbrowser":6,"./das":10,"./sha1":33,"./utils":49}],15:[function(d,v,s){if("undefined"!==typeof d)var n=d("./cbrowser").Browser,m=d("./glyphs").OverlayLabelCanvas,g=d("./numformats").formatQuantLabel,l=d("./sequence-draw").drawSeqTierGC;n.prototype.exportImage=function(d){d=d||{};for(var n=this.featurePanelWidth,E=0,c=0;c<this.tiers.length;++c){0<c&&(E+=3);var a=this.tiers[c];
void 0!==a.layoutHeight&&(E+=a.layoutHeight)}var b=d.resolutionMultiplier||1,c=(n+200)*b|0,a=E*b|0,E=makeElement("canvas",null,{width:c,height:a}),f=E.getContext("2d");f.fillStyle="white";f.fillRect(0,0,c,a);f.scale(b,b);for(c=b=0;c<this.tiers.length;++c){var a=this.tiers[c],p=(a.glyphCacheOrigin-this.viewStart)*this.scale,q=new m;f.save();f.translate(0,b);f.save();f.beginPath();f.moveTo(200,0);f.lineTo(200+n,0);f.lineTo(200+n,a.layoutHeight);f.lineTo(200,a.layoutHeight);f.closePath();f.clip();f.translate(200,
0);f.save();f.translate(p,0);a.subtiers?a.paintToContext(f,q,p+1E3):l(a,a.currentSequence,f);f.restore();f.save();f.translate(p,0);q.draw(f,-p,n-p);f.restore();f.restore();for(var q=!1,k=0,r=a.subtiers||[],H=0;H<r.length;++H){var Q=r[H];if(Q.quant){var q=!0,B=Q.quant,w=Q.height,I=2;40<w&&(I=1+(w/20|0));var w=w/(I-1),y=(B.max-B.min)/(I-1);f.beginPath();f.moveTo(205,k);f.lineTo(200,k);f.lineTo(200,k+Q.height);f.lineTo(205,k+Q.height);for(var F=1;F<I-1;++F){var u=F*w;f.moveTo(200,k+u);f.lineTo(203,k+
u)}f.strokeStyle="black";f.strokeWidth=2;f.stroke();f.fillStyle="black";var F=g(B.max),L=k+7;f.fillText(F,197-f.measureText(F).width,L);F=g(B.min);L=k+Q.height;f.fillText(F,197-f.measureText(F).width,L);for(F=1;F<I-1;++F)u=F*w,L=g(1*B.max-F*y),u=k+u+3,f.fillText(L,197-f.measureText(L).width,u)}k+=Q.height+3}k="string"===typeof a.config.name?a.config.name:a.dasSource.name;r=f.measureText(k).width;f.fillStyle="black";f.fillText(k,200-(q?22:12)-r,(a.layoutHeight+6)/2);f.restore();b+=a.layoutHeight+3}if(d.highlights){f.save();
f.beginPath();f.moveTo(200,0);f.lineTo(200+n,0);f.lineTo(200+n,b);f.lineTo(200,b);f.closePath();f.clip();f.translate(200+p,0);p=n=this.viewStart;c=this.viewEnd;for(a=0;a<this.highlights.length;++a)w=this.highlights[a],(w.chr===this.chr||w.chr==="chr"+this.chr)&&w.min<c&&w.max>p&&(f.globalAlpha=this.defaultHighlightAlpha,f.fillStyle=this.defaultHighlightFill,f.fillRect((w.min-n)*this.scale,0,(w.max-w.min)*this.scale,b));f.restore()}n=-1;"center"==d.ruler?n=200+(this.viewEnd-this.viewStart+1)*this.scale/
2:"left"==d.ruler?n=200:"right"==d.ruler&&(n=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=n&&(f.strokeStyle="blue",f.beginPath(),f.moveTo(n,0),f.lineTo(n,b),f.stroke());return E.toDataURL("image/png")}},{"./cbrowser":6,"./glyphs":21,"./numformats":26,"./sequence-draw":31}],16:[function(d,v,s){if("undefined"!==typeof d){var n=d("./cbrowser").Browser;d=d("./utils");var m=d.makeElement,g=d.removeChildren}n.prototype.openExportPanel=function(){var d=this;if("export"===this.uiMode)this.hideToolPanel(),
this.setUiMode("none");else{var n=m("div",null,{className:"export-form"}),C=m("select");C.appendChild(m("option","SVG",{value:"svg"}));C.appendChild(m("option","Image",{value:"png"}));C.appendChild(m("option","Dalliance config",{value:"config"}));C.appendChild(m("option","Dalliance sources",{value:"sources"}));C.appendChild(m("option","Dalliance page",{value:"page"}));C.value="svg";C.addEventListener("change",function(a){g(f);H()},!1);n.appendChild(m("p",["Export as: ",C]));var E=m("input",null,{type:"checkbox",
checked:this.exportHighlights});E.addEventListener("change",function(a){d.exportHighlights=E.checked;d.storeStatus()},!1);var c=m("input",null,{type:"checkbox",checked:this.exportRuler});c.addEventListener("change",function(a){d.exportRuler=c.checked;d.storeStatus()},!1);var a=m("input",null,{type:"text",value:"1.0"}),b=m("button","Export",{className:"btn btn-primary"});b.addEventListener("click",function(b){g(f);var k,p,q,r;if("svg"===C.value)k=URL.createObjectURL(d.makeSVG({highlights:E.checked,
ruler:c.checked?d.rulerLocation:"none"})),p="SVG",q="image/svg",r="dalliance-view.svg";else if("png"===C.value){q=parseFloat(a.value);if(0.1>q||10<q){alert("bad scale "+q);return}k=d.exportImage({highlights:E.checked,ruler:c.checked?d.rulerLocation:"none",resolutionMultiplier:q});p="Image";q="image/png";r="dalliance-view.png"}else"config"===C.value?(q=JSON.stringify(d.exportFullConfig(),null,2),p=new Blob([q],{type:"text/plain"}),k=URL.createObjectURL(p),p="Configuration",q="text/plain",r="dalliance-config.json"):
"sources"===C.value?(q=JSON.stringify(d.exportSourceConfig(),null,2),p=new Blob([q],{type:"text/plain"}),k=URL.createObjectURL(p),p="Source array",q="text/plain",r="dalliance-sources.json"):"page"===C.value&&(p=d.exportPageTemplate(),q="text/html",p=new Blob([p],{type:q}),k=URL.createObjectURL(p),p="Page template",r="dalliance-view.html");k&&(b=m("a","[Download]",{href:k,download:r,type:q}),q=m("a","[Preview in browser]",{href:k,type:q,target:"_new"}),f.appendChild(m("p",[""+p+" created: ",b,q])))},
!1);d.addViewListener(function(){g(f)});d.addTierListener(function(){g(f)});var f=m("p",""),p=m("tr",[m("th","Include highlights",{},{width:"200px",textAlign:"right"}),m("td",E)]),q=m("tr",[m("th","Include vertical guideline"),m("td",c)]),k=m("tr",[m("th","Scale multiplier"),m("td",a)]),r=m("table",[p,q,k]),H=function(){var a=C.value;p.style.display="svg"==a||"png"==a?"table-row":"none";q.style.display="svg"==a||"png"==a?"table-row":"none";k.style.display="png"==a?"table-row":"none"};H();n.appendChild(r);
n.appendChild(b);n.appendChild(f);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(n,this.svgHolder);this.activeToolPanel=n;this.setUiMode("export")}}},{"./cbrowser":6,"./utils":49}],17:[function(d,v,s){v=d("./cbrowser");s=d("./chainset");var n=d("./sourceadapters"),m=d("./utils"),g=d("./das");d=d("./sourcecompare");window.Browser=v.Browser;window.sourcesAreEqual=d.sourcesAreEqual;window.Chainset=s.Chainset;window.makeElement=m.makeElement;window.dalliance_registerSourceAdapterFactory=
n.registerSourceAdapterFactory;window.dalliance_registerParserFactory=n.registerParserFactory;window.dalliance_makeParser=n.makeParser;window.DASSequence=g.DASSequence;window.DASFeature=g.DASFeature;window.DASGroup=g.DASGroup;window.DASStylesheet=g.DASStylesheet;window.DASStyle=g.DASStyle;window.DASSource=g.DASSource},{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":34,"./sourcecompare":35,"./utils":49}],18:[function(d,v,s){function n(){this.glyphs=[];this.height=0;this.quant=null}function m(a){Date.now();
aa=a.viewport.getContext("2d");a.padding="number"===typeof a.dasSource.padding?a.dasSource.padding:X;a.scaleVertical="boolean"===typeof a.dasSource.scaleVertical?a.dasSource.scaleVertical:!1;var e=[],b={},h={},f;for(f in a.ungroupedFeatures)for(var k=a.ungroupedFeatures[f],d=0;d<k.length;++d){var p=k[d];if(!p.parts){var q=a.styleForFeature(p);if(q)if("LINEPLOT"==q.glyph)c(b,q.id,p),h[q.id]=q;else{var r=l(p,0,q,a);r&&e.push(r)}}}for(var x in b)f=b[x],q=h[x],"LINEPLOT"==q.glyph&&e.push(t(f,q,a));if(a.dasSource.collapseSuperGroups&&
!a.bumped)for(var u in a.superGroups){b=a.superGroups[u];a.groups[u]=E(a.groups[u]);a.groups[u].isSuperGroup=!0;h={};x=1E10;k=-1E10;d=null;for(r=0;r<b.length;++r)if(f=a.groupedFeatures[b[r]]){for(q=0;q<f.length;++q)p=f[q],c(h,p.type,p),x=Math.min(p.min,x),k=Math.max(p.max,k),p.segment&&!d&&(d=p.segment);if(a.groups[u]&&!a.groups[u].links||0==a.groups[u].links.length)a.groups[u].links=a.groups[b[0]].links;delete a.groupedFeatures[b[r]]}a.groups[u].max=k;a.groups[u].min=x;a.groups[u].segment=d;for(var A in h){f=
h[A];x=f[0];k=null;for(q=0;q<f.length;++q)p=f[q],p=new K(p.min,p.max),k=k?G(k,p):p;k=k.ranges();for(d=0;d<k.length;++d){for(var w=k[d],z=((w.max()|0)-(w.min()|0)+1)*b.length,m=0,q=0;q<f.length;++q)if(p=f[q],(p.min|0)<=w.max()&&(p.max|0)>=w.min())var y=Math.max(p.min|0,w.min()),p=Math.min(p.max|0,w.max()),m=m+(p-y+1);var p=new T,B;for(B in x)p[B]=x[B];p.min=w.min();p.max=w.max();p.label&&1<b.length&&(p.label+=" ("+b.length+" vars)");p.visualWeight=1*m/z;c(a.groupedFeatures,u,p)}}delete a.superGroups[u]}B=
[];for(var H in a.groupedFeatures)B.push(H);B.sort(function(e,b){var h=a.groupedFeatures[e][0].score-a.groupedFeatures[b][0].score;return 0<h?-1:0==h?0:1});A={};for(p=0;p<B.length;++p)if(H=B[p],r=g(a.groupedFeatures[H],0,a.groups[H],a,a.dasSource.collapseSuperGroups&&!a.bumped?"collapsed_gene":"tent"))r.group=a.groups[H],A[H]=r;for(u in a.superGroups){b=a.superGroups[u];H=[];x=1E10;k=-1E10;for(B=0;B<b.length;++B)p=A[b[B]],A[b[B]]=null,p&&(H.push(p),x=Math.min(x,p.min()),k=Math.max(k,p.max()));for(B=
0;B<H.length;++B)p=H[B],e.push(new Q(p,x,k))}for(r in A)(p=A[r])&&e.push(p);u=new n;H=[];A=a.subtierMax||a.dasSource.subtierMax||a.browser.defaultSubtierMax;B=!1;p=0;a:for(;p<e.length;++p)if(r=e[p],r.bump&&(a.bumped||a.dasSource.collapseSuperGroups)){for(b=0;b<H.length;++b)if(h=H[b],h.hasSpaceFor(r)){h.add(r);continue a}H.length>=A?B=!0:(h=new n,h.add(r),H.push(h))}else u.add(r);0<u.glyphs.length&&(H=[u].concat(H));for(b=0;b<H.length;++b)h=H[b],h.quant&&h.glyphs.unshift(new J(h.height));for(b=0;b<
H.length;++b)h=H[b],h.glyphs.sort(function(a,e){return(a.zindex||0)-(e.zindex||0)});a.subtiers=H;a.glyphCacheOrigin=a.browser.viewStart;B?a.updateStatus("Bumping limit exceeded, use the track editor to see more features"):a.updateStatus()}function g(a,e,h,c,f){f=c.styleForFeature(h);var k,d=!1,q=[];e=null;for(var g=0;g<a.length;++g){var r=a[g];r.orientation&&null==e&&(e=r.orientation);!k&&r.label&&(k=r.label);var x=c.styleForFeature(r);x&&!r.parts&&(M(x.LABEL)&&(d=!0),(r=l(r,0,x,c,null,!0))&&q.push(r))}if(0==
q.length)return null;a="flat";f&&"LINE"===f.glyph||(c.dasSource.collapseSuperGroups&&!c.bumped?"+"===e?a="collapsed+":"-"===e&&(a="collapsed-"):"+"===e?a="hat+":"-"===e&&(a="hat-"));c=null;if(k&&d||f&&(M(f.LABEL)||M(f.LABELS)))c=h.label||k;h=new b(q,a);c&&("+"===e?c=">"+c:"-"===e&&(c="<"+c),h=new p(aa,h,c,!1));h.bump=!0;return h}function l(c,f,d,g,l,K){function n(a,e,b){var c=null;if(a.currentSequence){var h=a.currentSequence.start|0,f=a.currentSequence.end|0;if(h<=b&&f>=e){for(var k=Math.max(e,h),
f=Math.min(b,f),c=a.currentSequence.seq.substr(k-h,f-k+1);e<k;)c="N"+c,k--;for(;b>f;)c+="N",f++}}return c}var m=g.browser.scale,t=g.browser.viewStart,E=d.glyph||"BOX",D=c.min,G=c.max,C=c.orientation,J=c.score,s=c.label||c.id,v=(D-t)*m,T=Math.max((G-t+1)*m,v+1),R=g.forceHeight||d.HEIGHT||l||12,S=R*=1,t=d.BUMP&&M(d.BUMP),X;if("CROSS"===E||"EX"===E||"TRIANGLE"===E||"DOT"===E||"SQUARE"===E||"STAR"===E||"PLIMSOLL"===E){var W=d.FGCOLOR||"black",O=d.BGCOLOR||"none",D=d.STROKECOLOR;d.BGITEM&&c.itemRgb?W=
c.itemRgb:M(d.COLOR_BY_SCORE2)&&(m=d.BGGRAD||d._gradient,m||(m=h(50,d.COLOR1,d.COLOR2,d.COLOR3),d._gradient=m),R=c.score2,void 0==R&&W||(S=d.MIN2?1*d.MIN2:0,G=(1*(R||0)-S)/((d.MAX2?1*d.MAX2:1)-S)*m.length|0,0>G&&(G=0),G>=m.length&&(G=m.length-1),W=m[G]));R=g.forceHeight||d.HEIGHT||l||12;S=R*=1;G=d.SIZE||R;d.RSIZE&&(G=1*d.RSIZE*R);d.STROKETHRESHOLD&&G<1*d.STROKETHRESHOLD&&(D=null);G*=1;R=(v+T)/2;m=G/2;"EX"===E?D=new k(R,G,W):"TRIANGLE"===E?D=new r(R,G,d.DIRECTION||"N",d.LINEWIDTH||G,W,D):"DOT"===E?
D=new H(R,G,W,D):"PLIMSOLL"===E?D=new z(R,G,0.2*G,W,D):"SQUARE"===E?D=new a(R-m,0,G,G,W,D):"STAR"===E?(E=5,d.POINTS&&(E=d.POINTS|0),D=new U(R,m,E,W,D)):D=new q(R,G,W);O&&"none"!=O&&5<T-v&&(v=new a(v,0,T-v,G,O),D=new b([v,D]));if(M(d.SCATTER)){O=g.quantMin(d);(G=g.quantMax(d))||(G=0>O?0:10);O||(O=0);g=(1*J-O)/(G-O);J=-1*O/(G-O);if(0>g||1<g)return null;g>=J?(R=Math.max(1,(g-J)*S),f=f+(1-J)*S-R):(R=Math.max(1,(g-J)*S),f+=(1-J)*S);X={min:O,max:G};v=0;T="undefined"!==typeof c.forceLabel?c.forceLabel:d.LABEL;
Y(T)&&s&&!K&&(D=new p(aa,D,s,!0,null,"above"==T?"above":"below"),"above"==T&&(v=D.textHeight+2),K=!0);D=new A(D,0,f-m-v,S)}}else if("HISTOGRAM"===E||"GRADIENT"===E&&"undefined"!==J)O=g.quantMin(d),(G=g.quantMax(d))||(G=0>O?0:10),O||(O=0),1*J<1*O&&(J=O),1*J>1*G&&(J=G),g=(1*J-O)/(G-O),J=-1*O/(G-O),"HISTOGRAM"===E&&(g>=J?(R=(g-Math.max(0,J))*S,f=f+(1-Math.max(0,J))*S-R):(R=(Math.max(0,J)-g)*S,f+=(1-Math.max(0,J))*S),X={min:O,max:G}),W=d.FGCOLOR||null,O=d.BGCOLOR||d.COLOR1||"green",d.BGITEM&&c.itemRgb&&
(O=c.itemRgb),J=d.ALPHA?1*d.ALPHA:null,d.BGGRAD&&(m=d.BGGRAD,G=g*m.length|0,0>G&&(G=0),G>=m.length&&(G=m.length-1),O=m[G]),d.COLOR2&&(m=d._gradient,m||(m=h(50,d.COLOR1,d.COLOR2,d.COLOR3),d._gradient=m),G=g*m.length|0,0>G&&(G=0),G>=m.length&&(G=m.length-1),O=m[G]),D=new a(v,f,T-v,R,O,W,J),D=new A(D,0,0,S);else if("HIDDEN"===E)D=new Q(null,v,T),K=!0;else if("ARROW"===E)g=d.FGCOLOR||"purple",f=M(d.PARALLEL),S=M(d.SOUTHWEST),J=M(d.NORTHEAST),D=new F(v,T,R,g,f,S,J);else if("ANCHORED_ARROW"===E)W=d.FGCOLOR||
"none",O=d.BGCOLOR||"green",D=new B(v,T,R,O,W,C),D.bump=!0;else if("SPAN"===E)W=d.FGCOLOR||"black",D=new w(v,T,R,W);else if("LINE"===E)W=d.FGCOLOR||"black",D=new I(v,T,R,d.STYLE||"solid",C,W);else if("PRIMERS"===E)W=d.FGCOLOR||"black",O=d.BGCOLOR||"red",D=new y(v,T,R,O,W);else if("TEXT"===E)g=d.STRING||"text",O=d.FGCOLOR||"black",D=new L(aa,v,T,R,O,g);else if("TOOMANY"===E)W=d.FGCOLOR||"gray",O=d.BGCOLOR||"orange",D=new u(v,T,R,O,W);else if("POINT"===E)R=g.forceHeight||d.HEIGHT||30,O=g.quantMin(d),
G=g.quantMax(d),g=(1*J-O)/(G-O),f=1*R/(G-O)*(J-1*O)|0,X={min:O,max:G},O=d.FGCOLOR||d.COLOR1||"black",d.COLOR2&&(m=d._gradient,m||(m=h(50,d.COLOR1,d.COLOR2,d.COLOR3),d._gradient=m),G=g*m.length|0,0>G&&(G=0),G>=m.length&&(G=m.length-1),O=m[G]),D=new P((v+T)/2,R-f,R,O);else if("__SEQUENCE"===E){J=E=c.seq;O=W=c.quals;f=M(d.__INSERTIONS);S=[];if(c.cigar){l=ea(c.cigar);for(var O=J="",oa=C=0;oa<l.length;++oa){var Z=l[oa];if("M"==Z.op)J+=E.substr(C,Z.cnt),O+=W.substr(C,Z.cnt),C+=Z.cnt;else if("D"==Z.op)for(var ja=
0;ja<Z.cnt;++ja)J+="-",O+="Z";else if("I"==Z.op){var va=E.substr(C,Z.cnt),ja=new r(v+J.length*m,5,"S",5,g.browser.baseColors.I);f&&(ja=new p(aa,ja,va,!1,"center","above","7px sans-serif"));ja.feature={label:"Insertion: "+va,type:"insertion",method:"insertion"};S.push(ja);C+=Z.cnt}else"S"==Z.op?C+=Z.cnt:console.log("unknown cigop"+Z.op)}}m=n(g,D,G);if(J&&m&&("mismatch"===d.__SEQCOLOR||"mismatch-all"===d.__SEQCOLOR)){D=[];G="-"===c.orientation?",":".";for(E=0;E<J.length;++E)D.push(J[E]==m[E]?G:J[E]);
J=D.join("")}D="-"===c.orientation?d._minusColor||"lightskyblue":d._plusColor||"lightsalmon";d.__disableQuals&&(O=!1);D=new e(g.browser.baseColors,D,v,T,R,J,m,d.__SEQCOLOR,O,!M(d.__CLEARBG),g.scaleVertical);f&&(D=new A(D,0,7));0<S.length&&(S.splice(0,0,D),D=new b(S))}else if("__INSERTION"===E)ja=new r(v,5,"S",5,g.browser.baseColors.I),D=new p(aa,ja,c.insertion||c.altAlleles[0],!1,"center","above","7px sans-serif"),1<T-v&&(O=d.BGCOLOR||d.COLOR1||"green",v=new a(v,5,T-v,R,O,W),D=new b([v,D]));else{if("__NONE"===
E)return null;W=d.FGCOLOR||null;O=d.BGCOLOR||d.COLOR1||"green";d.BGITEM&&c.itemRgb&&(O=c.itemRgb);m=(T-v)/(G-D);"translation"==c.type&&("protein_coding"==c.method||c.readframeExplicit)&&(!c.tags||0>c.tags.indexOf("cds_start_NF")||c.readframeExplicit)&&(!g.dasSource.collapseSuperGroups||g.bumped)&&0.5<=m?(m=n(g,D,G),D=new x(v,T,R,O,m,c.orientation,c.readframe)):D=new a(v,0,T-v,R,O,W)}(M(d.LABEL)||c.forceLabel)&&s&&!K&&(D=new p(aa,D,s,!1));t&&(D.bump=!0);D.feature=c;X&&(D.quant=X);d.ZINDEX&&(D.zindex=
d.ZINDEX|0);return D}function t(a,e,b){var c=b.browser.viewStart,h=b.browser.scale,k=b.forceHeight||e.HEIGHT||30,d=b.quantMin(e);b=b.quantMax(e);for(var p=1*k/(b-d),q=e.FGCOLOR||e.COLOR1||"black",g=[],r=0;r<a.length;++r){var x=a[r],u=k-((x.score-1*d)*p|0);g.push((((x.min|0)+(x.max|0))/2-c)*h);g.push(u)}a=new f(g,q,k);a.quant={min:d,max:b};e.ZINDEX&&(a.zindex=e.ZINDEX|0);return a}if("undefined"!==typeof d){var C=d("./utils"),E=C.shallowCopy,c=C.pusho,C=d("./tier").DasTier;s=d("./glyphs");var a=s.BoxGlyph,
b=s.GroupGlyph,f=s.LineGraphGlyph,p=s.LabelledGlyph,q=s.CrossGlyph,k=s.ExGlyph,r=s.TriangleGlyph,H=s.DotGlyph,Q=s.PaddedGlyph,B=s.AArrowGlyph,w=s.SpanGlyph,I=s.LineGlyph,y=s.PrimersGlyph,F=s.ArrowGlyph,u=s.TooManyGlyph,L=s.TextGlyph,e=s.SequenceGlyph,x=s.AminoAcidGlyph,A=s.TranslatedGlyph,P=s.PointGlyph,J=s.GridGlyph,U=s.StarGlyph,z=s.PlimsollGlyph,D=s.OverlayLabelCanvas,h=d("./color").makeGradient;s=d("./spans");var K=s.Range,G=s.union;s=d("./das");var T=s.DASFeature,M=s.isDasBooleanTrue,Y=s.isDasBooleanNotFalse,
ea=d("./cigar").parseCigar,S=d("./numformats").formatQuantLabel}var X=3;n.prototype.indexFor=function(a){a=a.min();for(var e=0,b=this.glyphs.length;b>e;){var c=(e+b)/2|0;if(c>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[c].min()?b=c:e=c+1}return b};n.prototype.add=function(a){var e=this.indexFor(a);this.glyphs.splice(e,0,a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};n.prototype.hasSpaceFor=function(a){var e=this.indexFor(a);return 0<
e&&this.glyphs[e-1].max()>=a.min()||e<this.glyphs.length&&this.glyphs[e].min()<=a.max()?!1:!0};var aa;C.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,e=this.subtiers;if(e){var b=this.browser.featurePanelWidth+2E3;a&&(b*=2);var c=this.viewport.width|0;c<b-50&&(this.viewport.width=c=b);for(var b=this.padding,h=0;h<e.length;++h)b=b+e[h].height+this.padding;h=b=Math.max(b+6,this.browser.minTierHeight);a&&(h*=2);h!=this.viewport.height&&(this.viewport.height=h);Math.max(b,
this.browser.minTierHeight);this.viewportHolder.style.left="-1000px";this.viewport.style.width=a?""+c/2+"px":""+c+"px";this.viewport.style.height=""+b+"px";this.layoutHeight=Math.max(b,this.browser.minTierHeight);this.updateHeight();this.norigin=this.browser.viewStart;e=this.viewport.getContext("2d");e.clearRect(0,0,c,h);e.save();a&&e.scale(2,2);c=this.browser.viewStart-1E3/this.browser.scale;h=this.browser.viewEnd+1E3/this.browser.scale;a=[];if(this.knownCoverage)for(var f=this.knownCoverage.ranges(),
k=0;k<f.length;++k){var d=f[k];0==k?d.min()>c&&a.push({min:c,max:d.min()-1}):a.push({min:f[k-1].max()+1,max:d.min()-1});k==f.length-1&&d.max()<h&&a.push({min:d.max()+1,max:h})}if(0<a.length)for(e.fillStyle="gray",c=0;c<a.length;++c)h=a[c],f=(h.min-this.browser.viewStart)*this.browser.scale+1E3,e.fillRect(f,0,(h.max-this.browser.viewStart)*this.browser.scale+1E3-f,b);b=new D;a=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;e.translate(a,this.padding);b.translate(0,this.padding);
this.paintToContext(e,b,a);this.overlayLabelCanvas=0<b.glyphs.length?b:null;e.restore();this.drawOverlay();this.paintQuant()}};C.prototype.paintToContext=function(a,e,b){var c=this.subtiers,h=this.viewport.width|0;a.save();for(var f=0;f<c.length;++f){for(var k=null,d=c[f].glyphs,p=0;p<d.length;++p){var q=d[p];q.min()<h-b&&q.max()>-b&&(q=d[p],q.draw(a,e),q.quant&&(k=q.quant))}this.scaleVertical?(d=this.browser.scale,a.translate(0,d+this.padding),e.translate(0,d+this.padding)):(a.translate(0,c[f].height+
this.padding),e.translate(0,c[f].height+this.padding))}a.restore();k&&this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(e=c[0].height*(1-(this.quantLeapThreshold-k.min)/(k.max-k.min)),a.save(),a.strokeStyle="red",a.lineWidth=0.3,a.beginPath(),a.moveTo(-1E3,e),a.lineTo(h+1E3,e),a.stroke(),a.restore())};C.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,e;this.subtiers&&0<this.subtiers.length&&
(e=this.subtiers[0].quant);if(e){var b=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var c=this.quantOverlay.getContext("2d");a&&c.scale(2,2);a=2;40<b&&(a=1+(b/20|0));var h=(b+2*this.padding)/(a-1),f=(e.max-e.min)/(a-1);c.fillStyle="white";c.globalAlpha=0.6;"right"==this.browser.rulerLocation?
c.fillRect(20,0,30,b+2*this.padding):c.fillRect(0,0,30,b+2*this.padding);c.globalAlpha=1;c.strokeStyle="black";c.lineWidth=1;c.beginPath();if("right"==this.browser.rulerLocation){c.moveTo(42,this.padding);c.lineTo(50,this.padding);c.lineTo(50,b+this.padding);c.lineTo(42,b+this.padding);for(var k=1;k<a-1;++k){var d=k*h;c.moveTo(50,d);c.lineTo(45,d)}}else for(c.moveTo(8,this.padding),c.lineTo(0,this.padding),c.lineTo(0,b+this.padding),c.lineTo(8,b+this.padding),k=1;k<a-1;++k)d=k*h,c.moveTo(0,d),c.lineTo(5,
d);c.stroke();c.fillStyle="black";if("right"==this.browser.rulerLocation)for(c.textAlign="right",c.fillText(S(e.max),41,8),c.fillText(S(e.min),41,b+this.padding),k=1;k<a-1;++k)d=k*h,c.fillText(S(1*e.max-k*f),41,d+3);else for(c.textAlign="left",c.fillText(S(e.max),9,8),c.fillText(S(e.min),9,b+this.padding),k=1;k<a-1;++k)d=k*h,c.fillText(S(1*e.max-k*f),9,d+3)}else this.quantOverlay.style.display="none"}};C.prototype.styleForFeature=function(a){var e=this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;
for(var b=null,c=this.stylesheet.styles,h=0;h<c.length;++h){var f=c[h];if(!(f.zoom&&f.zoom!=e||f.orientation&&f.orientation!=a.orientation)){var k=f._labelRE;k&&k.test||(k=new RegExp("^"+f.label+"$"),f._labelRE=k);if(!f.label||k.test(a.label))if(k=f._methodRE,k&&k.test||(k=new RegExp("^"+f.method+"$"),f._methodRE=k),!f.method||k.test(a.method)){if(f.type)if("default"==f.type){b||(b=f.style);continue}else if(k=f._typeRE,k&&k.test||(k=new RegExp("^"+f.type+"$"),f._typeRE=k),!k.test(a.type))continue;
return f.style}}}return b};C.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||0};C.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==typeof v&&(v.exports={drawFeatureTier:m})},{"./cigar":8,"./color":9,"./das":10,"./glyphs":21,"./numformats":26,
"./spans":36,"./tier":45,"./utils":49}],19:[function(d,v,s){function n(c,a,b){var f=l(b.type,a.type),d=l(b.label,a.label,b.id,a.id);d&&0!=d.indexOf("__dazzle")&&(f=f+": "+d);this.hit=c;this.feature=a;this.group=b;this.title=f;this.sections=[]}function m(c,a){var b=[];if(c)for(var f=0;f<c.length;++f)t(b,c[f]);if(a)for(f=0;f<a.length;++f)t(b,a[f]);return b}if("undefined"!==typeof d){var g=d("./cbrowser").Browser;d=d("./utils");var l=d.pick,t=d.pushnew,C=d.makeElement}var E=/^([A-Za-z_-]+)=(.+)/;g.prototype.addFeatureInfoPlugin=
function(c){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(c)};n.prototype.setTitle=function(c){this.title=c};n.prototype.add=function(c,a){"string"===typeof a&&(a=C("span",a));this.sections.push({label:c,info:a})};g.prototype.featurePopup=function(c,a,b,f){var d=b.length;a=0<=--d?b[d]:{};var q=0<=--d?b[d]:{};b=new n(b,a,q);b.tier=f;for(var d=this.featureInfoPlugins||[],k=0;k<d.length;++k)try{d[k](a,b)}catch(g){console.log(g.stack||g)}d=f.featureInfoPlugins||[];
for(k=0;k<d.length;++k)try{d[k](a,b)}catch(l){console.log(l.stack||l)}this.removeAllPopups();f=C("table",null,{className:"table table-striped table-condensed"});f.style.width="100%";f.style.margin="0px";d=0;a.method&&(k=C("tr",[C("th","Method"),C("td",a.method)]),f.appendChild(k),++d);k=q.segment?q:a;k=C("tr",[C("th","Location"),C("td",k.segment+":"+k.min+"-"+k.max,{},{minWidth:"200px"})]);f.appendChild(k);++d;void 0===a.score||null===a.score||"-"==a.score||a.suppressScore||(k=C("tr",[C("th","Score"),
C("td",""+a.score)]),f.appendChild(k),++d);(k=m(q.links,a.links))&&0<k.length&&(k=C("tr",[C("th","Links"),C("td",k.map(function(a){return C("div",C("a",a.desc,{href:a.uri,target:"_new"}))}))]),f.appendChild(k),++d);a=m(q.notes,a.notes);for(q=0;q<a.length;++q){var k="Note",t=a[q],B=t.match(E);B&&(k=B[1],t=B[2]);k=C("tr",[C("th",k),C("td",t)]);f.appendChild(k);++d}for(a=0;a<b.sections.length;++a)d=b.sections[a],f.appendChild(C("tr",[C("th",d.label),C("td",d.info)]));this.popit(c,b.title||"Feature",
f,{width:450})}},{"./cbrowser":6,"./utils":49}],20:[function(d,v,s){function n(d){for(var n=d.browser.drawnStart,C=d.browser.drawnEnd,E={},c={},a={},b={},f={},p={},q={},k={},r=[],H,s,B,w=function(){B={};for(var a=0;a<d.currentFeatures.length;++a){var e=d.currentFeatures[a];e.id&&(B[e.id]=e)}},I=function(a){var e=[];if(a.parents)for(var b=0;b<a.parents.length;++b){var c=a.parents[b],f=B[c];f&&"SO:0000704"==f.typeCv&&pushnew(e,c)}return e},y=0;y<d.currentFeatures.length;++y){var F=d.currentFeatures[y];
if(!F.parts){var u=F.min<=C&&F.max>=n;if(F.min&&F.max){if(F.score&&"."!=F.score&&"-"!=F.score){var L=1*F.score;if(!H||L<H)H=L;if(!s||L>s)s=L}var L=[],e=null;if(F.groups)for(var x=0;x<F.groups.length;++x){var A=F.groups[x],P=A.id;if("gene"==A.type)e=P,p[P]=A;else if("translation"!=A.type){m(c,P,F);p[P]=A;L.push(P);A=b[P];if(!A||F.min<A)b[P]=F.min;A=f[P];if(!A||F.max>A)f[P]=F.max}}if(F.parents)for(B||w(),x=0;x<F.parents.length;++x){var J=F.parents[x],v=B[J];if(v){v.parts||(v.parts=[F]);g(c,J,v);m(c,
J,F);p[J]||(p[J]={type:v.type,id:v.id,label:v.label||v.id});L.push(J);A=b[J];if(!A||F.min<A)b[J]=F.min;A=f[J];if(!A||F.max>A)f[J]=F.max;A=I(v);0<A.length&&(e=A[0],J=B[A[0]],p[A[0]]={type:J.type,id:J.id,label:J.label||J.id},d.dasSource.collapseSuperGroups||(d.dasSource.collapseSuperGroups=!0))}}if(0==L.length)u&&m(E,F.type,F);else if(e)for(A=0;A<L.length;++A)P=L[A],g(q,e,P),k[P]=e}else r.push(F)}}for(P in c)r=p[P],"number"!==typeof r.min&&(r.min=b[P]),"number"!==typeof r.max&&(r.max=f[P]),f[P]>=n&&
b[P]<=C&&(a[P]=c[P]);d.ungroupedFeatures=E;d.groupedFeatures=a;d.groups=p;d.superGroups=q;d.groupsToSupers=k;H&&(0<H?H=0:0>s&&(s=0),d.currentFeaturesMinScore=H,d.currentFeaturesMaxScore=s)}if("undefined"!==typeof d){d=d("./utils");var m=d.pusho,g=d.pushnewo}"undefined"!==typeof v&&(v.exports={sortFeatures:n})},{"./utils":49}],21:[function(d,v,s){function n(a,e){this._stroke=a;this._fill=e}function m(a,e,b,c,f,k,d,p){this.x=a;this.y=e;this._width=b;this._height=c;this.fill=f;this.stroke=k;this._alpha=
d;this._radius=p||0}function g(a,e){this.glyphs=a;this.connector=e;this.h=a[0].height();for(var b=[],c=0;c<a.length;++c){var f=a[c];b.push(new P(f.min(),f.max()));this.h=Math.max(this.h,f.height())}this.coverage=A(b)}function l(a,e,b){this.points=a;this.color=e;this._height=b||50}function t(a,e,b,c,f,k,d){this.glyph=e;this.text=b;this.anchor=f||"left";this.align=k||"below";d&&(this.font=d);this.font&&(a.save(),a.font=this.font);b=a.measureText(b);this.font&&a.restore();this.textLen=b.width;this.textHeight=
5;this.bump=e.bump;this.measured=!c}function C(a,e,b){this._x=a;this._height=e;this._stroke=b}function E(a,e,b){this._x=a;this._height=e;this._stroke=b}function c(a,e,b,c,f,d){n.call(this,d,f);this._x=a;this._height=e;this._dir=b;this._width=c}function a(a,e,b,c){this._x=a;this._height=e;this._fill=b;this._stroke=c}function b(a,e,b){this.glyph=a;this._min=e;this._max=b;a&&(this.bump=a.bump)}function f(a,e,b,c,f,d){n.call(this,f,c);this._min=a;this._max=e;this._height=b;this._ori=d}function p(a,e,
b,c){n.call(this,c,null);this._min=a;this._max=e;this._height=b}function q(a,e,b,c,f,d){this._min=a;this._max=e;this._height=b;this._style=c;this._strand=f;this._stroke=d}function k(a,e,b,c,f){this._min=a;this._max=e;this._height=b;this._fill=c;this._stroke=f}function r(a,e,b,c,f,d,k){n.call(this,null,c);this._min=a;this._max=e;this._height=b;this._color=c;this._parallel=f;this._sw=d;this._ne=k}function H(a,e,b,c,f){this._min=a;this._max=e;this._height=b;this._fill=c;this._stroke=f}function Q(a,e,
b,c,f,d){this._min=e;this._max=b;this._height=c;this._fill=f;this._string=d;this._textLen=a.measureText(d).width}function B(a,e,b){var c={red:"darkred",purple:"mediumpurple",blue:"darkblue",green:"darkgreen"}[b.toLowerCase()];b=c?[b,c]:["rgb(73, 68, 149)","rgb(9, 0, 103)"];return"?"==a?"black":"M"==a?"greenyellow":"*"==a?"crimson":b[e%2]}function w(a){var e={A:"T",T:"A",G:"C",C:"G"};a=a.split("").reverse().join("");for(var b=[],c=0;c<a.length;++c){var f=a.substr(c,1).toUpperCase();b.push(f in e?e[f]:
"N")}return b.join("")}function I(a,e,b,c,f,d,k){this._min=a;this._max=e;this._height=b;this._fill=c;this._seq=f;this._orientation=d;this._readframe=k}function y(a,e,b,c){this.glyph=a;this._height=c;this._x=e;this._y=b}function F(a,e,b,c){this._x=a;this._y=e;this._height=b;this._fill=c}function u(a){this._height=a||50}function L(a,e,b,c,f){n.call(this,f,c);this._x=a;this._r=e;this._points=b}function e(a,e,b,c,f){this._x=a;this._height=e;this._overhang=b;this._fill=c;this._stroke=f;this._hh=e/2}function x(){this.oy=
this.ox=0;this.glyphs=[]}if("undefined"!==typeof d){s=d("./spans");var A=s.union,P=s.Range;s=d("./utils");var J=s.makeElementNS,U=s.AMINO_ACID_TRANSLATION;d=d("./svg-utils");var z=d.NS_SVG,D=d.SVGPath}n.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};n.prototype.toSVG=function(){var a=new D;this.drawPath(a);return J(z,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||
"none"})};n.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};m.prototype.draw=function(a){var e=this._radius;0<e?(a.beginPath(),a.moveTo(this.x+e,this.y),a.lineTo(this.x+this._width-e,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+e,e),a.lineTo(this.x+this._width,this.y+this._height-e),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-e,this.y+this._height,e),a.lineTo(this.x+e,this.y+this._height),a.arcTo(this.x,this.y+
this._height,this.x,this.y+this._height-e,e),a.lineTo(this.x,this.y+e),a.arcTo(this.x,this.y,this.x+e,this.y,e),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.strokeRect(this.x,
this.y,this._width,this._height)));null!=this._alpha&&a.restore()};m.prototype.toSVG=function(){var a=J(z,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:0.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};m.prototype.min=function(){return this.x};m.prototype.max=function(){return this.x+this._width};m.prototype.height=function(){return this.y+this._height};g.prototype.drawConnectors=function(a){for(var e=
this.coverage.ranges(),b=1;b<e.length;++b){var c=e[b],f=e[b-1];if(f&&c.min()>f.max()){var f=f.max(),c=c.min(),d=(f+c)/2;"hat+"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(d,0),a.lineTo(c,this.h/2)):"hat-"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(d,this.h),a.lineTo(c,this.h/2)):"collapsed+"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(c,this.h/2),4<c-f&&(a.moveTo(d-2,this.h/2-3),a.lineTo(d+2,this.h/2),a.lineTo(d-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(c,
this.h/2),4<c-f&&(a.moveTo(d+2,this.h/2-3),a.lineTo(d-2,this.h/2),a.lineTo(d+2,this.h/2+3))):(a.moveTo(f,this.h/2),a.lineTo(c,this.h/2))}}};g.prototype.draw=function(a,e){for(var b=0;b<this.glyphs.length;++b)this.glyphs[b].draw(a,e);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};g.prototype.toSVG=function(){for(var a=J(z,"g"),e=0;e<this.glyphs.length;++e)a.appendChild(this.glyphs[e].toSVG());e=new D;this.drawConnectors(e);0<e.toPathData().length&&(e=J(z,"path",null,{d:e.toPathData(),
fill:"none",stroke:"black",strokeWidth:0.5}),a.appendChild(e));return a};g.prototype.min=function(){return this.coverage.min()};g.prototype.max=function(){return this.coverage.max()};g.prototype.height=function(){return this.h};l.prototype.min=function(){return this.points[0]};l.prototype.max=function(){return this.points[this.points.length-2]};l.prototype.height=function(){return this._height};l.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var e=0;e<
this.points.length;e+=2){var b=this.points[e],c=this.points[e+1];0==e?a.moveTo(b,c):a.lineTo(b,c)}a.stroke();a.restore()};l.prototype.toSVG=function(){for(var a=new D,e=0;e<this.points.length;e+=2){var b=this.points[e],c=this.points[e+1];0==e?a.moveTo(b,c):a.lineTo(b,c)}return J(z,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};t.prototype.toSVG=function(){var a=this.glyph.toSVG(),e={};"above"==this.align?(a=J(z,"g",a,{transform:"translate(0, "+(this.textHeight|2)+
")"}),e.y=this.textHeight):e.y=this.glyph.height()+15;this.font&&(e.fontSize=7);e.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return J(z,"g",[a,J(z,"text",this.text,e)])};t.prototype.min=function(){return this.glyph.min()};t.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};t.prototype.height=function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+
2):a+20);return a};t.prototype.draw=function(a,e){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();e.registerGlyph(this)};t.prototype.drawOverlay=function(a,e,b){a.fillStyle="black";this.font&&(a.save(),a.font=this.font);"center"==this.anchor?b=(this.glyph.min()+this.glyph.max()-this.textLen)/2:(b=this.glyph.min(),b<e&&(b=Math.min(e,this.glyph.max()-this.textLen)));a.fillText(this.text,b,"above"==this.align?this.textHeight:this.glyph.height()+
15);this.font&&a.restore()};C.prototype.draw=function(a){var e=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-e,e);a.lineTo(this._x+e,e);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};C.prototype.toSVG=function(){var a=this._height/2,e=new D;e.moveTo(this._x,0);e.lineTo(this._x,this._height);e.moveTo(this._x-a,a);e.lineTo(this._x+a,a);return J(z,"path",null,{d:e.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};C.prototype.min=
function(){return this._x-this._height/2};C.prototype.max=function(){return this._x+this._height/2};C.prototype.height=function(){return this._height};E.prototype.draw=function(a){var e=this._height/2;a.beginPath();a.moveTo(this._x-e,0);a.lineTo(this._x+e,this._height);a.moveTo(this._x-e,this._height);a.lineTo(this._x+e,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};E.prototype.toSVG=function(){var a=this._height/2,e=new D;e.moveTo(this._x-a,0);e.lineTo(this._x+a,this._height);e.moveTo(this._x-
a,this._height);e.lineTo(this._x+a,0);return J(z,"path",null,{d:e.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};E.prototype.min=function(){return this._x-this._height/2};E.prototype.max=function(){return this._x+this._height/2};E.prototype.height=function(){return this._height};c.prototype=Object.create(n.prototype);c.prototype.drawPath=function(a){var e=this._height/2,b=this._width/2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-b,0),a.lineTo(this._x+b,0)):
"W"===this._dir?(a.moveTo(this._x+b,e),a.lineTo(this._x-b,0),a.lineTo(this._x-b,this._height)):"E"===this._dir?(a.moveTo(this._x-b,e),a.lineTo(this._x+b,0),a.lineTo(this._x+b,this._height)):(a.moveTo(this._x,0),a.lineTo(this._x+b,this._height),a.lineTo(this._x-b,this._height));a.closePath()};c.prototype.min=function(){return this._x-this._height/2};c.prototype.max=function(){return this._x+this._height/2};c.prototype.height=function(){return this._height};a.prototype.draw=function(a){var e=this._height/
2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,e,e,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};a.prototype.toSVG=function(){var a=this._height/2;return J(z,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};a.prototype.min=function(){return this._x-this._height/2};a.prototype.max=function(){return this._x+this._height/2};a.prototype.height=function(){return this._height};
b.prototype.draw=function(a,e){this.glyph&&this.glyph.draw(a,e)};b.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():J(z,"g")};b.prototype.min=function(){return this._min};b.prototype.max=function(){return this._max};b.prototype.height=function(){return this.glyph?this.glyph.height():1};f.prototype=Object.create(n.prototype);f.prototype.min=function(){return this._min};f.prototype.max=function(){return this._max};f.prototype.height=function(){return this._height};f.prototype.drawPath=
function(a){var e=this._max,b=this._min,c=this._height,f=0,d=0,k=this._height+2,p=0.333333*this._height;this._ori&&("+"===this._ori?d=0.5*this._height:"-"===this._ori&&(f=0.5*this._height));e-b<k&&(b=(e+b-k)/2,e=b+k);a.moveTo(b+f,0+p);a.lineTo(e-d,0+p);a.lineTo(e-d,0);a.lineTo(e,0+this._height/2);a.lineTo(e-d,0+c);a.lineTo(e-d,0+p+p);a.lineTo(b+f,0+p+p);a.lineTo(b+f,0+c);a.lineTo(b,0+c/2);a.lineTo(b+f,0);a.lineTo(b+f,0+p)};p.prototype=Object.create(n.prototype);p.prototype.min=function(){return this._min};
p.prototype.max=function(){return this._max};p.prototype.height=function(){return this._height};p.prototype.drawPath=function(a){var e=this._min,b=this._max,c=this._height,f=c/2;a.moveTo(e,f);a.lineTo(b,f);a.moveTo(e,0);a.lineTo(e,c);a.moveTo(b,0);a.lineTo(b,c)};q.prototype.min=function(){return this._min};q.prototype.max=function(){return this._max};q.prototype.height=function(){return this._height};q.prototype.drawPath=function(a){var e=this._min,b=this._max,c=this._height,f=c/2;"hat"===this._style?
(a.moveTo(e,f),a.lineTo((e+b)/2,"-"===this._strand?c:0)):a.moveTo(e,f);a.lineTo(b,f)};q.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};q.prototype.toSVG=function(){var a=new D;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return J(z,"path",null,a)};k.prototype.min=function(){return this._min};
k.prototype.max=function(){return this._max};k.prototype.height=function(){return this._height};k.prototype.drawStemPath=function(a){var e=this._max,b=this._height/2;a.moveTo(this._min,b);a.lineTo(e,b)};k.prototype.drawTrigsPath=function(a){var e=this._min,b=this._max,c=this._height,f=c/2;a.moveTo(e,0);a.lineTo(e+c,f);a.lineTo(e,c);a.lineTo(e,0);a.moveTo(b,0);a.lineTo(b-c,f);a.lineTo(b,c);a.lineTo(b,0)};k.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();
a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};k.prototype.toSVG=function(){var a=new D;this.drawStemPath(a);var e=new D;this.drawTrigsPath(e);return J(z,"g",[J(z,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),J(z,"path",null,{d:e.toPathData(),fill:this._fill||"none"})])};r.prototype=Object.create(n.prototype);r.prototype.min=function(){return this._min};r.prototype.max=function(){return this._max};r.prototype.height=function(){return this._height};r.prototype.drawPath=
function(a){var e=this._min,b=this._max,c=this._height;if(this._parallel){var f=c/2,d=0.4*c;this._sw?(a.moveTo(e+f,c-d),a.lineTo(e+f,c),a.lineTo(e,f),a.lineTo(e+f,0),a.lineTo(e+f,d)):(a.moveTo(e,c-d),a.lineTo(e,d));this._ne?(a.lineTo(b-f,d),a.lineTo(b-f,0),a.lineTo(b,f),a.lineTo(b-f,c),a.lineTo(b-f,c-d)):(a.lineTo(b,d),a.lineTo(b,c-d))}else{var f=(e+b)/2,d=0.4*(b-e),k=c/3;this._ne?(a.moveTo(e+d,k),a.lineTo(e,k),a.lineTo(f,0),a.lineTo(b,k),a.lineTo(b-d,k)):(a.moveTo(e+d,0),a.lineTo(b-d,0));this._sw?
(a.lineTo(b-d,c-k),a.lineTo(b,c-k),a.lineTo(f,c),a.lineTo(e,c-k),a.lineTo(e+d,c-k)):(a.lineTo(b-d,c),a.lineTo(e+d,c))}a.closePath()};H.prototype.min=function(){return this._min};H.prototype.max=function(){return this._max};H.prototype.height=function(){return this._height};H.prototype.toSVG=function(){return J(z,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};H.prototype.draw=function(a){this._fill&&(a.fillStyle=this._fill,
a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var e=2;e<this._height;e+=3)a.moveTo(this._min,e),a.lineTo(this._max,e);a.stroke()}};Q.prototype.min=function(){return this._min};Q.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};Q.prototype.height=function(){return this._height};Q.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,
this._min,this._height-4)};Q.prototype.toSVG=function(){return J(z,"text",this._string,{x:this._min,y:this._height-4})};I.prototype.min=function(){return this._min};I.prototype.max=function(){return this._max};I.prototype.height=function(){return this._height};I.prototype.draw=function(a){var e=this._seq,b=this._fill;if(e){var c=(this._max-this._min+1)/e.length,f=(3-this._readframe)%3,d=(e.length-f)%3,f="+"==this._orientation?f:d;0<f&&(a.fillStyle=b,a.fillRect(this._min,0,c*f,this._height));for(;f<
e.length;f+=3){d=e.substr(f,3).toUpperCase();"-"==this._orientation&&(d=w(d));var k=d in U?U[d]:"?",b=3==d.length?B(k,f,this._fill):this._fill;a.fillStyle=b;a.fillRect(this._min+f*c,0,c*d.length,this._height);8<=c&&3==d.length&&(a.fillStyle="white",a.fillText(k,this._min+(f+1)*c,this._height))}}};I.prototype.toSVG=function(){var a=J(z,"g"),e=this._seq,b=this._fill;if(!e)return a;var c=(this._max-this._min+1)/e.length,f=(3-this._readframe)%3,d=(e.length-f)%3,f="+"==this._orientation?f:d;for(0<f&&a.appendChild(J(z,
"rect",null,{x:this._min,y:0,width:c*f,height:this._height,fill:b}));f<e.length;f+=3){d=e.substr(f,3).toUpperCase();"-"==this._orientation&&(d=w(d));var k=d in U?U[d]:"?",b=3==d.length?B(k,f,this._fill):this._fill;a.appendChild(J(z,"rect",null,{x:this._min+f*c,y:0,width:c*d.length,height:this._height,fill:b}));8<=c&&3==d.length&&a.appendChild(J(z,"text",k,{x:this._min+(f+1)*c,y:this._height,fill:"white"}))}return a};(function(a){function e(a,b,c,f,d,h,k,p,q,g,r){this.baseColors=a;this._strandColor=
b;this._min=c;this._max=f;this._height=d;this._seq=h;this._ref=k;this._scheme=p;this._quals=q;this._fillbg=g;this._scaleVertical=r}var b=1<window.devicePixelRatio,c={},f=/^[ACGT-]$/;e.prototype.min=function(){return this._min};e.prototype.max=function(){return this._max};e.prototype.height=function(){return this._height};e.prototype.alphaForQual=function(a){return 0.1+0.9*Math.max(0,Math.min(1*a/30,1))};e.prototype.draw=function(a){var e=this._seq,d=this._ref,h="mismatch-all"===this._scheme,k=e?e.length:
this._max-this._min+1,p=(this._max-this._min+1)/k;"mismatch"!==this._scheme&&"mismatch-all"!==this._scheme||8<=p||(a.fillStyle=this._strandColor,this._scaleVertical?a.fillRect(this._min,p,this._max-this._min,p):a.fillRect(this._min,this._height/4,this._max-this._min,this._height/2));for(var q=0;q<k;++q){var g=e?e.substr(q,1).toUpperCase():"N";if(f.test(g)||8<=p){var r=this.baseColors[g];if(this._quals){var x=this._quals.charCodeAt(q)-33,u=a.globalAlpha;a.globalAlpha=this.alphaForQual(x)}r||(x=d?d.substr(q,
1).toUpperCase():"N",r="N"==g||"N"==x?"gray":this._strandColor,h&&(g=x));a.fillStyle=r;x=f.test(g);!this._fillbg&&8<=p&&x||(this._scaleVertical?a.fillRect(this._min+q*p,p,p,p):a.fillRect(this._min+q*p,0,p,this._height));if(8<=p&&x){var A=r+"_"+g,x=c[A];if(!x){x=document.createElement("canvas");b?(x.width=16,x.height=20):(x.width=8,x.height=10);var w=x.getContext("2d");b&&w.scale(2,2);w.fillStyle=this._fillbg?"black":r;r=w.measureText(g).width;w.fillText(g,0.5*(8-r),8);c[A]=x}g=this._scaleVertical?
p:0;b?a.drawImage(x,this._min+q*p+0.5*(p-8),g,8,10):a.drawImage(x,this._min+q*p+0.5*(p-8),g)}this._quals&&(a.globalAlpha=u)}}};e.prototype.toSVG=function(){for(var a=this._seq,e=this._ref,b="mismatch-all"===this._scheme,c=(this._max-this._min+1)/this._seq.length,d=J(z,"g"),h=0;h<a.length;++h){var k=a?a.substr(h,1).toUpperCase():"N",p=this.baseColors[k];if(!p){var q=e?e.substr(h,1).toUpperCase():"N",p="N"==k||"N"==q?"gray":this._strandColor;b&&(k=q)}q=1;this._quals&&(q=this._quals.charCodeAt(h)-33,
q=this.alphaForQual(q));var g=f.test(k);!this._fillbg&&8<=c&&g||d.appendChild(J(z,"rect",null,{x:this._min+h*c,y:0,width:c,height:this._height,fill:p,fillOpacity:q}));8<=c&&g&&d.appendChild(J(z,"text",k,{x:this._min+(0.5+h)*c,y:8,textAnchor:"middle",fill:this._fillbg?"black":p,fillOpacity:q}))}return d};a.SequenceGlyph=e})(this);y.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};y.prototype.min=function(){return this.glyph.min()+this._x};y.prototype.max=function(){return this.glyph.max()+
this._x};y.prototype.minY=function(){return this._y};y.prototype.maxY=function(){return this._y+this.glyph.height()};y.prototype.draw=function(a,e){a.save();a.translate(this._x,this._y);this.glyph.draw(a,e);a.restore()};y.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};F.prototype.min=function(){return this._x-2};F.prototype.max=function(){return this._x+2};F.prototype.height=function(){return this._height};F.prototype.draw=
function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};F.prototype.toSVG=function(){return J(z,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};u.prototype.notSelectable=!0;u.prototype.min=function(){return-1E5};u.prototype.max=function(){return 1E5};u.prototype.height=function(){return this._height};u.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var e=
0;e<=this._height;e+=10)a.moveTo(-5E3,e),a.lineTo(5E3,e);a.stroke();a.restore()};u.prototype.toSVG=function(){for(var a=new D,e=0;e<=this._height;e+=10)a.moveTo(-5E3,e),a.lineTo(5E3,e);return J(z,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};L.prototype=Object.create(n.prototype);L.prototype.min=function(){return this._x-this._r};L.prototype.max=function(){return this._x+this._r};L.prototype.height=function(){return 2*this._r};L.prototype.drawPath=function(a){for(var e=
this._x,b=this._r,c=this._r,f=0;f<this._points;++f){var d=6.28*f/this._points,k=e+c*Math.sin(d),d=b-c*Math.cos(d);0==f?a.moveTo(k,d):a.lineTo(k,d);d=6.28*(f+0.5)/this._points;k=e+0.4*c*Math.sin(d);d=b-0.4*c*Math.cos(d);a.lineTo(k,d)}a.closePath()};e.prototype.draw=function(a){var e=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,e,e-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=
this._stroke,a.stroke())};e.prototype.toSVG=function(){var a=this._hh;return J(z,"g",[J(z,"circle",null,{cx:this._x,cy:a,r:a-this._overhang}),J(z,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};e.prototype.min=function(){return this._x-this._hh};e.prototype.max=function(){return this._x+this._hh};e.prototype.height=function(){return this._height};x.prototype.translate=function(a,e){this.ox+=a;this.oy+=e};x.prototype.registerGlyph=
function(a){this.glyphs.push({x:this.ox,y:this.oy,glyph:a})};x.prototype.draw=function(a,e,b){for(var c=0;c<this.glyphs.length;++c){var f=this.glyphs[c];a.save();a.translate(f.x,f.y);f.glyph.drawOverlay(a,e,b);a.restore()}};"undefined"!==typeof v&&(v.exports={BoxGlyph:m,GroupGlyph:g,LineGraphGlyph:l,LabelledGlyph:t,CrossGlyph:C,ExGlyph:E,TriangleGlyph:c,DotGlyph:a,PaddedGlyph:b,AArrowGlyph:f,SpanGlyph:p,LineGlyph:q,PrimersGlyph:k,ArrowGlyph:r,TooManyGlyph:H,TextGlyph:Q,SequenceGlyph:this.SequenceGlyph,
AminoAcidGlyph:I,TranslatedGlyph:y,GridGlyph:u,StarGlyph:L,PointGlyph:F,PlimsollGlyph:e,OverlayLabelCanvas:x})},{"./spans":36,"./svg-utils":39,"./utils":49}],22:[function(d,v,s){function n(c,a){this.base=c;this.query=a}function m(c){if(0<c)return"+";if(0>c)return"-"}if("undefined"!==typeof d)var g=d("./das").DASFeature,l=d("./utils").shallowCopy,t=d("./spans"),C=t.Range,E=t.union;n.prototype.features=function(c,a,b){url=this.base+"/features/"+c.name;a=[];this.query&&a.push(this.query);c.isBounded&&
(a.push("start="+c.start),a.push("end="+c.end));0<a.length&&(url=url+"?"+a.join("&"));var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4==f.readyState)if(300<=f.status)b(null,"Error code "+f.status);else{var a=JSON.parse(f.response).features,d=[];for(fi=0;fi<a.length;++fi){var k=a[fi],r=new g;r.segment=c.name;r.min=(k.start|0)+1;r.max=k.end|0;k.name&&(r.label=k.name);k.strand&&(r.orientation=m(k.strand));r.type=k.type||"unknown";if(k.subfeatures&&0<k.subfeatures.length){r.id=k.uniqueID;
for(var n=[],s=[],B=[],w=0;w<k.subfeatures.length;++w){var I=k.subfeatures[w],y=l(r);y.min=I.start+1;y.max=I.end;y.groups=[r];B.push(y);n.push(new C(y.min,y.max));"CDS"===I.type&&s.push(y)}if(0<s.length){t=E(n);var F=l(r);F.type="transcript";t.ranges().forEach(function(a){d.push({segment:c.name,min:a.min(),max:a.max(),orientation:r.orientation,groups:[F],type:"transcript"})});var u=l(r);s.forEach(function(a){a.type="translation";a.groups=[u];d.push(a)})}else B.forEach(function(a){d.push(a)})}else d.push(r)}b(d)}};
f.open("GET",url,!0);f.responseType="text";f.send("")};"undefined"!==typeof v&&(v.exports={JBrowseStore:n})},{"./das":10,"./spans":36,"./utils":49}],23:[function(d,v,s){function n(){var a=this;this.reqs=[];this.awaitedFeatures={};this.requestsIssued=new y(function(b,c){a.notifyRequestsIssued=b})}function m(a,b,c,e,f,d,k){this.chr=a;this.min=b;this.max=c;this.coverage=k;this.scale=e;this.features=f||[];this.status=d}function g(a,b,c,e,f,d){this.tierMap=a;this.chr=b;this.min=c;this.max=e;this.scale=
f;this.seqSource=d||new q;this.viewCount=0;this.featureCache={};this.latestViews={}}function l(a,b,c){for(var e=[],f={},d=0;d<a.length;++d){var k=a[d];k.min&&k.max?k.groups&&0<k.groups.length?C(f,k.groups[0].id,k):k.min<=c&&k.max>=b&&e.push(k):e.push(k)}for(var p in f){a=f[p];for(var q=1E11,g=-1E11,d=0;d<a.length;++d)k=a[d],q=Math.min(q,k.min),g=Math.max(g,k.max);if(q<=c||g>=b)for(d=0;d<a.length;++d)e.push(a[d])}return e}if("undefined"!==typeof d){s=d("./utils");var t=s.Awaited,C=s.pusho;s=d("./sourceadapters");
var E=s.MappedFeatureSource,c=s.CachingFeatureSource,a=s.BWGFeatureSource,b=s.RemoteBWGFeatureSource,f=s.BAMFeatureSource,p=s.RemoteBAMFeatureSource,q=s.DummySequenceSource,k=s.DummyFeatureSource,r=d("./overlay").OverlayFeatureSource;s=d("./spans");var H=s.Range,Q=s.intersection;s=d("./sample");var B=s.downsample,w=s.getBaseCoverage,I=d("./das").DASSequence,y=d("es6-promise").Promise}n.prototype.addRequest=function(a){this.reqs.push(a)};n.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};
m.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};g.prototype.cancel=function(){this.cancelled=!0};g.prototype.bestCacheOverlapping=function(a,b,c){return(a=this.featureCache[this.tierMap[0]])?a:null};g.prototype.retrieveFeatures=function(a,b,c,e,f,d){if(f!=f)throw"retrieveFeatures called with silly scale";if(b!=this.chr)throw"Can't extend Known Space to a new chromosome";1>c&&(c=1);this.min=c;this.max=e;this.scale=f;this.pool&&this.pool.abortAll();this.pool=
new n;this.awaitedSeq=new t;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(a,d);this.pool.notifyRequestsIssued()};g.prototype.invalidate=function(a,b){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a],b))};g.prototype.startFetchesForTiers=function(a,b){for(var c=this,e=this.awaitedSeq,f=!1,d,k=0;k<a.length;++k)try{this.startFetchesFor(a[k],e,b)&&(f=!0)}catch(p){var q=a[k];q.currentFeatures=[];q.currentSequence=null;console.log("Error fetching tier source");console.log(p);
d=p;b(p,q)}if(f&&!this.seqWasFetched){this.seqWasFetched=!0;var g=this.min,r=this.max;if(this.cs&&this.cs.start<=g&&this.cs.end>=r)return f=this.cs.start==g&&this.cs.end==r?this.cs:new I(this.cs.name,g,r,this.cs.alphabet,this.cs.seq.substring(g-this.cs.start,r+1-this.cs.start)),e.provide(f);this.seqSource.fetch(this.chr,g,r,this.pool,function(a,b){if(b){if(!c.cs||g<=c.cs.start&&r>=c.cs.end||g>=c.cs.end||r<=c.cs.start||r-g>c.cs.end-c.cs.start)c.cs=b;e.provide(b)}else console.log("Sequence loading failed",
a),e.provide(null)})}if(d)throw d;};g.prototype.startFetchesFor=function(a,b,c){var e=this,f=this.viewCount,d=a.getSource()||new k,p=a.needsSequence(this.scale),q=e.featureCache[a],g=a.getActiveStyleFilters(this.scale),r;g&&(r=g.typeList());var w=this.chr,h=this.min,n=this.max;if(void 0===r)return!1;if(q&&q.chr===this.chr&&q.min<=h&&q.max>=n){var y=q.features;if(q.min<h||q.max>n)y=l(y,h,n);e.provision(a,q.chr,Q(q.coverage,new H(h,n)),q.scale,r,y,q.status,p?b:null,c);y=d.getScales();if(q.scale<=this.scale||
!y)return p}d.instrument&&console.log("Starting  fetch "+f+" ("+h+", "+n+")");d.fetch(w,h,n,this.scale,r,this.pool,function(k,g,l,y){d.instrument&&console.log("Finishing fetch "+f);var t=e.latestViews[a]||-1;if(!(e.cancelled||t>f)){y||(y=new H(h,n));if(!q||h<q.min||n>q.max)e.featureCache[a]=new m(w,h,n,l,g,k,y);e.latestViews[a]=f;e.provision(a,w,y,l,r,g,k,p?b:null,c)}},g);return p};g.prototype.provision=function(d,k,q,e,g,m,n,l,y){if(n)d.setFeatures(k,q,e,[],null),y(n,d);else{for(var z=!1,t=!1,h=
d.getSource();E.prototype.isPrototypeOf(h)||c.prototype.isPrototypeOf(h)||r.prototype.isPrototypeOf(h);)h=r.prototype.isPrototypeOf(h)?h.sources[0]:h.source;if(a.prototype.isPrototypeOf(h)||b.prototype.isPrototypeOf(h)||f.prototype.isPrototypeOf(h)||p.prototype.isPrototypeOf(h))z=!0;h.opts&&(h.opts.forceReduction||h.opts.noDownsample)||z&&g&&1==g.length&&0<=g.indexOf("density")&&(m=B(m,this.scale));g&&1==g.length&&0<=g.indexOf("base-coverage")&&(t=!0);l?l.await(function(a){t&&(m=w(m,a,d.browser.baseColors));
d.setFeatures(k,q,e,m,a);y(n,d)}):(d.setFeatures(k,q,e,m),y(n,d))}};"undefined"!==typeof v&&(v.exports={KnownSpace:g})},{"./das":10,"./overlay":27,"./sample":29,"./sourceadapters":34,"./spans":36,"./utils":49,"es6-promise":53}],24:[function(d,v,s){function n(a,b){this.block=a;this.offset=b}function m(a,b){var c=4294967296*(a[b+6]&255)+16777216*(a[b+5]&255)+65536*(a[b+4]&255)+256*(a[b+3]&255)+(a[b+2]&255),d=a[b+1]<<8|a[b];return 0==c&&0==d?null:new n(c,d)}function g(a,b){b=Math.min(b||1,a.byteLength-
50);for(var f=[],d=[0],q=0;d[0]<b;){var k=new Uint8Array(a,d[0],12),k=k[11]<<8|k[10],k=E(a,12+k+d[0],Math.min(65536,a.byteLength-12-k-d[0]),d);d[0]+=8;q+=k.byteLength;f.push(k)}if(1==f.length)return f[0];d=new Uint8Array(q);for(k=q=0;k<f.length;++k){var g=new Uint8Array(f[k]);c(g,0,d,q,g.length);q+=g.length}return d.buffer}function l(a,b){this.minv=a;this.maxv=b}function t(a,b){--b;return a>>14==b>>14?4681+(a>>14):a>>17==b>>17?585+(a>>17):a>>20==b>>20?73+(a>>20):a>>23==b>>23?9+(a>>23):a>>26==b>>26?
1+(a>>26):0}function C(a,b){var c,d=[];--b;d.push(0);for(c=1+(a>>26);c<=1+(b>>26);++c)d.push(c);for(c=9+(a>>23);c<=9+(b>>23);++c)d.push(c);for(c=73+(a>>20);c<=73+(b>>20);++c)d.push(c);for(c=585+(a>>17);c<=585+(b>>17);++c)d.push(c);for(c=4681+(a>>14);c<=4681+(b>>14);++c)d.push(c);return d}if("undefined"!==typeof d){d=d("jszlib");var E=d.inflateBuffer,c=d.arrayCopy}n.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof v&&(v.exports={unbgzf:g,readVob:m,reg2bin:t,reg2bins:C,
Chunk:l})},{jszlib:65}],25:[function(d,v,s){function n(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}function m(c){this.source=c;t.call(this);this.storeHolder=new C;this.parser=l(c.payload);if(!this.parser)throw"Unsupported memstore payload: "+c.payload;var a=this;this._load(function(b,c){if(b){for(var d=new n,q=[],k=b.split("\n"),g=a.parser.createSession(function(a){q.push(a)}),m=0;m<k.length;++m){var l=k[m];0<l.length&&g.parse(l)}g.flush();d.addFeatures(q);a.storeHolder.provide(d)}else a.error=
c||"No data",a.storeHolder.provide(null)})}if("undefined"!==typeof d){v=d("./sourceadapters");var g=v.registerSourceAdapterFactory,l=v.makeParser,t=v.FeatureSourceBase;d("./das");d=d("./utils");var C=d.Awaited,E=d.textXHR}n.prototype.addFeatures=function(c){for(var a={},b=0;b<c.length;++b){var f=c[b],d=f.segment||f.chr,q=this.featuresByChr[d];q||(q=[],this.featuresByChr[d]=q);q.push(f);a[d]=!0;f=f.max-f.min+1;f>this.maxLength&&(this.maxLength=f)}for(d in a)q=this.featuresByChr[d],q.sort(function(a,
b){var c=a.min-b.min;return 0!=c?c:a.max-b.max});this.chrRing=null};n.prototype._indexFor=function(c,a){for(var b=0,f=c.length;f>b;){var d=(b+f)/2|0;if(d>=c.length)return c.length;a<c[d].min?f=d:b=d+1}return f};n.prototype.fetch=function(c,a,b){var f=this.featuresByChr[c];f||(f=0==c.indexOf("chr")?this.featuresByChr[c.substring(3)]:this.featuresByChr["chr"+c]);if(!f)return[];var d=Math.max(0,this._indexFor(f,a-this.maxLength-1));c=Math.min(f.length-1,this._indexFor(f,b));for(var q=[];d<=c;++d){var k=
f[d];k.min<=b&&k.max>=a&&q.push(k)}return q};n.prototype.findNextFeature=function(c,a,b){if(null==this.chrRing){this.chrRing=[];for(c in this.featuresByChr)this.chrRing.push(c);this.chrRing.sort()}var f=this.featuresByChr[c];f||(c=0==c.indexOf("chr")?c.substring(3):"chr"+c,f=this.featuresByChr[c]);if(!f)return null;var d=Math.max(0,Math.min(this._indexFor(f,a),f.length-1));if(0<b){for(;d<f.length;){var q=f[d++];if(q.min>a)return q}c=this.chrRing.indexOf(c)+1;c>=this.chrRing.length&&(c=0);return this.findNextFeature(this.chrRing[c],
0,b)}for(;0<=d;)if(q=f[d--],q.max<a)return q;c=this.chrRing.indexOf(c)-1;0>c&&(c=this.chrRing.length-1);return this.findNextFeature(this.chrRing[c],1E10,b)};m.prototype=Object.create(t.prototype);m.prototype._load=function(c){if(this.source.blob){var a=new FileReader;a.onloadend=function(){return c(a.result,a.error)};a.readAsText(this.source.blob)}else{if(this.source.credentials)var b={credentials:this.source.credentials};E(this.source.uri,c,b)}};m.prototype.fetch=function(c,a,b,f,d,q,k){var g=this;
this.storeHolder.await(function(f){return f?(f=f.fetch(c,a,b),k(null,f,1E8)):k(g.error)})};m.prototype.getStyleSheet=function(c){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(c)};m.prototype.getDefaultFIPs=function(c){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(c)};m.prototype.getScales=function(){return 1E8};m.prototype.findNextFeature=function(c,a,b,f){var d=this;this.storeHolder.await(function(q){return q?f(q.findNextFeature(c,a,b)):f(null,d.error)})};
m.prototype.capabilities=function(){return{leap:!0}};g("memstore",function(c){return{features:new m(c)}})},{"./das":10,"./sourceadapters":34,"./utils":49}],26:[function(d,v,s){function n(d){return(d|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function m(d){d=""+d;var m=d.indexOf(".");if(0>m)return d;var n=2;"-"==d.substring(0,1)&&++n;return m>=n?d.substring(0,m):d.substring(0,m+2)}"undefined"!==typeof v&&(v.exports={formatLongInt:n,formatQuantLabel:m})},{}],27:[function(d,v,s){function n(d,
c){this.sources=d;this.opts=c||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var a=0;a<this.sources.length;++a)this.initN(a);"function"===typeof c.merge?this.merge=c.merge:"concat"==c.merge?this.merge=l:"alternates"==c.merge?(this.merge=l,this.filterDispatchOnMethod=!0):this.merge=g}function m(d,c,a){this.source=d;this.callback=c;this.sources=a;this.count=a.length;this.statusCount=this.returnCount=0;this.returns=[];this.features=
[];this.statuses=[];this.scale=null}function g(d){for(var c=[],a=1;a<d.length;++a){for(var b={},f=d[a],p=0;p<f.length;++p)b[this.keyForFeature(f[p])]=f[p];c.push(b)}a=[];d=d[0];for(p=0;p<d.length;++p){for(var q=d[p],k=0;k<c.length;++k)if(b=c[k],f=b[this.keyForFeature(q)])for(var g in f)"score"===g?q.score2=f.score:"min"!==g&&"max"!==g&&"segment"!==g&&"_cachedStyle"!==g&&(q[g]=f[g]);a.push(q)}return a}function l(d,c){for(var a=[],b=0;b<d.length;++b)for(var f=d[b],p=c[b].name,q=0;q<f.length;++q){var k=
f[q];k.method=p;a.push(k)}return a}if("undefined"!==typeof d){d=d("./utils");var t=d.shallowCopy,C=d.arrayIndexOf}n.prototype.initN=function(d){var c=this.sources[d],a=this;this.business[d]=0;c.addActivityListener&&c.addActivityListener(function(b){a.business[d]=b;a.notifyActivity()});c.addChangeListener&&c.addChangeListener(function(){a.notifyChange()});c.addReadinessListener&&c.addReadinessListener(function(b){a.readiness[d]=b;a.notifyReadiness()})};n.prototype.addReadinessListener=function(d){this.readinessListeners.push(d);
this.notifyReadinessListener(d)};n.prototype.removeReadinessListener=function(d){d=C(this.readinessListeners,d);0<=d&&this.readinessListeners.splice(d,1)};n.prototype.notifyReadiness=function(){for(var d=0;d<this.readinessListeners.length;++d)this.notifyReadinessListener(this.readinessListeners[d])};n.prototype.notifyReadinessListener=function(d){for(var c=null,a=0;a<this.readiness.length;++a)if(null!=this.readiness[a]){c=this.readiness[a];break}try{d(c)}catch(b){console.log(b)}};n.prototype.addActivityListener=
function(d){this.activityListeners.push(d)};n.prototype.removeActivityListener=function(d){d=C(this.activityListeners,d);0<=d&&this.activityListeners.splice(d,1)};n.prototype.notifyActivity=function(){for(var d=0,c=0;c<this.business.length;++c)d+=this.business[c];for(c=0;c<this.activityListeners.length;++c)try{this.activityListeners[c](d)}catch(a){console.log(a)}};n.prototype.addChangeListener=function(d){this.changeListeners.push(d)};n.prototype.removeChangeListener=function(d){d=C(this.changeListeners,
d);0<=d&&this.changeListeners.splice(d,1)};n.prototype.notifyChange=function(){for(var d=0;d<this.changeListeners.length;++d)try{this.changeListeners[d](this.busy)}catch(c){console.log(c)}};n.prototype.getScales=function(){return this.sources[0].getScales()};n.prototype.getStyleSheet=function(d){return this.sources[0].getStyleSheet(d)};n.prototype.capabilities=function(){var d={},c=this.sources[0];c.capabilities&&(d=t(c.capabilities()));for(c=1;c<this.sources.length;++c){var a=this.sources[c];a.capabilities&&
(a=a.capabilities(),a.search&&(d.search=a.search))}return d};n.prototype.search=function(d,c){for(var a=0;a<this.sources.length;++a){var b;b=this.sources[a];b=b.capabilities?b.capabilities().search:!1;if(b)return this.sources[a].search(d,c)}};n.prototype.fetch=function(d,c,a,b,f,p,q,k){var g;if(this.filterDispatchOnMethod){g=[];for(var n=k.list(),l=0;l<this.sources.length;++l)for(var t=this.sources[l],w=0;w<n.length;++w){var I=n[w];if(!I.method||I.method==t.name){g.push(t);break}}}else g=this.sources;
q=new m(this,q,g);for(l=0;l<g.length;++l)this.fetchN(q,l,g[l],d,c,a,b,f,p,k)};n.prototype.fetchN=function(d,c,a,b,f,p,g,k,r,m){a.fetch(b,f,p,g,k,r,function(a,b,f){return d.completed(c,a,b,f)},m)};n.prototype.quantFindNextFeature=function(d,c,a,b,f){return this.sources[0].quantFindNextFeature(d,c,a,b,f)};n.prototype.findNextFeature=function(d,c,a,b){return this.sources[0].findNextFeature(d,c,a,b)};m.prototype.completed=function(d,c,a,b){if(null==this.scale||0==d)this.scale=b;if(this.returns[d])throw"Multiple returns for source "+
d;this.returns[d]=!0;this.returnCount++;this.features[d]=a;c&&(this.statuses[d]=c,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){d="";for(c=0;c<this.count;++c)if(a=this.statuses[c])0<d.length&&(d+=", "),d+=a;return this.callback(d,null,this.scale)}this.callback(null,this.source.merge(this.features,this.sources),this.scale)}};n.prototype.getDefaultFIPs=function(d){for(var c=0;c<this.sources.length;++c){var a=this.sources[c];a.getDefaultFIPs&&a.getDefaultFIPs(d)}};n.prototype.keyForFeature=
function(d){return""+d.min+".."+d.max};"undefined"!==typeof v&&(v.exports={OverlayFeatureSource:n})},{"./utils":49}],28:[function(d,v,s){function n(d,k,r){var H=/^\w+\s[0-9]+\s[0-9]+.*$/,s=/([^=]+)=\"?([^\"]+)\"?/,B=/^##\s*fileformat=VCFv4\..+/;(d.blob?new l(d.blob):"encode"==d.transport?new p(d.uri):new g(d.uri,{credentials:d.credentials})).slice(0,65536).salted().fetch(function(p,g){if(!p)return r||(d.credentials=!0,n(d,k,!0)),k(d,"Couldn't fetch data");var l=new Uint8Array(p),F=(new Uint32Array(p,
0,1))[0];if(F==C||F==E){d.tier_type="bwg";l=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(l=l.exec(d.uri||d.blob.name))d.name=l[1];return k(d,null)}if(F==b)return d.tier_type="bai",k(d,null);if(31==l[0]||139==l[1]){l=c(p);l=new Uint8Array(l);F=t(l,0);if(F==a){d.tier_type="bam";l=/\/?([^/]+?)(.bam)?$/;if(l=l.exec(d.uri||d.blob.name))d.name=l[1];return k(d,null)}if(F==f)return d.tier_type="tabix-index",k(d,null);if(1768301347==F){d.tier_type="tabix";d.payload="vcf";l=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(l=
l.exec(d.uri||d.blob.name))d.name=l[1];return k(d,null)}console.log("magic = "+F.toString(16));return k(d,"Unsupported format")}l=String.fromCharCode.apply(null,l).split("\n");if(0<l.length&&B.test(l[0]))return d.tier_type="memstore",d.payload="vcf",l=/\/?([^/]+?)(.vcf)?$/,(l=l.exec(d.uri||d.blob.name))&&!d.name&&(d.name=l[1]),k(d,null);for(var u=0;u<l.length;++u)if(F=l[u].replace("\r",""),0!=F.length&&0!=F.indexOf("browser")){if(0==F.indexOf("track")){l="bed";F=F.split(/\s/);for(u=1;u<F.length;++u){var v=
s.exec(F[u]);v&&("type"==v[1]&&"wiggle_0"==v[2]?l="wig":"name"==v[0]&&(d.name=v[2]))}m(d,l);return k(d,null)}if(0==F.indexOf("fixedStep")||0==F.indexOf("variableStep"))return m(d,"wig"),k(d,null);if(H.test(F))return m(d,null),k(d,null);break}return k(d,"Unsupported format")},{timeout:1500})}function m(a,b){a.tier_type="memstore";var c=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);c&&(a.name||(a.name=c[1]),!b&&c[3]&&(b=c[3]));a.payload=b||"bed"}if("undefined"!==typeof d){s=d("./bin");var g=
s.URLFetchable,l=s.BlobFetchable,t=s.readInt;s=d("./bigwig");var C=s.BIG_WIG_MAGIC,E=s.BIG_BED_MAGIC,c=d("./lh3utils").unbgzf;s=d("./bam");var a=s.BAM_MAGIC,b=s.BAI_MAGIC,f=d("./tabix").TABIX_MAGIC,p=d("./encode").EncodeFetchable}"undefined"!==typeof v&&(v.exports={probeResource:n})},{"./bam":1,"./bigwig":3,"./bin":4,"./encode":12,"./lh3utils":24,"./tabix":41}],29:[function(d,v,s){function n(a){return b[a%b.length]*Math.pow(10,a/b.length|0)}function m(a,b,c){this.scale=a;this.cnt=this.tot=0;this.hasScore=
!1;this.min=b;this.max=c;this.features=[]}function g(a,b){return a.min<b.min?-1:a.min>b.min?1:a.max<b.max?-1:b.max>a.max?1:0}function l(a,b){for(var c=0;n(c+1)<b;)++c;for(var c=n(c),d=[],g=-1E10,l=1E10,t=0;t<a.length;++t){var B=a[t];if(B.groups&&0<B.groups.length)return a;for(var w=B.min/c|0,I=B.max/c|0,g=Math.max(g,I),l=Math.min(l,w);w<=I;++w){var y=d[w];y||(y=new m(c,w*c,(w+1)*c-1),d[w]=y);y.feature(B)}}t=[];for(w=l;w<=g;++w)if(y=d[w])B=new E,B.segment=a[0].segment,B.min=w*c+1,B.max=(w+1)*c,B.score=
y.score(),B.type="density",t.push(B);Date.now();return t}function t(a){this._pos=a;this._bases={};this._totalCount=0}function C(b,d,g){for(var k,r,l=null,m=null,n=[],w=0;w<b.length;++w){var I=b[w];if(I.groups&&0<I.groups.length)return b;k=I.seq;var y=I.quals,F=c(I.cigar),u=[];r=[];for(var C=0,e=0;e<F.length;++e){var x=F[e];if("M"==x.op)u.push(k.substr(C,x.cnt)),r.push(y.substr(C,x.cnt)),C+=x.cnt;else if("D"==x.op)for(var A=0;A<x.cnt;++A)u.push("-"),r.push("Z");else"I"==x.op?C+=x.cnt:"S"==x.op?C+=
x.cnt:console.log("unknown cigop"+x.op)}k=u.join("");r=r.join("");u=k;C=r;e=I.orientation;x=I.min||0;I=I.max||0;r=0;for(k=x;k<=I;++k)F=n[k],F||(F=new t(k),n[k]=F),y=u.charAt(r),A=C.charCodeAt(r)-33,F.recordBase(y,A,e),r++;l=l?Math.min(l,x):x;m=m?Math.max(m,I):I}I=l;w=m;r=[];if(d&&(k=d.start|0,F=d.end|0,k<=w&&F>=I)){y=Math.max(I,k);F=Math.min(w,F);for(u=0;u<y-I;u++)r.push("N");r.push(d.seq.substr(y-k,F-y+1));for(u=0;u<w-F;u++)r.push("N")}d=r.join("");w=[];r=0;for(k=l;k<=m;++k){if(F=n[k])if(I=new E,
I.segment=b[0].segment,I.min=F.pos(),I.max=I.min,I.notes=[],I.notes=I.notes.concat(F.infoList()),I.type="base-coverage",I.suppressScore=!0,d)for(l=d.charAt(r),I.notes.unshift("Ref="+l),F=F.baseScoreList(l,0.2),u=0;u<F.length;u++){y=F[u].base;C=F[u].score;e=a(I);e.score=C;if(1<F.length||y!=l)e.itemRgb=g[y];w.push(e)}else w.push(I);r++}return w}if("undefined"!==typeof d)var E=d("./das").DASFeature,c=d("./cigar").parseCigar,a=d("./utils").shallowCopy;var b=[1,2,5];m.prototype.score=function(){if(0==
this.cnt)return 0;if(this.hasScore)return this.tot/this.cnt;var a=this.features;a.sort(g);for(var b=-1E10,c=0,d=0,r=1;r<a.length;++r){var l=a[r],m=Math.max(l.min,this.min),l=Math.min(l.max,this.max),d=d+(l-m+1);m>b?(c+=l-m+1,b=l):l>b&&(c+=l-b,b=l)}return 0<c?1*d/c:0};m.prototype.feature=function(a){void 0!==a.score&&(this.tot+=a.score,this.hasScore=!0);++this.cnt;this.features.push(a)};t.prototype.recordBase=function(a,b,c){if(this._bases[a])a=this._bases[a],a.cnt++,a.totalQual+=b,a.strandCnt[c]++;
else{var d={"+":0,"-":0};d[c]++;this._bases[a]={cnt:1,totalQual:b,strandCnt:d}}this._totalCount++};t.prototype.totalCount=function(){return this._totalCount};t.prototype.pos=function(){return this._pos};t.prototype.infoList=function(){var a=[],b=this._totalCount;a.push("Depth="+b.toString());for(var c in this._bases){var d=this._bases[c],g=d.cnt,l=d.strandCnt["+"],m=d.strandCnt["-"],d=d.totalQual/g,g=[c,"=",g," (",(100*g/b).toFixed(0),"%, ",l," +, ",m," -, Qual: ",d.toFixed(0),")"];a.push(g.join(""))}return a};
t.prototype.baseScoreList=function(a,b){var c=[],d=this._totalCount,g=b*d,l;for(l in this._bases){var m=this._bases[l].cnt;m<g||l==a||(c.push({base:l,score:d}),d-=m)}c.push({base:a,score:d});return c};"undefined"!==typeof v&&(v.exports={downsample:l,getBaseCoverage:C})},{"./cigar":8,"./das":10,"./utils":49}],30:[function(d,v,s){function n(d,g){var c=parseFloat(d.replace(/,/g,""));return"k"===g||"K"===g?1E3*c|0:"m"==g||"M"===g?1E6*c|0:c|0}if("undefined"!==typeof d)var m=d("./cbrowser").Browser,g=d("./bin").URLFetchable,
l=d("./trix").connectTrix;var t=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;m.prototype.search=function(d,m){var c=this,a=t.exec(d);if(a){var b=a[1],f;if(a[6])f=n(a[2],a[3]),a=n(a[6],a[7]);else{var p=this.viewEnd-this.viewStart+1;f=n(a[2],a[3])-p/2|0;a=f+p-1}this.setLocation(b,f,a,m)}else{if(!d||0==d.length)return!1;var q=0,k=!1,r=function(a,b){--q;if(b)return m(b);a||(a=[]);for(var f=5E8,p=-1E8,g=null,r=0;r<a.length;++r){var l=a[r];null==g&&(g=l.segment);f=
Math.min(f,l.min);p=Math.max(p,l.max)}if(g)k=!0,c.highlightRegion(g,f,p),r=Math.max(2500,0.3*(p-f+1)|0),c.setLocation(g,f-r,p+r,m);else if(0==q&&!k)return m("no match for '"+d+"'")},H=function(a,b){b.lookup(d,function(b,c){if(null==b||2>b.length)return a.featureSource.search(d,r);var f=b[1].split(",")[0];return a.featureSource.search(f,r)})};if(this.searchEndpoint)return q=1,this.doDasSearch(c.searchEndpoint,d,r);for(b=0;b<this.tiers.length;++b)(function(a){c.sourceAdapterIsCapable(a.featureSource,
"search")?a.dasSource.trixURI?(++q,a.trix?H(a,a.trix):l(new g(a.dasSource.trixURI),new g(a.dasSource.trixURI+"x"),function(b){a.trix=b;H(a,b)})):(++q,a.featureSource.search(d,r)):a.dasSource.provides_search&&(++q,c.doDasSearch(a.dasSource,d,r))})(this.tiers[b])}};m.prototype.doDasSearch=function(d,g,c){d.features(null,{group:g,type:"transcript"},function(a){a||(a=[]);for(var b=[],d=0;d<a.length;++d){var p=a[d];p.label.toLowerCase()==g.toLowerCase()&&b.push(p)}return c(b)},!1)}},{"./bin":4,"./cbrowser":6,
"./trix":47}],31:[function(d,v,s){function n(b,d){d||(d=c);for(var p=a.length;b*a[p%a.length]*Math.pow(10,p/a.length|0)<d;)++p;return a[p%a.length]*Math.pow(10,p/a.length|0)}function m(a,c){var d=a.viewport.getContext("2d"),q=a.browser.retina&&1<window.devicePixelRatio,k=a.browser.featurePanelWidth+2E3;q&&(k*=2);var r=a.viewport.width|0;r<k-50&&(a.viewport.width=r=k);k=50;c&&c.seq&&(k+=25);var l=k;q&&(l*=2);a.viewport.height=l;a.viewport.style.height=""+k+"px";a.viewport.style.width=q?""+r/2+"px":
""+r+"px";a.layoutHeight=k;a.updateHeight();a.background&&(d.fillStyle=a.background,d.fillRect(0,0,r,a.viewport.height));q&&d.scale(2,2);d.translate(1E3,0);g(a,c,d);a.norigin=a.browser.viewStart;a.viewportHolder.style.left="-1000px"}function g(a,c,d){var g=a.browser.scale,k=a.browser.viewStart-1E3/g|0,r=a.browser.viewEnd+2E3/g,l=a.browser.currentSeqMax,m=r;0<l&&l<r&&(m=l);for(var B=n(g),w=Math.max(0,(k/B|0)*B),l=a.browser.viewStart;w<=m;)d.fillStyle=0==w/B%2?"white":"black",d.strokeStyle="black",
d.fillRect((w-l)*g,8,B*g,3),d.strokeRect((w-l)*g,8,B*g,3),d.fillStyle="black",d.fillText(t(w),(w-l)*g,22),w+=B;if(c&&c.seq)for(;k<=r;++k)k>=c.start&&k<=c.end&&(m=c.seq.substr(k-c.start,1).toUpperCase(),(B=a.browser.baseColors[m])||(B="gray"),d.fillStyle=B,8<=g?(B=d.measureText(m).width,d.fillText(m,(k-l)*g+0.5*(g-B),52)):d.fillRect((k-l)*g,42,g,12))}function l(a,c){var d=a.browser.scale,g=a.browser.viewStart-1E3/d|0,k=a.browser.viewEnd+2E3/d,r=a.browser.currentSeqMax,l=k;0<r&&r<k&&(l=r);for(var m=
n(d),B=Math.max(0,(g/m|0)*m),r=a.browser.viewStart,w=C(E,"g",[],{fontSize:"8pt"});B<=l;)w.appendChild(C(E,"rect",null,{x:(B-r)*d,y:8,width:m*d,height:3,fill:0==B/m%2?"white":"black",stroke:"black"})),w.appendChild(C(E,"text",t(B),{x:(B-r)*d,y:28,fill:"black",stroke:"none"})),B+=m;if(c&&c.seq)for(;g<=k;++g)g>=c.start&&g<=c.end&&(l=c.seq.substr(g-c.start,1).toUpperCase(),(m=a.browser.baseColors[l])||(m="gray"),8<=d?w.appendChild(C(E,"text",l,{x:(0.5+g-r)*d,y:52,textAnchor:"middle",fill:m})):w.appendChild(C(E,
"rect",null,{x:(g-r)*d,y:42,width:d,height:12,fill:m})));return w}if("undefined"!==typeof d){s=d("./utils");var t=s.formatLongInt,C=s.makeElementNS,E=d("./svg-utils").NS_SVG,t=d("./numformats").formatLongInt}var c=100,a=[1,2,5],E="http://www.w3.org/2000/svg";"undefined"!==typeof v&&(v.exports={drawSeqTier:m,drawSeqTierGC:g,svgSeqTier:l})},{"./numformats":26,"./svg-utils":39,"./utils":49}],32:[function(d,v,s){if("undefined"!=typeof d){var n=d("./cbrowser").Browser;v=d("./sourcecompare");var m=v.sourceDataURI,
g=v.sourcesAreEqual,l=d("./version"),t=d("./utils").miniJSONify,C=d("./sha1").hex_sha1}n.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];
delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+this.cookieKey+".ruler-location"]};n.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};n.prototype.storeViewStatus=function(){!this.cookieKey||
this.noPersist||this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};
n.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var d=[],c=0;c<this.tiers.length;++c){var a=this.tiers[c];a.dasSource.noPersist||d.push({source:a.dasSource,config:a.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(d);d={};c=[];for(a=0;a<this.hubObjects.length;++a){var b=this.hubObjects[a],f={url:b.hub.url,genome:b.genome};b.credentials&&(f.credentials=b.credentials);b.mapping&&(f.mapping=b.mapping);d[f.url]=!0;c.push(f)}for(a=0;a<this.hubs.length;++a)f=
this.hubs[a],"string"===typeof f&&(f={url:f}),d[f.url]||c.push(f);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(c);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+this.cookieKey+".single-base-highlight"]=this.singleBaseHighlight;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+
this.cookieKey+".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=l.CONFIG}};n.prototype.restoreStatus=function(){if(!this.noPersist){var d=localStorage["dalliance."+this.cookieKey+".version"];if(l.CONFIG==(d?d|0:-100)){var d=localStorage["dalliance."+this.cookieKey+".configHash"]||"",c=C(t({sources:this.sources,hubs:this.hubs}));if(c!=d)localStorage["dalliance."+this.cookieKey+
".configHash"]=c;else{d={};for(c=0;c<this.sources.length;++c){var a=this.sources[c];if(a){var b=m(a),f=d[b];f||(d[b]=f=[]);f.push(a)}}if(!this.noPersistView&&(c=localStorage["dalliance."+this.cookieKey+".view-chr"],a=localStorage["dalliance."+this.cookieKey+".view-start"]|0,f=localStorage["dalliance."+this.cookieKey+".view-end"]|0,c&&a&&f)){this.chr=c;this.viewStart=a;this.viewEnd=f;if(c=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=c|0;this.isSnapZooming="true"==
localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];c=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof c||isNaN(c)||(this.savedZoom=c)}this.reverseScrolling=(c=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==c;this.reverseKeyScrolling=(c=localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"])&&"true"==c;this.singleBaseHighlight=(c=localStorage["dalliance."+this.cookieKey+".single-base-highlight"])&&"true"==c;if(c=
localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=c;if(c=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===c;if(c=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights="true"===c;if(c=localStorage["dalliance."+this.cookieKey+".sources"]){var p=JSON.parse(c);this.sources=[];this.restoredConfigs=[];for(c=0;c<p.length;++c)for(a=this.sources[c]=p[c].source,this.restoredConfigs[c]=p[c].config,b=m(a),f=d[b]||[],
b=0;b<f.length;++b){var q=f[b];if(g(a,q))for(var k in q)q.hasOwnProperty(k)&&("function"===typeof q[k]||q[k]instanceof Blob)&&(a[k]=q[k])}}if(k=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(k);return!0}}}};n.prototype.reset=function(){for(var d=this.tiers.length-1;0<=d;--d)this.removeTier({index:d},!0);for(d=0;d<this.defaultSources.length;++d)this.defaultSources[d].disabled||this.addTier(this.defaultSources[d]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,
this.defaultStart,this.defaultEnd)}},{"./cbrowser":6,"./sha1":33,"./sourcecompare":35,"./utils":49,"./version":51}],33:[function(d,v,s){function n(c){c=g(l(c));for(var a=C?"0123456789ABCDEF":"0123456789abcdef",b="",d,p=0;p<c.length;p++)d=c.charCodeAt(p),b+=a.charAt(d>>>4&15)+a.charAt(d&15);return b}function m(c){c=g(l(c));for(var a="",b=c.length,d=0;d<b;d+=3)for(var p=c.charCodeAt(d)<<16|(d+1<b?c.charCodeAt(d+1)<<8:0)|(d+2<b?c.charCodeAt(d+2):0),q=0;4>q;q++)a=8*d+6*q>8*c.length?a+E:a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>>
6*(3-q)&63);return a}function g(c){for(var a=Array(c.length>>2),b=0;b<a.length;b++)a[b]=0;for(b=0;b<8*c.length;b+=8)a[b>>5]|=(c.charCodeAt(b/8)&255)<<24-b%32;c=8*c.length;a[c>>5]|=128<<24-c%32;a[(c+64>>9<<4)+15]=c;c=Array(80);for(var b=1732584193,d=-271733879,g=-1732584194,q=271733878,k=-1009589776,r=0;r<a.length;r+=16){for(var l=b,m=d,n=g,w=q,I=k,y=0;80>y;y++){if(16>y)c[y]=a[r+y];else{var C=c[y-3]^c[y-8]^c[y-14]^c[y-16];c[y]=C<<1|C>>>31}var C=b<<5|b>>>27,u;u=20>y?d&g|~d&q:40>y?d^g^q:60>y?d&g|d&q|
g&q:d^g^q;C=t(t(C,u),t(t(k,c[y]),20>y?1518500249:40>y?1859775393:60>y?-1894007588:-899497514));k=q;q=g;g=d<<30|d>>>2;d=b;b=C}b=t(b,l);d=t(d,m);g=t(g,n);q=t(q,w);k=t(k,I)}a=[b,d,g,q,k];c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>24-b%32&255);return c}function l(c){for(var a="",b=-1,d,g;++b<c.length;)d=c.charCodeAt(b),g=b+1<c.length?c.charCodeAt(b+1):0,55296<=d&&56319>=d&&56320<=g&&57343>=g&&(d=65536+((d&1023)<<10)+(g&1023),b++),127>=d?a+=String.fromCharCode(d):2047>=d?a+=String.fromCharCode(192|
d>>>6&31,128|d&63):65535>=d?a+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(a+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return a}function t(c,a){var b=(c&65535)+(a&65535);return(c>>16)+(a>>16)+(b>>16)<<16|b&65535}var C=0,E="";"undefined"!==typeof v&&(v.exports={b64_sha1:m,hex_sha1:n})},{}],34:[function(d,v,s){function n(a,e){fa[a]=e}function m(a,e){ga[a]=e}function g(a){if(ga[a])return ga[a](a)}function l(a){var e=this;this.source=a;this.cfsid=
"cfs"+ ++ma;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){e.cfsid="cfs"+ ++ma})}function t(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}function C(a){this.dasSource=new P(a);this.busy=0;this.activityListeners=[]}function E(a){this.dasSource=new P(a);this.awaitedEntryPoints=new F;var e=this;this.dasSource.entryPoints(function(a){e.awaitedEntryPoints.provide(a)})}function c(a){var e=this;this.source=a;this.twoBit=new F;if(a.twoBitURI)a=
new h(a.twoBitURI,{credentials:a.credentials,resolver:this.resolver});else if(a.twoBitBlob)a=new K(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");G(a,function(a,b){b?console.log(b):e.twoBit.provide(a)})}function a(a){this.source=a}function b(a){t.call(this);var e=this;this.readiness="Connecting";this.bwgSource=this.opts=a;e.bwgHolder=new F;if(this.opts.preflight){var b=$[this.opts.preflight];if(!b){b=new F;$[this.opts.preflight]=b;var c=new XMLHttpRequest;c.onreadystatechange=
function(){4==c.readyState&&(200==c.status?b.provide("success"):b.provide("failure"))};c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(c.withCredentials=!0);c.send("")}b.await(function(a){"success"===a&&e.init()})}else e.init()}function f(a,e,b){t.call(this);this.worker=e;this.readiness="Connecting";this.bwgSource=this.opts=a;this.keyHolder=new F;a.resolver&&(this.resolverKey=b.registerResolver(a.resolver));this.init()}function p(a,e){if(!(a.flag&Y.SEGMENT_UNMAPPED)){var b;
b=a.seq?a.seq.length:a.seqLength;if(a.cigar){b=0;for(var c=X(a.cigar),d=0;d<c.length;++d){var f=c[d];if("M"==f.op||"D"==f.op)b+=f.cnt}}c=new U;c.min=a.pos+1;c.max=a.pos+b;c.segment=a.segment;c.type="bam";c.id=a.readName;c.notes=["MQ="+a.mq];c.cigar=a.cigar;c.seq=a.seq;c.quals=a.quals;c.orientation=a.flag&Y.REVERSE_COMPLEMENT?"-":"+";c.bamRecord=a;e&&a.flag&Y.MULTIPLE_SEGMENTS&&(c.groups=[{id:a.readName,type:"readpair"}]);return c}}function q(a){t.call(this);var e=this;this.bamSource=a;this.opts={credentials:a.credentials,
preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new F;if(this.opts.preflight){var c=$[this.opts.preflight];if(!c){c=new F;$[this.opts.preflight]=c;var b=new XMLHttpRequest;b.onreadystatechange=function(){4==b.readyState&&(200==b.status?c.provide("success"):c.provide("failure"))};b.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(b.withCredentials="true");b.send("")}c.await(function(a){"success"===a&&e.init()})}else e.init()}function k(a,e){t.call(this);
this.bamSource=a;this.worker=e;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.keyHolder=new F;bwgSource.resolver&&(this.resolverKey=w.registerResolver(bwgSource.resolver));this.init()}function r(a,e){this.source=a;this.mapping=e;this.activityListeners=[];this.busy=0}function H(){}function Q(){}function B(a){this.store=new la(a.jbURI,a.jbQuery)}if("undefined"!==typeof d){var w=d("./cbrowser"),I=w.Browser,y=d("./tier").DasTier;s=d("./utils");var F=s.Awaited,u=s.arrayIndexOf,
L=s.shallowCopy,e=s.resolveUrlToPage;s=d("./das");var x=s.DASStylesheet,A=s.DASStyle,P=s.DASSource,J=s.DASSegment,U=s.DASFeature,z=s.DASSequence,D=s.DASLink;s=d("./bin");var h=s.URLFetchable,K=s.BlobFetchable,G=d("./twoBit").makeTwoBit,T=d("./bigwig").makeBwg;s=d("./bam");var M=s.makeBam,Y=s.BamFlags;s=d("./spans");var ea=s.Range,S=s.union,X=d("./cigar").parseCigar,aa=d("./overlay").OverlayFeatureSource,la=d("./jbjson").JBrowseStore,pa=d("./chainset").Chainset;d("./style");var qa=d("./encode").EncodeFetchable}var fa=
{},ga={};y.prototype.initSources=function(){var a=this,e=this.browser.createSources(this.dasSource);this.featureSource=e.features||new H;this.sequenceSource=e.sequence;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};I.prototype.createSources=function(e){var d=this.sourceCache.get(e);if(d)return d;var h,g;if("sequence"==e.tier_type||e.twoBitURI||e.twoBitBlob)g=e.twoBitURI||e.twoBitBlob?new c(e):e.ensemblURI?new a(e):
new E(e);else if(e.tier_type&&fa[e.tier_type])g=(0,fa[e.tier_type])(e),h=g.features,g=g.sequence;else if(e.bwgURI||e.bwgBlob)h=(h=this.getWorker())?new f(e,h,this):new b(e);else if(e.bamURI||e.bamBlob)h=(h=this.getWorker())?new k(e,h,this):new q(e);else if(e.jbURI)h=new B(e);else if(e.uri||e.features_uri)h=new C(e);if(e.overlay){d=[];h&&d.push(new l(h));for(h=0;h<e.overlay.length;++h){var p=this.createSources(e.overlay[h]);p&&p.features&&d.push(p.features)}h=new aa(d,e)}e.sequenceAliases&&(h=new r(h,
new pa({type:"alias",sequenceAliases:e.sequenceAliases})));e.mapping&&(h=new r(h,this.chains[e.mapping]));e.name&&h&&!h.name&&(h.name=e.name);null!=h&&(h=new l(h));if(null!=h||null!=g)d={features:h,sequence:g},this.sourceCache.put(e,d);return d};y.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri||!(this.dasSource.tier_type||this.dasSource.bwgURI||this.dasSource.bwgBlob||this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.twoBitURI||this.dasSource.twoBitBlob||this.dasSource.jbURI||
this.dasSource.overlay)?new C(this.dasSource):this.getSource()).getStyleSheet(a)};var ma=0;l.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};l.prototype.removeReadinessListener=function(a){if(this.source.removeReadinessListener)return this.source.removeReadinessListener(a)};l.prototype.search=function(a,e){if(this.source.search)return this.source.search(a,e)};l.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};
l.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};l.prototype.getScales=function(){return this.source.getScales()};l.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};l.prototype.removeActivityListener=function(a){this.source.removeActivityListener&&this.source.removeActivityListener(a)};l.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};l.prototype.removeChangeListener=
function(a){this.source.removeChangeListener&&this.source.removeChangeListener(a)};l.prototype.findNextFeature=function(a,e,c,b){this.source.findNextFeature(a,e,c,b)};l.prototype.quantFindNextFeature=function(a,e,c,b,d){this.source.quantFindNextFeature(a,e,c,b,d)};l.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};l.prototype.fetch=function(a,e,c,b,d,f,k,h){if(!f)throw Error("Fetch pool is null");var g=this,p=this.cfsid,r=f.awaitedFeatures[p];if(r&&
r.started){if(r.styleFilters.doesNotContain(h)){g.source.fetch(a,e,c,b,d,f,k,h);return}}else r?r.styleFilters.addAll(h):(r=new F,r.styleFilters=h,f.awaitedFeatures[p]=r,f.requestsIssued.then(function(){r.started=!0;g.source.fetch(a,e,c,b,r.styleFilters.typeList(),f,function(a,e,c,b){r.res||r.provide({status:a,features:e,scale:c,coverage:b})},r.styleFilters)}).catch(function(a){console.log(a)}));r.await(function(a){k(a.status,a.features,a.scale,a.coverage)})};t.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);
a(this.readiness)};t.prototype.removeReadinessListener=function(a){a=u(this.readinessListeners,a);0<=a&&this.readinessListeners.splice(a,1)};t.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(e){console.log(e)}};t.prototype.addActivityListener=function(a){this.activityListeners.push(a)};t.prototype.removeActivityListener=function(a){a=u(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};t.prototype.notifyActivity=
function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(e){console.log(e)}};t.prototype.getScales=function(){return null};t.prototype.fetch=function(a,e,c,b,d,f,k){return k(null,[],1E9)};t.prototype.getStyleSheet=function(a){var e=new x,c=new A;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";e.pushStyle({type:"default"},null,c);return a(e)};C.prototype.addActivityListener=function(a){this.activityListeners.push(a)};C.prototype.removeActivityListener=
function(a){a=u(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};C.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(e){console.log(e)}};C.prototype.getStyleSheet=function(a){this.dasSource.stylesheet(function(e){a(e)},function(){a(null,"Couldn't fetch DAS stylesheet")})};C.prototype.fetch=function(a,e,c,b,d,f,k){if(d&&0==d.length)k(null,[],b);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&
this.cachedStaticFeatures)return k(null,this.cachedStaticFeatures,this.cachedStaticScale);var h=!1!==this.dasSource.maxbins;d={type:d};h&&(d.maxbins=1+((c-e)/b|0));var g=this;g.busy++;g.notifyActivity();this.dasSource.features(new J(a,e,c),d,function(a,e){g.busy--;g.notifyActivity();var c=b;h||(c=0.1);!e&&g.dasSource.dasStaticFeatures&&(g.cachedStaticFeatures=a,g.cachedStaticScale=c);k(e,a,c)})}};C.prototype.findNextFeature=this.sourceFindNextFeature=function(a,e,c,b){if(this.dasSource.capabilities&&
0<=u(this.dasSource.capabilities,"das1:adjacent-feature")){var d=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(e|0)+":"+(0<c?"F":"B")};if(e=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=e;thisTier.dasSource.features(null,a,function(a){d.dasAdjLock=!1;0<a.length&&null!=a[0]&&b(a[0])})}};E.prototype.fetch=function(a,e,c,b,d){this.dasSource.sequence(new J(a,e,c),function(a){return 1==a.length?d(null,a[0]):
d("Didn't get sequence")})};E.prototype.getSeqInfo=function(a,e){this.awaitedEntryPoints.await(function(c){for(var b=0;b<c.length;++b)if(c[b].name==a)return e({length:c[b].end});return e()})};c.prototype.fetch=function(a,e,c,b,d){this.twoBit.await(function(b){b.fetch(a,e,c,function(b,f){if(f)return d(f,null);var k=new z(a,e,c,"DNA",b);return d(null,k)})})};c.prototype.getSeqInfo=function(a,e){this.twoBit.await(function(c){c.getSeq(a)?c.getSeq(a).length(function(a){e({length:a})}):e()})};a.prototype.fetch=
function(a,e,c,b,d){b=this.source.ensemblURI+"/sequence/region/"+this.source.species+"/"+a+":"+e+".."+c+":1?content-type=application/json";var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4==f.readyState)if(300<=f.status){var b="Error code "+f.status;try{var k=JSON.parse(f.response);k.error&&(b=k.error)}catch(h){}d(b,null)}else return k=JSON.parse(f.response),b=new z(a,e,c,"DNA",k.seq),d(null,b)};f.open("GET",b,!0);f.responseType="text";f.send("")};a.prototype.getSeqInfo=function(a,e){var c=
this.source.ensemblURI+"/info/assembly/"+this.source.species+"/"+a+"?content-type=application/json",b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState)if(300<=b.status)e();else{var a=JSON.parse(b.response);e(a)}};b.open("GET",c,!0);b.responseType="text";b.send("")};C.prototype.getScales=function(){return[]};var $={};b.prototype=Object.create(t.prototype);b.prototype.init=function(){var a=this,e;e=(e=this.bwgSource.uri||this.bwgSource.bwgURI)?"encode"===this.bwgSource.transport?
new qa(e,{credentials:this.opts.credentials}):new h(e,{credentials:this.opts.credentials,resolver:this.opts.resolver}):new K(this.bwgSource.bwgBlob);T(e,function(e,c){c?(a.error=c,a.readiness=null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(e),a.readiness=null,a.notifyReadiness(),"bigbed"==e.type&&e.getExtraIndices(function(e){a.extraIndices=e}))})};b.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&
0<this.extraIndices.length){a.search=[];for(var e=0;e<this.extraIndices.length;++e)a.search.push(this.extraIndices[e].field)}return a};b.prototype.fetch=function(a,e,c,b,d,f,k){var h=this;this.bwgHolder.await(function(f){if(null==f)return k(h.error||"Can't access binary file",null,null);var g;g=!d||0==d.length||0<=u(d,"density");h.opts.clientBin&&(g=!1);if("bigwig"==f.type||g||"undefined"!==typeof h.opts.forceReduction){g=-1;for(var p=0;p<f.zoomLevels.length;++p)if(f.zoomLevels[p].reduction<=b)g=
p;else break;"undefined"!==typeof h.opts.forceReduction&&(g=h.opts.forceReduction);g=0>g?f.getUnzoomedView():f.getZoomedView(g)}else g=f.getUnzoomedView();h.busy++;h.notifyActivity();g.readWigData(a,e,c,function(a){h.busy--;h.notifyActivity();var b=1E9;if("bigwig"===f.type){var d=(c-e)/a.length/2;d<b&&(b=d)}if(h.opts.link)for(d=0;d<a.length;++d){var g=a[d];g.label&&(g.links=[new D("Link",h.opts.link.replace(/\$\$/,g.label))])}k(null,a,b)})})};b.prototype.quantFindNextFeature=function(a,e,c,b,d){var f=
this;f.busy++;f.notifyActivity();this.bwgHolder.res.thresholdSearch(a,e,c,b,function(a,e){f.busy--;f.notifyActivity();return d(a,e)})};b.prototype.findNextFeature=function(a,e,c,b){var d=this;d.busy++;d.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,e,c,function(a){d.busy--;d.notifyActivity();0<a.length&&null!=a[0]&&b(a[0])})};b.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var e=[1],c=0;c<a.zoomLevels.length;++c)e.push(a.zoomLevels[c].reduction);return e}return null};
b.prototype.search=function(a,e){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,e):e(null,"No indices available")};b.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(e){e&&e.schema&&e.definedFieldCount<e.schema.fields.length&&a(function(a,c){for(var b=0;b<c.hit.length;++b)if(c.hit[b].isSuperGroup)return;for(b=e.definedFieldCount;b<e.schema.fields.length;++b){var d=e.schema.fields[b];c.add(d.comment,a[d.name])}})})};
b.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(e){if(!e)return a(null,"bbi error");var c=new x;if("bigbed"==e.type){var b=new A;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="blue";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=20;c.pushStyle({type:"bigbed"},null,b);b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="red";b.HEIGHT=10;b.BUMP=!0;b.ZINDEX=20;c.pushStyle({type:"translation"},null,b);b=new A;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="white";b.HEIGHT=10;b.ZINDEX=10;b.BUMP=!0;b.LABEL=
!0;c.pushStyle({type:"transcript"},null,b);b=new A;b.glyph="HISTOGRAM";b.COLOR1="white";b.COLOR2="black";b.HEIGHT=30;c.pushStyle({type:"density"},null,b)}else b=new A,b.glyph="HISTOGRAM",b.COLOR1="white",b.COLOR2="black",b.HEIGHT=30,c.pushStyle({type:"default"},null,b);12==e.definedFieldCount&&14<=e.fieldCount&&(c.geneHint=!0);return a(c)})};f.prototype=Object.create(t.prototype);f.prototype.init=function(){var a=this,b=this.uri||this.bwgSource.uri||this.bwgSource.bwgURI,c=this.bwgSource.blob||this.bwgSource.bwgBlob,
d=function(e,b){a.readiness=null;a.notifyReadiness();e?a.worker.postCommand({command:"meta",connection:e},function(b,c){c?(a.error=c,a.keyHolder.provide(null)):(a.meta=b,a.keyHolder.provide(e))}):(a.error=b,a.keyHolder.provide(null))};c?this.worker.postCommand({command:"connectBBI",blob:c},d):this.worker.postCommand({command:"connectBBI",uri:e(b),resolver:this.resolverKey,transport:this.bwgSource.transport,credentials:this.bwgSource.credentials},d)};f.prototype.capabilities=function(){var a={leap:!0};
this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=[];for(var e=0;e<this.meta.extraIndices.length;++e)a.search.push(this.meta.extraIndices[e].field)}return a};f.prototype.fetch=function(a,e,b,c,d,f,k){var h=this;h.busy++;h.notifyActivity();this.keyHolder.await(function(f){if(!f)return h.busy--,h.notifyActivity(),k(h.error||"Can't access binary file",null,null);var g=-1,p=!d||0==d.length||0<=u(d,"density");h.opts.clientBin&&
(p=!1);if("bigwig"==h.meta.type||p||"undefined"!==typeof h.opts.forceReduction){for(p=1;p<h.meta.zoomLevels.length;++p)if(h.meta.zoomLevels[p]<=c)g=p-1;else break;"undefined"!==typeof h.opts.forceReduction&&(g=h.opts.forceReduction)}h.worker.postCommand({command:"fetch",connection:f,chr:a,min:e,max:b,zoom:g},function(a,c){h.busy--;h.notifyActivity();var d=1E9;if("bigwig"===h.meta.type){var f=(b-e)/a.length/2;f<d&&(d=f)}if(h.opts.link)for(f=0;f<a.length;++f){var g=a[f];g.label&&(g.links=[new D("Link",
h.opts.link.replace(/\$\$/,g.label))])}k(c,a,d)})})};f.prototype.quantFindNextFeature=function(a,e,b,c,d){var f=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:e,dir:b,threshold:c,under:!1},function(a,e){console.log(a,e);f.busy--;f.notifyActivity();return d(a,e)})};f.prototype.findNextFeature=function(a,e,b,c){var d=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,
chr:a,pos:e,dir:b},function(a,e){d.busy--;d.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};f.prototype.getScales=function(){var a=this.meta;return a?a.zoomLevels:null};f.prototype.search=function(a,e){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return e(null,"No indices available");var b=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,c){b.busy--;b.notifyActivity();
e(a,c)})};f.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var e=this;this.keyHolder.await(function(b){var c=e.meta;c&&c.schema&&c.definedFieldCount<c.schema.fields.length&&a(function(a,e){for(var b=0;b<e.hit.length;++b)if(e.hit[b].isSuperGroup)return;for(b=c.definedFieldCount;b<c.schema.fields.length;++b){var d=c.schema.fields[b];e.add(d.comment,a[d.name])}})})};f.prototype.getStyleSheet=function(a){var e=this;this.keyHolder.await(function(b){b=e.meta;if(!b)return a(null,
"bbi error");var c=new x;if("bigbed"==b.type){var d=new A;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="blue";d.HEIGHT=8;d.BUMP=!0;d.LABEL=!0;d.ZINDEX=20;c.pushStyle({type:"bigbed"},null,d);d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="red";d.HEIGHT=10;d.BUMP=!0;d.ZINDEX=20;c.pushStyle({type:"translation"},null,d);d=new A;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="white";d.HEIGHT=10;d.ZINDEX=10;d.BUMP=!0;d.LABEL=!0;c.pushStyle({type:"transcript"},null,d);d=new A;d.glyph="HISTOGRAM";d.COLOR1="white";d.COLOR2=
"black";d.HEIGHT=30;c.pushStyle({type:"density"},null,d)}else d=new A,d.glyph="HISTOGRAM",d.COLOR1="white",d.COLOR2="black",d.HEIGHT=30,c.pushStyle({type:"default"},null,d);12==b.definedFieldCount&&14<=b.fieldCount&&(c.geneHint=!0);return a(c)})};q.prototype=Object.create(t.prototype);q.prototype.init=function(){var a=this,e,b;this.bamSource.bamBlob?(e=new K(this.bamSource.bamBlob),b=new K(this.bamSource.baiBlob)):(e=new h(this.bamSource.bamURI,{credentials:this.opts.credentials,resolver:this.opts.resolver}),
b=new h(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials,resolver:this.opts.resolver}));M(e,b,null,function(e,b){a.readiness=null;a.notifyReadiness();e?a.bamHolder.provide(e):(a.error=b,a.bamHolder.provide(null))})};q.prototype.fetch=function(a,e,b,c,d,f,h){var k=d&&1==d.length&&"density"==d[0],g=this;g.busy++;g.notifyActivity();this.bamHolder.await(function(c){if(!c)return g.busy--,g.notifyActivity(),h(g.error||"Couldn't fetch BAM");c.fetch(a,e,b,function(a,
e){g.busy--;g.notifyActivity();if(e)h(e,null,null);else{for(var b=[],c=0;c<a.length;++c){var d=p(a[c],g.opts.bamGroup);d&&b.push(d)}h(null,b,1E9)}},{light:k})})};q.prototype.getScales=function(){return 1E9};q.prototype.getStyleSheet=function(a){this.bamHolder.await(function(e){e=new x;var b=new A;b.glyph="HISTOGRAM";b.COLOR1="black";b.COLOR2="red";b.HEIGHT=30;e.pushStyle({type:"density"},"low",b);e.pushStyle({type:"density"},"medium",b);b=new A;b.glyph="__SEQUENCE";b.FGCOLOR="black";b.BGCOLOR="blue";
b.HEIGHT=8;b.BUMP=!0;b.LABEL=!1;b.ZINDEX=20;e.pushStyle({type:"bam"},"high",b);return a(e)})};k.prototype=Object.create(t.prototype);k.prototype.init=function(){var a=this,b=this.bamSource.uri||this.bamSource.bamURI,c=this.bamSource.indexUri||this.bamSource.baiURI||b+".bai",d=this.bamSource.bamBlob||this.bamSource.blob,f=this.bamSource.baiBlob||this.bamSource.indexBlob,h=function(e,b){a.readiness=null;a.notifyReadiness();e?a.keyHolder.provide(e):(a.error=b,a.keyHolder.provide(null))};d?this.worker.postCommand({command:"connectBAM",
blob:d,indexBlob:f},h):this.worker.postCommand({command:"connectBAM",uri:e(b),resolver:this.resolverKey,indexUri:e(c),credentials:this.bamSource.credentials,indexChunks:this.bamSource.indexChunks},h)};k.prototype.fetch=function(a,e,b,c,d,f,h){var k=d&&1==d.length&&"density"==d[0],g=this;g.busy++;g.notifyActivity();this.keyHolder.await(function(c){if(!c)return g.busy--,g.notifyActivity(),h(g.error||"Couldn't fetch BAM");g.worker.postCommand({command:"fetch",connection:c,chr:a,min:e,max:b,opts:{light:k}},
function(a,e){g.busy--;g.notifyActivity();if(e)h(e,null,null);else{for(var b=[],c=0;c<a.length;++c){var d=p(a[c],g.opts.bamGroup);d&&b.push(d)}h(null,b,1E9)}})})};k.prototype.getScales=function(){return 1E9};k.prototype.getStyleSheet=function(a){this.keyHolder.await(function(e){e=new x;var b=new A;b.glyph="HISTOGRAM";b.COLOR1="black";b.COLOR2="red";b.HEIGHT=30;e.pushStyle({type:"density"},"low",b);e.pushStyle({type:"density"},"medium",b);b=new A;b.glyph="__SEQUENCE";b.FGCOLOR="black";b.BGCOLOR="blue";
b.HEIGHT=8;b.BUMP=!0;b.LABEL=!1;b.ZINDEX=20;e.pushStyle({type:"bam"},"high",b);return a(e)})};r.prototype.addActivityListener=function(a){this.activityListeners.push(a)};r.prototype.removeActivityListener=function(a){a=u(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,0)};r.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(e){console.log(e)}};r.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};
r.prototype.getScales=function(){return this.source.getScales()};r.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};r.prototype.simplifySegments=function(a,e){if(0==a.length)return a;a.sort(function(a,e){var b=a.name-e.name;return b?b:(b=a.start-e.start)?b:a.end-e.end});for(var b=[],c=a[0],d=0;d<a.length;++d){var f=a[d];f.name!=c.name||f.start>c.end+e?(b.push(c),c=f):c=new J(c.name,Math.min(c.start,f.start),Math.max(c.end,f.end))}b.push(c);return b};
r.prototype.fetch=function(a,e,b,c,d,f,h,k){var g=this,p=b-e+1;g.busy++;g.notifyActivity();this.mapping.sourceBlocksForRange(a,e,b,function(a){if(0==a.length)g.busy--,g.notifyActivity(),h("No mapping available for this regions",[],c);else{a=g.simplifySegments(a,Math.max(100,0.05*p));var e=[],b=null,r=a.length,q;a.map(function(a){g.source.fetch(a.name,a.start,a.end,c,d,f,function(c,d,f){c&&!q&&(q=c);if(d)for(c=0;c<d.length;++c){var k=d[c],p=k.segment;0==p.indexOf("chr")&&(p=p.substr(3));p=g.mapping.mapSegment(p,
k.min,k.max);if(0==p.length)k.parts&&0<k.parts.length&&e.push(k);else for(var l=0;l<p.length;++l){var x=p[l],m=L(k);m.segment=x.segment;m.min=x.min;m.max=x.max;x.partialMin&&(m.partialMin=x.partialMin);x.partialMax&&(m.partialMax=x.partialMax);x.flipped&&("-"==k.orientation?m.orientation="+":"+"==k.orientation&&(m.orientation="-"));e.push(m)}}d=g.mapping.mapPoint(a.name,a.start);c=g.mapping.mapPoint(a.name,a.end);d&&c&&(d=new ea(d.pos,c.pos),b=b?S(b,d):d);--r;0==r&&(g.busy--,g.notifyActivity(),h(q,
e,f,b))},k)})}})};H.prototype.getScales=function(){return null};H.prototype.fetch=function(a,e,b,c,d,f,h){return h(null,[],1E9)};H.prototype.getStyleSheet=function(a){var e=new x,b=new A;b.glyph="BOX";b.BGCOLOR="blue";b.FGCOLOR="black";e.pushStyle({type:"default"},null,b);return a(e)};Q.prototype.fetch=function(a,e,b,c,d){return d(null,null)};B.prototype.getScales=function(){return null};B.prototype.getStyleSheet=function(a){var e=new x,b=new A;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="red";b.HEIGHT=
10;b.BUMP=!0;b.ZINDEX=20;e.pushStyle({type:"translation"},null,b);b=new A;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="white";b.HEIGHT=10;b.ZINDEX=10;b.BUMP=!0;b.LABEL=!0;e.pushStyle({type:"transcript"},null,b);b=new A;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="green";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=20;e.pushStyle({type:"default"},null,b);return a(e)};B.prototype.fetch=function(a,e,b,c,d,f,h){d&&0==d.length?h(null,[],c):this.store.features(new J(a,e,b),{},function(a,e){h(e,a,1E5)})};I.prototype.sourceAdapterIsCapable=
function(a,e){return a.capabilities?a.capabilities()[e]:!1};"undefined"!==typeof v&&(v.exports={FeatureSourceBase:t,TwoBitSequenceSource:c,EnsemblSequenceSource:a,DASSequenceSource:E,MappedFeatureSource:r,CachingFeatureSource:l,BWGFeatureSource:b,RemoteBWGFeatureSource:f,BAMFeatureSource:q,RemoteBAMFeatureSource:k,DummyFeatureSource:H,DummySequenceSource:Q,registerSourceAdapterFactory:n,registerParserFactory:m,makeParser:g},d("./ensembljson"),d("./tabix-source"),d("./memstore"),d("./bedwig"),d("./vcf"))},
{"./bam":1,"./bedwig":2,"./bigwig":3,"./bin":4,"./cbrowser":6,"./chainset":7,"./cigar":8,"./das":10,"./encode":12,"./ensembljson":13,"./jbjson":22,"./memstore":25,"./overlay":27,"./spans":36,"./style":37,"./tabix-source":40,"./tier":45,"./twoBit":48,"./utils":49,"./vcf":50}],35:[function(d,v,s){function n(d){return d.uri?d.uri:d.blob?"file:"+d.blob.name:d.bwgBlob?"file:"+d.bwgBlob.name:d.bamBlob?"file:"+d.bamBlob.name:d.twoBitBlob?"file:"+d.twoBitBlob.name:d.bwgURI||d.bamURI||d.jbURI||d.twoBitURI||
"https://www.biodalliance.org/magic/no_uri"}function m(d){return d.stylesheet_uri?d.stylesheet_uri:"sequence"==d.tier_type||d.twoBitURI||d.twoBitBlob?"https://www.biodalliance.org/magic/sequence":n(d)}function g(d,l){if(n(d)!=n(l)||d.mapping!=l.mapping||d.tier_type!=l.tier_type)return!1;if(d.overlay){if(!l.overlay||l.overlay.length!=d.overlay.length)return!1;for(var m=0;m<d.overlay.length;++m)if(!g(d.overlay[m],l.overlay[m]))return!1}else if(l.overlay)return!1;return!0}function l(d,g){if(n(d)!=n(g)||
m(d)!=m(g)||d.mapping!=g.mapping||d.tier_type!=g.tier_type)return!1;if(d.overlay){if(!g.overlay||g.overlay.length!=d.overlay.length)return!1;for(var s=0;s<d.overlay.length;++s)if(!l(d.overlay[s],g.overlay[s]))return!1}else if(g.overlay)return!1;return!0}"undefined"!==typeof v&&(v.exports={sourcesAreEqual:l,sourcesAreEqualModuloStyle:g,sourceDataURI:n,sourceStyleURI:m})},{}],36:[function(d,v,s){function n(c,a){if("number"!=typeof c||"number"!=typeof a)throw"Bad range "+c+","+a;this._min=c;this._max=
a}function m(c){c=c.sort(E);var a=[],b=c.shift();c.forEach(function(c){c._min<=b._max?c._max>b._max&&(b._max=c._max):(a.push(b),b=c)});a.push(b);this._ranges=a}function g(c,a){c instanceof m||(c instanceof Array||(c=[c]),c=new m(c));a&&c.insertRange(a);return c}function l(c,a){for(var b=c.ranges(),d=a.ranges(),g=b.length,l=d.length,k=0,r=0,t=[];k<g&&r<l;){c=b[k];a=d[r];var s=Math.max(c.min(),a.min()),B=Math.min(c.max(),a.max());B>=s&&t.push(new n(s,B));c.max()>a.max()?++r:++k}return 0==t.length?null:
1==t.length?t[0]:new m(t)}function t(c){var a=0;c=c.ranges();for(var b=0;b<c.length;++b)var d=c[b],a=a+(d.max()-d.min()+1);return a}function C(c,a){return c.min()<a.min()?-1:c.min()>a.min()?1:c.max()<a.max()?-1:a.max()>c.max()?1:0}function E(c,a){return c._min<a._min?-1:c._min>a._min?1:c._max<a._max?-1:a._max>c._max?1:0}n.prototype.min=function(){return this._min};n.prototype.max=function(){return this._max};n.prototype.contains=function(c){return c>=this._min&&c<=this._max};n.prototype.isContiguous=
function(){return!0};n.prototype.ranges=function(){return[this]};n.prototype._pushRanges=function(c){c.push(this)};n.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};m.prototype.min=function(){return this._ranges[0].min()};m.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};m.prototype.lower_bound=function(c){var a=this.ranges();if(c>this.max())return a.length;if(c<this.min())return 0;for(var b=0,d=a.length-1;b<=d;){var g=Math.floor((b+d)/2);if(c>a[g]._max)b=
g+1;else if(c<a[g]._min)d=g-1;else return g}return b};m.prototype.contains=function(c){var a=this.lower_bound(c);return a<this._ranges.length&&this._ranges[a].contains(c)?!0:!1};m.prototype.insertRange=function(c){var a=this.lower_bound(c._min);if(a===this._ranges.length)this._ranges.push(c);else{var b=this.ranges();if(c._max<b[a]._min)this._ranges.splice(a,0,c);else{b[a]._min<c._min&&(c._min=b[a]._min);for(var d=a+1;d<b.length&&b[d]._min<=c._max;)d++;d--;b[d]._max>c._max&&(c._max=b[d]._max);this._ranges.splice(a,
d-a+1,c)}}};m.prototype.isContiguous=function(){return 1<this._ranges.length};m.prototype.ranges=function(){return this._ranges};m.prototype._pushRanges=function(c){for(var a=0;a<this._ranges.length;++a)c.push(this._ranges[a])};m.prototype.toString=function(){for(var c="",a=0;a<this._ranges.length;++a)0<a&&(c+=","),c+=this._ranges[a].toString();return c};"undefined"!==typeof v&&(v.exports={Range:n,union:g,intersection:l,coverage:t,rangeOver:C,_rangeOrder:E})},{}],37:[function(d,v,s){function n(d,
l,m){this.type=d;this.method=l;this.label=m}function m(d){this._filters={};if(d)for(var l=0;l<d.length;++l)this.add(d[l])}n.prototype.equals=function(d){return this.type==d.type&&this.method==d.method&&this.label==d.label};n.prototype.toString=function(){var d=[];this.type&&d.push("type="+this.type);this.method&&d.push("method="+this.method);this.label&&d.push("label="+this.label);return"StyleFilter<"+d.join(";")+">"};m.prototype.add=function(d){var l=d.toString();this._filters[l]||(this._filters[l]=
d,this._list=null)};m.prototype.addAll=function(d){d=d.list();for(var l=0;l<d.length;++l)this.add(d[l])};m.prototype.doesNotContain=function(d){d=d.list();for(var l=0;l<d.length;++l)if(!this._filters[l.toString()])return!0;return!1};m.prototype.list=function(){if(!this._list){this._list=[];for(var d in this._filters)this._filters.hasOwnProperty(d)&&this._list.push(this._filters[d])}return this._list};m.prototype.typeList=function(){for(var d=[],l=this.list(),m=0;m<l.length;++m){var n=l[m].type;if(!n||
"default"==n)return null;0>d.indexOf(n)&&d.push(n)}return d};"undefined"!==typeof v&&(v.exports={StyleFilter:n,StyleFilterSet:m})},{}],38:[function(d,v,s){if("undefined"!==typeof d){var n=d("./cbrowser").Browser,m=d("./utils").makeElementNS,g=d("./version"),l=d("./sequence-draw").svgSeqTier;v=d("./svg-utils");var t=v.NS_SVG,C=v.NS_XLINK,E=v.SVGPath,c=d("./numformats").formatQuantLabel}n.prototype.makeSVG=function(a){a=a||{};var b=a.minTierHeight||20,d=document.implementation.createDocument(t,"svg",
null),p=m(t,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});d.documentElement.appendChild(p);var q=m(t,"a",m(t,"text","Graphics from Dalliance "+g,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",textAnchor:"middle",fill:"blue"}));q.setAttribute("xmlns:xlink",C);q.setAttribute("xlink:href","http://www.biodalliance.org/");p.appendChild(q);q=m(t,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});q=m(t,"clipPath",q,{id:"featureClip"});p.appendChild(q);for(var q=
70,k=m(t,"g",null,{}),r=0;r<this.tiers.length;++r){var n=this.tiers[r],s=m(t,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),B=m(t,"g"),w=q,I=m(t,"rect",null,{x:0,y:w,width:"10000",height:50,fill:n.background});s.appendChild(I);if(n.sequenceSource){var y=l(n,n.currentSequence);s.appendChild(m(t,"g",y,{transform:"translate(200, "+q+")"}));q+=80}else{if(!n.subtiers)continue;for(var y=(n.glyphCacheOrigin-this.viewStart)*this.scale,F=!1,u=0;u<n.subtiers.length;++u){for(var q=q+3,v=n.subtiers[u],
e=[],x=0;x<v.glyphs.length;++x)e.push(v.glyphs[x].toSVG());s.appendChild(m(t,"g",e,{transform:"translate("+(200+y)+", "+q+")"}));if(v.quant){var F=!0,e=v.quant,A=v.height,x=2;40<A&&(x=1+(A/20|0));var A=A/(x-1),P=(e.max-e.min)/(x-1),J=new E;J.moveTo(205,q);J.lineTo(200,q);J.lineTo(200,q+v.height);J.lineTo(205,q+v.height);for(var U=1;U<x-1;++U){var z=U*A;J.moveTo(200,q+z);J.lineTo(203,q+z)}B.appendChild(m(t,"path",null,{d:J.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));B.appendChild(m(t,
"text",c(e.max),{x:197,y:q+7,textAnchor:"end"}));B.appendChild(m(t,"text",c(e.min),{x:197,y:q+v.height,textAnchor:"end"}));for(U=1;U<x-1;++U)z=U*A,B.appendChild(m(t,"text",c(1*e.max-U*P),{x:197,y:q+z+3,textAnchor:"end"}))}q+=v.height+3}q-w<b&&(q=w+b)}B.appendChild(m(t,"text","string"===typeof n.config.name?n.config.name:n.dasSource.name,{x:200-(F?20:12),y:(q+w+8)/2,fontSize:"10pt",textAnchor:"end"}));I.setAttribute("height",q-w);k.appendChild(m(t,"g",[s,B]))}if(a.highlights)for(b=this.highlights||
[],F=0;F<b.length;++F)A=b[F],(A.chr==this.chr||A.chr=="chr"+this.chr)&&A.min<this.viewEnd&&A.max>this.viewStart&&(r=(Math.max(A.min,this.viewStart)-this.viewStart)*this.scale,n=(Math.min(A.max,this.viewEnd)-this.viewStart)*this.scale,k.appendChild(m(t,"rect",null,{x:200+r,y:70,width:n-r,height:q-70,stroke:"none",fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));b=-1;"center"==a.ruler?b=200+(this.viewEnd-this.viewStart)*this.scale/2:"left"==a.ruler?b=200:"right"==a.ruler&&(b=
200+(this.viewEnd-this.viewStart)*this.scale);0<=b&&k.appendChild(m(t,"line",null,{x1:b,y1:70,x2:b,y2:q,stroke:"blue"}));p.appendChild(k);d.documentElement.setAttribute("width",this.featurePanelWidth+20+200);d.documentElement.setAttribute("height",q+50);return new Blob([(new XMLSerializer).serializeToString(d)],{type:"image/svg+xml"})}},{"./cbrowser":6,"./numformats":26,"./sequence-draw":31,"./svg-utils":39,"./utils":49,"./version":51}],39:[function(d,v,s){function n(){this.ops=[]}n.prototype.moveTo=
function(d,g){this.ops.push("M "+d+" "+g)};n.prototype.lineTo=function(d,g){this.ops.push("L "+d+" "+g)};n.prototype.closePath=function(){this.ops.push("Z")};n.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof v&&(v.exports={NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",SVGPath:n})},{}],40:[function(d,v,s){function n(a){l.call(this);this.readiness="Connecting";this.source=a;this.tabixHolder=new E;var b=this,d=g(a.payload);if(d)this.parser=
d;else throw"Unsuported tabix payload "+a.payload;var p;this.source.blob?(a=new C(this.source.blob),p=new C(this.source.indexBlob)):(a=new t(this.source.uri,{credentials:this.source.credentials,resolver:this.source.resolver}),p=new t(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials,resolver:this.source.resolver}));c(a,p,function(a,c){b.tabixHolder.provide(a);a.fetchHeader(function(a,b){if(a){for(var c=d.createSession(function(){}),k=0;k<a.length;++k)c.parse(a[k]);
c.flush()}});b.readiness=null;b.notifyReadiness()})}if("undefined"!==typeof d){v=d("./sourceadapters");var m=v.registerSourceAdapterFactory,g=v.makeParser,l=v.FeatureSourceBase;v=d("./bin");var t=v.URLFetchable,C=v.BlobFetchable,E=d("./utils").Awaited,c=d("./tabix").connectTabix}n.prototype=Object.create(l.prototype);n.prototype.fetch=function(a,b,c,d,g,k,r){var l=this;l.busy++;l.notifyActivity();this.tabixHolder.await(function(d){d.fetch(a,b,c,function(a,b){l.busy--;l.notifyActivity();for(var c=
[],d=l.parser.createSession(function(a){c.push(a)}),f=0;f<a.length;++f)d.parse(a[f]);d.flush();r(null,c,1E9)})})};n.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};n.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};m("tabix",function(a){return{features:new n(a)}})},{"./bin":4,"./sourceadapters":34,"./tabix":41,"./utils":49}],41:[function(d,v,s){function n(){}function m(a,b,c){var d=
new n;d.data=a;d.tbi=b;d.tbi.fetch(function(a){if(!a)return c(null,"Couldn't access Tabix");a=C(a,a.byteLength);var b=new Uint8Array(a);if(l(b,0)!=g)return c(null,"Not a tabix index");var r=l(b,4);d.format=l(b,8);d.colSeq=l(b,12);d.colStart=l(b,16);d.colEnd=l(b,20);d.meta=l(b,24);d.skip=l(b,28);l(b,32);d.indices=[];var m=36;d.chrToIndex={};d.indexToChr=[];for(var n=0;n<r;++n){for(var B="";;){var w=b[m++];if(0==w)break;B+=String.fromCharCode(w)}d.chrToIndex[B]=n;0==B.indexOf("chr")?d.chrToIndex[B.substring(3)]=
n:d.chrToIndex["chr"+B]=n;d.indexToChr.push(B)}B=1E9;for(w=0;w<r;++w){for(var I=m,y=l(b,m),m=m+4,n=0;n<y;++n){l(b,m);var s=l(b,m+4),m=m+(8+16*s)}for(var s=l(b,m),u=m+=4,n=0;n<s;++n){var v=t(b,u),u=u+8;if(v){n=v.block;0<v.offset&&(n+=65536);n<B&&(B=n);break}}m+=8*s;0<y&&(d.indices[w]=new Uint8Array(a,I,m-I))}d.headerMax=B;c(d)},{timeout:5E3})}var g=21578324;if("undefined"!==typeof d){d("./spans");var l=d("./bin").readInt;d=d("./lh3utils");var t=d.readVob,C=d.unbgzf,E=d.reg2bins,c=d.Chunk}n.prototype.blocksForRange=
function(a,b,d){var g=this.indices[a];if(!g)return[];a=E(b,d);for(var m=[],k=0;k<a.length;++k)m[a[k]]=!0;a=[];for(var r=[],k=l(g,0),n=4,s=0;s<k;++s){var B=l(g,n),w=l(g,n+4),n=n+8;if(m[B])for(var I=0;I<w;++I){var y=t(g,n),v=t(g,n+8);(4681>B?r:a).push(new c(y,v));n+=16}else n+=16*w}k=l(g,n);m=null;b=Math.min(b>>14,k-1);d=Math.min(d>>14,k-1);for(k=b;k<=d;++k)(b=t(g,n+4+8*k))&&(!m||b.block<m.block||b.offset<m.offset)&&(m=b);g=[];if(null!=m)for(k=0;k<r.length;++k)d=r[k],d.maxv.block>=m.block&&d.maxv.offset>=
m.offset&&g.push(d);r=g;g=[];for(k=0;k<r.length;++k)g.push(r[k]);for(k=0;k<a.length;++k)g.push(a[k]);g.sort(function(a,b){var e=a.minv.block-b.minv.block;return 0!=e?e:a.minv.offset-b.minv.offset});a=[];if(0<g.length){r=g[0];for(k=1;k<g.length;++k)d=g[k],d.minv.block==r.maxv.block?r=new c(r.minv,d.maxv):(a.push(r),r=d);a.push(r)}return a};n.prototype.fetch=function(a,b,c,d){function g(){if(n>=m.length)return d(l);if(w){var a=new Uint8Array(w);k.readRecords(a,m[n].minv.offset,l,b,c,r);w=null;++n;return g()}var y=
m[n],a=y.minv.block;k.data.slice(a,y.maxv.block+65536-a).fetch(function(a){w=C(a,y.maxv.block-y.minv.block+1);return g()})}var k=this;a=this.chrToIndex[a];if(void 0==a)return d([]);var r=this.indexToChr[a],m;void 0===a?m=[]:(m=this.blocksForRange(a,b,c))||d(null,"Error in index fetch");var l=[],n=0,w;g()};n.prototype.readRecords=function(a,b,c,d,g,k){a:for(;;){for(var m="";b<a.length;){var l=a[b++];if(10==l){l=m.split("\t");if(l[this.colSeq-1]==k){var n=parseInt(l[this.colStart-1]),t=n;0<this.colEnd&&
(t=parseInt(l[this.colEnd-1]));this.format&65536&&++n;n<=g&&t>=d&&c.push(m)}continue a}else m+=String.fromCharCode(l)}break}};n.prototype.fetchHeader=function(a){var b=this;b.data.slice(0,b.headerMax).fetch(function(c){if(!c)return a(null,"Fetch failed");c=new Uint8Array(C(c,c.byteLength));for(var d=0,g="",k=[];d<c.length;){var m=c[d++];if(10==m)if(g.charCodeAt(0)==b.meta)k.push(g),g="";else return a(k);else g+=String.fromCharCode(m)}a(k)})};"undefined"!==typeof v&&(v.exports={connectTabix:m,TABIX_MAGIC:g})},
{"./bin":4,"./lh3utils":24,"./spans":36}],42:[function(d,v,s){function n(a){this.genomes={};this.url=a}function m(){}function g(a){this.hub=a}function l(a,b,c){c=c||{};c.salt=!0;C(a,function(d,m){if(m)return b(null,m);var l=d.split(p),q=new n(a);c.credentials&&(q.credentials=c.credentials);for(var y=0;y<l.length-2;y+=3)q[l[y+1]]=l[y+2];if(q.genomesFile){var t=E(a,q.genomesFile);C(t,function(a,d){if(d)return b(null,d);for(var e=a.split(f),k=0;k<e.length;++k){var m=e[k].split(p),l=new g(q);c.credentials&&
(l.credentials=c.credentials);for(var n=0;n<m.length-2;n+=3)l[m[n+1]]=m[n+2];l.twoBitPath&&(l.twoBitPath=E(t,l.twoBitPath));l.genome&&l.trackDb&&(l.absURL=E(t,l.trackDb),q.genomes[l.genome]=l)}b(q)},c)}else b(null,"No genomesFile")},c)}function t(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}if("undefined"!==typeof d){s=d("./utils");var C=s.textXHR,E=s.relativeURL,c=s.shallowCopy;d=d("./das");var a=d.DASStylesheet,
b=d.DASStyle}var f=/\n\s*\n/,p=/(\w+) +(.+)\n?/,q=/subGroup[1-9]/;m.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};g.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);C(this.absURL,function(c,d){if(d)return a(null,d);c=c.replace("\\\n"," ");for(var g=[],l={},n=c.split(f),y=0;y<n.length;++y){var t=n[y].replace(/\#.*/g,"").split(p),u=new m;u._db=b;for(var s=0;s<t.length-2;s+=3){var e=t[s+1],x=t[s+2];if(e.match(q)){u.subgroups||
(u.subgroups={});for(var e=x.split(/\s/),x=e[0],A={name:e[1],tags:[],titles:[]},v=2;v<e.length;++v){var J=e[v].split(/=/);A.tags.push(J[0]);A.titles.push(J[1])}u.subgroups[x]=A}else if("subGroups"===e)for(e=x.split(/(\w+)=(\w+)/),u.sgm={},v=0;v<e.length-2;v+=3)u.sgm[e[v+1]]=e[v+2];else u[t[s+1]]=t[s+2]}u.track&&(u.type||u.container||u.view||u.bigDataUrl)&&(g.push(u),l[u.track]=u)}n=[];y=[];for(e=0;e<g.length;++e)u=g[e],t=!0,u.parent&&(s=u.parent.split(/\s+/),(x=l[s[0]])?(u._parent=x,x.children||(x.children=
[]),x.children.push(u),x&&(t=!1)):console.log("Couldn't find parent "+s[0]+"("+u.parent+")")),u.compositeTrack?y.push(u):t&&n.push(u);for(g=0;g<y.length;++g)if(l=y[g],l.children){u=!1;for(t=0;t<l.children.length;++t)e=l.children[t],e.view&&(e.shortLabel=l.shortLabel+": "+e.shortLabel,n.push(e),u=!0);u||n.push(l)}b._tracks=n;return a(b._tracks,null)},{credentials:this.credentials,salt:!0})};m.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&
(a.mapping=this._db.mapping);var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant="http://genome.ucsc.edu/images/"+b[0]);if(b=this.get("searchTrix"))a.trixURI=E(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var c=0;c<b.length;++c){var d=b[c],f=d.toDallianceSource();a.overlay.push(f);if(f.style)for(var g=0;g<f.style.length;++g){var p=f.style[g];p.method=d.shortLabel;"transparentOverlay"==this.aggregate&&
(p.style.ALPHA=0.5);a.style.push(p)}}return a}b=this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){c=b.split(/\s+/);if("bigBed"==c[0]&&this.bigDataUrl)return b=c[1]|0,c="+"==c[2],a.bwgURI=E(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&c&&(a.collapseSuperGroups=!0),a;if("bigWig"==c[0]&&this.bigDataUrl)return a.bwgURI=E(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&
"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==c[0]&&this.bigDataUrl)return a.bamURI=E(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;if("vcfTabix"==c[0]&&this.bigDataUrl)return a.uri=E(this._db.absURL,this.bigDataUrl),a.tier_type="tabix",a.payload="vcf",this._db.credentials&&(a.credentials=!0),a;console.log("Unsupported "+this.type)}};m.prototype.bigwigStyles=function(){var c=
this.type;if(!c){for(c=this;c._parent&&!c.type;)c=c._parent;c=c.type}if(c){var c=c.split(/\s+/),d,f;3<=c.length&&(d=1*c[1],f=1*c[2]);var g;this.maxHeightPixels&&(c=this.maxHeightPixels.split(/:/),3==c.length?g=c[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));c="bars";this.graphTypeDefault&&(c=this.graphTypeDefault);var p="black",l=null;this.color&&(p="rgb("+this.color+")");this.altColor&&(l="rgb("+this.altColor+")");var m=new a,n=new b;n.glyph="points"==c?"POINT":"HISTOGRAM";
l?(n.COLOR1=p,n.COLOR2=l):n.BGCOLOR=p;n.HEIGHT=g||30;if(d||f)n.MIN=d,n.MAX=f;m.pushStyle({type:"default"},null,n);return m.styles}};m.prototype.bigbedStyles=function(){var d="on"==(""+this.get("itemRgb")).toLowerCase(),f=this.get("visibility")||"full",g=this.get("color"),g=g?"rgb("+g+")":"blue",p=new a,l=new b;l.glyph="BOX";l.FGCOLOR="black";l.BGCOLOR=g;l.HEIGHT="full"==f||"pack"==f?12:8;l.BUMP="full"==f||"pack"==f;l.LABEL="full"==f||"pack"==f;l.ZINDEX=20;d&&(l.BGITEM=!0);(f=this.get("colorByStrand"))?
(f=f.split(/\s+/),g=c(l),g.BGCOLOR="rgb("+f[0]+")",p.pushStyle({type:"bigwig",orientation:"+"},null,g),l=c(l),l.BGCOLOR="rgb("+f[1]+")",p.pushStyle({type:"bigwig",orientation:"-"},null,l)):p.pushStyle({type:"bigwig"},null,l);l=new b;l.glyph="BOX";l.FGCOLOR="black";d&&(l.BGITEM=!0);l.BGCOLOR="red";l.HEIGHT=10;l.BUMP=!0;l.ZINDEX=20;p.pushStyle({type:"translation"},null,l);d=new b;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="white";d.HEIGHT=10;d.ZINDEX=10;d.BUMP=!0;d.LABEL=!0;p.pushStyle({type:"transcript"},
null,d);return p.styles};"undefined"!==typeof v&&(v.exports={connectTrackHub:l,THUB_COMPARE:t})},{"./das":10,"./utils":49}],43:[function(d,v,s){if("undefined"!==typeof d)var n=d("./cbrowser").Browser,m=d("./utils").shallowCopy;n.prototype.mergeSelectedTiers=function(){for(var d=[],l=[],n=0;n<this.selectedTiers.length;++n){var s=this.tiers[this.selectedTiers[n]];d.push(m(s.dasSource));for(var v=s.stylesheet.styles,c=0;c<v.length;++c){var a=v[c],b=m(a);b.method=s.dasSource.name.replace(/[()+*?]/g,"\\$&");
b._methodRE=null;b.style=m(a.style);void 0===b.style.ZINDEX&&(b.style.ZINDEX=n);s.forceMin&&(b.style.MIN=s.forceMin);s.forceMax&&(b.style.MAX=s.forceMax);l.push(b)}}this.addTier({name:"Merged",merge:"concat",overlay:d,noDownsample:!0,style:l});this.setSelectedTier(this.tiers.length-1)}},{"./cbrowser":6,"./utils":49}],44:[function(d,v,s){function n(a){for(var b=0;b<a.styles.length;++b){var c=a.styles[b].style;if("__SEQUENCE"===c.glyph)return c}}if("undefined"!==typeof d){var m=d("./cbrowser").Browser,
g=d("./utils").makeElement;v=d("./das");var l=v.isDasBooleanTrue,t=v.copyStylesheet,C=d("./color").dasColourForName,E=d("./sourcecompare").sourceDataURI}var c={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};m.prototype.openTierPanel=function(a){if("tier"===this.uiMode&&this.manipulatingTier===a)this.hideToolPanel(),this.setUiMode("none");else if(a){var b=function(a){a.BGGRAD||(1==P?("LINEPLOT"==a.glyph||c[a.glyph]?a.FGCOLOR=y.value:a.BGCOLOR=y.value,a.COLOR1=a.COLOR2=a.COLOR3=null):
(a.COLOR1=y.value,a.COLOR2=F.value,a.COLOR3=2<P?u.value:null),a._gradient=null,a._plusColor=L.value,a._minusColor=e.value)},d=function(e){for(var b=t(a.stylesheet),c=a.browser.zoomForCurrentScale(),d=0;d<b.styles.length;++d){var f=b.styles[d];f.zoom&&f.zoom!=c||e(f.style)}return b},p=function(e){a.mergeStylesheet(d(b))};this.manipulatingTier=a;var m=g("div",null,{className:"tier-edit"}),k=g("div","About '"+(a.config.Name||a.dasSource.name)+"'",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",
textAlign:"center"});m.appendChild(k);var k=g("div",[g("p",a.dasSource.desc)]),r=[],s=E(a.dasSource);!s||0!=s.indexOf("http://")&&0!=s.indexOf("https://")&&0!=s.indexOf("//")||"https://www.biodalliance.org/magic/no_uri"===s||r.push(g("li",g("a","(Download data)",{href:s})));a.dasSource.mapping&&(s=this.chains[a.dasSource.mapping].coords,r.push(g("li","Mapped from "+s.auth+s.version)));0<r.length&&k.appendChild(g("ul",r));m.appendChild(k);var v=g("span"," (styles for current zoom level)",null,{display:"none"}),
k=g("div",["Edit",v],null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"});m.appendChild(k);var B=g("input",null,{type:"text"}),w=g("input",null,{type:"checkbox",disabled:this.disablePinning}),I=g("select");I.appendChild(g("option","Histogram",{value:"HISTOGRAM"}));I.appendChild(g("option","Line Plot",{value:"LINEPLOT"}));I.appendChild(g("option","Ribbon",{value:"GRADIENT"}));I.appendChild(g("option","Scatter",{value:"SCATTER"}));var y=g("input",null,{type:"text",value:"#dd00dd"}),
F=g("input",null,{type:"text",value:"#dd00dd"}),u=g("input",null,{type:"text",value:"#dd00dd"}),L=g("input",null,{type:"text",value:"#ffa07a"}),e=g("input",null,{type:"text",value:"#87cefa"});try{y.type=F.type=u.type="color",L.type=e.type="color"}catch(x){}var A=[y,F,u],k=g("i",null,{className:"fa fa-plus-circle"}),r=g("i",null,{className:"fa fa-minus-circle"}),P=1,s=g("td",A),J=function(a){P=a;for(var e=0;e<a;++e)A[e].style.display="block";for(e=a;e<A.length;++e)A[e].style.display="none"};k.addEventListener("click",
function(a){3>P&&(J(P+1),p(null))},!1);r.addEventListener("click",function(a){1<P&&(J(P-1),p(null))},!1);var U=g("input",null,{type:"text",value:"0.0"}),z=g("input",null,{type:"text",value:"10.0"}),D=g("input",null,{type:"checkbox"}),h=g("input",null,{type:"checkbox"}),K=g("input",null,{type:"checkbox",checked:void 0!==a.quantLeapThreshold}),G=g("input",null,{type:"text",value:a.quantLeapThreshold,disabled:!K.checked}),T=g("input",null,{type:"text",value:"50"}),M=g("input",null,{type:"checkbox"}),
Y=g("input",null,{type:"text"}),ea=g("input",null,{type:"checkbox"}),S=null;0<a.stylesheet.styles.length&&(S=a.stylesheet.styles[0].style);var X=function(){B.value="string"===typeof a.config.name?a.config.name:a.dasSource.name;w.checked=a.pinned;a.forceHeight?T.value=""+a.forceHeight:S&&S.HEIGHT&&(T.value=""+S.HEIGHT);"number"==typeof a.quantLeapThreshold?(K.checked=!0,G.disabled=!1,parseFloat(G.value)!=a.quantLeapThreshold&&(G.value=a.quantLeapThreshold)):(K.checked=!1,G.disabled=!0);Y.value="number"==
typeof a.subtierMax?""+a.subtierMax:""+(a.dasSource.subtierMax||a.browser.defaultSubtierMax);if(0<a.stylesheet.styles.length){for(var b=null,c=!1,d=!1,d=a.browser.zoomForCurrentScale(),f=0,k=0;k<a.stylesheet.styles.length;++k){var g=a.stylesheet.styles[k];if(!g.zoom||g.zoom==d)if(++f,g=a.stylesheet.styles[k].style,b||(b=S=g),"LINEPLOT"==g.glyph||"HISTOGRAM"==g.glyph||"GRADIENT"==g.glyph||l(g.SCATTER))c||(b=S=g),c=!0}if(!b)return;v.style.display=f==a.stylesheet.styles.length?"none":"inline";d=c&&1==
f;c?(ra.style.display="table-row",da.style.display="table-row",ua.style.display="none",V.style.display="none"):(ra.style.display="none",da.style.display="none",ua.style.display="table-row",M.checked=l(S.BUMP),Y.disabled=!l(S.BUMP),V.style.display="table-row",ea.checked=l(S.LABEL));d?(ma.style.display="table-row",$.style.display="table-row"):(ma.style.display="none",$.style.display="none");f=1;b.COLOR1?(y.value=C(b.COLOR1).toHexString(),b.COLOR2&&(F.value=C(b.COLOR2).toHexString(),b.COLOR3?(u.value=
C(b.COLOR3).toHexString(),f=3):f=2)):"LINEPLOT"==b.glyph||"DOT"==b.glyph&&b.FGCOLOR?y.value=C(b.FGCOLOR).toHexString():b.BGCOLOR&&(y.value=C(b.BGCOLOR).toHexString());J(f);b._plusColor&&(L.value=C(b._plusColor).toHexString()||b._plusColor);b._minusColor&&(e.value=C(b._minusColor).toHexString()||b._minusColor);l(b.SCATTER)?I.value="SCATTER":I.value=b.glyph;var p,m;void 0!==b.MIN&&(f=parseFloat(b.MIN),isNaN(f)||(p=f));a.forceMinDynamic||void 0===b.MIN&&void 0===a.forceMin?(D.checked=!1,U.disabled=!0):
(D.checked=!0,U.disabled=!1);void 0!==b.MAX&&(f=parseFloat(b.MAX),isNaN(f)||(m=f));a.forceMaxDynamic||void 0===b.MAX&&void 0===a.forceMax?(h.checked=!1,z.disabled=!0):(h.checked=!0,z.disabled=!1);void 0!=a.forceMin&&(p=a.forceMin);void 0!=a.forceMax&&(m=a.forceMax);"number"==typeof p&&p!=parseFloat(U.value)&&(U.value=p);"number"==typeof m&&m!=parseFloat(z.value)&&(z.value=m);(b=n(a.stylesheet))?(la.style.display="table-row",aa.checked="mismatch"===b.__SEQCOLOR,qa.style.display="table-row",pa.checked=
l(b.__INSERTIONS),ga.style.display="table-row",fa.checked=void 0===b.__disableQuals||!1===b.__disableQuals,console.log(b.__disableQuals)):(la.style.display="none",qa.style.display="none",ga.style.display="none");b&&aa.checked&&!d?(ka.style.display="table-row",na.style.display="table-row"):(ka.style.display="none",na.style.display="none")}c&&a.browser.sourceAdapterIsCapable(a.featureSource,"quantLeap")?ta.style.display="table-row":ta.style.display="none"},aa=g("input",null,{type:"checkbox"}),la=g("tr",
[g("th","Highlight mismatches & strands"),g("td",aa)]);aa.addEventListener("change",function(e){e=t(a.stylesheet);n(e).__SEQCOLOR=aa.checked?"mismatch":"base";a.mergeStylesheet(e)});var pa=g("input",null,{type:"checkbox"}),qa=g("tr",[g("th","Show insertions"),g("td",pa)]);pa.addEventListener("change",function(e){e=t(a.stylesheet);n(e).__INSERTIONS=pa.checked?"yes":"no";a.mergeStylesheet(e)});var fa=g("input",null,{type:"checkbox"}),ga=g("tr",[g("th","Reflect base quality as base color transparency"),
g("td",fa)]);fa.addEventListener("change",function(e){e=t(a.stylesheet);var b=n(e);b.__disableQuals=!fa.checked;console.log(b.__disableQuals);a.mergeStylesheet(e)});var ma=g("tr",[g("th","Style"),g("td",I)]),$=g("tr",[g("th",["Colour(s)",k,r]),s]),ka=g("tr",[g("th","Plus Strand Color"),g("td",L)]),na=g("tr",[g("th","Minus Strand Color"),g("td",e)]),ra=g("tr",[g("th","Min value"),g("td",[D," ",U])]),da=g("tr",[g("th","Max value"),g("td",[h," ",z])]),ta=g("tr",[g("th","Threshold leap:"),g("td",[K," ",
G])]),ua=g("tr",[g("th","Bump overlaps"),g("td",[M," limit: ",Y])]),V=g("tr",[g("th","Label features"),g("td",ea)]),k=g("table",[g("tr",[g("th","Name",{},{width:"150px",textAlign:"right"}),B]),g("tr",[g("th","Pin to top"),w]),g("tr",[g("th","Height"),g("td",T)]),ma,$,ka,na,ra,da,ta,ua,V,la,qa,ga]);X();m.appendChild(k);k=g("button","Reset track",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});k.addEventListener("click",function(e){a.setConfig({})},!1);m.appendChild(k);B.addEventListener("input",
function(e){a.mergeConfig({name:B.value})},!1);w.addEventListener("change",function(e){a.mergeConfig({pinned:w.checked})},!1);for(k=0;k<A.length;++k)A[k].addEventListener("change",p,!1);L.addEventListener("change",p,!1);e.addEventListener("change",p,!1);I.addEventListener("change",function(e){e=d(function(a){"SCATTER"===I.value?(a.SCATTER=!0,a.glyph="DOT",a.SIZE="3"):(a.glyph=I.value,a.SCATTER=void 0);b(a)});a.mergeStylesheet(e)},!1);D.addEventListener("change",function(e){e={forceMinDynamic:!D.checked};
U.disabled=!D.checked;var b=parseFloat(U.value);D.checked&&"number"==typeof b&&!isNaN(b)&&(e.forceMin=parseFloat(b));a.mergeConfig(e)});U.addEventListener("input",function(e){e=parseFloat(U.value);"number"!=typeof e||isNaN(e)||a.mergeConfig({forceMin:e})},!1);h.addEventListener("change",function(e){e={forceMaxDynamic:!h.checked};z.disabled=!h.checked;var b=parseFloat(z.value);h.checked&&"number"==typeof b&&!isNaN(b)&&(e.forceMax=parseFloat(b));a.mergeConfig(e)});z.addEventListener("input",function(e){e=
parseFloat(z.value);"number"!=typeof e||isNaN(e)||a.mergeConfig({forceMax:e})},!1);T.addEventListener("input",function(e){e=parseFloat(T.value);"number"!=typeof e||isNaN(e)||a.mergeConfig({height:Math.min(500,e|0)})},!1);var ba=function(){G.disabled=!K.checked;if(K.checked){var e=parseFloat(G.value);"number"!=typeof e||isNaN(e)||a.mergeConfig({quantLeapThreshold:parseFloat(G.value)})}else a.mergeConfig({quantLeapThreshold:null})};K.addEventListener("change",function(a){ba()},!1);G.addEventListener("input",
function(a){ba()},!1);ea.addEventListener("change",function(e){e=d(function(a){a.LABEL=ea.checked?"yes":"no"});a.mergeStylesheet(e)},!1);M.addEventListener("change",function(e){e=d(function(a){a.BUMP=M.checked?"yes":"no"});a.mergeStylesheet(e)},!1);Y.addEventListener("input",function(e){e=parseInt(Y.value);"number"==typeof e&&0<e&&a.mergeConfig({subtierMax:e})},!1);this.showToolPanel(m);this.setUiMode("tier");a.addTierListener(X);var N=a.browser.scale;a.browser.addViewListener(function(){a.browser.scale!=
N&&(N=a.browser.scale,X())})}}},{"./cbrowser":6,"./color":9,"./das":10,"./sourcecompare":35,"./utils":49}],45:[function(d,v,s){function n(a,b,c,d){this.config=c||{};this.id="tier"+ ++r;this.browser=a;this.dasSource=l(b);this.background=d;this.viewport=m("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport_12_5"},{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=m("div",this.viewport,{className:"viewport-holder_12_5"},{background:d,
position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=m("canvas",null,{width:+(this.browser.featurePanelWidth|0),height:"30",className:"viewport-overlay"});this.notifier=m("div","",{className:"notifier"});this.notifierHolder=m("div",this.notifier,{className:"notifier-holder"});this.quantOverlay=m("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=m("i",null,{className:"fa fa-times"});this.bumpButton=m("i",null,
{className:"fa fa-plus-circle"});this.loaderButton=a.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=m("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=m("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);b.pennant?this.nameButton.appendChild(m("img",null,{src:b.pennant,width:"16",height:"16"})):b.mapping&&(c=null,this.browser.chains[b.mapping]&&(c=this.browser.chains[b.mapping].coords.version),c&&this.nameButton.appendChild(m("span",
""+c,null,{fontSize:"8pt",background:"black",color:"white",paddingLeft:"3px",paddingRight:"3px",paddingTop:"1px",paddingBottom:"1px",marginLeft:"2px",borderRadius:"10px"})));this.nameElement=m("span",b.name);this.nameButton.appendChild(m("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=m("span",[this.nameButton],{className:"btn-group track-label"});this.row=m("div",[this.viewportHolder,
this.overlay,this.quantOverlay],{className:"tier"+(b.className?" "+b.className:"")});d||(this.row.style.background="none");a.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);this.initSources();
var f=this;this.featureSource&&this.featureSource.getDefaultFIPs&&!b.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&f.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&(this.readinessListener=function(a){f.notify(a,-1)},this.featureSource.addReadinessListener(this.readinessListener));this.featureSource&&this.featureSource.addActivityListener&&(this.activityListener=function(a){f.loaderButton.style.display=0<a?"inline-block":"none";f.browser.pingActivity()},
this.featureSource.addActivityListener(this.activityListener));this.listeners=[];this.featuresLoadedListeners=[]}if("undefined"!==typeof d){s=d("./utils");var m=s.makeElement,g=s.removeChildren,l=s.shallowCopy,t=s.miniJSONify,C=s.arrayIndexOf;s=d("./das");var E=s.DASStylesheet,c=s.DASStyle,a=d("./sha1").b64_sha1;s=d("./style");var b=s.StyleFilter,f=s.StyleFilterSet,p=d("./sourcecompare").sourceDataURI,q=d("es6-promise").Promise,k=d("./features").sortFeatures}var r=0;n.prototype.destroy=function(){this.featureSource.removeReadinessListener&&
this.featureSource.removeReadinessListener(this.readinessListener);this.featureSource.removeActivityListener&&this.featureSource.removeActivityListener(this.activityListener)};n.prototype.setBackground=function(a){this.background=a;this.viewportHolder.style.background=a};n.prototype.toString=function(){return this.id};n.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};n.prototype.init=function(){var a=this;return new q(function(b,
d){a.dasSource.style?(a.setStylesheet({styles:a.dasSource.style}),b(a)):(a.status="Fetching stylesheet",a.fetchStylesheet(function(d,f){if(f||!d){a.error="No stylesheet";d=new E;var k=new c;k.glyph="BOX";k.BGCOLOR="blue";k.FGCOLOR="black";d.pushStyle({type:"default"},null,k);a.setStylesheet(d)}else a.setStylesheet(d),d.geneHint&&(a.dasSource.collapseSuperGroups=!0,a.bumped=!1,a.updateLabel()),a._updateFromConfig();b(a)}))})};n.prototype.setStylesheet=function(b){this.baseStylesheet=l(b);for(b=0;b<
this.baseStylesheet.styles.length;++b){var c=this.baseStylesheet.styles[b]=l(this.baseStylesheet.styles[b]);c._methodRE=c._labelRE=c._typeRE=null;c.style=l(c.style);c.style.id="style"+ ++this.styleIdSeed}this.baseStylesheetValidity=a(t(this.baseStylesheet));this._updateFromConfig()};n.prototype.getSource=function(){return this.featureSource};n.prototype.getDesiredTypes=function(a){if(a=this.getActiveStyleFilters(a))return a.typeList()};n.prototype.getActiveStyleFilters=function(a){a=this.browser.zoomForCurrentScale();
if(this.stylesheet){for(var c=new f,d=this.stylesheet.styles,k=0;k<d.length;++k){var g=d[k];g.zoom&&g.zoom!=a||c.add(new b(g.type,g.method,g.label))}return c}};n.prototype.needsSequence=function(a){return this.sequenceSource&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.bwgURI||this.dasSource.bwgBlob)&&20>a?!0:!1};n.prototype.setFeatures=function(a,b,c,d,f){this.currentFeatures=d;this.currentSequence=f;this.knownChr=a;this.knownCoverage=b;d&&(k(this),this.notifyFeaturesLoaded())};
n.prototype.draw=function(){var a=this.currentSequence;this.sequenceSource?Q(this,a):H(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};n.prototype.findNextFeature=function(a,b,c,d,f){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*c/2|0,this.featureSource.quantFindNextFeature(a,b,c,this.quantLeapThreshold,f);else{if(this.knownCoverage&&b>=this.knownCoverage.min()&&b<=this.knownCoverage.max()&&this.currentFeatures){for(var k=null,g=0;g<this.currentFeatures.length;++g){var e=
this.currentFeatures[g];if(e.min&&e.max&&!(e.parents&&0<e.parents.length))if(0>c)if(1==d&&e.max>=b&&e.min<b){if(!k||e.min>k.min||e.min==k.min&&e.max<k.max)k=e}else e.max<b&&(!k||e.max>k.max||e.max==k.max&&e.min<k.min||e.min==k.mmin&&k.max>=b)&&(k=e);else if(1==d&&e.min<=b&&e.max>b){if(!k||e.max<k.max||e.max==k.max&&e.min>k.min)k=e}else e.min>b&&(!k||e.min<k.min||e.min==k.min&&e.max>k.max||e.max==k.max&&k.min<=b)&&(k=e)}if(k)return f(k);b=0>c?this.browser.knownSpace.min:this.browser.knownSpace.max}this.trySourceFNF(a,
b,c,f)}};n.prototype.trySourceFNF=function(a,b,c,d){var f=this;this.featureSource.findNextFeature(a,b,c,function(a){a||d(a);var b=f.browser.getSequenceSource();b||d(a);b.getSeqInfo(a.segment,function(e){e?d(a):f.trySourceFNF(a.segment,0<c?1E10:0,c,d)})})};n.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};n.prototype.updateHeight=function(){this.currentHeight=
Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};n.prototype.drawOverlay=function(){var a=this.browser,b=a.retina&&1<window.devicePixelRatio;this.overlay.height=this.viewport.height;this.overlay.width=b?2*a.featurePanelWidth:a.featurePanelWidth;var c=this.overlay.getContext("2d");b&&c.scale(2,2);var d=b=a.viewStart,f=a.viewEnd;if(this.overlayLabelCanvas){var k=(this.glyphCacheOrigin-
this.browser.viewStart)*this.browser.scale;c.save();c.translate(k,0);var g=-k+2;this.dasSource.tierGroup&&(g+=15);this.overlayLabelCanvas.draw(c,g,a.featurePanelWidth-k);c.restore()}for(k=0;k<a.highlights.length;++k)g=a.highlights[k],(g.chr===a.chr||g.chr==="chr"+a.chr)&&g.min<f&&g.max>d&&(c.globalAlpha=a.defaultHighlightAlpha,c.fillStyle=a.defaultHighlightFill,c.fillRect((g.min-b)*a.scale,0,(g.max-g.min)*a.scale,this.overlay.height));this.overlay.style.width=a.featurePanelWidth;this.overlay.style.height=
this.viewport.style.height;this.overlay.style.left="0px"};n.prototype.updateStatus=function(a){var b=this;a?(this.status=a,this._notifierToStatus(),p(this.dasSource),"https:"!==window.location.protocol||0!=p(this.dasSource).indexOf("http:")||this.checkedHTTP||(this.checkedHTTP=!0,this.browser.canFetchPlainHTTP().then(function(a){a||(b.warnHTTP=!0,b._notifierToStatus())}))):this.status&&(this.status=null,this._notifierToStatus())};n.prototype.notify=function(a,b){"number"!==typeof b&&(b=2E3);this.notifierFadeTimeout&&
(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(a){if(this._notifierOn(a),0<b){var c=this;this.notifierFadeTimeout=setTimeout(function(){c._notifierToStatus()},b)}}else this._notifierToStatus()};n.prototype._notifierOn=function(a,b){g(this.notifier);b?this.notifier.appendChild(m("span",[m("a","[HTTP Warning] ",{href:this.browser.httpWarningURL,target:"_blank"}),a])):this.notifier.textContent=a;this.notifier.style.opacity=0.8};n.prototype._notifierOff=function(){this.notifier.style.opacity=
0};n.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status,this.warnHTTP):this._notifierOff()};n.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();this.notifyTierListeners()};n.prototype.mergeStylesheet=function(a){this.mergeConfig({stylesheet:a,stylesheetValidity:this.baseStylesheetValidity})};n.prototype.mergeConfig=function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();this.notifyTierListeners()};n.prototype._updateFromConfig=
function(){var a=!1,b=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var c=this.config.height||this.dasSource.forceHeight;c!=this.forceHeight&&(this.forceHeight=c,a=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);c=void 0!=this.config.forceMin?this.config.forceMin:this.dasSource.forceMin;this.forceMin!=c&&(this.forceMin=c,a=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&
(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);c=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=c&&(this.forceMax=c,a=!0);c=null;void 0!==this.config.quantLeapThreshold?c=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(c=this.dasSource.quantLeapThreshold);c!=this.quantLeapThreshold&&(this.quantLeapThreshold=c,a=!0);c=null;this.config.stylesheetValidity==this.baseStylesheetValidity&&(c=this.config.stylesheet);c=c||this.baseStylesheet;
this.stylesheet!==c&&(this.stylesheet=c,a=!0);c=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;c!==this.pinned&&(this.pinned=c,b=!0);c=typeof("number"===this.config.subtierMax)?this.config.subtierMax:this.dasSource.subtierMax||this.browser.defaultSubtierMax;c!=this.subtierMax&&(this.subtierMax=c,a=!0);c=void 0!==this.config.bumped?this.config.bumped:void 0!==this.dasSource.bumped?this.dasSource.bumped:this.dasSource.collapseSuperGroups?!1:!0;c!==this.bumped&&(this.bumped=c,a=
!0,this.updateLabel());a&&this.scheduleRedraw();b&&this.browser.reorderTiers()};n.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();a.redrawTimeout=null},10))}};n.prototype.clearTierListeners=function(){this.listeners=[]};n.prototype.addTierListener=function(a){this.listeners.push(a)};n.prototype.removeTierListener=function(a){a=C(this.listeners,a);0<=a&&this.listeners.splice(a,1)};n.prototype.notifyTierListeners=
function(a){for(var b=0;b<this.listeners.length;++b)try{this.listeners[b](a)}catch(c){console.log(c)}this.browser.notifyTier()};n.prototype.clearFeaturesLoadedListeners=function(){this.featuresLoadedListeners=[]};n.prototype.addFeaturesLoadedListener=function(a){this.featuresLoadedListeners.push(a)};n.prototype.removeFeaturesLoadedListener=function(a){a=C(this.featuresLoadedListeners,a);0<=a&&this.featuresLoadedListeners.splice(a,1)};n.prototype.notifyFeaturesLoaded=function(){for(var a=0;a<this.featuresLoadedListeners.length;++a)try{this.featuresLoadedListeners[a].call(this)}catch(b){console.log(b)}};
if("undefined"!==typeof v){v.exports={DasTier:n};var H=d("./feature-draw").drawFeatureTier,Q=d("./sequence-draw").drawSeqTier}},{"./das":10,"./feature-draw":18,"./features":20,"./sequence-draw":31,"./sha1":33,"./sourcecompare":35,"./style":37,"./utils":49,"es6-promise":53}],46:[function(d,v,s){function n(a,b){for(var c=0;c<a.length;++c){var e=a[c];e===b?e.classList.add("active"):e.classList.remove("active")}}if("undefined"!==typeof d){var m=d("./cbrowser").Browser,g=d("./sourcecompare").sourcesAreEqual;
v=d("./utils");var l=v.makeElement,t=v.removeChildren,C=v.Observed;v=d("./thub");var E=v.THUB_COMPARE,c=v.connectTrackHub,a=d("./domui").makeTreeTableSection,b=d("./probe").probeResource;v=d("./bin");var f=v.URLFetchable,p=v.BlobFetchable,q=v.readInt,k=d("./lh3utils").unbgzf,r=d("./bam").BAI_MAGIC,H=d("./tabix").TABIX_MAGIC;v=d("./das");var Q=v.DASSource,B=v.DASSegment,w=v.DASRegistry,I=v.coordsMatch,y=d("./encode").EncodeFetchable}m.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(g(this.tiers[b].dasSource,
a))return this.tiers[b];return!1};m.prototype.makeButton=function(a,b){var c=l("a",a,{href:"#"});b&&this.makeTooltip(c,b);return l("li",c)};m.prototype.showTrackAdder=function(d){function g(e){ca.style.display="none";ha.style.display="none";ia.style.display="none";V=!1;t(N);for(var b=l("div",null,{},{width:"100%"}),c=[],d=0;d<e.length;++d)c.push(e[d]);c.sort(function(a,e){return a.shortLabel.toLowerCase().trim().localeCompare(e.shortLabel.toLowerCase().trim())});e=[];for(var f=[],d=0;d<c.length;++d){var k=
c[d];k.children&&0<k.children.length&&"multiWig"!=k.container?e.push(k):f.push(k)}0<f.length&&e.push({shortLabel:"Others",priority:-1E8,children:f});e.sort(E);for(var p=[],c=0;c<e.length;++c){k=f=e[c];!k.dimensions&&k._parent&&k._parent.dimensions&&(k=k._parent);d={};if(k.dimensions)for(var m=k.dimensions.split(/(\w+)=(\w+)/),n=0;n<m.length-2;n+=3)d[m[n+1]]=m[n+2];if(d.dimX&&d.dimY){for(var x=d.dimX,q=d.dimY,d=k.subgroups[x],m=k.subgroups[q],n={},r=0;r<f.children.length;++r){var A=f.children[r],k=
A.sgm[x],u=A.sgm[q];n[k]||(n[k]={});n[k][u]=A}q=l("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});k=l("tr");k.appendChild(l("th",null,{},{width:"150px",height:"100px"}));for(u=0;u<d.titles.length;++u)x=l("th",l("div",d.titles[u],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),k.appendChild(x);
q.appendChild(k);for(var z=l("tbody",null,{className:"table table-striped table-condensed"}),w=0;w<m.titles.length;++w){var u=m.tags[w],D=l("tr");D.appendChild(l("th",m.titles[w]),{});for(var y=0;y<d.titles.length;++y){var k=d.tags[y],s=l("td");if(n[k]&&n[k][u]){k=n[k][u];r=k.toDallianceSource();if(!r)continue;x=l("tr");A=l("td");A.style.textAlign="center";var v=l("input");v.type="checkbox";v.dalliance_source=r;sa&&(v.dalliance_mapping=sa);p.push(v);s.appendChild(v);v.addEventListener("change",function(a){a.target.checked?
h.addTier(a.target.dalliance_source):h.removeTier(a.target.dalliance_source)})}D.appendChild(s)}z.appendChild(D)}q.appendChild(z);b.appendChild(a(f.shortLabel,q,0==c))}else{m=l("tbody",null,{className:"table table-striped table-condensed"});n=l("table",m,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});u=0;f.children.sort(E);for(d=0;d<f.children.length;++d)if(k=f.children[d],r=k.toDallianceSource())x=l("tr"),A=l("td",null,{},{width:"30px"}),A.style.textAlign="center",
v=l("input"),v.type="checkbox",v.dalliance_source=r,sa&&(v.dalliance_mapping=sa),p.push(v),A.appendChild(v),v.addEventListener("change",function(a){a.target.checked?h.addTier(a.target.dalliance_source):h.removeTier(a.target.dalliance_source)}),x.appendChild(A),q=l("td"),q.appendChild(document.createTextNode(k.shortLabel)),k.longLabel&&0<k.longLabel.length&&h.makeTooltip(q,k.longLabel),x.appendChild(q),m.appendChild(x),++u;1<e.length||"Others"!==f.shortLabel?b.appendChild(a(f.shortLabel,n,0==c)):b.appendChild(n)}}var J=
function(){for(var a=0;a<p.length;++a){var e=p[a],b=h.currentlyActive(e.dalliance_source);b?(e.checked=!0,e.disabled=null!=b.sequenceSource):e.checked=!1}};J();h.addTierListener(function(a){J()});N.appendChild(b)}function m(){n(K,fa);V="bin";ca.style.display="none";ha.style.display="inline";ia.style.display="none";t(N);var a=l("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(l("h3","Add custom URL-based data"));a.appendChild(l("p",["You can add indexed binary data hosted on an web server that supports CORS (",
l("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(l("br"));a.appendChild(document.createTextNode("URL: "));$=l("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});a.appendChild($);a.appendChild(l("br"));a.appendChild(l("b","- or -"));a.appendChild(l("br"));a.appendChild(document.createTextNode("File: "));da=l("input",null,{type:"file",multiple:"multiple"});
a.appendChild(da);a.appendChild(l("p",'Clicking the "Add" button below will initiate a series of test queries.'));N.appendChild(a);$.focus()}function e(){n(K,ga);ca.style.display="none";ha.style.display="inline";ia.style.display="none";V="hub-connect";ca.style.visibility="hidden";t(N);var a=l("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(l("h3","Connect to a track hub."));a.appendChild(l("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));
$=l("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild($);N.appendChild(a);$.focus()}function x(){n(K,qa);ca.style.display="none";ha.style.display="inline";ia.style.display="none";V="das";t(N);var a=l("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(l("h3","Add custom DAS data"));a.appendChild(l("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));
a.appendChild(document.createTextNode("URL: "));a.appendChild(l("br"));$=l("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild($);a.appendChild(l("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));N.appendChild(a);$.focus()}function A(){if(V)if("das"===V){var a=$.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);a=new Q({name:"temporary",
uri:a});wa(a)}else if("bin"===V){var b=da.files;if(b&&0<b.length){a=Z=[];V="multiple";for(var c=0;c<b.length;++c){var d=b[c];d&&a.push({blob:d})}for(c=0;c<a.length;++c)ja(a[c]);va()}else a=$.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),b={uri:a},a=a.toLowerCase(),0==a.indexOf("https://www.encodeproject.org/")&&0<=a.indexOf("@@download")&&(b.transport="encode"),O(b)}else if("reset"===V)x();else if("reset-bin"===V)m();else if("reset-hub"===V)e();else if("prompt-bai"===V)(b=da.files)&&0<b.length&&
b[0]?(ba.baiBlob=b[0],U(ba)):(b=ba,ca.style.display="none",ha.style.display="inline",ia.style.display="inline",t(N),V="prompt-bai",N.appendChild(l("h2","Select an index file")),N.appendChild(l("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),N.appendChild(document.createTextNode("Index file: ")),
da=l("input",null,{type:"file"}),N.appendChild(da),ba=b);else if("prompt-tbi"===V)(b=da.files)&&0<b.length&&b[0]?(ba.indexBlob=b[0],z(ba)):(b=ba,ca.style.display="none",ha.style.display="inline",ia.style.display="inline",t(N),V="prompt-tbi",N.appendChild(l("h2","Select an index file")),N.appendChild(l("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
N.appendChild(document.createTextNode("Index file: ")),da=l("input",null,{type:"file"}),N.appendChild(da),ba=b);else if("finalize"===V||"finalize-bin"===V)ba.name=ka.value,b=na.value,ba.mapping="__default__"!=b?b:void 0,ra&&(ba.maxbins=ra.checked),1<ta.value.length&&1<ua.value.length&&(ba.xUser=ta.value,ba.xPass=ua.value),h.addTier(ba),"finalize-bin"==V?m():x();else if("hub-connect"===V)a=$.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),s(a);else{if("multiple"===V){for(b=0;b<Z.length;++b)if(a=Z[b],
!a.hidden&&("bam"!=a.tier_type||a.indexBlob||a.indexUri)&&("tabix"!=a.tier_type||a.indexBlob||a.indexUri)&&(a=W(a)))a.noPersist=!0,h.addTier(a);m()}}else h.removeAllPopups()}function s(a,e,b){e=e||{};for(var d=0;d<h.hubObjects.length;++d){var f=h.hubObjects[d];if(f.hub.url==a){for(d=0;d<K.length;++d)K[d].hub==f&&n(K,K[d]);f.getTracks(function(a,e){e&&console.log(e);g(a)});return}}c(a,function(c,d){if(d){if(!b)return s(a,{credentials:!0},!0);t(N);N.appendChild(l("h2","Error connecting to track hub"));
N.appendChild(l("p",d));V="reset-hub"}else{var f=null,k=null,p;for(p in c.genomes){var m=null,x=!1;if(p==h.coordSystem.ucscName)x=!0;else for(var q in h.chains)p==h.chains[q].coords.ucscName&&(m=q,x=!0);x&&(x={url:a,genome:p},e.credentials&&(x.credentials=!0),m&&(x.mapping=m,c.genomes[p].mapping=m),h.hubs.push(x),h.hubObjects.push(c.genomes[p]),x=aa(c.genomes[p]),ma.appendChild(x),m&&f||(f=c.genomes[p],k=x))}f?(h.notifyTier(),n(K,k),f.getTracks(function(a,e){g(a)})):(t(N),N.appendChild(l("h2","No data for this genome")),
N.appendChild(l("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),N.appendChild(l("p","coordSystem.ucscName = "+h.coordSystem.ucscName)),V="reset-hub")}},e)}function v(a,e){var b=a.uri;if(e){var c=/(.+)\/[^\/]+\/?/.exec(b);c&&(b=c[1]+"/sources")}(new w(b,{credentials:a.credentials})).sources(function(b){if(!b||0==b.length)return e?oa(a):v(a,!0);var c=null;if(1==b.length)c=b[0];else for(var d=0;d<b.length;++d)if(b[d].uri===a.uri){c=
b[d];break}d=b=!1;if(c&&(a.name=c.name,a.desc=c.desc,a.maxbins=c.maxbins?!0:!1,c.capabilities&&(a.capabilities=c.capabilities),d=!0,c.coords&&1==c.coords.length))if(c=c.coords[0],I(c,h.coordSystem))b=!0;else if(h.chains)for(var f in h.chains)I(c,h.chains[f].coords)&&(a.mapping=f,b=!0);return oa(a,b,d)},function(){return e?oa(a):v(a,!0)})}function U(a){(a.baiBlob?new p(a.baiBlob):"encode"==a.transport?new y(a.bamURI+".bai"):new f(a.bamURI+".bai",{credentials:a.credentials})).slice(0,256).fetch(function(e){var b=
!1;e&&(e=new Uint8Array(e),b=q(e,0)==r);return b?oa(a,!1,!1,!0):D("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function z(a){(a.indexBlob?new p(a.indexBlob):new f(a.uri+".tbi")).slice(0,65536).fetch(function(e){var b=!1;if(e){var c=new Uint8Array(e);if(31==c[0]||139==c[1])e=k(e),c=new Uint8Array(e),b=q(c,0)==H}return b?oa(a,!1,!1,!0):D('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
function D(a){ca.style.display="none";ha.style.display="inline";ia.style.display="inline";t(N);a=a||"Custom data format not recognized";N.appendChild(l("h2","Error adding custom data"));N.appendChild(l("p",a));N.appendChild(l("p","Currently supported formats are bigBed, bigWig, and BAM."));V="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var h=this;d=l("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top",paddingRight:"15px"});var K=[],G,T;if(!this.noRegistryTabs){var M=this.makeButton("Registry","Browse compatible datasources from the DAS registry");K.push(M);for(var Y in this.mappableSources)(function(a){var e=h.makeButton(h.chains[a].srcTag,"Browse datasources mapped from "+h.chains[a].srcTag);K.push(e);e.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();n(K,e);G(h.mappableSources[a],a)},!1)})(Y)}Y={};for(var ea=0;ea<this.defaultSources.length;++ea){var S=
this.defaultSources[ea],X=S.group||"Defaults";Y[X]?Y[X].push(S):Y[X]=[S]}var aa=function(a){var b=a.hub,c=l("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),d=b.altLabel||b.shortLabel||"Unknown";a.mapping&&(d=d+" ("+a.genome+")");var d=l("span",[d," ",c]),f=h.makeButton(d,b.longLabel);f.hub=a;K.push(f);f.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();n(K,f);t(N);e=h.makeLoader(24);e.style.marginLeft="auto";e.style.marginRight="auto";e.style.marginTop="100px";
N.appendChild(l("div",e,null,{textAlign:"center"}));ca.style.display="none";ha.style.display="none";ia.style.display="none";a.getTracks(function(a,e){e&&console.log(e);g(a)})},!1);c.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();var c=l("li",l("a","Remove hub")),d=l("li",l("a","Enable all")),k=l("li",l("a","Disable all")),g=l("ul",[c,d,k],{className:"dropdown-menu"},{display:"block"}),p=b.clientX;b=b.clientY;p+=document.documentElement.scrollLeft||document.body.scrollLeft;
b+=document.documentElement.scrollTop||document.body.scrollTop;g.style.position="absolute";g.style.top=""+(b+10)+"px";g.style.left=""+(p-30)+"px";h.hPopupHolder.appendChild(g);var m=function(a){console.log("cc");document.body.removeEventListener("click",m,!0);h.hPopupHolder.removeChild(g)};document.body.addEventListener("click",m,!0);c.addEventListener("click",function(b){for(b=0;b<h.hubObjects.length;++b)if(h.hubObjects[b].absURL==a.absURL){h.hubObjects.splice(b,1);break}for(b=0;b<h.hubs.length;++b){var c=
h.hubs[b];"string"===typeof c&&(c={url:c});if(c.url==a.hub.url&&!c.genome||c.genome==a.genome){h.hubs.splice(b,1);break}}h.notifyTier();ma.removeChild(f);n(K,ga);e()},!1);d.addEventListener("click",function(e){a.getTracks(function(a,e){e&&console.log(e);for(var b=0;b<a.length;++b){var c=a[b].toDallianceSource();h.currentlyActive(c)||h.addTier(c)}})},!1);k.addEventListener("click",function(e){a.getTracks(function(a,e){e&&console.log(e);for(var b=0;b<a.length;++b){var c=a[b].toDallianceSource();h.currentlyActive(c)&&
h.removeTier(c)}})},!1)},!1);return f},la=null,pa=null;for(X in Y)(function(a,e){var b=h.makeButton(a,"Browse the default set of data for this browser");b.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();n(K,b);G(new C(e))},!1);K.push(b);la||(la=b,pa=e)})(X,Y[X]);var qa=this.makeButton("DAS","Add arbitrary DAS data");K.push(qa);var fa=this.makeButton("Binary","Add data in bigwig or bigbed format");K.push(fa);for(X=0;X<this.hubObjects.length;++X)aa(this.hubObjects[X]);var ga=
this.makeButton("+","Connect to a new track-hub");K.push(ga);var ma=l("ul",K,{className:"nav nav-tabs"},{marginBottom:"0px"});d.appendChild(ma);var $,ka,na,ra,da,ta,ua,V=!1,ba=null,X=l("form",null,{},{display:"inline-block",width:"100%"});X.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();A();return!1},!0);var N=l("div");N.style.position="relative";N.style.overflow="scroll";X.appendChild(N);var sa,R;G=function(a,e){ca.style.display="none";ha.style.display="none";ia.style.display=
"none";R&&R.removeListener(T);sa=e;R=a;R.addListenerAndFire(T)};T=function(a){V=!1;var e=[];t(N);if(a){for(var b=l("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),c=l("table",b,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),d=0,f=[],k=0;k<a.length;++k)f.push(a[k]);f.sort(function(a,e){return a.name.toLowerCase().trim().localeCompare(e.name.toLowerCase().trim())});for(k=0;k<f.length;++k){a=f[k];var g=l("tr"),p=l("td",null,{},{width:"30px"});
p.style.textAlign="center";if(!a.props||a.props.cors){var m=l("input");m.type="checkbox";m.dalliance_source=a;sa&&(m.dalliance_mapping=sa);p.appendChild(m);e.push(m);m.addEventListener("change",function(a){a.target.checked?h.addTier(a.target.dalliance_source):h.removeTier(a.target.dalliance_source)})}else p.appendChild(document.createTextNode("!")),h.makeTooltip(p,l("span",["This data source isn't accessible because it doesn't support ",l("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));g.appendChild(p);
p=l("td");p.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&h.makeTooltip(p,a.desc);g.appendChild(p);b.appendChild(g);++d}var n=function(){for(var a=0;a<e.length;++a){var b=e[a];h.currentlyActive(b.dalliance_source)?b.checked=!0:b.checked=!1}};n();h.addTierListener(function(a){n()});N.appendChild(c)}else N.appendChild(l("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};M&&M.addEventListener("click",function(a){a.preventDefault();
a.stopPropagation();n(K,M);G(h.availableSources)},!1);fa.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();m()},!1);ga.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();e()},!1);qa.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();x()},!1);var ha=l("button","Add",{className:"btn btn-primary"});ha.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();A()},!1);var wa=function(a,e){var b=h.knownSpace;
if(b){var c=Math.max(b.min,(b.min+b.max-100)/2)|0,b=new B(b.chr,c,Math.min(c+99,b.max));a.features(b,{},function(b,c){if(c)e?(t(N),N.appendChild(l("h2","Custom data not found")),N.appendChild(l("p","DAS uri: "+a.uri+" is not answering features requests")),V="reset"):(a.credentials=!0,wa(a,!0));else{var d=/\/([^/]+)\/?$/.exec(a.uri);d&&(a.name=d[1]);v(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},W=function(a){var e={name:a.name};a.credentials&&(e.credentials=a.credentials);
a.mapping&&"__default__"!=a.mapping&&(e.mapping=a.mapping);a.transport&&(e.transport=a.transport);if("bwg"==a.tier_type)return a.blob?e.bwgBlob=a.blob:a.uri&&(e.bwgURI=a.uri),e;if("bam"==a.tier_type)return a.blob?(e.bamBlob=a.blob,e.baiBlob=a.indexBlob):(e.bamURI=a.uri,e.baiURI=a.indexUri),e;if("tabix"==a.tier_type)return e.tier_type="tabix",e.payload=a.payload,a.blob?(e.blob=a.blob,e.indexBlob=a.indexBlob):(e.uri=a.uri,e.indexUri=a.indexUri),e;if("memstore"==a.tier_type)return e.tier_type="memstore",
e.payload=a.payload,a.blob?e.blob=a.blob:e.uri=a.uri,e},O=function(a){b(a,function(a,e){if(e){t(N);var b=l("div");b.appendChild(l("h2","Couldn't access custom data"));b.appendChild(l("p",""+e));N.appendChild(b);console.log(a);"https:"===window.location.protocol&&0==a.uri.indexOf("http:")&&h.canFetchPlainHTTP().then(function(a){a||b.appendChild(l("p",[l("strong","HTTP warning: "),"you may not be able to access HTTP resources from an instance of Biodalliance which you are accessing via HTTPS.",l("a",
"[More info]",{href:h.httpWarningURL,target:"_blank"})]))});V="reset-bin"}else{var c=W(a);return"bam"==a.tier_type?U(c):"tabix"==a.tier_type?z(c):oa(c,!1,!1,!0)}})},oa=function(a,e,b,c){ca.style.display="none";ha.style.display="inline";ia.style.display="inline";t(N);N.appendChild(l("h2","Add custom data: step 2"));N.appendChild(document.createTextNode("Label: "));ka=l("input","",{value:a.name});N.appendChild(ka);ta=l("input","");ua=l("input","");N.appendChild(l("br"));N.appendChild(l("br"));N.appendChild(l("h4",
"Coordinate system: "));na=l("select",null);na.appendChild(l("option",h.nameForCoordSystem(h.coordSystem),{value:"__default__"}));if(h.chains)for(var d in h.chains)na.appendChild(l("option",h.nameForCoordSystem(h.chains[d].coords),{value:d}));na.value=a.mapping||"__default__";N.appendChild(na);e?N.appendChild(l("p","(Based on server response, probably doesn't need changing.)")):(N.appendChild(l("p",[l("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),
N.appendChild(l("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));c||(N.appendChild(document.createTextNode("Quantitative: ")),ra=l("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(ra.checked=a.maxbins),N.appendChild(ra),b?N.appendChild(l("p","(Based on server response, probably doesn't need changing.)")):N.appendChild(l("p",[l("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&
N.appendChild(l("p",[l("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));ka.focus();V="bin"===V||"prompt-bai"===V||"prompt-tbi"===V?"finalize-bin":"finalize";ba=a},Z=null,ja=function(a){b(a,function(a,e){e&&(a.error=e);for(var b=[],c={},d={},f=0;f<Z.length;++f){var h=Z[f];"bam"!=h.tier_type||h.indexBlob||(c[h.blob.name]=h);"tabix"!=h.tier_type||h.indexBlob||(d[h.blob.name]=h)}for(f=0;f<Z.length;++f)if(h=Z[f],"bai"===
h.tier_type){var k=/(.+)\.bai$/.exec(h.blob.name);k&&c[k[1]]&&(c[k[1]].indexBlob=h.blob,b.push(f))}else"tabix-index"===h.tier_type&&(k=/(.+)\.tbi$/.exec(h.blob.name))&&d[k[1]]&&(d[k[1]].indexBlob=h.blob,b.push(f));for(c=b.length-1;0<=c;--c)Z.splice(b[c],1);va()})},va=function(){t(N);var a=!1,e=l("table",Z.filter(function(a){return!a.hidden}).map(function(e){l("tr").appendChild(l("td",e.name||e.blob.name));var b;b=e.error?l("span","Error",null,{color:"red"}):e.tier_type?e.payload||e.tier_type:h.makeLoader(16);
var c,d="unknown";"bwg"==e.tier_type||"memstore"==e.tier_type?d="okay":"bam"==e.tier_type?d=e.indexBlob?"okay":"needs-index":"tabix"==e.tier_type&&(d=e.indexBlob?"okay":"needs-index");if("okay"==d){c=l("select",null,null,{width:"150px"});c.appendChild(l("option",h.nameForCoordSystem(h.coordSystem),{value:"__default__"}));if(h.chains)for(var f in h.chains)c.appendChild(l("option",h.nameForCoordSystem(h.chains[f].coords),{value:f}));c.value=e.mapping||"__default__";c.addEventListener("change",function(a){e.mapping=
c.value;console.log(e)},!1)}else"needs-index"==d&&(c=l("span","Needs index",{},{color:"red"}),a=!0);return l("tr",[l("td",e.name||e.blob.name),l("td",b),l("td",c)])}),{className:"table table-striped table-condensed"});N.appendChild(e);if(a){N.appendChild(l("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
N.appendChild(document.createTextNode("Index file(s): "));var b=l("input",null,{type:"file",multiple:"multiple"});N.appendChild(b);b.addEventListener("change",function(a){console.log("fileset changed");a=b.files||[];for(var e=0;e<a.length;++e){var c=a[e];c&&(c={blob:c,hidden:!0},Z.push(c),ja(c))}},!1)}},ia=l("button","Cancel",{className:"btn"});ia.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===V?m():x()},!1);var ca=l("button","Refresh",{className:"btn"});
ca.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();h.queryRegistry(sa)},!1);this.makeTooltip(ca,"Click to re-fetch data from the DAS registry");Y=l("div",[ha," ",ia," ",ca]);Y.style.margin="10px";X.appendChild(Y);d.appendChild(X);G(h.availableSources);this.showToolPanel(d);this.setUiMode("add");la&&(n(K,la),G(new C(pa)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./encode":12,"./lh3utils":24,"./probe":28,"./sourcecompare":35,"./tabix":41,"./thub":42,
"./utils":49}],47:[function(d,v,s){function n(d,l,n){l.fetchAsText(function(l){if(!l)return n(null,"Couldn't fetch index-index");l=l.split(/(.+)([0-9A-F]{10})\n/);for(var s=[],c=[],a=1;a<l.length;a+=3)s.push(l[a]),c.push(parseInt(l[a+1],16));return n(new m(s,c,d))})}function m(d,m,n){this.keys=d;this.offsets=m;this.ix=n}m.prototype.lookup=function(d,m){for(var n,s=(d+"     ").substring(0,5).toLowerCase(),v=0;v<this.keys.length;++v)if(0>s.localeCompare(this.keys[v])){n=this.ix.slice(this.offsets[v-
1],this.offsets[v]-this.offsets[v-1]);break}n||(n=this.ix.slice(this.offsets[this.offsets.length-1]));n.fetchAsText(function(c){c=c.split("\n");for(var a=0;a<c.length;++a)if(0==c[a].indexOf(d.toLowerCase()+" "))return m(c[a].split(" "));return m(null)})};"undefined"!==typeof v&&(v.exports={connectTrix:n})},{}],48:[function(d,v,s){function n(){}function m(c,d){var p=new n;p.data=c;var m=f,s=0;p.data.slice(0,m).fetch(function(c){if(!c)return d(null,"Couldn't access data");var n=new Uint8Array(c);c=
l(n,0);if(c==a)p.readInt=l;else if(c==b)p.readInt=t;else return d(null,"Not a .2bit file, magic=0x"+c.toString(16));c=p.readInt(n,4);if(0!=c)return d(null,"Unsupported version "+c);p.seqCount=p.readInt(n,8);p.seqDict={};var q=16,y=0,v=0,u=function(){for(;y<p.seqCount;){var a=n[q];if(q+a+6>=n.length)return s+=m,m=Math.max(f,Math.floor(s*p.seqCount/y)),p.data.slice(v+q,m).fetch(function(a){v+=q;q=0;n=new Uint8Array(a);u()});++q;for(var e="",b=1;b<=a;++b)e+=String.fromCharCode(n[q++]);a=p.readInt(n,
q);q+=4;p.seqDict[e]=new g(p,a);++y}return d(p)};u()})}function g(a,b){this.tbf=a;this.offset=b}if("undefined"!==typeof d){s=d("./bin");var l=s.readInt,t=s.readIntBE;d=d("./spans");var C=d.Range,E=d.union,c=d.intersection}var a=440477507,b=1126646042,f=12500;n.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};n.prototype.fetch=function(a,b,c,d){var f=this.getSeq(a);if(f){if(c<=b)return d("");f.fetch(b,c,d)}else return d(null,"Couldn't find "+a)};g.prototype.init=
function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);b._length=b.tbf.readInt(c,0);b.nBlockCnt=b.tbf.readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);for(var d=null,f=0;f<b.nBlockCnt;++f)var g=b.tbf.readInt(c,4*f),p=b.tbf.readInt(c,4*(f+b.nBlockCnt)),g=new C(g,g+p-1),d=d?E(d,g):g;b.nBlocks=d;b.mBlockCnt=b.tbf.readInt(c,8*b.nBlockCnt);
b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var p=["T","C","A","G"];g.prototype.fetch=function(a,b,d){--a;--b;var f=this;this.init(function(g){if(g)return d(null,g);var m=a>>2;g=b+3>>2;if(0>m||g>f.seqLength)return d("Coordinates out of bounds: "+a+":"+b);f.tbf.data.slice(f.seqOffset+m,g-m).salted().fetch(function(g){function l(a){for(;s<=a;){var e=s&3,b=n[(s>>2)-m];u+=p[0==e?b>>6&3:1==e?b>>4&3:2==e?b>>2&3:b&3];++s}}if(null==g)return d("SeqFetch failed");
var n=new Uint8Array(g);g=[];if(f.nBlocks){var t=c(new C(a,b),f.nBlocks);t&&(g=t.ranges())}for(var u="",s=a,t=0;t<g.length;++t){var e=g[t];if(s>e.min())throw"N mismatch...";for(s<e.min()&&l(e.min()-1);s<=e.max();)u+="N",++s}s<=b&&l(b);return d(u)})})};g.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b._length)})};"undefined"!==typeof v&&(v.exports={makeTwoBit:m})},{"./bin":4,"./spans":36}],49:[function(d,v,s){function n(a,b){for(var c=0;c<a.length;++c)if(a[c]==
b)return;a.push(b)}function m(a,b,c){a[b]?a[b].push(c):a[b]=[c]}function g(a,b,c){var d=a[b];if(d){for(a=0;a<d.length;++a)if(d[a]==c)return;d.push(c)}else a[b]=[c]}function l(a,b,c,d){if(a)return a;if(b)return b;if(c)return c;if(d)return d}function n(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function t(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function C(a,b,c,d){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var f=0;f<b.length;++f){var k=
b[f];k&&("string"==typeof k?k=document.createTextNode(k):"number"==typeof k&&(k=document.createTextNode(""+k)),a.appendChild(k))}}if(c)for(var e in c)try{a[e]=c[e]}catch(g){throw console.log("error setting "+e),g;}if(d)for(e in d)a.style[e]=d[e];return a}function E(a,b,c,d){a=document.createElementNS(a,b);if(c)for(c instanceof Array||(c=[c]),b=0;b<c.length;++b){var f=c[b];"string"==typeof f&&(f=document.createTextNode(f));a.appendChild(f)}if(d)for(var k in d){c=a;b=k;var f=d[k],e=Q[b];if(!e){for(var e=
"",g=0;g<b.length;++g)var p=b.substring(g,g+1),m=p.toLowerCase(),e=m!=p?e+"-"+m:e+p;Q[b]=e}c.setAttribute(e,f)}return a}function c(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}function a(b,c){if("undefined"===typeof b)return"undefined";if(null==b)return"null";if("string"==typeof b)return"'"+b+"'";if("number"==typeof b||"boolean"==typeof b)return""+b;if("object"==typeof b){if(b instanceof Array){for(var d=null,f=0;f<b.length;++f)d=(null==d?"":d+", ")+a(b[f],c);return"["+
(d?d:"")+"]"}c=c||{};d=null;for(f in b)c[f]||void 0!=f&&"function"!=typeof b[f]&&(d=(null==d?"":d+", ")+f+": "+a(b[f],c));return"{"+(d?d:"")+"}"}return typeof b}function b(a){var b={},c;for(c in a)b[c]=a[c];return b}function f(a){this.value=a;this.listeners=[]}function p(){this.queue=[]}function q(a,b,c){c&&c.salt&&(a=a+"?salt="+H(""+Date.now()+","+ ++B));try{var d;c.timeout&&(d=setTimeout(function(){console.log("timing out "+a);f.abort();return b(null,"Timeout")},c.timeout));var f=new XMLHttpRequest;
f.onreadystatechange=function(){4==f.readyState&&(d&&clearTimeout(d),200>f.status||300<=f.status?b(null,"Error code "+f.status):b(f.responseText))};f.open("GET",a,!0);f.responseType="text";c&&c.credentials&&(f.withCredentials=!0);f.send("")}catch(k){b(null,"Exception "+k)}}function k(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;var c=a.lastIndexOf("/");return 0<=c?a.substr(0,c+1)+b:b}function r(a){return C("a",null,{href:a}).href}if("undefined"!==typeof d)var H=d("./sha1").b64_sha1;
var Q={};f.prototype.addListener=function(a){this.listeners.push(a)};f.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};f.prototype.removeListener=function(a){var b=this.listeners;a=t(b,a);0<=a&&b.splice(a,1)};f.prototype.get=function(){return this.value};f.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};p.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=
0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};p.prototype.await=function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var B=0;d={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"*",TAG:"*",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",
AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"*",TGG:"W",CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"undefined"!==typeof v&&(v.exports={textXHR:q,relativeURL:k,resolveUrlToPage:r,shallowCopy:b,pusho:m,pushnew:n,pushnewo:g,arrayIndexOf:t,pick:l,makeElement:C,makeElementNS:E,removeChildren:c,miniJSONify:a,Observed:f,
Awaited:p,AMINO_ACID_TRANSLATION:d})},{"./sha1":33}],50:[function(d,v,s){function n(){this.info=[]}function m(a,c){this.parser=a;this.sink=c}if("undefined"!==typeof d){var g=d("./sourceadapters").registerParserFactory;d=d("./das");var l=d.DASStylesheet,t=d.DASStyle,C=d.DASFeature}var E=/([^;=]+)(=([^;]+))?;?/,c=/##INFO=<([^>]+)>/,a=/([^,=]+)=([^,]+|"[^"]+"),?/;n.prototype.createSession=function(a){return new m(this,a)};m.prototype.parse=function(b){if(0!=b.length)if("#"==b[0]){if(1<b.length&&"#"==
b[1]&&(b=c.exec(b))){var d=b[1].split(a),g=null,m=null;for(b=0;b<d.length-1;b+=3){var k=d[b+1],l=d[b+2].replace(/"/g,"");"ID"==k?g=l:"Description"==k&&(m=l)}g&&m&&this.parser.info.push({id:g,desc:m})}}else{d=b.split("\t");g=new C;g.segment=d[0];g.id=d[2];g.refAllele=d[3];g.altAlleles=d[4].split(",");g.min=parseInt(d[1]);g.max=g.min+g.refAllele.length-1;d=d[7].split(E);g.info={};for(b=0;b<d.length;b+=4)g.info[d[b+1]]=d[b+3];b=g.altAlleles[0];d=g.refAllele;b.length>d.length?(g.type="insertion",0==b.indexOf(d)?
(g.insertion=b.substr(d.length),g.min+=d.length,g.max=g.min-1):g.insertion=b):g.type=b.length<d.length?"deletion":"substitution";this.sink(g)}};m.prototype.flush=function(){};n.prototype.getStyleSheet=function(a){var c=new l,d=new t;d.glyph="__INSERTION";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";c.pushStyle({type:"insertion"},null,d);d=new t;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(255, 60, 60)";d.BGCOLOR="#888888";d.STROKECOLOR=
"black";c.pushStyle({type:"deletion"},null,d);d=new t;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";c.pushStyle({type:"default"},null,d);return a(c)};n.prototype.getDefaultFIPs=function(a){var c=this;a(function(a,b){b.add("Ref. allele",a.refAllele);b.add("Alt. alleles",a.altAlleles.join(","));if(a.info)for(var d=0;d<c.info.length;++d){var g=c.info[d],m=a.info[g.id];void 0!==m&&b.add(g.desc,m)}})};g("vcf",function(){return new n})},
{"./das":10,"./sourceadapters":34}],51:[function(d,v,s){d={CONFIG:5,MAJOR:0,MINOR:13,MICRO:6,PATCH:"a",BRANCH:"dev",toString:function(){var d=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(d+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(d=d+"-"+this.BRANCH);return d}};"undefined"!==typeof v&&(v.exports=d)},{}],52:[function(d,v,s){function n(d){function l(a){a=Math.min(a,v);b=a=Math.max(a,s);q.style.left=""+b+"px"}function n(a){a=Math.min(a,v);f=a=Math.max(a,s);k.style.left=""+f+"px"}d=d||
{};var s=0,v=d.width||200,c=0,a=200,b=50,f=100,p=[];d=m("hr",null,{className:"slider-track"},{width:""+(v|0)+"px"});var q=m("hr",null,{className:"slider-thumb active"}),k=m("hr",null,{className:"slider-thumb"}),r=m("div",[d,q,k],{className:"slider"},{width:""+((v|0)+10)+"px"});r.removeLabels=function(){for(var a=0;a<p.length;++a)r.removeChild(p[a]);p=[]};r.addLabel=function(b,d){var f=m("div",d,{className:"slider-label"},{left:""+(s+(b-c)*(v-s)/(a-c)|0)+"px"});r.appendChild(f);p.push(f)};var H=document.createEvent("HTMLEvents");
H.initEvent("change",!0,!1);Object.defineProperty(r,"value",{get:function(){return c+(b-s)*(a-c)/(v-s)},set:function(b){l(s+(b-c)*(v-s)/(a-c))}});Object.defineProperty(r,"value2",{get:function(){return c+(f-s)*(a-c)/(v-s)},set:function(b){n(s+(b-c)*(v-s)/(a-c))}});Object.defineProperty(r,"active",{get:function(){return q.classList.contains("active")?1:2},set:function(a){1==a?(q.classList.add("active"),k.classList.remove("active")):(k.classList.add("active"),q.classList.remove("active"))}});Object.defineProperty(r,
"min",{get:function(){return c},set:function(a){c=a}});Object.defineProperty(r,"max",{get:function(){return a},set:function(b){a=b}});var Q,B;d=function(a){B=this==q?1:2;B!=r.active&&(r.active=B,r.dispatchEvent(H));a.stopPropagation();a.preventDefault();window.addEventListener("mousemove",w,!1);window.addEventListener("mouseup",I,!1);Q=a.clientX-(1==B?b:f)};q.addEventListener("mousedown",d,!1);k.addEventListener("mousedown",d,!1);var w=function(a){1==B?l(a.clientX-Q):n(a.clientX-Q);r.dispatchEvent(H)},
I=function(a){window.removeEventListener("mousemove",w,!1);window.removeEventListener("mouseup",I,!1)};return r}if("undefined"!==typeof d)var m=d("./utils").makeElement;"undefined"!==typeof v&&(v.exports=n)},{"./utils":49}],53:[function(d,v,s){v=d("./promise/promise").Promise;d=d("./promise/polyfill").polyfill;s.Promise=v;s.polyfill=d},{"./promise/polyfill":58,"./promise/promise":59}],54:[function(d,v,s){var n=d("./utils").isArray,m=d("./utils").isFunction;s.all=function(d){if(!n(d))throw new TypeError("You must pass an array to all.");
return new this(function(l,n){function s(a){return function(b){v[a]=b;0===--c&&l(v)}}var v=[],c=d.length,a;0===c&&l([]);for(var b=0;b<d.length;b++)(a=d[b])&&m(a.then)?a.then(s(b),n):(v[b]=a,0===--c&&l(v))})}},{"./utils":63}],55:[function(d,v,s){(function(d,m){function g(){return function(){d.nextTick(v)}}function l(){var a=0,b=new c(v),d=document.createTextNode("");b.observe(d,{characterData:!0});return function(){d.data=a=++a%2}}function t(){return function(){a.setTimeout(v,1)}}function v(){for(var a=
0;a<b.length;a++){var c=b[a];(0,c[0])(c[1])}b=[]}var E="undefined"!==typeof window?window:{},c=E.MutationObserver||E.WebKitMutationObserver,a="undefined"!==typeof m?m:void 0===this?window:this,b=[],f;f="undefined"!==typeof d&&"[object process]"==={}.toString.call(d)?g():c?l():t();s.asap=function(a,c){1===b.push([a,c])&&f()}}).call(this,d("/Users/thomas/Projects/dalliance/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!==
typeof self?self:"undefined"!==typeof window?window:{})},{"/Users/thomas/Projects/dalliance/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":64}],56:[function(d,v,s){s.cast=function(d){return d&&"object"===typeof d&&d.constructor===this?d:new this(function(m){m(d)})}},{}],57:[function(d,v,s){var n={instrument:!1};s.config=n;s.configure=function(d,g){if(2===arguments.length)n[d]=g;else return n[d]}},{}],58:[function(d,v,s){(function(n){var m=
d("./promise").Promise,g=d("./utils").isFunction;s.polyfill=function(){var d;d="undefined"!==typeof n?n:"undefined"!==typeof window&&window.document?window:self;"Promise"in d&&"cast"in d.Promise&&"resolve"in d.Promise&&"reject"in d.Promise&&"all"in d.Promise&&"race"in d.Promise&&function(){var m;new d.Promise(function(d){m=d});return g(m)}()||(d.Promise=m)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./promise":59,"./utils":63}],59:[function(d,v,s){function n(a){if(!k(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");
if(!(this instanceof n))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[];m(a,this)}function m(b,c){function e(a){E(c,a)}function d(b){a(c,b)}try{b(e,d)}catch(f){d(f)}}function g(b,c,e,d){var f=k(e),g,p,m,l;if(f)try{g=e(d),m=!0}catch(n){l=!0,p=n}else g=d,m=!0;C(c,g)||(f&&m?E(c,g):l?a(c,p):b===y?E(c,g):b===F&&a(c,g))}function l(a,b,e,c){a=a._subscribers;var d=a.length;a[d]=b;a[d+y]=e;a[d+
F]=c}function t(a,b){for(var e,c,d=a._subscribers,f=a._detail,k=0;k<d.length;k+=3)e=d[k],c=d[k+b],g(b,e,c,f);a._subscribers=null}function C(b,d){var e=null,f;try{if(b===d)throw new TypeError("A promises callback cannot return that same promise.");if(q(d)&&(e=d.then,k(e)))return e.call(d,function(a){if(f)return!0;f=!0;d!==a?E(b,a):c(b,a)},function(e){if(f)return!0;f=!0;a(b,e)}),!0}catch(g){if(f)return!0;a(b,g);return!0}return!1}function E(a,b){a===b?c(a,b):C(a,b)||c(a,b)}function c(a,c){a._state===
w&&(a._state=I,a._detail=c,p.async(b,a))}function a(a,b){a._state===w&&(a._state=I,a._detail=b,p.async(f,a))}function b(a){t(a,a._state=y)}function f(a){t(a,a._state=F)}var p=d("./config").config;d("./config");var q=d("./utils").objectOrFunction,k=d("./utils").isFunction;d("./utils");v=d("./cast").cast;var r=d("./all").all,H=d("./race").race,Q=d("./resolve").resolve,B=d("./reject").reject;d=d("./asap").asap;p.async=d;var w=void 0,I=0,y=1,F=2;n.prototype={constructor:n,_state:void 0,_detail:void 0,
_subscribers:void 0,then:function(a,b){var e=this,c=new this.constructor(function(){});if(this._state){var d=arguments;p.async(function(){g(e._state,c,d[e._state-1],e._detail)})}else l(this,c,a,b);return c},"catch":function(a){return this.then(null,a)}};n.all=r;n.cast=v;n.race=H;n.resolve=Q;n.reject=B;s.Promise=n},{"./all":54,"./asap":55,"./cast":56,"./config":57,"./race":60,"./reject":61,"./resolve":62,"./utils":63}],60:[function(d,v,s){var n=d("./utils").isArray;s.race=function(d){if(!n(d))throw new TypeError("You must pass an array to race.");
return new this(function(g,l){for(var n,s=0;s<d.length;s++)(n=d[s])&&"function"===typeof n.then?n.then(g,l):g(n)})}},{"./utils":63}],61:[function(d,v,s){s.reject=function(d){return new this(function(m,g){g(d)})}},{}],62:[function(d,v,s){s.resolve=function(d){return new this(function(m,g){m(d)})}},{}],63:[function(d,v,s){function n(d){return"function"===typeof d}d=Date.now||function(){return(new Date).getTime()};s.objectOrFunction=function(d){return n(d)||"object"===typeof d&&null!==d};s.isFunction=
n;s.isArray=function(d){return"[object Array]"===Object.prototype.toString.call(d)};s.now=d},{}],64:[function(d,v,s){function n(){}d=v.exports={};d.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(d){return window.setImmediate(d)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var d=[];window.addEventListener("message",function(g){var l=g.source;l!==window&&null!==l||"process-tick"!==g.data||(g.stopPropagation(),0<d.length&&d.shift()())},
!0);return function(g){d.push(g);window.postMessage("process-tick","*")}}return function(d){setTimeout(d,0)}}();d.title="browser";d.browser=!0;d.env={};d.argv=[];d.on=n;d.once=n;d.off=n;d.emit=n;d.binding=function(d){throw Error("process.binding is not supported");};d.cwd=function(){return"/"};d.chdir=function(d){throw Error("process.chdir is not supported");}},{}],65:[function(d,v,s){function n(){}function m(){this.was=[0]}function g(b,c,d){this.hufts=new Int32Array(3*a);this.window=new Uint8Array(d);
this.end=d;this.checkfn=c;this.mode=r;this.reset(b,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new l;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new t}function l(){}function t(){}function C(a,b,c,d,f){if(0!=f){if(!a)throw"Undef src";if(!c)throw"Undef dest";if(0==b&&f==a.length)c.set(a,d);else if(L)a=a.subarray(b,b+f),c.set(a,d);else if(1==a.BYTES_PER_ELEMENT&&100<f)a=new Uint8Array(a.buffer,
a.byteOffset+b,f),c.set(a,d);else for(var k=0;k<f;++k)c[d+k]=a[b+k]}}function E(a,d,k,g){a=d?k?new Uint8Array(a,d,k):new Uint8Array(a,d,a.byteLength-d):new Uint8Array(a);k=new n;k.inflateInit(c,!0);k.next_in=a;k.next_in_index=0;k.avail_in=a.length;a=[];for(var m=0;;){var l=new Uint8Array(32E3);k.next_out=l;k.next_out_index=0;k.avail_out=l.length;var r=k.inflate(b);if(r!=f&&r!=p&&r!=q)throw k.msg;if(0!=k.avail_out){var t=new Uint8Array(l.length-k.avail_out);C(l,0,t,0,l.length-k.avail_out);l=t}a.push(l);
m+=l.length;if(r==p||r==q)break}g&&(g[0]=(d||0)+k.next_in_index);if(1==a.length)return a[0].buffer;d=new Uint8Array(m);for(k=g=0;k<a.length;++k)m=a[k],C(m,0,d,g,m.length),g+=m.length;return d.buffer}var c=15,a=1440,b=0,f=0,p=1,q=-5,k=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],r=0,H=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,
8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,
0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,
73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,
0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,
227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,
0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,
7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,
0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],Q=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],B=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,
59,67,83,99,115,131,163,195,227,258,0,0],w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],I=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],y=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];n.prototype.inflateInit=function(a,b){a||(a=c);b&&(b=!1);this.istate=new m;return this.istate.inflateInit(this,b?-a:a)};n.prototype.inflate=function(a){return null==this.istate?-2:this.istate.inflate(this,
a)};n.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);this.istate=null;return a};n.prototype.inflateSync=function(){return istate.inflateSync(this)};n.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};m.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,null);return f};m.prototype.inflateEnd=function(a){null!=
this.blocks&&this.blocks.free(a);this.blocks=null;return f};m.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),-2;this.wbits=b;a.istate.blocks=new g(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return f};m.prototype.inflate=function(a,b){var c,d;if(null==a||null==a.istate||null==a.next_in)return-2;b=4==b?q:f;for(c=q;;)switch(a.istate.mode){case 0:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;if(8!=
((a.istate.method=a.next_in[a.next_in_index++])&15)){a.istate.mode=13;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=13;a.msg="invalid window size";a.istate.marker=5;break}a.istate.mode=1;case 1:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;d=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+d)%31){a.istate.mode=13;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(d&32)){a.istate.mode=7;break}a.istate.mode=
2;case 2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=3;case 3:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=4;case 4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=5;case 5:if(0==a.avail_in)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&
255;a.adler=a.istate.need;a.istate.mode=6;return 2;case 6:return a.istate.mode=13,a.msg="need dictionary",a.istate.marker=0,-2;case 7:c=a.istate.blocks.proc(a,c);if(-3==c){a.istate.mode=13;a.istate.marker=0;break}c==f&&(c=b);if(c!=p)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=12;break}a.istate.mode=8;case 8:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=9;case 9:if(0==
a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=10;case 10:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=11;case 11:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=13;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=
12;case 12:return p;case 13:return-3;default:return-2}};m.prototype.inflateSetDictionary=function(a,b,c){var d=0,k=c;if(null==a||null==a.istate||6!=a.istate.mode)return-2;if(a._adler.adler32(1,b,0,c)!=a.adler)return-3;a.adler=a._adler.adler32(0,null,0,0);k>=1<<a.istate.wbits&&(k=(1<<a.istate.wbits)-1,d=c-k);a.istate.blocks.set_dictionary(b,d,k);a.istate.mode=7;return f};var F=[0,0,255,255];m.prototype.inflateSync=function(a){var b,c,d;if(null==a||null==a.istate)return-2;13!=a.istate.mode&&(a.istate.mode=
13,a.istate.marker=0);if(0==(b=a.avail_in))return q;c=a.next_in_index;for(d=a.istate.marker;0!=b&&4>d;)a.next_in[c]==F[d]?d++:d=0!=a.next_in[c]?0:4-d,c++,b--;a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=d;if(4!=d)return-3;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=7;return f};m.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};var u=[16,17,18,0,
8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];g.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&this.codes.free(a);this.mode=r;this.read=this.write=this.bitb=this.bitk=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};g.prototype.proc=function(a,b){var c,d,g,m,l,n,h;m=a.next_in_index;l=a.avail_in;d=this.bitb;g=this.bitk;n=this.write;for(h=n<this.read?this.read-n-1:this.end-n;;)switch(this.mode){case r:for(;3>g;){if(0!=l)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=l,
a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b);l--;d|=(a.next_in[m++]&255)<<g;g+=8}c=d&7;this.last=c&1;switch(c>>>1){case 0:d>>>=3;g-=3;c=g&7;d>>>=c;g-=c;this.mode=1;break;case 1:var q=new Int32Array(1),t=new Int32Array(1),s=[],v=[];c=t;var w=s,y=v;q[0]=9;c[0]=5;w[0]=H;y[0]=Q;this.codes.init(q[0],t[0],s[0],0,v[0],0,a);d>>>=3;g-=3;this.mode=6;break;case 2:d>>>=3;g-=3;this.mode=3;break;case 3:return d>>>=3,g-=3,this.mode=13,a.msg="invalid block type",b=-3,this.bitb=
d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b)}break;case 1:for(;32>g;){if(0!=l)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b);l--;d|=(a.next_in[m++]&255)<<g;g+=8}if((~d>>>16&65535)!=(d&65535))return this.mode=13,a.msg="invalid stored block lengths",b=-3,this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=
n,this.inflate_flush(a,b);this.left=d&65535;d=g=0;this.mode=0!=this.left?2:0!=this.last?7:r;break;case 2:if(0==l)return this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,write=n,this.inflate_flush(a,b);if(0==h&&(n==end&&0!=read&&(n=0,h=n<this.read?this.read-n-1:this.end-n),0==h&&(this.write=n,b=this.inflate_flush(a,b),n=this.write,h=n<this.read?this.read-n-1:this.end-n,n==this.end&&0!=this.read&&(n=0,h=n<this.read?this.read-n-1:this.end-n),0==h)))return this.bitb=
d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b);b=f;c=this.left;c>l&&(c=l);c>h&&(c=h);C(a.next_in,m,this.window,n,c);m+=c;l-=c;n+=c;h-=c;if(0!=(this.left-=c))break;this.mode=0!=this.last?7:r;break;case 3:for(;14>g;){if(0!=l)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b);l--;d|=(a.next_in[m++]&255)<<g;g+=8}this.table=c=d&16383;if(29<(c&31)||29<(c>>
5&31))return this.mode=9,a.msg="too many length or distance symbols",b=-3,this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b);c=258+(c&31)+(c>>5&31);if(null==this.blens||this.blens.length<c)this.blens=new Int32Array(c);else for(h=0;h<c;h++)this.blens[h]=0;d>>>=14;g-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>g;){if(0!=l)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,
a.next_in_index=m,this.write=n,this.inflate_flush(a,b);l--;d|=(a.next_in[m++]&255)<<g;g+=8}this.blens[u[this.index++]]=d&7;d>>>=3;g-=3}for(;19>this.index;)this.blens[u[this.index++]]=0;this.bb[0]=7;c=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(c!=f)return b=c,-3==b&&(this.blens=null,this.mode=9),this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,write=n,this.inflate_flush(a,b);this.index=0;this.mode=5;case 5:for(;;){c=this.table;if(!(this.index<
258+(c&31)+(c>>5&31)))break;for(c=this.bb[0];g<c;){if(0!=l)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b);l--;d|=(a.next_in[m++]&255)<<g;g+=8}c=this.hufts[3*(this.tb[0]+(d&k[c]))+1];t=this.hufts[3*(this.tb[0]+(d&k[c]))+2];if(16>t)d>>>=c,g-=c,this.blens[this.index++]=t;else{h=18==t?7:t-14;for(q=18==t?11:3;g<c+h;){if(0!=l)b=f;else return this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=
m,this.write=n,this.inflate_flush(a,b);l--;d|=(a.next_in[m++]&255)<<g;g+=8}d>>>=c;g-=c;q+=d&k[h];d>>>=h;g-=h;h=this.index;c=this.table;if(h+q>258+(c&31)+(c>>5&31)||16==t&&1>h)return this.blens=null,this.mode=9,a.msg="invalid bit length repeat",b=-3,this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b);t=16==t?this.blens[h-1]:0;do this.blens[h++]=t;while(0!=--q);this.index=h}}this.tb[0]=-1;q=new Int32Array(1);t=new Int32Array(1);s=
new Int32Array(1);v=new Int32Array(1);q[0]=9;t[0]=6;c=this.table;c=this.inftree.inflate_trees_dynamic(257+(c&31),1+(c>>5&31),this.blens,q,t,s,v,this.hufts,a);if(c!=f)return-3==c&&(this.blens=null,this.mode=13),b=c,this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b);this.codes.init(q[0],t[0],this.hufts,s[0],this.hufts,v[0],a);this.mode=6;case 6:this.bitb=d;this.bitk=g;a.avail_in=l;a.total_in+=m-a.next_in_index;a.next_in_index=m;
this.write=n;if((b=this.codes.proc(this,a,b))!=p)return this.inflate_flush(a,b);b=f;this.codes.free(a);m=a.next_in_index;l=a.avail_in;d=this.bitb;g=this.bitk;n=this.write;h=n<this.read?this.read-n-1:this.end-n;if(0==this.last){this.mode=r;break}this.mode=7;case 7:this.write=n;b=this.inflate_flush(a,b);n=this.write;if(this.read!=this.write)return this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b);mode=12;case 8:return b=p,this.bitb=
d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b);case 9:return b=-3,this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b);default:return b=-2,this.bitb=d,this.bitk=g,a.avail_in=l,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=n,this.inflate_flush(a,b)}};g.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};g.prototype.set_dictionary=
function(a,b,c){C(a,b,window,0,c);this.read=this.write=c};g.prototype.sync_point=function(){return 1==this.mode};g.prototype.inflate_flush=function(a,b){var c,d,g;d=a.next_out_index;g=this.read;c=(g<=this.write?this.write:this.end)-g;c>a.avail_out&&(c=a.avail_out);0!=c&&b==q&&(b=f);a.avail_out-=c;a.total_out+=c;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,g,c));C(this.window,g,a.next_out,d,c);d+=c;g+=c;g==this.end&&(g=0,this.write==this.end&&(this.write=0),c=this.write-
g,c>a.avail_out&&(c=a.avail_out),0!=c&&b==q&&(b=f),a.avail_out-=c,a.total_out+=c,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,g,c)),C(this.window,g,a.next_out,d,c),d+=c,g+=c);a.next_out_index=d;this.read=g;return b};l.prototype.init=function(a,b,c,d,f,g,k){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=d;this.dtree=f;this.dtree_index=g;this.tree=null};l.prototype.proc=function(a,b,c){var d,g,m=0,l=0,n=0,h,q,r,n=b.next_in_index;h=b.avail_in;m=
a.bitb;l=a.bitk;q=a.write;for(r=q<a.read?a.read-q-1:a.end-q;;)switch(this.mode){case 0:if(258<=r&&10<=h&&(a.bitb=m,a.bitk=l,b.avail_in=h,b.total_in+=n-b.next_in_index,b.next_in_index=n,a.write=q,c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b),n=b.next_in_index,h=b.avail_in,m=a.bitb,l=a.bitk,q=a.write,r=q<a.read?a.read-q-1:a.end-q,c!=f)){this.mode=c==p?7:9;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=
1;case 1:for(d=this.need;l<d;){if(0!=h)c=f;else return a.bitb=m,a.bitk=l,b.avail_in=h,b.total_in+=n-b.next_in_index,b.next_in_index=n,a.write=q,a.inflate_flush(b,c);h--;m|=(b.next_in[n++]&255)<<l;l+=8}d=3*(this.tree_index+(m&k[d]));m>>>=this.tree[d+1];l-=this.tree[d+1];g=this.tree[d];if(0==g){this.lit=this.tree[d+2];this.mode=6;break}if(0!=(g&16)){this.get=g&15;this.len=this.tree[d+2];this.mode=2;break}if(0==(g&64)){this.need=g;this.tree_index=d/3+this.tree[d+2];break}if(0!=(g&32)){this.mode=7;break}this.mode=
9;b.msg="invalid literal/length code";c=-3;a.bitb=m;a.bitk=l;b.avail_in=h;b.total_in+=n-b.next_in_index;b.next_in_index=n;a.write=q;return a.inflate_flush(b,c);case 2:for(d=this.get;l<d;){if(0!=h)c=f;else return a.bitb=m,a.bitk=l,b.avail_in=h,b.total_in+=n-b.next_in_index,b.next_in_index=n,a.write=q,a.inflate_flush(b,c);h--;m|=(b.next_in[n++]&255)<<l;l+=8}this.len+=m&k[d];m>>=d;l-=d;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=3;case 3:for(d=this.need;l<d;){if(0!=
h)c=f;else return a.bitb=m,a.bitk=l,b.avail_in=h,b.total_in+=n-b.next_in_index,b.next_in_index=n,a.write=q,a.inflate_flush(b,c);h--;m|=(b.next_in[n++]&255)<<l;l+=8}d=3*(this.tree_index+(m&k[d]));m>>=this.tree[d+1];l-=this.tree[d+1];g=this.tree[d];if(0!=(g&16)){this.get=g&15;this.dist=this.tree[d+2];this.mode=4;break}if(0==(g&64)){this.need=g;this.tree_index=d/3+this.tree[d+2];break}this.mode=9;b.msg="invalid distance code";c=-3;a.bitb=m;a.bitk=l;b.avail_in=h;b.total_in+=n-b.next_in_index;b.next_in_index=
n;a.write=q;return a.inflate_flush(b,c);case 4:for(d=this.get;l<d;){if(0!=h)c=f;else return a.bitb=m,a.bitk=l,b.avail_in=h,b.total_in+=n-b.next_in_index,b.next_in_index=n,a.write=q,a.inflate_flush(b,c);h--;m|=(b.next_in[n++]&255)<<l;l+=8}this.dist+=m&k[d];m>>=d;l-=d;this.mode=5;case 5:for(d=q-this.dist;0>d;)d+=a.end;for(;0!=this.len;){if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,c=a.inflate_flush(b,c),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&
(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=m,a.bitk=l,b.avail_in=h,b.total_in+=n-b.next_in_index,b.next_in_index=n,a.write=q,a.inflate_flush(b,c);a.window[q++]=a.window[d++];r--;d==a.end&&(d=0);this.len--}this.mode=0;break;case 6:if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,c=a.inflate_flush(b,c),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=m,a.bitk=l,b.avail_in=h,b.total_in+=
n-b.next_in_index,b.next_in_index=n,a.write=q,a.inflate_flush(b,c);c=f;a.window[q++]=this.lit;r--;this.mode=0;break;case 7:7<l&&(l-=8,h++,n--);a.write=q;c=a.inflate_flush(b,c);q=a.write;if(a.read!=a.write)return a.bitb=m,a.bitk=l,b.avail_in=h,b.total_in+=n-b.next_in_index,b.next_in_index=n,a.write=q,a.inflate_flush(b,c);this.mode=8;case 8:return c=p,a.bitb=m,a.bitk=l,b.avail_in=h,b.total_in+=n-b.next_in_index,b.next_in_index=n,a.write=q,a.inflate_flush(b,c);case 9:return c=-3,a.bitb=m,a.bitk=l,b.avail_in=
h,b.total_in+=n-b.next_in_index,b.next_in_index=n,a.write=q,a.inflate_flush(b,c);default:return c=-2,a.bitb=m,a.bitk=l,b.avail_in=h,b.total_in+=n-b.next_in_index,b.next_in_index=n,a.write=q,a.inflate_flush(b,c)}};l.prototype.free=function(a){};l.prototype.inflate_fast=function(a,b,c,d,g,m,l,n){var h,q,r,t,s,u,v,w,y,E,B,F;u=n.next_in_index;v=n.avail_in;t=l.bitb;s=l.bitk;w=l.write;y=w<l.read?l.read-w-1:l.end-w;a=k[a];E=k[b];do{for(;20>s;)v--,t|=(n.next_in[u++]&255)<<s,s+=8;h=t&a;q=c;r=d;F=3*(r+h);if(0==
(b=q[F]))t>>=q[F+1],s-=q[F+1],l.window[w++]=q[F+2],y--;else{do{t>>=q[F+1];s-=q[F+1];if(0!=(b&16)){b&=15;B=q[F+2]+(t&k[b]);t>>=b;for(s-=b;15>s;)v--,t|=(n.next_in[u++]&255)<<s,s+=8;h=t&E;q=g;r=m;F=3*(r+h);b=q[F];do if(t>>=q[F+1],s-=q[F+1],0!=(b&16)){for(b&=15;s<b;)v--,t|=(n.next_in[u++]&255)<<s,s+=8;h=q[F+2]+(t&k[b]);t>>=b;s-=b;y-=B;if(w>=h)h=w-h,l.window[w++]=l.window[h++],l.window[w++]=l.window[h++],B-=2;else{h=w-h;do h+=l.end;while(0>h);b=l.end-h;if(B>b){B-=b;if(0<w-h&&b>w-h){do l.window[w++]=l.window[h++];
while(0!=--b)}else C(l.window,h,l.window,w,b),w+=b;h=0}}do l.window[w++]=l.window[h++];while(0!=--B);break}else if(0==(b&64))h+=q[F+2],h+=t&k[b],F=3*(r+h),b=q[F];else return n.msg="invalid distance code",B=n.avail_in-v,B=s>>3<B?s>>3:B,v+=B,u-=B,s-=B<<3,l.bitb=t,l.bitk=s,n.avail_in=v,n.total_in+=u-n.next_in_index,n.next_in_index=u,l.write=w,-3;while(1);break}if(0==(b&64)){if(h+=q[F+2],h+=t&k[b],F=3*(r+h),0==(b=q[F])){t>>=q[F+1];s-=q[F+1];l.window[w++]=q[F+2];y--;break}}else{if(0!=(b&32))return B=n.avail_in-
v,B=s>>3<B?s>>3:B,v+=B,u-=B,s-=B<<3,l.bitb=t,l.bitk=s,n.avail_in=v,n.total_in+=u-n.next_in_index,n.next_in_index=u,l.write=w,p;n.msg="invalid literal/length code";B=n.avail_in-v;B=s>>3<B?s>>3:B;v+=B;u-=B;s-=B<<3;l.bitb=t;l.bitk=s;n.avail_in=v;n.total_in+=u-n.next_in_index;n.next_in_index=u;l.write=w;return-3}}while(1)}}while(258<=y&&10<=v);B=n.avail_in-v;B=s>>3<B?s>>3:B;u-=B;l.bitb=t;l.bitk=s-(B<<3);n.avail_in=v+B;n.total_in+=u-n.next_in_index;n.next_in_index=u;l.write=w;return f};t.prototype.huft_build=
function(b,c,d,g,k,l,m,n,h,p,r){var t,s,u,v,w,y,B,E,F;y=0;s=d;do this.c[b[c+y]]++,y++,s--;while(0!=s);if(this.c[0]==d)return m[0]=-1,n[0]=0,f;w=n[0];for(u=1;15>=u&&0==this.c[u];u++);v=u;w<u&&(w=u);for(s=15;0!=s&&0==this.c[s];s--);p=s;w>s&&(w=s);n[0]=w;for(n=1<<u;u<s;u++,n<<=1)if(0>(n-=this.c[u]))return-3;if(0>(n-=this.c[s]))return-3;this.c[s]+=n;this.x[1]=u=0;y=1;for(B=2;0!=--s;)this.x[B]=u+=this.c[y],B++,y++;y=s=0;do 0!=(u=b[c+y])&&(this.v[this.x[u]++]=s),y++;while(++s<d);d=this.x[p];y=this.x[0]=
s=0;c=-1;E=-w;for(F=B=this.u[0]=0;v<=p;v++)for(b=this.c[v];0!=b--;){for(;v>E+w;){c++;E+=w;F=p-E;F=F>w?w:F;if((t=1<<(u=v-E))>b+1&&(t-=b+1,B=v,u<F))for(;++u<F&&!((t<<=1)<=this.c[++B]);)t-=this.c[B];F=1<<u;if(this.hn[0]+F>a)return-3;this.u[c]=B=this.hn[0];this.hn[0]+=F;0!=c?(this.x[c]=s,this.r[0]=u,this.r[1]=w,u=s>>>E-w,this.r[2]=B-this.u[c-1]-u,C(this.r,0,h,3*(this.u[c-1]+u),3)):m[0]=B}this.r[1]=v-E;y>=d?this.r[0]=192:r[y]<g?(this.r[0]=256>this.v[y]?0:96,this.r[2]=this.v[y++]):(this.r[0]=l[this.v[y]-
g]+16+64,this.r[2]=k[this.v[y++]-g]);t=1<<v-E;for(u=s>>>E;u<F;u+=t)C(this.r,0,h,3*(B+u),3);for(u=1<<v-1;0!=(s&u);u>>>=1)s^=u;s^=u;for(u=(1<<E)-1;(s&u)!=this.x[c];)c--,E-=w,u=(1<<E)-1}return 0!=n&&1!=p?q:f};t.prototype.inflate_trees_bits=function(a,b,c,d,f){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(-3==a)f.msg="oversubscribed dynamic bit lengths tree";else if(a==q||0==b[0])f.msg="incomplete dynamic bit lengths tree",a=-3;return a};t.prototype.inflate_trees_dynamic=
function(a,b,c,d,g,k,l,m,h){this.initWorkArea(288);this.hn[0]=0;k=this.huft_build(c,0,a,257,B,w,k,d,m,this.hn,this.v);if(k!=f||0==d[0])return-3==k?h.msg="oversubscribed literal/length tree":-4!=k&&(h.msg="incomplete literal/length tree",k=-3),k;this.initWorkArea(288);k=this.huft_build(c,a,b,0,I,y,l,g,m,this.hn,this.v);return k!=f||0==g[0]&&257<a?(-3==k?h.msg="oversubscribed distance tree":k==q?(h.msg="incomplete distance tree",k=-3):-4!=k&&(h.msg="empty distance tree with lengths",k=-3),k):f};t.prototype.initWorkArea=
function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;C(this.c,0,this.u,0,15);C(this.c,0,this.x,0,16)};var L="function"===typeof(new Uint8Array(1)).subarray;"undefined"!==typeof v&&(v.exports={inflateBuffer:E,arrayCopy:C})},{}]},{},[17]);
